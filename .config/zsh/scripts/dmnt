#!/bin/zsh
# Gives a dmenu prompt to mount disk/drives. If found in /etc/fstab, it'll be mounted; otherwise, you'll be prompted to give a mountpoint from already existing directories. 
# until [[ -n ${w} ]]; do; w=$(xwininfo -name 'dmnt' -int | perl -ne 's/.*?Window id: ([0-9]+) ".*$/$1/ && print') 2>/dev/null; done;
case $(printf "mount\numount" | dmenu -i -p '..?') in
'mount') 
    a=(${(f)"$(lsblk -nlpo 'name,label,type,size,uuid,state,mountpoint' 2>/dev/null | /bin/grep -Pv '/home$|/boot$|/$|SWAP')"});
    s=$(printf "%s\n" ${(@)a} | dmenu -i -p 'mount..?' -l ${#a} | /bin/grep -oP '^[\w/]+') || return 1;
    mount ${s} 2&>/dev/null && return 0;
    while true; do c=$(ls -ap | /bin/grep -P '^(?!\./$).+/$' | dmenu -i -p "$(pwd)") || break; cd ${c}; done;
    [ "$(printf "No\\nYes" | dmenu -i -p "mount ${s} to $(pwd)?" -l 2)" = "Yes" ] && mount ${s} $(pwd);;
'umount') 
    a=(${(f)"$(findmnt --real -nlo 'target,source,fstype')"});
    s=$(printf "%s\n" ${(@)a} | dmenu -i -l ${#a} -p 'umount..?' | /bin/grep -oP '^[\w/]+') || return 1;
    [ "$(printf "No\\nYes" | dmenu -i -p "Unmount ${s}?" -l 2)" = "Yes" ] && umount ${s};;
esac;

#!/bin/zsh
emulate -LR zsh;
# { which zsh && which surfraw && which rdrview && which elinks && which fzf } &>/dev/null || return 2;
[[ -t 0 ]] || return 1;
typeset elvi cmd;
cmd='elinks -dump -no-numbering'"${1:+ -no-references}"; # any arg to srr to display href vals

# a=$(fzf -i +m --reverse --border=horizontal <<< ${(F)"$(surfraw -elvi | tail -n +2 | cut -s -f 1)"}) || return 0;
elvi=$(fzf -i +m --reverse --border=horizontal < ~/.config/surfraw/cache) || return 0;
[[ -n ${elvi} ]] || return;
fzf --phony --reverse --border=horizontal --bind=alt-/:toggle-preview,alt-\[:preview-up,alt-\':preview-down --preview="surfraw ${elvi} -p '{q}' | xargs -d '\n' rdrview -B \"${cmd}\"" --preview-window=99%:down:sharp --header="${(C)elvi}" <<< '';
rm -rf /tmp/*(/L80N) ~/.elinks/cookie*(N) &>/dev/null;

 unset file ext files dir; typeset file ext dir; typeset -a files; typeset -i q L; dir=${$(pwd):a:t}; ext=$(printf '%s\n' *(:e) | uniq -c | sort -rk1 | head -n 1 | pcre2grep -o1 '^\s*\d+\s+(\S+)$'); [[ -n *{png,jpg,gif,jpeg}(#qN) ]] || { tageditor -e cover -f "$(printf '%s\n' *${ext}(.DN) | head -n 1)" > cover.png; rm *.png(.L0) }; files=(*.${ext}(.DN)); l=${(c)#$(printf '%s\n' * | wc -l)}; ((${#files}>1)) && {printf '#EXTM3U\n' > 0.m3u; for file ( ${files} ) { printf "#EXTINF: #%.${L}d\n%s\n" $((++q)) ${file} >> 0.m3u } } 
 unset file ext files dur start; typeset file ext; typeset -a files; typeset -i dur start; file=${$(pwd):a:t}; [[ ${file} =~ \' ]] && { cd ..; mv ${file} "${file//'/_}"; cd "${file//'/_}" || return 123 }; for file ( *(.DN) ) { [[ ${file} =~ \' ]] && { mv -v ${file} "${file//'/_}" } }; ext=$(printf '%s\n' *(:e) | uniq -c | sort -rk1 | head -n 1 | pcre2grep -o1 '^\s*\d+\s+(\S+)$'); [[ -n *{png,jpg,gif,jpeg}(#qN) ]] || { tageditor -e cover -f "$(printf '%s\n' *${ext}(.DN) | head -n 1)" > cover.png }; files=(*.${ext}(.DN:a)); ((${#files}>1)) && { printf ';FFMETADATA1\n' > ffmetadata; for file ( ${files} ) { dur=$(($(ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 ${file}) * 1000000000)); printf '[CHAPTER]\nSTART=%s\nEND=%s\ntitle=%s\n' ${start} $((start + dur)) ${${file:t}%.*} >> ffmetadata; start=$((start + dur + 1000000000)) } }; ((${#files}>1)) && { ffmpeg -f concat -safe 0 -i <(printf "file '%s'\n" ${files}) -i ffmetadata -c copy all.${ext} && rm ${files} && beep -f 200 -d 50 -r 2 } 

 unset file ext files dur start; typeset file ext; typeset -a files; typeset -i dur start; for file ( *(.DN) ) { [[ $file =~ \' ]] && { mv -v $d "${file//'/_}" } }; ext=$(printf '%s\n' *(:e) | uniq -c | sort -rk1 | head -n 1 | pcre2grep -o1 '^\s*\d+\s+(\S+)$'); files=(*.${ext}(.DN:a)); ((${#files}>1)) && { printf ';FFMETADATA1\n' > ffmetadata; for file ( ${files} ) { dur=$(($(ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 ${file}) * 1000000000)); printf '[CHAPTER]\nSTART=%s\nEND=%s\n' ${start} $((start + dur)) >> ffmetadata; start=$((start + dur + 1)) } }; ((${#files}>1)) && { ffmpeg -f concat -safe 0 -i <(printf "file '%s'\n" ${files}) -i ffmetadata -c copy all.${ext} && rm ${a} && beep -f 200 -d 50 -r 2 }

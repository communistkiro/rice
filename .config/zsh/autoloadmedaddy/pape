#!/bin/sh
# pape setter
pape() {
local a s c o w f;
while getopts 'h' o; do case $o in h) ;& *) 
less -F <<HEREDOC
NAME
    pape - wallpaper setter

SYNOPSIS
    pape 

DESCRIPTION
    Browse your filesystem, looking for image formats, choose one or hit enter to get a 
    random selection from current directory, change feh's background setting options with 
    'bgopt', exit when you're content.
    
BUGS
    Please report any aberrant behavior or bugs to vlg@tutamail.com


HEREDOC
return 1;;esac; done;

a=( # feh bg options
  '--bg-center'
  '--bg-fill'
  '--bg-max'
  '--bg-scale'
  '--bg-tile'
);
c=~/im; # starting dir & file/folder choice
cd $c;
until [[ -n $w ]]; do; w=$(xwininfo -name 'pape' -int | perl -ne 's/.*?Window id: ([0-9]+) ".*$/$1/ && print') 2>/dev/null; done;
while true; do;
    [ -d $c ] && f=($(ls -ap $c | grep -v '/')) && d=($(ls -ap $c | grep '/' | grep -Pv '^\./'));
    c=$(printf "%s\n" "${d[@]}" "${f[@]}" "bgopts" "rand" | tr -s '\n' | dmenu -i -l 10 -p $(pwd) -w $w ) || break;
    [ -d $c ] && cd $c && c=.;
    [ -f $c ] && (feh ${s-${a[4]}} $c || break);
    [ $c = "bgopts" ] && s=$(printf "%s\n" "${a[@]}" | tr -s '\n' | dmenu -i -l ${#a} -p 'bg image options' -w $w) && feh $s $(perl -ne 's/.* [[:punct:]](.+)[[:punct:]]/$1/ && print' ~/.fehbg);
    [ $c = "rand" ] && (feh ${s-${a[4]}} $(ls -ap | grep -v '/' | shuf -n 1) || break);
done
}
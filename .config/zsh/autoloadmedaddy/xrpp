#!/bin/zsh
# ADD NEW LINKS (FROM CTEBCM PAGE, FROM BANDCAMP EMBEDDED PLAYERS)
function xrpp () {
  for a in $(lynx -listonly -dump $1); do;
    t1=$(mktemp /tmp/XXXXXX); t2=$(mktemp /tmp/XXXXXX);
    # EMBEDDED BC PLAYERS
    [[ ${a} =~ 'EmbeddedPlayer' ]] && lynx -listonly -dump ${a} | pre -o 'http.*/album/[\w-]+' >> ${t1};
    # DIRECT BC
    [[ ${a} =~ 'bandcamp.com(/album/)|(/track/)' ]] && echo ${${(S)a/*http/http}%%\?*} >> ${t1};
    # SC??
    # [[ ${a} =~ 'soundcloud' ]] && echo ${${(S)a/*http/http}%%\?*} >> /tmp/a1;
    # DZR??
    # [[ ${a} =~ 'deezer' ]] && echo ${${(S)a/*http/http}%%\?*} >> /tmp/a1;
  done;
  # REMOVE ALREADY TO-BE-DL'D AND ALREADY DL'D URLS; NO SPOTIFY EXTACTOR YET
  sort -u ${t1} | sed '/spotify/d' > ${t2};
  diff ~/nm/newlinks ${t2} | pre '^> ' | sed -r 's/^> //' > ${t1};
  diff ~/nm/oldlinks ${t1} | pre '^> ' | sed -r 's/^> //' > ${t2};
  diff ~/nm/soon ${t2} | pre '^> ' | sed -r 's/^> //' > ${t1};
  cat ~/nm/newlinks >> ${t1};
  sort -u ${t1} > ~/nm/newlinks;
  # cat ${t1} | sort -u > ~/nm/newlinks
  rm ${t1} ${t2};
}


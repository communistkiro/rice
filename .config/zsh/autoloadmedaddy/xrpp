#!/bin/zsh
# ADD NEW LINKS (FROM CTEBCM PAGE, FROM BANDCAMP EMBEDDED PLAYERS)
function xrpp () {
  sudo rm -f /tmp/1;
  for a in $(lynx -listonly -dump $1); do;
    # EMBEDDED BC PLAYERS
    [[ ${a} =~ 'EmbeddedPlayer' ]] && lynx -listonly -dump ${a} | pre -o 'http.*/album/[\w-]+' >> /tmp/1;
    # DIRECT BC
    [[ ${a} =~ 'bandcamp.com(/album/)|(/track/)' ]] && echo ${${(S)a/*http/http}%%\?*} >> /tmp/1;
    # SC??
    # [[ ${a} =~ 'soundcloud' ]] && echo ${${(S)a/*http/http}%%\?*} >> /tmp/a1;
    # DZR??
    # [[ ${a} =~ 'deezer' ]] && echo ${${(S)a/*http/http}%%\?*} >> /tmp/a1;
  done;
  # REMOVE ALREADY TO-BE-DL'D AND ALREADY DL'D URLS; NO SPOTIFY EXTACTOR YET
  sort -u /tmp/1 | sed '/spotify/d' > /tmp/2;
  diff ~/nm/newlinks /tmp/2 | pre '^> ' | sed -r 's/^> //' > /tmp/1;
  diff ~/nm/oldlinks /tmp/1 | pre '^> ' | sed -r 's/^> //' > /tmp/2;
  diff ~/nm/soon /tmp/2 | pre '^> ' | sed -r 's/^> //' > /tmp/1;
  cat ~/nm/newlinks >> /tmp/1;
  sort -u /tmp/1 > ~/nm/newlinks;
  # cat /tmp/1 | sort -u > ~/nm/newlinks
}


!function(e){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[v][e]}})}function r(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new o(t)}function o(e){Object.defineProperty(this,v,{value:e}),Object.keys(e).forEach(t,this)}function n(e){return"@node/"===e.substr(0,6)?c(e,r(m(e.substr(6)))):p[e]}function u(e){var t=n(e);if(!t)throw new Error('Module "'+e+'" expected, but not contained in build.');if(t.module)return t.module;var r=t.linkRecord;return function i(e,t){if(!t.depLoads){t.declare&&d(e,t),t.depLoads=[];for(var r=0;r<t.deps.length;r++){var o=n(t.deps[r]);t.depLoads.push(o),o.linkRecord&&i(o,o.linkRecord);var u=t.setters&&t.setters[r];u&&(u(o.module||o.linkRecord.moduleObj),o.importerSetters.push(u))}return e}}(t,r),a(t,r,[]),t.module}function d(t,r){var o=r.moduleObj,n=t.importerSetters,u=!1,i=r.declare.call(e,function(e,t){if(!u){if("object"==typeof e)for(var r in e)"__useDefault"!==r&&(o[r]=e[r]);else o[e]=t;u=!0;for(var i=0;i<n.length;i++)n[i](o);return u=!1,t}},{id:t.key});"function"!=typeof i?(r.setters=i.setters,r.execute=i.execute):(r.setters=[],r.execute=i)}function l(e,t,r){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:r,setters:void 0,execute:void 0,moduleObj:{}}}}function f(e,t,r,o){var n={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:o,executingRequire:r,moduleObj:{default:n,__useDefault:n},setters:void 0}}}function a(t,r,n){if(n.push(t),t.module)return t.module;if(r.setters){for(var i=0;i<r.deps.length;i++){var d=r.depLoads[i],l=d.linkRecord;l&&-1===n.indexOf(d)&&a(d,l,l.setters?n:[])}r.execute.call(y)}else{var f={id:t.key},c=r.moduleObj;Object.defineProperty(f,"exports",{configurable:!0,set:function(e){c.default=c.__useDefault=e},get:function(){return c.__useDefault}});var p=function(e,t,r){return function(o){for(var n=0;n<e.length;n++)if(e[n]===o){var u,i=t[n],d=i.linkRecord;return"__useDefault"in(u=d?-1===r.indexOf(i)?a(i,d,r):d.moduleObj:i.module)?u.__useDefault:u}}}(r.deps,r.depLoads,n);if(!r.executingRequire)for(i=0;i<r.deps.length;i++)p(r.deps[i]);var v=r.execute.call(e,p,c.__useDefault,f);void 0!==v?c.default=c.__useDefault=v:f.exports!==c.__useDefault&&(c.default=c.__useDefault=f.exports);var m=c.__useDefault;if(m&&m.__esModule)for(var b in m)Object.hasOwnProperty.call(m,b)&&(c[b]=m[b])}f=t.module=new o(r.moduleObj);if(!r.setters)for(i=0;i<t.importerSetters.length;i++)t.importerSetters[i](f);return f}function c(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},v="undefined"!=typeof Symbol?Symbol():"@@baseObject";o.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(o.prototype[Symbol.toStringTag]="Module");var m="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require,y={};return Object.freeze&&Object.freeze(y),function(e,t,n,i){return function(d){d(function(d){var s={_nodeRequire:m,register:l,registerDynamic:f,registry:{get:function(e){return p[e].module},set:c},newModule:function(e){return new o(e)}};c("@empty",new o({}));for(var a=0;a<t.length;a++)c(t[a],r(arguments[a]));i(s);var v=u(e[0]);if(e.length>1)for(a=1;a<e.length;a++)u(e[a]);return n?v.__useDefault:(v instanceof o&&Object.defineProperty(v,"__esModule",{value:!0}),v)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],[],!1,function($__System){this.require,this.exports,this.module;$__System.registerDynamic("b",["c","d","e"],!0,function($__require,exports,module){this||self;$__require("c"),$__require("d"),module.exports=$__require("e").Symbol}),$__System.registerDynamic("f",["10","11"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.S,"Array",{isArray:$__require("11")})}),$__System.registerDynamic("12",["13","10","14","15","16","17","18","19","1a"],!0,function($__require,exports,module){"use strict";this||self;var ctx=$__require("13"),$export=$__require("10"),toObject=$__require("14"),call=$__require("15"),isArrayIter=$__require("16"),toLength=$__require("17"),createProperty=$__require("18"),getIterFn=$__require("19");$export($export.S+$export.F*!$__require("1a")(function(iter){Array.from(iter)}),"Array",{from:function(arrayLike){var length,result,step,iterator,O=toObject(arrayLike),C="function"==typeof this?this:Array,aLen=arguments.length,mapfn=aLen>1?arguments[1]:void 0,mapping=void 0!==mapfn,index=0,iterFn=getIterFn(O);if(mapping&&(mapfn=ctx(mapfn,aLen>2?arguments[2]:void 0,2)),null==iterFn||C==Array&&isArrayIter(iterFn))for(result=new C(length=toLength(O.length));length>index;index++)createProperty(result,index,mapping?mapfn(O[index],index):O[index]);else for(iterator=iterFn.call(O),result=new C;!(step=iterator.next()).done;index++)createProperty(result,index,mapping?call(iterator,mapfn,[step.value,index],!0):step.value);return result.length=index,result}})}),$__System.registerDynamic("18",["1b","1c"],!0,function($__require,exports,module){"use strict";this||self;var $defineProperty=$__require("1b"),createDesc=$__require("1c");module.exports=function(object,index,value){index in object?$defineProperty.f(object,index,createDesc(0,value)):object[index]=value}}),$__System.registerDynamic("1d",["10","18","1e"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),createProperty=$__require("18");$export($export.S+$export.F*$__require("1e")(function(){function F(){}return!(Array.of.call(F)instanceof F)}),"Array",{of:function(){for(var index=0,aLen=arguments.length,result=new("function"==typeof this?this:Array)(aLen);aLen>index;)createProperty(result,index,arguments[index++]);return result.length=aLen,result}})}),$__System.registerDynamic("1f",["10","20","21","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),toIObject=$__require("20"),arrayJoin=[].join;$export($export.P+$export.F*($__require("21")!=Object||!$__require("22")(arrayJoin)),"Array",{join:function(separator){return arrayJoin.call(toIObject(this),void 0===separator?",":separator)}})}),$__System.registerDynamic("23",["10","24","25","26","17","1e"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),html=$__require("24"),cof=$__require("25"),toAbsoluteIndex=$__require("26"),toLength=$__require("17"),arraySlice=[].slice;$export($export.P+$export.F*$__require("1e")(function(){html&&arraySlice.call(html)}),"Array",{slice:function(begin,end){var len=toLength(this.length),klass=cof(this);if(end=void 0===end?len:end,"Array"==klass)return arraySlice.call(this,begin,end);for(var start=toAbsoluteIndex(begin,len),upTo=toAbsoluteIndex(end,len),size=toLength(upTo-start),cloned=new Array(size),i=0;i<size;i++)cloned[i]="String"==klass?this.charAt(start+i):this[start+i];return cloned}})}),$__System.registerDynamic("27",["10","28","14","1e","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),aFunction=$__require("28"),toObject=$__require("14"),fails=$__require("1e"),$sort=[].sort,test=[1,2,3];$export($export.P+$export.F*(fails(function(){test.sort(void 0)})||!fails(function(){test.sort(null)})||!$__require("22")($sort)),"Array",{sort:function(comparefn){return void 0===comparefn?$sort.call(toObject(this)):$sort.call(toObject(this),aFunction(comparefn))}})}),$__System.registerDynamic("29",["10","2a","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$forEach=$__require("2a")(0),STRICT=$__require("22")([].forEach,!0);$export($export.P+$export.F*!STRICT,"Array",{forEach:function(callbackfn){return $forEach(this,callbackfn,arguments[1])}})}),$__System.registerDynamic("2b",["10","2a","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$map=$__require("2a")(1);$export($export.P+$export.F*!$__require("22")([].map,!0),"Array",{map:function(callbackfn){return $map(this,callbackfn,arguments[1])}})}),$__System.registerDynamic("2c",["10","2a","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$filter=$__require("2a")(2);$export($export.P+$export.F*!$__require("22")([].filter,!0),"Array",{filter:function(callbackfn){return $filter(this,callbackfn,arguments[1])}})}),$__System.registerDynamic("2d",["10","2a","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$some=$__require("2a")(3);$export($export.P+$export.F*!$__require("22")([].some,!0),"Array",{some:function(callbackfn){return $some(this,callbackfn,arguments[1])}})}),$__System.registerDynamic("2e",["10","2a","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$every=$__require("2a")(4);$export($export.P+$export.F*!$__require("22")([].every,!0),"Array",{every:function(callbackfn){return $every(this,callbackfn,arguments[1])}})}),$__System.registerDynamic("2f",["10","30","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$reduce=$__require("30");$export($export.P+$export.F*!$__require("22")([].reduce,!0),"Array",{reduce:function(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],!1)}})}),$__System.registerDynamic("30",["28","14","21","17"],!0,function($__require,exports,module){this||self;var aFunction=$__require("28"),toObject=$__require("14"),IObject=$__require("21"),toLength=$__require("17");module.exports=function(that,callbackfn,aLen,memo,isRight){aFunction(callbackfn);var O=toObject(that),self=IObject(O),length=toLength(O.length),index=isRight?length-1:0,i=isRight?-1:1;if(aLen<2)for(;;){if(index in self){memo=self[index],index+=i;break}if(index+=i,isRight?index<0:length<=index)throw TypeError("Reduce of empty array with no initial value")}for(;isRight?index>=0:length>index;index+=i)index in self&&(memo=callbackfn(memo,self[index],index,O));return memo}}),$__System.registerDynamic("31",["10","30","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$reduce=$__require("30");$export($export.P+$export.F*!$__require("22")([].reduceRight,!0),"Array",{reduceRight:function(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],!0)}})}),$__System.registerDynamic("32",["10","33","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$indexOf=$__require("33")(!1),$native=[].indexOf,NEGATIVE_ZERO=!!$native&&1/[1].indexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!$__require("22")($native)),"Array",{indexOf:function(searchElement){return NEGATIVE_ZERO?$native.apply(this,arguments)||0:$indexOf(this,searchElement,arguments[1])}})}),$__System.registerDynamic("22",["1e"],!0,function($__require,exports,module){"use strict";this||self;var fails=$__require("1e");module.exports=function(method,arg){return!!method&&fails(function(){arg?method.call(null,function(){},1):method.call(null)})}}),$__System.registerDynamic("34",["10","20","35","17","22"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),toIObject=$__require("20"),toInteger=$__require("35"),toLength=$__require("17"),$native=[].lastIndexOf,NEGATIVE_ZERO=!!$native&&1/[1].lastIndexOf(1,-0)<0;$export($export.P+$export.F*(NEGATIVE_ZERO||!$__require("22")($native)),"Array",{lastIndexOf:function(searchElement){if(NEGATIVE_ZERO)return $native.apply(this,arguments)||0;var O=toIObject(this),length=toLength(O.length),index=length-1;for(arguments.length>1&&(index=Math.min(index,toInteger(arguments[1]))),index<0&&(index=length+index);index>=0;index--)if(index in O&&O[index]===searchElement)return index||0;return-1}})}),$__System.registerDynamic("36",["14","26","17"],!0,function($__require,exports,module){"use strict";this||self;var toObject=$__require("14"),toAbsoluteIndex=$__require("26"),toLength=$__require("17");module.exports=[].copyWithin||function(target,start){var O=toObject(this),len=toLength(O.length),to=toAbsoluteIndex(target,len),from=toAbsoluteIndex(start,len),end=arguments.length>2?arguments[2]:void 0,count=Math.min((void 0===end?len:toAbsoluteIndex(end,len))-from,len-to),inc=1;for(from<to&&to<from+count&&(inc=-1,from+=count-1,to+=count-1);count-- >0;)from in O?O[to]=O[from]:delete O[to],to+=inc,from+=inc;return O}}),$__System.registerDynamic("37",["10","36","38"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.P,"Array",{copyWithin:$__require("36")}),$__require("38")("copyWithin")}),$__System.registerDynamic("39",["14","26","17"],!0,function($__require,exports,module){"use strict";this||self;var toObject=$__require("14"),toAbsoluteIndex=$__require("26"),toLength=$__require("17");module.exports=function(value){for(var O=toObject(this),length=toLength(O.length),aLen=arguments.length,index=toAbsoluteIndex(aLen>1?arguments[1]:void 0,length),end=aLen>2?arguments[2]:void 0,endPos=void 0===end?length:toAbsoluteIndex(end,length);endPos>index;)O[index++]=value;return O}}),$__System.registerDynamic("3a",["10","39","38"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.P,"Array",{fill:$__require("39")}),$__require("38")("fill")}),$__System.registerDynamic("3b",["10","2a","38"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$find=$__require("2a")(5),forced=!0;"find"in[]&&Array(1).find(function(){forced=!1}),$export($export.P+$export.F*forced,"Array",{find:function(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:void 0)}}),$__require("38")("find")}),$__System.registerDynamic("3c",["3d","11","3e"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d"),isArray=$__require("11"),SPECIES=$__require("3e")("species");module.exports=function(original){var C;return isArray(original)&&("function"!=typeof(C=original.constructor)||C!==Array&&!isArray(C.prototype)||(C=void 0),isObject(C)&&null===(C=C[SPECIES])&&(C=void 0)),void 0===C?Array:C}}),$__System.registerDynamic("3f",["3c"],!0,function($__require,exports,module){this||self;var speciesConstructor=$__require("3c");module.exports=function(original,length){return new(speciesConstructor(original))(length)}}),$__System.registerDynamic("2a",["13","21","14","17","3f"],!0,function($__require,exports,module){this||self;var ctx=$__require("13"),IObject=$__require("21"),toObject=$__require("14"),toLength=$__require("17"),asc=$__require("3f");module.exports=function(TYPE,$create){var IS_MAP=1==TYPE,IS_FILTER=2==TYPE,IS_SOME=3==TYPE,IS_EVERY=4==TYPE,IS_FIND_INDEX=6==TYPE,NO_HOLES=5==TYPE||IS_FIND_INDEX,create=$create||asc;return function($this,callbackfn,that){for(var val,res,O=toObject($this),self=IObject(O),f=ctx(callbackfn,that,3),length=toLength(self.length),index=0,result=IS_MAP?create($this,length):IS_FILTER?create($this,0):void 0;length>index;index++)if((NO_HOLES||index in self)&&(res=f(val=self[index],index,O),TYPE))if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return!0;case 5:return val;case 6:return index;case 2:result.push(val)}else if(IS_EVERY)return!1;return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result}}}),$__System.registerDynamic("40",["10","2a","38"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$find=$__require("2a")(6),KEY="findIndex",forced=!0;KEY in[]&&Array(1)[KEY](function(){forced=!1}),$export($export.P+$export.F*forced,"Array",{findIndex:function(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:void 0)}}),$__require("38")(KEY)}),$__System.registerDynamic("41",["42"],!0,function($__require,exports,module){this||self;$__require("42")("Array")}),$__System.registerDynamic("43",["44","f","12","1d","1f","23","27","29","2b","2c","2d","2e","2f","31","32","34","37","3a","3b","40","41","45","e"],!0,function($__require,exports,module){this||self;$__require("44"),$__require("f"),$__require("12"),$__require("1d"),$__require("1f"),$__require("23"),$__require("27"),$__require("29"),$__require("2b"),$__require("2c"),$__require("2d"),$__require("2e"),$__require("2f"),$__require("31"),$__require("32"),$__require("34"),$__require("37"),$__require("3a"),$__require("3b"),$__require("40"),$__require("41"),$__require("45"),module.exports=$__require("e").Array}),$__System.registerDynamic("46",["10","33","38"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$includes=$__require("33")(!0);$export($export.P,"Array",{includes:function(el){return $includes(this,el,arguments.length>1?arguments[1]:void 0)}}),$__require("38")("includes")}),$__System.registerDynamic("47",["3e"],!0,function($__require,exports,module){this||self;exports.f=$__require("3e")}),$__System.registerDynamic("48",["49","e","4a","47","1b"],!0,function($__require,exports,module){global=this||self;var global=$__require("49"),core=$__require("e"),LIBRARY=$__require("4a"),wksExt=$__require("47"),defineProperty=$__require("1b").f;module.exports=function(name){var $Symbol=core.Symbol||(core.Symbol=LIBRARY?{}:global.Symbol||{});"_"==name.charAt(0)||name in $Symbol||defineProperty($Symbol,name,{value:wksExt.f(name)})}}),$__System.registerDynamic("4b",["4c","4d","4e"],!0,function($__require,exports,module){this||self;var getKeys=$__require("4c"),gOPS=$__require("4d"),pIE=$__require("4e");module.exports=function(it){var result=getKeys(it),getSymbols=gOPS.f;if(getSymbols)for(var key,symbols=getSymbols(it),isEnum=pIE.f,i=0;symbols.length>i;)isEnum.call(it,key=symbols[i++])&&result.push(key);return result}}),$__System.registerDynamic("11",["25"],!0,function($__require,exports,module){this||self;var cof=$__require("25");module.exports=Array.isArray||function(arg){return"Array"==cof(arg)}}),$__System.registerDynamic("c",["49","4f","50","10","51","52","1e","53","54","55","3e","47","48","4b","11","56","3d","14","20","57","1c","58","59","5a","4d","1b","4c","5b","4e","4a","5c"],!0,function($__require,exports,module){"use strict";global=this||self;var global=$__require("49"),has=$__require("4f"),DESCRIPTORS=$__require("50"),$export=$__require("10"),redefine=$__require("51"),META=$__require("52").KEY,$fails=$__require("1e"),shared=$__require("53"),setToStringTag=$__require("54"),uid=$__require("55"),wks=$__require("3e"),wksExt=$__require("47"),wksDefine=$__require("48"),enumKeys=$__require("4b"),isArray=$__require("11"),anObject=$__require("56"),isObject=$__require("3d"),toObject=$__require("14"),toIObject=$__require("20"),toPrimitive=$__require("57"),createDesc=$__require("1c"),_create=$__require("58"),gOPNExt=$__require("59"),$GOPD=$__require("5a"),$GOPS=$__require("4d"),$DP=$__require("1b"),$keys=$__require("4c"),gOPD=$GOPD.f,dP=$DP.f,gOPN=gOPNExt.f,$Symbol=global.Symbol,$JSON=global.JSON,_stringify=$JSON&&$JSON.stringify,HIDDEN=wks("_hidden"),TO_PRIMITIVE=wks("toPrimitive"),isEnum={}.propertyIsEnumerable,SymbolRegistry=shared("symbol-registry"),AllSymbols=shared("symbols"),OPSymbols=shared("op-symbols"),ObjectProto=Object.prototype,USE_NATIVE="function"==typeof $Symbol&&!!$GOPS.f,QObject=global.QObject,setter=!QObject||!QObject.prototype||!QObject.prototype.findChild,setSymbolDesc=DESCRIPTORS&&$fails(function(){return 7!=_create(dP({},"a",{get:function(){return dP(this,"a",{value:7}).a}})).a})?function(it,key,D){var protoDesc=gOPD(ObjectProto,key);protoDesc&&delete ObjectProto[key],dP(it,key,D),protoDesc&&it!==ObjectProto&&dP(ObjectProto,key,protoDesc)}:dP,wrap=function(tag){var sym=AllSymbols[tag]=_create($Symbol.prototype);return sym._k=tag,sym},isSymbol=USE_NATIVE&&"symbol"==typeof $Symbol.iterator?function(it){return"symbol"==typeof it}:function(it){return it instanceof $Symbol},$defineProperty=function(it,key,D){return it===ObjectProto&&$defineProperty(OPSymbols,key,D),anObject(it),key=toPrimitive(key,!0),anObject(D),has(AllSymbols,key)?(D.enumerable?(has(it,HIDDEN)&&it[HIDDEN][key]&&(it[HIDDEN][key]=!1),D=_create(D,{enumerable:createDesc(0,!1)})):(has(it,HIDDEN)||dP(it,HIDDEN,createDesc(1,{})),it[HIDDEN][key]=!0),setSymbolDesc(it,key,D)):dP(it,key,D)},$defineProperties=function(it,P){anObject(it);for(var key,keys=enumKeys(P=toIObject(P)),i=0,l=keys.length;l>i;)$defineProperty(it,key=keys[i++],P[key]);return it},$propertyIsEnumerable=function(key){var E=isEnum.call(this,key=toPrimitive(key,!0));return!(this===ObjectProto&&has(AllSymbols,key)&&!has(OPSymbols,key))&&(!(E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key])||E)},$getOwnPropertyDescriptor=function(it,key){if(it=toIObject(it),key=toPrimitive(key,!0),it!==ObjectProto||!has(AllSymbols,key)||has(OPSymbols,key)){var D=gOPD(it,key);return!D||!has(AllSymbols,key)||has(it,HIDDEN)&&it[HIDDEN][key]||(D.enumerable=!0),D}},$getOwnPropertyNames=function(it){for(var key,names=gOPN(toIObject(it)),result=[],i=0;names.length>i;)has(AllSymbols,key=names[i++])||key==HIDDEN||key==META||result.push(key);return result},$getOwnPropertySymbols=function(it){for(var key,IS_OP=it===ObjectProto,names=gOPN(IS_OP?OPSymbols:toIObject(it)),result=[],i=0;names.length>i;)!has(AllSymbols,key=names[i++])||IS_OP&&!has(ObjectProto,key)||result.push(AllSymbols[key]);return result};USE_NATIVE||(redefine(($Symbol=function(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor!");var tag=uid(arguments.length>0?arguments[0]:void 0),$set=function(value){this===ObjectProto&&$set.call(OPSymbols,value),has(this,HIDDEN)&&has(this[HIDDEN],tag)&&(this[HIDDEN][tag]=!1),setSymbolDesc(this,tag,createDesc(1,value))};return DESCRIPTORS&&setter&&setSymbolDesc(ObjectProto,tag,{configurable:!0,set:$set}),wrap(tag)}).prototype,"toString",function(){return this._k}),$GOPD.f=$getOwnPropertyDescriptor,$DP.f=$defineProperty,$__require("5b").f=gOPNExt.f=$getOwnPropertyNames,$__require("4e").f=$propertyIsEnumerable,$GOPS.f=$getOwnPropertySymbols,DESCRIPTORS&&!$__require("4a")&&redefine(ObjectProto,"propertyIsEnumerable",$propertyIsEnumerable,!0),wksExt.f=function(name){return wrap(wks(name))}),$export($export.G+$export.W+$export.F*!USE_NATIVE,{Symbol:$Symbol});for(var es6Symbols="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),j=0;es6Symbols.length>j;)wks(es6Symbols[j++]);for(var wellKnownSymbols=$keys(wks.store),k=0;wellKnownSymbols.length>k;)wksDefine(wellKnownSymbols[k++]);$export($export.S+$export.F*!USE_NATIVE,"Symbol",{for:function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function(sym){if(!isSymbol(sym))throw TypeError(sym+" is not a symbol!");for(var key in SymbolRegistry)if(SymbolRegistry[key]===sym)return key},useSetter:function(){setter=!0},useSimple:function(){setter=!1}}),$export($export.S+$export.F*!USE_NATIVE,"Object",{create:function(it,P){return void 0===P?_create(it):$defineProperties(_create(it),P)},defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});var FAILS_ON_PRIMITIVES=$fails(function(){$GOPS.f(1)});$export($export.S+$export.F*FAILS_ON_PRIMITIVES,"Object",{getOwnPropertySymbols:function(it){return $GOPS.f(toObject(it))}}),$JSON&&$export($export.S+$export.F*(!USE_NATIVE||$fails(function(){var S=$Symbol();return"[null]"!=_stringify([S])||"{}"!=_stringify({a:S})||"{}"!=_stringify(Object(S))})),"JSON",{stringify:function(it){for(var replacer,$replacer,args=[it],i=1;arguments.length>i;)args.push(arguments[i++]);if($replacer=replacer=args[1],(isObject(replacer)||void 0!==it)&&!isSymbol(it))return isArray(replacer)||(replacer=function(key,value){if("function"==typeof $replacer&&(value=$replacer.call(this,key,value)),!isSymbol(value))return value}),args[1]=replacer,_stringify.apply($JSON,args)}}),$Symbol.prototype[TO_PRIMITIVE]||$__require("5c")($Symbol.prototype,TO_PRIMITIVE,$Symbol.prototype.valueOf),setToStringTag($Symbol,"Symbol"),setToStringTag(Math,"Math",!0),setToStringTag(global.JSON,"JSON",!0)}),$__System.registerDynamic("5d",["10","58"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.S,"Object",{create:$__require("58")})}),$__System.registerDynamic("5e",["10","50","1b"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.S+$export.F*!$__require("50"),"Object",{defineProperty:$__require("1b").f})}),$__System.registerDynamic("5f",["10","50","60"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.S+$export.F*!$__require("50"),"Object",{defineProperties:$__require("60")})}),$__System.registerDynamic("61",["20","5a","62"],!0,function($__require,exports,module){this||self;var toIObject=$__require("20"),$getOwnPropertyDescriptor=$__require("5a").f;$__require("62")("getOwnPropertyDescriptor",function(){return function(it,key){return $getOwnPropertyDescriptor(toIObject(it),key)}})}),$__System.registerDynamic("63",["14","64","62"],!0,function($__require,exports,module){this||self;var toObject=$__require("14"),$getPrototypeOf=$__require("64");$__require("62")("getPrototypeOf",function(){return function(it){return $getPrototypeOf(toObject(it))}})}),$__System.registerDynamic("65",["14","4c","62"],!0,function($__require,exports,module){this||self;var toObject=$__require("14"),$keys=$__require("4c");$__require("62")("keys",function(){return function(it){return $keys(toObject(it))}})}),$__System.registerDynamic("5b",["66","67"],!0,function($__require,exports,module){this||self;var $keys=$__require("66"),hiddenKeys=$__require("67").concat("length","prototype");exports.f=Object.getOwnPropertyNames||function(O){return $keys(O,hiddenKeys)}}),$__System.registerDynamic("59",["20","5b"],!0,function($__require,exports,module){this||self;var toIObject=$__require("20"),gOPN=$__require("5b").f,toString={}.toString,windowNames="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];module.exports.f=function(it){return windowNames&&"[object Window]"==toString.call(it)?function(it){try{return gOPN(it)}catch(e){return windowNames.slice()}}(it):gOPN(toIObject(it))}}),$__System.registerDynamic("68",["62","59"],!0,function($__require,exports,module){this||self;$__require("62")("getOwnPropertyNames",function(){return $__require("59").f})}),$__System.registerDynamic("69",["3d","52","62"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d"),meta=$__require("52").onFreeze;$__require("62")("freeze",function($freeze){return function(it){return $freeze&&isObject(it)?$freeze(meta(it)):it}})}),$__System.registerDynamic("6a",["3d","52","62"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d"),meta=$__require("52").onFreeze;$__require("62")("seal",function($seal){return function(it){return $seal&&isObject(it)?$seal(meta(it)):it}})}),$__System.registerDynamic("6b",["3d","52","62"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d"),meta=$__require("52").onFreeze;$__require("62")("preventExtensions",function($preventExtensions){return function(it){return $preventExtensions&&isObject(it)?$preventExtensions(meta(it)):it}})}),$__System.registerDynamic("6c",["3d","62"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d");$__require("62")("isFrozen",function($isFrozen){return function(it){return!isObject(it)||!!$isFrozen&&$isFrozen(it)}})}),$__System.registerDynamic("6d",["3d","62"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d");$__require("62")("isSealed",function($isSealed){return function(it){return!isObject(it)||!!$isSealed&&$isSealed(it)}})}),$__System.registerDynamic("62",["10","e","1e"],!0,function($__require,exports,module){this||self;var $export=$__require("10"),core=$__require("e"),fails=$__require("1e");module.exports=function(KEY,exec){var fn=(core.Object||{})[KEY]||Object[KEY],exp={};exp[KEY]=exec(fn),$export($export.S+$export.F*fails(function(){fn(1)}),"Object",exp)}}),$__System.registerDynamic("6e",["3d","62"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d");$__require("62")("isExtensible",function($isExtensible){return function(it){return!!isObject(it)&&(!$isExtensible||$isExtensible(it))}})}),$__System.registerDynamic("4d",[],!0,function($__require,exports,module){this||self;exports.f=Object.getOwnPropertySymbols}),$__System.registerDynamic("6f",["50","4c","4d","4e","14","21","1e"],!0,function($__require,exports,module){"use strict";this||self;var DESCRIPTORS=$__require("50"),getKeys=$__require("4c"),gOPS=$__require("4d"),pIE=$__require("4e"),toObject=$__require("14"),IObject=$__require("21"),$assign=Object.assign;module.exports=!$assign||$__require("1e")(function(){var A={},B={},S=Symbol(),K="abcdefghijklmnopqrst";return A[S]=7,K.split("").forEach(function(k){B[k]=k}),7!=$assign({},A)[S]||Object.keys($assign({},B)).join("")!=K})?function(target,source){for(var T=toObject(target),aLen=arguments.length,index=1,getSymbols=gOPS.f,isEnum=pIE.f;aLen>index;)for(var key,S=IObject(arguments[index++]),keys=getSymbols?getKeys(S).concat(getSymbols(S)):getKeys(S),length=keys.length,j=0;length>j;)key=keys[j++],DESCRIPTORS&&!isEnum.call(S,key)||(T[key]=S[key]);return T}:$assign}),$__System.registerDynamic("70",["10","6f"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.S+$export.F,"Object",{assign:$__require("6f")})}),$__System.registerDynamic("71",["10","72"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.S,"Object",{is:$__require("72")})}),$__System.registerDynamic("73",["10","74"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.S,"Object",{setPrototypeOf:$__require("74").set})}),$__System.registerDynamic("75",["c","5d","5e","5f","61","63","65","68","69","6a","6b","6c","6d","6e","70","71","73","d","e"],!0,function($__require,exports,module){this||self;$__require("c"),$__require("5d"),$__require("5e"),$__require("5f"),$__require("61"),$__require("63"),$__require("65"),$__require("68"),$__require("69"),$__require("6a"),$__require("6b"),$__require("6c"),$__require("6d"),$__require("6e"),$__require("70"),$__require("71"),$__require("73"),$__require("d"),module.exports=$__require("e").Object}),$__System.registerDynamic("76",["10","26"],!0,function($__require,exports,module){this||self;var $export=$__require("10"),toAbsoluteIndex=$__require("26"),fromCharCode=String.fromCharCode,$fromCodePoint=String.fromCodePoint;$export($export.S+$export.F*(!!$fromCodePoint&&1!=$fromCodePoint.length),"String",{fromCodePoint:function(x){for(var code,res=[],aLen=arguments.length,i=0;aLen>i;){if(code=+arguments[i++],toAbsoluteIndex(code,1114111)!==code)throw RangeError(code+" is not a valid code point");res.push(code<65536?fromCharCode(code):fromCharCode(55296+((code-=65536)>>10),code%1024+56320))}return res.join("")}})}),$__System.registerDynamic("77",["10","20","17"],!0,function($__require,exports,module){this||self;var $export=$__require("10"),toIObject=$__require("20"),toLength=$__require("17");$export($export.S,"String",{raw:function(callSite){for(var tpl=toIObject(callSite.raw),len=toLength(tpl.length),aLen=arguments.length,res=[],i=0;len>i;)res.push(String(tpl[i++])),i<aLen&&res.push(String(arguments[i]));return res.join("")}})}),$__System.registerDynamic("78",[],!0,function($__require,exports,module){this||self;module.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}),$__System.registerDynamic("79",["10","7a","1e","78"],!0,function($__require,exports,module){this||self;var $export=$__require("10"),defined=$__require("7a"),fails=$__require("1e"),spaces=$__require("78"),space="["+spaces+"]",ltrim=RegExp("^"+space+space+"*"),rtrim=RegExp(space+space+"*$"),exporter=function(KEY,exec,ALIAS){var exp={},FORCE=fails(function(){return!!spaces[KEY]()||"​"!="​"[KEY]()}),fn=exp[KEY]=FORCE?exec(trim):spaces[KEY];ALIAS&&(exp[ALIAS]=fn),$export($export.P+$export.F*FORCE,"String",exp)},trim=exporter.trim=function(string,TYPE){return string=String(defined(string)),1&TYPE&&(string=string.replace(ltrim,"")),2&TYPE&&(string=string.replace(rtrim,"")),string};module.exports=exporter}),$__System.registerDynamic("7b",["79"],!0,function($__require,exports,module){"use strict";this||self;$__require("79")("trim",function($trim){return function(){return $trim(this,3)}})}),$__System.registerDynamic("7c",["10","7d"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),$at=$__require("7d")(!1);$export($export.P,"String",{codePointAt:function(pos){return $at(this,pos)}})}),$__System.registerDynamic("7e",["10","17","7f","80"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),toLength=$__require("17"),context=$__require("7f"),$endsWith="".endsWith;$export($export.P+$export.F*$__require("80")("endsWith"),"String",{endsWith:function(searchString){var that=context(this,searchString,"endsWith"),endPosition=arguments.length>1?arguments[1]:void 0,len=toLength(that.length),end=void 0===endPosition?len:Math.min(toLength(endPosition),len),search=String(searchString);return $endsWith?$endsWith.call(that,search,end):that.slice(end-search.length,end)===search}})}),$__System.registerDynamic("81",["10","7f","80"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),context=$__require("7f");$export($export.P+$export.F*$__require("80")("includes"),"String",{includes:function(searchString){return!!~context(this,searchString,"includes").indexOf(searchString,arguments.length>1?arguments[1]:void 0)}})}),$__System.registerDynamic("82",["35","7a"],!0,function($__require,exports,module){"use strict";this||self;var toInteger=$__require("35"),defined=$__require("7a");module.exports=function(count){var str=String(defined(this)),res="",n=toInteger(count);if(n<0||n==1/0)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(str+=str))1&n&&(res+=str);return res}}),$__System.registerDynamic("83",["10","82"],!0,function($__require,exports,module){this||self;var $export=$__require("10");$export($export.P,"String",{repeat:$__require("82")})}),$__System.registerDynamic("7f",["84","7a"],!0,function($__require,exports,module){this||self;var isRegExp=$__require("84"),defined=$__require("7a");module.exports=function(that,searchString,NAME){if(isRegExp(searchString))throw TypeError("String#"+NAME+" doesn't accept regex!");return String(defined(that))}}),$__System.registerDynamic("80",["3e"],!0,function($__require,exports,module){this||self;var MATCH=$__require("3e")("match");module.exports=function(KEY){var re=/./;try{"/./"[KEY](re)}catch(e){try{return re[MATCH]=!1,!"/./"[KEY](re)}catch(f){}}return!0}}),$__System.registerDynamic("85",["10","17","7f","80"],!0,function($__require,exports,module){"use strict";this||self;var $export=$__require("10"),toLength=$__require("17"),context=$__require("7f"),$startsWith="".startsWith;$export($export.P+$export.F*$__require("80")("startsWith"),"String",{startsWith:function(searchString){var that=context(this,searchString,"startsWith"),index=toLength(Math.min(arguments.length>1?arguments[1]:void 0,that.length)),search=String(searchString);return $startsWith?$startsWith.call(that,search,index):that.slice(index,index+search.length)===search}})}),$__System.registerDynamic("86",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("anchor",function(createHTML){return function(name){return createHTML(this,"a","name",name)}})}),$__System.registerDynamic("88",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("big",function(createHTML){return function(){return createHTML(this,"big","","")}})}),$__System.registerDynamic("89",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("blink",function(createHTML){return function(){return createHTML(this,"blink","","")}})}),$__System.registerDynamic("8a",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("bold",function(createHTML){return function(){return createHTML(this,"b","","")}})}),$__System.registerDynamic("8b",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("fixed",function(createHTML){return function(){return createHTML(this,"tt","","")}})}),$__System.registerDynamic("8c",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("fontcolor",function(createHTML){return function(color){return createHTML(this,"font","color",color)}})}),$__System.registerDynamic("8d",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("fontsize",function(createHTML){return function(size){return createHTML(this,"font","size",size)}})}),$__System.registerDynamic("8e",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("italics",function(createHTML){return function(){return createHTML(this,"i","","")}})}),$__System.registerDynamic("8f",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("link",function(createHTML){return function(url){return createHTML(this,"a","href",url)}})}),$__System.registerDynamic("90",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("small",function(createHTML){return function(){return createHTML(this,"small","","")}})}),$__System.registerDynamic("91",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("strike",function(createHTML){return function(){return createHTML(this,"strike","","")}})}),$__System.registerDynamic("92",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("sub",function(createHTML){return function(){return createHTML(this,"sub","","")}})}),$__System.registerDynamic("87",["10","1e","7a"],!0,function($__require,exports,module){this||self;var $export=$__require("10"),fails=$__require("1e"),defined=$__require("7a"),quot=/"/g,createHTML=function(string,tag,attribute,value){var S=String(defined(string)),p1="<"+tag;return""!==attribute&&(p1+=" "+attribute+'="'+String(value).replace(quot,"&quot;")+'"'),p1+">"+S+"</"+tag+">"};module.exports=function(NAME,exec){var O={};O[NAME]=exec(createHTML),$export($export.P+$export.F*fails(function(){var test=""[NAME]('"');return test!==test.toLowerCase()||test.split('"').length>3}),"String",O)}}),$__System.registerDynamic("93",["87"],!0,function($__require,exports,module){"use strict";this||self;$__require("87")("sup",function(createHTML){return function(){return createHTML(this,"sup","","")}})}),$__System.registerDynamic("94",["56","17","95","96","97"],!0,function($__require,exports,module){"use strict";this||self;var anObject=$__require("56"),toLength=$__require("17"),advanceStringIndex=$__require("95"),regExpExec=$__require("96");$__require("97")("match",1,function(defined,MATCH,$match,maybeCallNative){return[function(regexp){var O=defined(this),fn=null==regexp?void 0:regexp[MATCH];return void 0!==fn?fn.call(regexp,O):new RegExp(regexp)[MATCH](String(O))},function(regexp){var res=maybeCallNative($match,regexp,this);if(res.done)return res.value;var rx=anObject(regexp),S=String(this);if(!rx.global)return regExpExec(rx,S);var fullUnicode=rx.unicode;rx.lastIndex=0;for(var result,A=[],n=0;null!==(result=regExpExec(rx,S));){var matchStr=String(result[0]);A[n]=matchStr,""===matchStr&&(rx.lastIndex=advanceStringIndex(S,toLength(rx.lastIndex),fullUnicode)),n++}return 0===n?null:A}]})}),$__System.registerDynamic("98",["56","14","17","35","95","96","97"],!0,function($__require,exports,module){"use strict";this||self;var anObject=$__require("56"),toObject=$__require("14"),toLength=$__require("17"),toInteger=$__require("35"),advanceStringIndex=$__require("95"),regExpExec=$__require("96"),max=Math.max,min=Math.min,floor=Math.floor,SUBSTITUTION_SYMBOLS=/\$([$&`']|\d\d?|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&`']|\d\d?)/g;$__require("97")("replace",2,function(defined,REPLACE,$replace,maybeCallNative){return[function(searchValue,replaceValue){var O=defined(this),fn=null==searchValue?void 0:searchValue[REPLACE];return void 0!==fn?fn.call(searchValue,O,replaceValue):$replace.call(String(O),searchValue,replaceValue)},function(regexp,replaceValue){var res=maybeCallNative($replace,regexp,this,replaceValue);if(res.done)return res.value;var rx=anObject(regexp),S=String(this),functionalReplace="function"==typeof replaceValue;functionalReplace||(replaceValue=String(replaceValue));var global=rx.global;if(global){var fullUnicode=rx.unicode;rx.lastIndex=0}for(var results=[];;){var result=regExpExec(rx,S);if(null===result)break;if(results.push(result),!global)break;""===String(result[0])&&(rx.lastIndex=advanceStringIndex(S,toLength(rx.lastIndex),fullUnicode))}for(var it,accumulatedResult="",nextSourcePosition=0,i=0;i<results.length;i++){result=results[i];for(var matched=String(result[0]),position=max(min(toInteger(result.index),S.length),0),captures=[],j=1;j<result.length;j++)captures.push(void 0===(it=result[j])?it:String(it));var namedCaptures=result.groups;if(functionalReplace){var replacerArgs=[matched].concat(captures,position,S);void 0!==namedCaptures&&replacerArgs.push(namedCaptures);var replacement=String(replaceValue.apply(void 0,replacerArgs))}else replacement=getSubstitution(matched,S,position,captures,namedCaptures,replaceValue);position>=nextSourcePosition&&(accumulatedResult+=S.slice(nextSourcePosition,position)+replacement,nextSourcePosition=position+matched.length)}return accumulatedResult+S.slice(nextSourcePosition)}];function getSubstitution(matched,str,position,captures,namedCaptures,replacement){var tailPos=position+matched.length,m=captures.length,symbols=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==namedCaptures&&(namedCaptures=toObject(namedCaptures),symbols=SUBSTITUTION_SYMBOLS),$replace.call(replacement,symbols,function(match,ch){var capture;switch(ch.charAt(0)){case"$":return"$";case"&":return matched;case"`":return str.slice(0,position);case"'":return str.slice(tailPos);case"<":capture=namedCaptures[ch.slice(1,-1)];break;default:var n=+ch;if(0===n)return match;if(n>m){var f=floor(n/10);return 0===f?match:f<=m?void 0===captures[f-1]?ch.charAt(1):captures[f-1]+ch.charAt(1):match}capture=captures[n-1]}return void 0===capture?"":capture})}})}),$__System.registerDynamic("72",[],!0,function($__require,exports,module){this||self;module.exports=Object.is||function(x,y){return x===y?0!==x||1/x==1/y:x!=x&&y!=y}}),$__System.registerDynamic("99",["56","72","96","97"],!0,function($__require,exports,module){"use strict";this||self;var anObject=$__require("56"),sameValue=$__require("72"),regExpExec=$__require("96");$__require("97")("search",1,function(defined,SEARCH,$search,maybeCallNative){return[function(regexp){var O=defined(this),fn=null==regexp?void 0:regexp[SEARCH];return void 0!==fn?fn.call(regexp,O):new RegExp(regexp)[SEARCH](String(O))},function(regexp){var res=maybeCallNative($search,regexp,this);if(res.done)return res.value;var rx=anObject(regexp),S=String(this),previousLastIndex=rx.lastIndex;sameValue(previousLastIndex,0)||(rx.lastIndex=0);var result=regExpExec(rx,S);return sameValue(rx.lastIndex,previousLastIndex)||(rx.lastIndex=previousLastIndex),null===result?-1:result.index}]})}),$__System.registerDynamic("84",["3d","25","3e"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d"),cof=$__require("25"),MATCH=$__require("3e")("match");module.exports=function(it){var isRegExp;return isObject(it)&&(void 0!==(isRegExp=it[MATCH])?!!isRegExp:"RegExp"==cof(it))}}),$__System.registerDynamic("9a",["56","28","3e"],!0,function($__require,exports,module){this||self;var anObject=$__require("56"),aFunction=$__require("28"),SPECIES=$__require("3e")("species");module.exports=function(O,D){var S,C=anObject(O).constructor;return void 0===C||null==(S=anObject(C)[SPECIES])?D:aFunction(S)}}),$__System.registerDynamic("95",["7d"],!0,function($__require,exports,module){"use strict";this||self;var at=$__require("7d")(!0);module.exports=function(S,index,unicode){return index+(unicode?at(S,index).length:1)}}),$__System.registerDynamic("96",["9b"],!0,function($__require,exports,module){"use strict";this||self;var classof=$__require("9b"),builtinExec=RegExp.prototype.exec;module.exports=function(R,S){var exec=R.exec;if("function"==typeof exec){var result=exec.call(R,S);if("object"!=typeof result)throw new TypeError("RegExp exec method returned something other than an Object or null");return result}if("RegExp"!==classof(R))throw new TypeError("RegExp#exec called on incompatible receiver");return builtinExec.call(R,S)}}),$__System.registerDynamic("9c",["9d","10"],!0,function($__require,exports,module){"use strict";this||self;var regexpExec=$__require("9d");$__require("10")({target:"RegExp",proto:!0,forced:regexpExec!==/./.exec},{exec:regexpExec})}),$__System.registerDynamic("9e",["56"],!0,function($__require,exports,module){"use strict";this||self;var anObject=$__require("56");module.exports=function(){var that=anObject(this),result="";return that.global&&(result+="g"),that.ignoreCase&&(result+="i"),that.multiline&&(result+="m"),that.unicode&&(result+="u"),that.sticky&&(result+="y"),result}}),$__System.registerDynamic("9d",["9e"],!0,function($__require,exports,module){"use strict";this||self;var re1,re2,regexpFlags=$__require("9e"),nativeExec=RegExp.prototype.exec,nativeReplace=String.prototype.replace,patchedExec=nativeExec,UPDATES_LAST_INDEX_WRONG=(re1=/a/,re2=/b*/g,nativeExec.call(re1,"a"),nativeExec.call(re2,"a"),0!==re1.lastIndex||0!==re2.lastIndex),NPCG_INCLUDED=void 0!==/()??/.exec("")[1];(UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED)&&(patchedExec=function(str){var lastIndex,reCopy,match,i,re=this;return NPCG_INCLUDED&&(reCopy=new RegExp("^"+re.source+"$(?!\\s)",regexpFlags.call(re))),UPDATES_LAST_INDEX_WRONG&&(lastIndex=re.lastIndex),match=nativeExec.call(re,str),UPDATES_LAST_INDEX_WRONG&&match&&(re.lastIndex=re.global?match.index+match[0].length:lastIndex),NPCG_INCLUDED&&match&&match.length>1&&nativeReplace.call(match[0],reCopy,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(match[i]=void 0)}),match}),module.exports=patchedExec}),$__System.registerDynamic("97",["9c","51","5c","1e","7a","3e","9d"],!0,function($__require,exports,module){"use strict";this||self;$__require("9c");var redefine=$__require("51"),hide=$__require("5c"),fails=$__require("1e"),defined=$__require("7a"),wks=$__require("3e"),regexpExec=$__require("9d"),SPECIES=wks("species"),REPLACE_SUPPORTS_NAMED_GROUPS=!fails(function(){var re=/./;return re.exec=function(){var result=[];return result.groups={a:"7"},result},"7"!=="".replace(re,"$<a>")}),SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=function(){var re=/(?:)/,originalExec=re.exec;re.exec=function(){return originalExec.apply(this,arguments)};var result="ab".split(re);return 2===result.length&&"a"===result[0]&&"b"===result[1]}();module.exports=function(KEY,length,exec){var SYMBOL=wks(KEY),DELEGATES_TO_SYMBOL=!fails(function(){var O={};return O[SYMBOL]=function(){return 7},7!=""[KEY](O)}),DELEGATES_TO_EXEC=DELEGATES_TO_SYMBOL?!fails(function(){var execCalled=!1,re=/a/;return re.exec=function(){return execCalled=!0,null},"split"===KEY&&(re.constructor={},re.constructor[SPECIES]=function(){return re}),re[SYMBOL](""),!execCalled}):void 0;if(!DELEGATES_TO_SYMBOL||!DELEGATES_TO_EXEC||"replace"===KEY&&!REPLACE_SUPPORTS_NAMED_GROUPS||"split"===KEY&&!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC){var nativeRegExpMethod=/./[SYMBOL],fns=exec(defined,SYMBOL,""[KEY],function(nativeMethod,regexp,str,arg2,forceStringMethod){return regexp.exec===regexpExec?DELEGATES_TO_SYMBOL&&!forceStringMethod?{done:!0,value:nativeRegExpMethod.call(regexp,str,arg2)}:{done:!0,value:nativeMethod.call(str,regexp,arg2)}:{done:!1}}),strfn=fns[0],rxfn=fns[1];redefine(String.prototype,KEY,strfn),hide(RegExp.prototype,SYMBOL,2==length?function(string,arg){return rxfn.call(string,this,arg)}:function(string){return rxfn.call(string,this)})}}}),$__System.registerDynamic("9f",["84","56","9a","95","17","96","9d","1e","97"],!0,function($__require,exports,module){"use strict";this||self;var isRegExp=$__require("84"),anObject=$__require("56"),speciesConstructor=$__require("9a"),advanceStringIndex=$__require("95"),toLength=$__require("17"),callRegExpExec=$__require("96"),regexpExec=$__require("9d"),fails=$__require("1e"),$min=Math.min,$push=[].push,SUPPORTS_Y=!fails(function(){RegExp(4294967295,"y")});$__require("97")("split",2,function(defined,SPLIT,$split,maybeCallNative){var internalSplit;return internalSplit="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(separator,limit){var string=String(this);if(void 0===separator&&0===limit)return[];if(!isRegExp(separator))return $split.call(string,separator,limit);for(var match,lastIndex,lastLength,output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.unicode?"u":"")+(separator.sticky?"y":""),lastLastIndex=0,splitLimit=void 0===limit?4294967295:limit>>>0,separatorCopy=new RegExp(separator.source,flags+"g");(match=regexpExec.call(separatorCopy,string))&&!((lastIndex=separatorCopy.lastIndex)>lastLastIndex&&(output.push(string.slice(lastLastIndex,match.index)),match.length>1&&match.index<string.length&&$push.apply(output,match.slice(1)),lastLength=match[0].length,lastLastIndex=lastIndex,output.length>=splitLimit));)separatorCopy.lastIndex===match.index&&separatorCopy.lastIndex++;return lastLastIndex===string.length?!lastLength&&separatorCopy.test("")||output.push(""):output.push(string.slice(lastLastIndex)),output.length>splitLimit?output.slice(0,splitLimit):output}:"0".split(void 0,0).length?function(separator,limit){return void 0===separator&&0===limit?[]:$split.call(this,separator,limit)}:$split,[function(separator,limit){var O=defined(this),splitter=null==separator?void 0:separator[SPLIT];return void 0!==splitter?splitter.call(separator,O,limit):internalSplit.call(String(O),separator,limit)},function(regexp,limit){var res=maybeCallNative(internalSplit,regexp,this,limit,internalSplit!==$split);if(res.done)return res.value;var rx=anObject(regexp),S=String(this),C=speciesConstructor(rx,RegExp),unicodeMatching=rx.unicode,flags=(rx.ignoreCase?"i":"")+(rx.multiline?"m":"")+(rx.unicode?"u":"")+(SUPPORTS_Y?"y":"g"),splitter=new C(SUPPORTS_Y?rx:"^(?:"+rx.source+")",flags),lim=void 0===limit?4294967295:limit>>>0;if(0===lim)return[];if(0===S.length)return null===callRegExpExec(splitter,S)?[S]:[];for(var p=0,q=0,A=[];q<S.length;){splitter.lastIndex=SUPPORTS_Y?q:0;var e,z=callRegExpExec(splitter,SUPPORTS_Y?S:S.slice(q));if(null===z||(e=$min(toLength(splitter.lastIndex+(SUPPORTS_Y?0:q)),S.length))===p)q=advanceStringIndex(S,q,unicodeMatching);else{if(A.push(S.slice(p,q)),A.length===lim)return A;for(var i=1;i<=z.length-1;i++)if(A.push(z[i]),A.length===lim)return A;q=p=e}}return A.push(S.slice(p)),A}]})}),$__System.registerDynamic("a0",["76","77","7b","44","7c","7e","81","83","85","86","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","98","99","9f","e"],!0,function($__require,exports,module){this||self;$__require("76"),$__require("77"),$__require("7b"),$__require("44"),$__require("7c"),$__require("7e"),$__require("81"),$__require("83"),$__require("85"),$__require("86"),$__require("88"),$__require("89"),$__require("8a"),$__require("8b"),$__require("8c"),$__require("8d"),$__require("8e"),$__require("8f"),$__require("90"),$__require("91"),$__require("92"),$__require("93"),$__require("94"),$__require("98"),$__require("99"),$__require("9f"),module.exports=$__require("e").String}),$__System.registerDynamic("a1",["a2","a3","a4"],!0,function($__require,exports,module){"use strict";this||self;var strong=$__require("a2"),validate=$__require("a3");module.exports=$__require("a4")("Map",function(get){return function(){return get(this,arguments.length>0?arguments[0]:void 0)}},{get:function(key){var entry=strong.getEntry(validate(this,"Map"),key);return entry&&entry.v},set:function(key,value){return strong.def(validate(this,"Map"),0===key?0:key,value)}},strong,!0)}),$__System.registerDynamic("a5",["d","44","a6","a1","e"],!0,function($__require,exports,module){this||self;$__require("d"),$__require("44"),$__require("a6"),$__require("a1"),module.exports=$__require("e").Map}),$__System.registerDynamic("d",["9b","3e","51"],!0,function($__require,exports,module){"use strict";this||self;var classof=$__require("9b"),test={};test[$__require("3e")("toStringTag")]="z",test+""!="[object z]"&&$__require("51")(Object.prototype,"toString",function(){return"[object "+classof(this)+"]"},!0)}),$__System.registerDynamic("7d",["35","7a"],!0,function($__require,exports,module){this||self;var toInteger=$__require("35"),defined=$__require("7a");module.exports=function(TO_STRING){return function(that,pos){var a,b,s=String(defined(that)),i=toInteger(pos),l=s.length;return i<0||i>=l?TO_STRING?"":void 0:(a=s.charCodeAt(i))<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):b-56320+(a-55296<<10)+65536}}}),$__System.registerDynamic("44",["7d","a7"],!0,function($__require,exports,module){"use strict";this||self;var $at=$__require("7d")(!0);$__require("a7")(String,"String",function(iterated){this._t=String(iterated),this._i=0},function(){var point,O=this._t,index=this._i;return index>=O.length?{value:void 0,done:!0}:(point=$at(O,index),this._i+=point.length,{value:point,done:!1})})}),$__System.registerDynamic("38",["3e","5c"],!0,function($__require,exports,module){this||self;var UNSCOPABLES=$__require("3e")("unscopables"),ArrayProto=Array.prototype;null==ArrayProto[UNSCOPABLES]&&$__require("5c")(ArrayProto,UNSCOPABLES,{}),module.exports=function(key){ArrayProto[UNSCOPABLES][key]=!0}}),$__System.registerDynamic("45",["38","a8","a9","20","a7"],!0,function($__require,exports,module){"use strict";this||self;var addToUnscopables=$__require("38"),step=$__require("a8"),Iterators=$__require("a9"),toIObject=$__require("20");module.exports=$__require("a7")(Array,"Array",function(iterated,kind){this._t=toIObject(iterated),this._i=0,this._k=kind},function(){var O=this._t,kind=this._k,index=this._i++;return!O||index>=O.length?(this._t=void 0,step(1)):step(0,"keys"==kind?index:"values"==kind?O[index]:[index,O[index]])},"values"),Iterators.Arguments=Iterators.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries")}),$__System.registerDynamic("a6",["45","4c","51","49","5c","a9","3e"],!0,function($__require,exports,module){global=this||self;for(var $iterators=$__require("45"),getKeys=$__require("4c"),redefine=$__require("51"),global=$__require("49"),hide=$__require("5c"),Iterators=$__require("a9"),wks=$__require("3e"),ITERATOR=wks("iterator"),TO_STRING_TAG=wks("toStringTag"),ArrayValues=Iterators.Array,DOMIterables={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},collections=getKeys(DOMIterables),i=0;i<collections.length;i++){var key,NAME=collections[i],explicit=DOMIterables[NAME],Collection=global[NAME],proto=Collection&&Collection.prototype;if(proto&&(proto[ITERATOR]||hide(proto,ITERATOR,ArrayValues),proto[TO_STRING_TAG]||hide(proto,TO_STRING_TAG,NAME),Iterators[NAME]=ArrayValues,explicit))for(key in $iterators)proto[key]||redefine(proto,key,$iterators[key],!0)}}),$__System.registerDynamic("60",["1b","56","4c","50"],!0,function($__require,exports,module){this||self;var dP=$__require("1b"),anObject=$__require("56"),getKeys=$__require("4c");module.exports=$__require("50")?Object.defineProperties:function(O,Properties){anObject(O);for(var P,keys=getKeys(Properties),length=keys.length,i=0;length>i;)dP.f(O,P=keys[i++],Properties[P]);return O}}),$__System.registerDynamic("24",["49"],!0,function($__require,exports,module){this||self;var document=$__require("49").document;module.exports=document&&document.documentElement}),$__System.registerDynamic("58",["56","60","67","aa","ab","24"],!0,function($__require,exports,module){this||self;var anObject=$__require("56"),dPs=$__require("60"),enumBugKeys=$__require("67"),IE_PROTO=$__require("aa")("IE_PROTO"),Empty=function(){},createDict=function(){var iframeDocument,iframe=$__require("ab")("iframe"),i=enumBugKeys.length;for(iframe.style.display="none",$__require("24").appendChild(iframe),iframe.src="javascript:",(iframeDocument=iframe.contentWindow.document).open(),iframeDocument.write("<script>document.F=Object<\/script>"),iframeDocument.close(),createDict=iframeDocument.F;i--;)delete createDict.prototype[enumBugKeys[i]];return createDict()};module.exports=Object.create||function(O,Properties){var result;return null!==O?(Empty.prototype=anObject(O),result=new Empty,Empty.prototype=null,result[IE_PROTO]=O):result=createDict(),void 0===Properties?result:dPs(result,Properties)}}),$__System.registerDynamic("ac",["58","1c","54","5c","3e"],!0,function($__require,exports,module){"use strict";this||self;var create=$__require("58"),descriptor=$__require("1c"),setToStringTag=$__require("54"),IteratorPrototype={};$__require("5c")(IteratorPrototype,$__require("3e")("iterator"),function(){return this}),module.exports=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)}),setToStringTag(Constructor,NAME+" Iterator")}}),$__System.registerDynamic("14",["7a"],!0,function($__require,exports,module){this||self;var defined=$__require("7a");module.exports=function(it){return Object(defined(it))}}),$__System.registerDynamic("64",["4f","14","aa"],!0,function($__require,exports,module){this||self;var has=$__require("4f"),toObject=$__require("14"),IE_PROTO=$__require("aa")("IE_PROTO"),ObjectProto=Object.prototype;module.exports=Object.getPrototypeOf||function(O){return O=toObject(O),has(O,IE_PROTO)?O[IE_PROTO]:"function"==typeof O.constructor&&O instanceof O.constructor?O.constructor.prototype:O instanceof Object?ObjectProto:null}}),$__System.registerDynamic("a7",["4a","10","51","5c","a9","ac","54","64","3e"],!0,function($__require,exports,module){"use strict";this||self;var LIBRARY=$__require("4a"),$export=$__require("10"),redefine=$__require("51"),hide=$__require("5c"),Iterators=$__require("a9"),$iterCreate=$__require("ac"),setToStringTag=$__require("54"),getPrototypeOf=$__require("64"),ITERATOR=$__require("3e")("iterator"),BUGGY=!([].keys&&"next"in[].keys()),returnThis=function(){return this};module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var methods,key,IteratorPrototype,getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case"keys":case"values":return function(){return new Constructor(this,kind)}}return function(){return new Constructor(this,kind)}},TAG=NAME+" Iterator",DEF_VALUES="values"==DEFAULT,VALUES_BUG=!1,proto=Base.prototype,$native=proto[ITERATOR]||proto["@@iterator"]||DEFAULT&&proto[DEFAULT],$default=$native||getMethod(DEFAULT),$entries=DEFAULT?DEF_VALUES?getMethod("entries"):$default:void 0,$anyNative="Array"==NAME&&proto.entries||$native;if($anyNative&&(IteratorPrototype=getPrototypeOf($anyNative.call(new Base)))!==Object.prototype&&IteratorPrototype.next&&(setToStringTag(IteratorPrototype,TAG,!0),LIBRARY||"function"==typeof IteratorPrototype[ITERATOR]||hide(IteratorPrototype,ITERATOR,returnThis)),DEF_VALUES&&$native&&"values"!==$native.name&&(VALUES_BUG=!0,$default=function(){return $native.call(this)}),LIBRARY&&!FORCED||!BUGGY&&!VALUES_BUG&&proto[ITERATOR]||hide(proto,ITERATOR,$default),Iterators[NAME]=$default,Iterators[TAG]=returnThis,DEFAULT)if(methods={values:DEF_VALUES?$default:getMethod("values"),keys:IS_SET?$default:getMethod("keys"),entries:$entries},FORCED)for(key in methods)key in proto||redefine(proto,key,methods[key]);else $export($export.P+$export.F*(BUGGY||VALUES_BUG),NAME,methods);return methods}}),$__System.registerDynamic("a8",[],!0,function($__require,exports,module){this||self;module.exports=function(done,value){return{value:value,done:!!done}}}),$__System.registerDynamic("42",["49","1b","50","3e"],!0,function($__require,exports,module){"use strict";global=this||self;var global=$__require("49"),dP=$__require("1b"),DESCRIPTORS=$__require("50"),SPECIES=$__require("3e")("species");module.exports=function(KEY){var C=global[KEY];DESCRIPTORS&&C&&!C[SPECIES]&&dP.f(C,SPECIES,{configurable:!0,get:function(){return this}})}}),$__System.registerDynamic("a2",["1b","58","ad","13","ae","af","a7","a8","42","50","52","a3"],!0,function($__require,exports,module){"use strict";this||self;var dP=$__require("1b").f,create=$__require("58"),redefineAll=$__require("ad"),ctx=$__require("13"),anInstance=$__require("ae"),forOf=$__require("af"),$iterDefine=$__require("a7"),step=$__require("a8"),setSpecies=$__require("42"),DESCRIPTORS=$__require("50"),fastKey=$__require("52").fastKey,validate=$__require("a3"),SIZE=DESCRIPTORS?"_s":"size",getEntry=function(that,key){var entry,index=fastKey(key);if("F"!==index)return that._i[index];for(entry=that._f;entry;entry=entry.n)if(entry.k==key)return entry};module.exports={getConstructor:function(wrapper,NAME,IS_MAP,ADDER){var C=wrapper(function(that,iterable){anInstance(that,C,NAME,"_i"),that._t=NAME,that._i=create(null),that._f=void 0,that._l=void 0,that[SIZE]=0,null!=iterable&&forOf(iterable,IS_MAP,that[ADDER],that)});return redefineAll(C.prototype,{clear:function(){for(var that=validate(this,NAME),data=that._i,entry=that._f;entry;entry=entry.n)entry.r=!0,entry.p&&(entry.p=entry.p.n=void 0),delete data[entry.i];that._f=that._l=void 0,that[SIZE]=0},delete:function(key){var that=validate(this,NAME),entry=getEntry(that,key);if(entry){var next=entry.n,prev=entry.p;delete that._i[entry.i],entry.r=!0,prev&&(prev.n=next),next&&(next.p=prev),that._f==entry&&(that._f=next),that._l==entry&&(that._l=prev),that[SIZE]--}return!!entry},forEach:function(callbackfn){validate(this,NAME);for(var entry,f=ctx(callbackfn,arguments.length>1?arguments[1]:void 0,3);entry=entry?entry.n:this._f;)for(f(entry.v,entry.k,this);entry&&entry.r;)entry=entry.p},has:function(key){return!!getEntry(validate(this,NAME),key)}}),DESCRIPTORS&&dP(C.prototype,"size",{get:function(){return validate(this,NAME)[SIZE]}}),C},def:function(that,key,value){var prev,index,entry=getEntry(that,key);return entry?entry.v=value:(that._l=entry={i:index=fastKey(key,!0),k:key,v:value,p:prev=that._l,n:void 0,r:!1},that._f||(that._f=entry),prev&&(prev.n=entry),that[SIZE]++,"F"!==index&&(that._i[index]=entry)),that},getEntry:getEntry,setStrong:function(C,NAME,IS_MAP){$iterDefine(C,NAME,function(iterated,kind){this._t=validate(iterated,NAME),this._k=kind,this._l=void 0},function(){for(var kind=this._k,entry=this._l;entry&&entry.r;)entry=entry.p;return this._t&&(this._l=entry=entry?entry.n:this._t._f)?step(0,"keys"==kind?entry.k:"values"==kind?entry.v:[entry.k,entry.v]):(this._t=void 0,step(1))},IS_MAP?"entries":"values",!IS_MAP,!0),setSpecies(NAME)}}}),$__System.registerDynamic("a3",["3d"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d");module.exports=function(it,TYPE){if(!isObject(it)||it._t!==TYPE)throw TypeError("Incompatible receiver, "+TYPE+" required!");return it}}),$__System.registerDynamic("ad",["51"],!0,function($__require,exports,module){this||self;var redefine=$__require("51");module.exports=function(target,src,safe){for(var key in src)redefine(target,key,src[key],safe);return target}}),$__System.registerDynamic("52",["55","3d","4f","1b","1e"],!0,function($__require,exports,module){this||self;var META=$__require("55")("meta"),isObject=$__require("3d"),has=$__require("4f"),setDesc=$__require("1b").f,id=0,isExtensible=Object.isExtensible||function(){return!0},FREEZE=!$__require("1e")(function(){return isExtensible(Object.preventExtensions({}))}),setMeta=function(it){setDesc(it,META,{value:{i:"O"+ ++id,w:{}}})},meta=module.exports={KEY:META,NEED:!1,fastKey:function(it,create){if(!isObject(it))return"symbol"==typeof it?it:("string"==typeof it?"S":"P")+it;if(!has(it,META)){if(!isExtensible(it))return"F";if(!create)return"E";setMeta(it)}return it[META].i},getWeak:function(it,create){if(!has(it,META)){if(!isExtensible(it))return!0;if(!create)return!1;setMeta(it)}return it[META].w},onFreeze:function(it){return FREEZE&&meta.NEED&&isExtensible(it)&&!has(it,META)&&setMeta(it),it}}}),$__System.registerDynamic("15",["56"],!0,function($__require,exports,module){this||self;var anObject=$__require("56");module.exports=function(iterator,fn,value,entries){try{return entries?fn(anObject(value)[0],value[1]):fn(value)}catch(e){var ret=iterator.return;throw void 0!==ret&&anObject(ret.call(iterator)),e}}}),$__System.registerDynamic("16",["a9","3e"],!0,function($__require,exports,module){this||self;var Iterators=$__require("a9"),ITERATOR=$__require("3e")("iterator"),ArrayProto=Array.prototype;module.exports=function(it){return void 0!==it&&(Iterators.Array===it||ArrayProto[ITERATOR]===it)}}),$__System.registerDynamic("9b",["25","3e"],!0,function($__require,exports,module){this||self;var cof=$__require("25"),TAG=$__require("3e")("toStringTag"),ARG="Arguments"==cof(function(){return arguments}());module.exports=function(it){var O,T,B;return void 0===it?"Undefined":null===it?"Null":"string"==typeof(T=function(it,key){try{return it[key]}catch(e){}}(O=Object(it),TAG))?T:ARG?cof(O):"Object"==(B=cof(O))&&"function"==typeof O.callee?"Arguments":B}}),$__System.registerDynamic("a9",[],!0,function($__require,exports,module){this||self;module.exports={}}),$__System.registerDynamic("19",["9b","3e","a9","e"],!0,function($__require,exports,module){this||self;var classof=$__require("9b"),ITERATOR=$__require("3e")("iterator"),Iterators=$__require("a9");module.exports=$__require("e").getIteratorMethod=function(it){if(null!=it)return it[ITERATOR]||it["@@iterator"]||Iterators[classof(it)]}}),$__System.registerDynamic("af",["13","15","16","56","17","19"],!0,function($__require,exports,module){this||self;var ctx=$__require("13"),call=$__require("15"),isArrayIter=$__require("16"),anObject=$__require("56"),toLength=$__require("17"),getIterFn=$__require("19"),BREAK={},RETURN={};(exports=module.exports=function(iterable,entries,fn,that,ITERATOR){var length,step,iterator,result,iterFn=ITERATOR?function(){return iterable}:getIterFn(iterable),f=ctx(fn,that,entries?2:1),index=0;if("function"!=typeof iterFn)throw TypeError(iterable+" is not iterable!");if(isArrayIter(iterFn)){for(length=toLength(iterable.length);length>index;index++)if((result=entries?f(anObject(step=iterable[index])[0],step[1]):f(iterable[index]))===BREAK||result===RETURN)return result}else for(iterator=iterFn.call(iterable);!(step=iterator.next()).done;)if((result=call(iterator,f,step.value,entries))===BREAK||result===RETURN)return result}).BREAK=BREAK,exports.RETURN=RETURN}),$__System.registerDynamic("ae",[],!0,function($__require,exports,module){this||self;module.exports=function(it,Constructor,name,forbiddenField){if(!(it instanceof Constructor)||void 0!==forbiddenField&&forbiddenField in it)throw TypeError(name+": incorrect invocation!");return it}}),$__System.registerDynamic("1a",["3e"],!0,function($__require,exports,module){this||self;var ITERATOR=$__require("3e")("iterator"),SAFE_CLOSING=!1;try{var riter=[7][ITERATOR]();riter.return=function(){SAFE_CLOSING=!0},Array.from(riter,function(){throw 2})}catch(e){}module.exports=function(exec,skipClosing){if(!skipClosing&&!SAFE_CLOSING)return!1;var safe=!1;try{var arr=[7],iter=arr[ITERATOR]();iter.next=function(){return{done:safe=!0}},arr[ITERATOR]=function(){return iter},exec(arr)}catch(e){}return safe}}),$__System.registerDynamic("3e",["53","55","49"],!0,function($__require,exports,module){this||self;var store=$__require("53")("wks"),uid=$__require("55"),Symbol=$__require("49").Symbol,USE_SYMBOL="function"==typeof Symbol;(module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)("Symbol."+name))}).store=store}),$__System.registerDynamic("54",["1b","4f","3e"],!0,function($__require,exports,module){this||self;var def=$__require("1b").f,has=$__require("4f"),TAG=$__require("3e")("toStringTag");module.exports=function(it,tag,stat){it&&!has(it=stat?it:it.prototype,TAG)&&def(it,TAG,{configurable:!0,value:tag})}}),$__System.registerDynamic("5a",["4e","1c","20","57","4f","b0","50"],!0,function($__require,exports,module){this||self;var pIE=$__require("4e"),createDesc=$__require("1c"),toIObject=$__require("20"),toPrimitive=$__require("57"),has=$__require("4f"),IE8_DOM_DEFINE=$__require("b0"),gOPD=Object.getOwnPropertyDescriptor;exports.f=$__require("50")?gOPD:function(O,P){if(O=toIObject(O),P=toPrimitive(P,!0),IE8_DOM_DEFINE)try{return gOPD(O,P)}catch(e){}if(has(O,P))return createDesc(!pIE.f.call(O,P),O[P])}}),$__System.registerDynamic("74",["3d","56","13","5a"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d"),anObject=$__require("56"),check=function(O,proto){if(anObject(O),!isObject(proto)&&null!==proto)throw TypeError(proto+": can't set as prototype!")};module.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(test,buggy,set){try{(set=$__require("13")(Function.call,$__require("5a").f(Object.prototype,"__proto__").set,2))(test,[]),buggy=!(test instanceof Array)}catch(e){buggy=!0}return function(O,proto){return check(O,proto),buggy?O.__proto__=proto:set(O,proto),O}}({},!1):void 0),check:check}}),$__System.registerDynamic("b1",["3d","74"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d"),setPrototypeOf=$__require("74").set;module.exports=function(that,target,C){var P,S=target.constructor;return S!==C&&"function"==typeof S&&(P=S.prototype)!==C.prototype&&isObject(P)&&setPrototypeOf&&setPrototypeOf(that,P),that}}),$__System.registerDynamic("a4",["49","10","51","ad","52","af","ae","3d","1e","1a","54","b1"],!0,function($__require,exports,module){"use strict";global=this||self;var global=$__require("49"),$export=$__require("10"),redefine=$__require("51"),redefineAll=$__require("ad"),meta=$__require("52"),forOf=$__require("af"),anInstance=$__require("ae"),isObject=$__require("3d"),fails=$__require("1e"),$iterDetect=$__require("1a"),setToStringTag=$__require("54"),inheritIfRequired=$__require("b1");module.exports=function(NAME,wrapper,methods,common,IS_MAP,IS_WEAK){var Base=global[NAME],C=Base,ADDER=IS_MAP?"set":"add",proto=C&&C.prototype,O={},fixMethod=function(KEY){var fn=proto[KEY];redefine(proto,KEY,"delete"==KEY?function(a){return!(IS_WEAK&&!isObject(a))&&fn.call(this,0===a?0:a)}:"has"==KEY?function(a){return!(IS_WEAK&&!isObject(a))&&fn.call(this,0===a?0:a)}:"get"==KEY?function(a){return IS_WEAK&&!isObject(a)?void 0:fn.call(this,0===a?0:a)}:"add"==KEY?function(a){return fn.call(this,0===a?0:a),this}:function(a,b){return fn.call(this,0===a?0:a,b),this})};if("function"==typeof C&&(IS_WEAK||proto.forEach&&!fails(function(){(new C).entries().next()}))){var instance=new C,HASNT_CHAINING=instance[ADDER](IS_WEAK?{}:-0,1)!=instance,THROWS_ON_PRIMITIVES=fails(function(){instance.has(1)}),ACCEPT_ITERABLES=$iterDetect(function(iter){new C(iter)}),BUGGY_ZERO=!IS_WEAK&&fails(function(){for(var $instance=new C,index=5;index--;)$instance[ADDER](index,index);return!$instance.has(-0)});ACCEPT_ITERABLES||((C=wrapper(function(target,iterable){anInstance(target,C,NAME);var that=inheritIfRequired(new Base,target,C);return null!=iterable&&forOf(iterable,IS_MAP,that[ADDER],that),that})).prototype=proto,proto.constructor=C),(THROWS_ON_PRIMITIVES||BUGGY_ZERO)&&(fixMethod("delete"),fixMethod("has"),IS_MAP&&fixMethod("get")),(BUGGY_ZERO||HASNT_CHAINING)&&fixMethod(ADDER),IS_WEAK&&proto.clear&&delete proto.clear}else C=common.getConstructor(wrapper,NAME,IS_MAP,ADDER),redefineAll(C.prototype,methods),meta.NEED=!0;return setToStringTag(C,NAME),O[NAME]=C,$export($export.G+$export.W+$export.F*(C!=Base),O),IS_WEAK||common.setStrong(C,NAME,IS_MAP),C}}),$__System.registerDynamic("b2",["a2","a3","a4"],!0,function($__require,exports,module){"use strict";this||self;var strong=$__require("a2"),validate=$__require("a3");module.exports=$__require("a4")("Set",function(get){return function(){return get(this,arguments.length>0?arguments[0]:void 0)}},{add:function(value){return strong.def(validate(this,"Set"),value=0===value?0:value,value)}},strong)}),$__System.registerDynamic("b3",["d","44","a6","b2","e"],!0,function($__require,exports,module){this||self;$__require("d"),$__require("44"),$__require("a6"),$__require("b2"),module.exports=$__require("e").Set}),$__System.registerDynamic("b4",["10","b5"],!0,function($__require,exports,module){this||self;var $export=$__require("10"),$values=$__require("b5")(!1);$export($export.S,"Object",{values:function(it){return $values(it)}})}),$__System.registerDynamic("56",["3d"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d");module.exports=function(it){if(!isObject(it))throw TypeError(it+" is not an object!");return it}}),$__System.registerDynamic("ab",["3d","49"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d"),document=$__require("49").document,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{}}}),$__System.registerDynamic("b0",["50","1e","ab"],!0,function($__require,exports,module){this||self;module.exports=!$__require("50")&&!$__require("1e")(function(){return 7!=Object.defineProperty($__require("ab")("div"),"a",{get:function(){return 7}}).a})}),$__System.registerDynamic("3d",[],!0,function($__require,exports,module){this||self;module.exports=function(it){return"object"==typeof it?null!==it:"function"==typeof it}}),$__System.registerDynamic("57",["3d"],!0,function($__require,exports,module){this||self;var isObject=$__require("3d");module.exports=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&"function"==typeof(fn=it.toString)&&!isObject(val=fn.call(it)))return val;if("function"==typeof(fn=it.valueOf)&&!isObject(val=fn.call(it)))return val;if(!S&&"function"==typeof(fn=it.toString)&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")}}),$__System.registerDynamic("1b",["56","b0","57","50"],!0,function($__require,exports,module){this||self;var anObject=$__require("56"),IE8_DOM_DEFINE=$__require("b0"),toPrimitive=$__require("57"),dP=Object.defineProperty;exports.f=$__require("50")?Object.defineProperty:function(O,P,Attributes){if(anObject(O),P=toPrimitive(P,!0),anObject(Attributes),IE8_DOM_DEFINE)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");return"value"in Attributes&&(O[P]=Attributes.value),O}}),$__System.registerDynamic("1c",[],!0,function($__require,exports,module){this||self;module.exports=function(bitmap,value){return{enumerable:!(1&bitmap),configurable:!(2&bitmap),writable:!(4&bitmap),value:value}}}),$__System.registerDynamic("5c",["1b","1c","50"],!0,function($__require,exports,module){this||self;var dP=$__require("1b"),createDesc=$__require("1c");module.exports=$__require("50")?function(object,key,value){return dP.f(object,key,createDesc(1,value))}:function(object,key,value){return object[key]=value,object}}),$__System.registerDynamic("b6",["53"],!0,function($__require,exports,module){this||self;module.exports=$__require("53")("native-function-to-string",Function.toString)}),$__System.registerDynamic("51",["49","5c","4f","55","b6","e"],!0,function($__require,exports,module){global=this||self;var global=$__require("49"),hide=$__require("5c"),has=$__require("4f"),SRC=$__require("55")("src"),$toString=$__require("b6"),TPL=(""+$toString).split("toString");$__require("e").inspectSource=function(it){return $toString.call(it)},(module.exports=function(O,key,val,safe){var isFunction="function"==typeof val;isFunction&&(has(val,"name")||hide(val,"name",key)),O[key]!==val&&(isFunction&&(has(val,SRC)||hide(val,SRC,O[key]?""+O[key]:TPL.join(String(key)))),O===global?O[key]=val:safe?O[key]?O[key]=val:hide(O,key,val):(delete O[key],hide(O,key,val)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[SRC]||$toString.call(this)})}),$__System.registerDynamic("28",[],!0,function($__require,exports,module){this||self;module.exports=function(it){if("function"!=typeof it)throw TypeError(it+" is not a function!");return it}}),$__System.registerDynamic("13",["28"],!0,function($__require,exports,module){this||self;var aFunction=$__require("28");module.exports=function(fn,that,length){if(aFunction(fn),void 0===that)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}}),$__System.registerDynamic("10",["49","e","5c","51","13"],!0,function($__require,exports,module){global=this||self;var global=$__require("49"),core=$__require("e"),hide=$__require("5c"),redefine=$__require("51"),ctx=$__require("13"),$export=function(type,name,source){var key,own,out,exp,IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?global:IS_STATIC?global[name]||(global[name]={}):(global[name]||{}).prototype,exports=IS_GLOBAL?core:core[name]||(core[name]={}),expProto=exports.prototype||(exports.prototype={});for(key in IS_GLOBAL&&(source=name),source)out=((own=!IS_FORCED&&target&&void 0!==target[key])?target:source)[key],exp=IS_BIND&&own?ctx(out,global):IS_PROTO&&"function"==typeof out?ctx(Function.call,out):out,target&&redefine(target,key,out,type&$export.U),exports[key]!=out&&hide(exports,key,exp),IS_PROTO&&expProto[key]!=out&&(expProto[key]=out)};global.core=core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128,module.exports=$export}),$__System.registerDynamic("1e",[],!0,function($__require,exports,module){this||self;module.exports=function(exec){try{return!!exec()}catch(e){return!0}}}),$__System.registerDynamic("50",["1e"],!0,function($__require,exports,module){this||self;module.exports=!$__require("1e")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})}),$__System.registerDynamic("4f",[],!0,function($__require,exports,module){this||self;var hasOwnProperty={}.hasOwnProperty;module.exports=function(it,key){return hasOwnProperty.call(it,key)}}),$__System.registerDynamic("17",["35"],!0,function($__require,exports,module){this||self;var toInteger=$__require("35"),min=Math.min;module.exports=function(it){return it>0?min(toInteger(it),9007199254740991):0}}),$__System.registerDynamic("35",[],!0,function($__require,exports,module){this||self;var ceil=Math.ceil,floor=Math.floor;module.exports=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)}}),$__System.registerDynamic("26",["35"],!0,function($__require,exports,module){this||self;var toInteger=$__require("35"),max=Math.max,min=Math.min;module.exports=function(index,length){return(index=toInteger(index))<0?max(index+length,0):min(index,length)}}),$__System.registerDynamic("33",["20","17","26"],!0,function($__require,exports,module){this||self;var toIObject=$__require("20"),toLength=$__require("17"),toAbsoluteIndex=$__require("26");module.exports=function(IS_INCLUDES){return function($this,el,fromIndex){var value,O=toIObject($this),length=toLength(O.length),index=toAbsoluteIndex(fromIndex,length);if(IS_INCLUDES&&el!=el){for(;length>index;)if((value=O[index++])!=value)return!0}else for(;length>index;index++)if((IS_INCLUDES||index in O)&&O[index]===el)return IS_INCLUDES||index||0;return!IS_INCLUDES&&-1}}}),$__System.registerDynamic("e",[],!0,function($__require,exports,module){this||self;var core=module.exports={version:"2.6.10"};"number"==typeof __e&&(__e=core)}),$__System.registerDynamic("49",[],!0,function($__require,exports,module){global=this||self;var global=module.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=global)}),$__System.registerDynamic("4a",[],!0,function($__require,exports,module){this||self;module.exports=!1}),$__System.registerDynamic("53",["e","49","4a"],!0,function($__require,exports,module){global=this||self;var global,core=$__require("e"),store=(global=$__require("49"))["__core-js_shared__"]||(global["__core-js_shared__"]={});(module.exports=function(key,value){return store[key]||(store[key]=void 0!==value?value:{})})("versions",[]).push({version:core.version,mode:$__require("4a")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),$__System.registerDynamic("55",[],!0,function($__require,exports,module){this||self;var id=0,px=Math.random();module.exports=function(key){return"Symbol(".concat(void 0===key?"":key,")_",(++id+px).toString(36))}}),$__System.registerDynamic("aa",["53","55"],!0,function($__require,exports,module){this||self;var shared=$__require("53")("keys"),uid=$__require("55");module.exports=function(key){return shared[key]||(shared[key]=uid(key))}}),$__System.registerDynamic("66",["4f","20","33","aa"],!0,function($__require,exports,module){this||self;var has=$__require("4f"),toIObject=$__require("20"),arrayIndexOf=$__require("33")(!1),IE_PROTO=$__require("aa")("IE_PROTO");module.exports=function(object,names){var key,O=toIObject(object),i=0,result=[];for(key in O)key!=IE_PROTO&&has(O,key)&&result.push(key);for(;names.length>i;)has(O,key=names[i++])&&(~arrayIndexOf(result,key)||result.push(key));return result}}),$__System.registerDynamic("67",[],!0,function($__require,exports,module){this||self;module.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")}),$__System.registerDynamic("4c",["66","67"],!0,function($__require,exports,module){this||self;var $keys=$__require("66"),enumBugKeys=$__require("67");module.exports=Object.keys||function(O){return $keys(O,enumBugKeys)}}),$__System.registerDynamic("25",[],!0,function($__require,exports,module){this||self;var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1)}}),$__System.registerDynamic("21",["25"],!0,function($__require,exports,module){this||self;var cof=$__require("25");module.exports=Object("z").propertyIsEnumerable(0)?Object:function(it){return"String"==cof(it)?it.split(""):Object(it)}}),$__System.registerDynamic("7a",[],!0,function($__require,exports,module){this||self;module.exports=function(it){if(null==it)throw TypeError("Can't call method on  "+it);return it}}),$__System.registerDynamic("20",["21","7a"],!0,function($__require,exports,module){this||self;var IObject=$__require("21"),defined=$__require("7a");module.exports=function(it){return IObject(defined(it))}}),$__System.registerDynamic("4e",[],!0,function($__require,exports,module){this||self;exports.f={}.propertyIsEnumerable}),$__System.registerDynamic("b5",["50","4c","20","4e"],!0,function($__require,exports,module){this||self;var DESCRIPTORS=$__require("50"),getKeys=$__require("4c"),toIObject=$__require("20"),isEnum=$__require("4e").f;module.exports=function(isEntries){return function(it){for(var key,O=toIObject(it),keys=getKeys(O),length=keys.length,i=0,result=[];length>i;)key=keys[i++],DESCRIPTORS&&!isEnum.call(O,key)||result.push(isEntries?[key,O[key]]:O[key]);return result}}}),$__System.registerDynamic("b7",["10","b5"],!0,function($__require,exports,module){this||self;var $export=$__require("10"),$entries=$__require("b5")(!0);$export($export.S,"Object",{entries:function(it){return $entries(it)}})}),$__System.register("a",["b","43","46","75","a0","a5","b3","b4","b7"],function($__export){"use strict";var noOp;return{setters:[function($__m){},function($__m){},function($__m){},function($__m){},function($__m){},function($__m){},function($__m){},function($__m){},function($__m){}],execute:function(){noOp=function(){},"undefined"==typeof performance&&(self.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}),"function"!=typeof performance.mark&&(performance.mark=noOp),"function"!=typeof performance.measure&&(performance.measure=noOp),void 0===Uint8Array.prototype.slice&&(Uint8Array.prototype.slice=function(from,to){return to||(to=this.byteLength),new Uint8Array(this.subarray(from,to))})}}})})(function(factory){System.registerDynamic("libs/polyfill.js",[],!1,function($__require,$__exports,$__module){return"function"==typeof factory?factory.call(this):factory})}),System.register("src/api/entities/base/PersistenceResourcePostReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PersistenceResourcePostReturnTypeRef,_TypeModel;return _export("createPersistenceResourcePostReturn",function(values){return Object.assign(create(_TypeModel,PersistenceResourcePostReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PersistenceResourcePostReturnTypeRef",PersistenceResourcePostReturnTypeRef=new TypeRef("base","PersistenceResourcePostReturn")),_export("PersistenceResourcePostReturnTypeRef",PersistenceResourcePostReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PersistenceResourcePostReturn",since:1,type:"DATA_TRANSFER_TYPE",id:0,rootId:"BGJhc2UAAA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},generatedId:{name:"generatedId",id:2,since:1,type:"GeneratedId",cardinality:"ZeroOrOne",final:!1,encrypted:!1},permissionListId:{name:"permissionListId",id:3,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"base",version:"1"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/base/Services.js",[],function(_export,_context){"use strict";var BaseService;return{setters:[],execute:function(){_export("BaseService",BaseService={}),_export("BaseService",BaseService)}}}),System.register("src/api/entities/sys/AdministratedGroupsRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AdministratedGroupsRefTypeRef,_TypeModel;return _export("createAdministratedGroupsRef",function(values){return Object.assign(create(_TypeModel,AdministratedGroupsRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AdministratedGroupsRefTypeRef",AdministratedGroupsRefTypeRef=new TypeRef("sys","AdministratedGroupsRef")),_export("AdministratedGroupsRefTypeRef",AdministratedGroupsRefTypeRef),_export("_TypeModel",_TypeModel={name:"AdministratedGroupsRef",since:27,type:"AGGREGATED_TYPE",id:1303,rootId:"A3N5cwAFFw",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1304,since:27,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{items:{name:"items",id:1305,since:27,type:"LIST_ASSOCIATION",cardinality:"One",refType:"AdministratedGroup",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/AuditLogRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AuditLogRefTypeRef,_TypeModel;return _export("createAuditLogRef",function(values){return Object.assign(create(_TypeModel,AuditLogRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AuditLogRefTypeRef",AuditLogRefTypeRef=new TypeRef("sys","AuditLogRef")),_export("AuditLogRefTypeRef",AuditLogRefTypeRef),_export("_TypeModel",_TypeModel={name:"AuditLogRef",since:22,type:"AGGREGATED_TYPE",id:1114,rootId:"A3N5cwAEWg",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1115,since:22,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{items:{name:"items",id:1116,since:22,type:"LIST_ASSOCIATION",cardinality:"One",refType:"AuditLogEntry",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/AuthenticatedDevice.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AuthenticatedDeviceTypeRef,_TypeModel;return _export("createAuthenticatedDevice",function(values){return Object.assign(create(_TypeModel,AuthenticatedDeviceTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AuthenticatedDeviceTypeRef",AuthenticatedDeviceTypeRef=new TypeRef("sys","AuthenticatedDevice")),_export("AuthenticatedDeviceTypeRef",AuthenticatedDeviceTypeRef),_export("_TypeModel",_TypeModel={name:"AuthenticatedDevice",since:1,type:"AGGREGATED_TYPE",id:43,rootId:"A3N5cwAr",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:44,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},authType:{name:"authType",id:45,since:1,type:"Number",cardinality:"One",final:!0,encrypted:!1},deviceKey:{name:"deviceKey",id:47,since:1,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},deviceToken:{name:"deviceToken",id:46,since:1,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Authentication.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AuthenticationTypeRef,_TypeModel;return _export("createAuthentication",function(values){return Object.assign(create(_TypeModel,AuthenticationTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AuthenticationTypeRef",AuthenticationTypeRef=new TypeRef("sys","Authentication")),_export("AuthenticationTypeRef",AuthenticationTypeRef),_export("_TypeModel",_TypeModel={name:"Authentication",since:1,type:"AGGREGATED_TYPE",id:453,rootId:"A3N5cwABxQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:454,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},accessToken:{name:"accessToken",id:1239,since:23,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!1},authVerifier:{name:"authVerifier",id:456,since:1,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},externalAuthToken:{name:"externalAuthToken",id:968,since:15,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1}},associations:{userId:{name:"userId",id:455,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/AutoLoginDataDelete.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AutoLoginDataDeleteTypeRef,_TypeModel;return _export("createAutoLoginDataDelete",function(values){return Object.assign(create(_TypeModel,AutoLoginDataDeleteTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AutoLoginDataDeleteTypeRef",AutoLoginDataDeleteTypeRef=new TypeRef("sys","AutoLoginDataDelete")),_export("AutoLoginDataDeleteTypeRef",AutoLoginDataDeleteTypeRef),_export("_TypeModel",_TypeModel={name:"AutoLoginDataDelete",since:1,type:"DATA_TRANSFER_TYPE",id:435,rootId:"A3N5cwABsw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:436,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},deviceToken:{name:"deviceToken",id:437,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/AutoLoginPostReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AutoLoginPostReturnTypeRef,_TypeModel;return _export("createAutoLoginPostReturn",function(values){return Object.assign(create(_TypeModel,AutoLoginPostReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AutoLoginPostReturnTypeRef",AutoLoginPostReturnTypeRef=new TypeRef("sys","AutoLoginPostReturn")),_export("AutoLoginPostReturnTypeRef",AutoLoginPostReturnTypeRef),_export("_TypeModel",_TypeModel={name:"AutoLoginPostReturn",since:1,type:"DATA_TRANSFER_TYPE",id:441,rootId:"A3N5cwABuQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:442,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},deviceToken:{name:"deviceToken",id:443,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/BookingItem.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,BookingItemTypeRef,_TypeModel;return _export("createBookingItem",function(values){return Object.assign(create(_TypeModel,BookingItemTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("BookingItemTypeRef",BookingItemTypeRef=new TypeRef("sys","BookingItem")),_export("BookingItemTypeRef",BookingItemTypeRef),_export("_TypeModel",_TypeModel={name:"BookingItem",since:9,type:"AGGREGATED_TYPE",id:700,rootId:"A3N5cwACvA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:701,since:9,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},currentCount:{name:"currentCount",id:703,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},currentInvoicedCount:{name:"currentInvoicedCount",id:706,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},featureType:{name:"featureType",id:702,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},maxCount:{name:"maxCount",id:704,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},price:{name:"price",id:707,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},priceType:{name:"priceType",id:708,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},totalInvoicedCount:{name:"totalInvoicedCount",id:705,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/BookingsRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,BookingsRefTypeRef,_TypeModel;return _export("createBookingsRef",function(values){return Object.assign(create(_TypeModel,BookingsRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("BookingsRefTypeRef",BookingsRefTypeRef=new TypeRef("sys","BookingsRef")),_export("BookingsRefTypeRef",BookingsRefTypeRef),_export("_TypeModel",_TypeModel={name:"BookingsRef",since:9,type:"AGGREGATED_TYPE",id:722,rootId:"A3N5cwAC0g",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:723,since:9,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{items:{name:"items",id:724,since:9,type:"LIST_ASSOCIATION",cardinality:"One",refType:"Booking",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/BootstrapFeature.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,BootstrapFeatureTypeRef,_TypeModel;return _export("createBootstrapFeature",function(values){return Object.assign(create(_TypeModel,BootstrapFeatureTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("BootstrapFeatureTypeRef",BootstrapFeatureTypeRef=new TypeRef("sys","BootstrapFeature")),_export("BootstrapFeatureTypeRef",BootstrapFeatureTypeRef),_export("_TypeModel",_TypeModel={name:"BootstrapFeature",since:24,type:"AGGREGATED_TYPE",id:1249,rootId:"A3N5cwAE4Q",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1250,since:24,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},feature:{name:"feature",id:1309,since:28,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Bucket.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,BucketTypeRef,_TypeModel;return _export("createBucket",function(values){return Object.assign(create(_TypeModel,BucketTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("BucketTypeRef",BucketTypeRef=new TypeRef("sys","Bucket")),_export("BucketTypeRef",BucketTypeRef),_export("_TypeModel",_TypeModel={name:"Bucket",since:1,type:"AGGREGATED_TYPE",id:129,rootId:"A3N5cwAAgQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:130,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{bucketPermissions:{name:"bucketPermissions",id:131,since:1,type:"LIST_ASSOCIATION",cardinality:"One",refType:"BucketPermission",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CertificateInfo.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CertificateInfoTypeRef,_TypeModel;return _export("createCertificateInfo",function(values){return Object.assign(create(_TypeModel,CertificateInfoTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CertificateInfoTypeRef",CertificateInfoTypeRef=new TypeRef("sys","CertificateInfo")),_export("CertificateInfoTypeRef",CertificateInfoTypeRef),_export("_TypeModel",_TypeModel={name:"CertificateInfo",since:44,type:"AGGREGATED_TYPE",id:1500,rootId:"A3N5cwAF3A",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1501,since:44,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},expiryDate:{name:"expiryDate",id:1502,since:44,type:"Date",cardinality:"ZeroOrOne",final:!0,encrypted:!1},state:{name:"state",id:1503,since:44,type:"Number",cardinality:"One",final:!0,encrypted:!1},type:{name:"type",id:1504,since:44,type:"Number",cardinality:"One",final:!0,encrypted:!1}},associations:{certificate:{name:"certificate",id:1505,since:44,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"SslCertificate",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Challenge.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ChallengeTypeRef,_TypeModel;return _export("createChallenge",function(values){return Object.assign(create(_TypeModel,ChallengeTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ChallengeTypeRef",ChallengeTypeRef=new TypeRef("sys","Challenge")),_export("ChallengeTypeRef",ChallengeTypeRef),_export("_TypeModel",_TypeModel={name:"Challenge",since:23,type:"AGGREGATED_TYPE",id:1187,rootId:"A3N5cwAEow",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1188,since:23,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},type:{name:"type",id:1189,since:23,type:"Number",cardinality:"One",final:!0,encrypted:!1}},associations:{otp:{name:"otp",id:1247,since:24,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"OtpChallenge",final:!0},u2f:{name:"u2f",id:1190,since:23,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"U2fChallenge",final:!0}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Chat.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ChatTypeRef,_TypeModel;return _export("createChat",function(values){return Object.assign(create(_TypeModel,ChatTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ChatTypeRef",ChatTypeRef=new TypeRef("sys","Chat")),_export("ChatTypeRef",ChatTypeRef),_export("_TypeModel",_TypeModel={name:"Chat",since:1,type:"AGGREGATED_TYPE",id:457,rootId:"A3N5cwAByQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:458,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},recipient:{name:"recipient",id:460,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1},sender:{name:"sender",id:459,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1},text:{name:"text",id:461,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CreateGroupData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateGroupDataTypeRef,_TypeModel;return _export("createCreateGroupData",function(values){return Object.assign(create(_TypeModel,CreateGroupDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateGroupDataTypeRef",CreateGroupDataTypeRef=new TypeRef("sys","CreateGroupData")),_export("CreateGroupDataTypeRef",CreateGroupDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateGroupData",since:1,type:"AGGREGATED_TYPE",id:356,rootId:"A3N5cwABZA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:357,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},adminEncGKey:{name:"adminEncGKey",id:363,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},customerEncUserGroupInfoSessionKey:{name:"customerEncUserGroupInfoSessionKey",id:1040,since:17,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},encryptedName:{name:"encryptedName",id:358,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},listEncSessionKey:{name:"listEncSessionKey",id:364,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:359,since:1,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},pubKey:{name:"pubKey",id:360,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},symEncGKey:{name:"symEncGKey",id:362,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},symEncPrivKey:{name:"symEncPrivKey",id:361,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CreateGroupListData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateGroupListDataTypeRef,_TypeModel;return _export("createCreateGroupListData",function(values){return Object.assign(create(_TypeModel,CreateGroupListDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateGroupListDataTypeRef",CreateGroupListDataTypeRef=new TypeRef("sys","CreateGroupListData")),_export("CreateGroupListDataTypeRef",CreateGroupListDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateGroupListData",since:1,type:"AGGREGATED_TYPE",id:365,rootId:"A3N5cwABbQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:366,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},adminEncGroupInfoListKey:{name:"adminEncGroupInfoListKey",id:368,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},customerEncGroupInfoListKey:{name:"customerEncGroupInfoListKey",id:367,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{createGroupData:{name:"createGroupData",id:369,since:1,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"CreateGroupData",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CustomerData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CustomerDataTypeRef,_TypeModel;return _export("createCustomerData",function(values){return Object.assign(create(_TypeModel,CustomerDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CustomerDataTypeRef",CustomerDataTypeRef=new TypeRef("sys","CustomerData")),_export("CustomerDataTypeRef",CustomerDataTypeRef),_export("_TypeModel",_TypeModel={name:"CustomerData",since:1,type:"DATA_TRANSFER_TYPE",id:374,rootId:"A3N5cwABdg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:375,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},accountingInfoBucketEncAccountingInfoSessionKey:{name:"accountingInfoBucketEncAccountingInfoSessionKey",id:385,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},adminEncAccountingInfoSessionKey:{name:"adminEncAccountingInfoSessionKey",id:383,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},authToken:{name:"authToken",id:376,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},company:{name:"company",id:377,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},date:{name:"date",id:877,since:9,type:"Date",cardinality:"ZeroOrOne",final:!1,encrypted:!1},domain:{name:"domain",id:378,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},salt:{name:"salt",id:388,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},symEncAccountGroupKey:{name:"symEncAccountGroupKey",id:390,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},systemCustomerPubEncAccountingInfoBucketKey:{name:"systemCustomerPubEncAccountingInfoBucketKey",id:386,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},systemCustomerPubKeyVersion:{name:"systemCustomerPubKeyVersion",id:387,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},userEncClientKey:{name:"userEncClientKey",id:384,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},verifier:{name:"verifier",id:389,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{adminGroupList:{name:"adminGroupList",id:379,since:1,type:"AGGREGATION",cardinality:"One",refType:"CreateGroupListData",final:!1},customerGroupList:{name:"customerGroupList",id:381,since:1,type:"AGGREGATION",cardinality:"One",refType:"CreateGroupListData",final:!1},teamGroupList:{name:"teamGroupList",id:382,since:1,type:"AGGREGATION",cardinality:"One",refType:"CreateGroupListData",final:!1},userGroupList:{name:"userGroupList",id:380,since:1,type:"AGGREGATION",cardinality:"One",refType:"CreateGroupListData",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CustomerInfoReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CustomerInfoReturnTypeRef,_TypeModel;return _export("createCustomerInfoReturn",function(values){return Object.assign(create(_TypeModel,CustomerInfoReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CustomerInfoReturnTypeRef",CustomerInfoReturnTypeRef=new TypeRef("sys","CustomerInfoReturn")),_export("CustomerInfoReturnTypeRef",CustomerInfoReturnTypeRef),_export("_TypeModel",_TypeModel={name:"CustomerInfoReturn",since:1,type:"DATA_TRANSFER_TYPE",id:550,rootId:"A3N5cwACJg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:551,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},sendMailDisabled:{name:"sendMailDisabled",id:552,since:1,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CustomerReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CustomerReturnTypeRef,_TypeModel;return _export("createCustomerReturn",function(values){return Object.assign(create(_TypeModel,CustomerReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CustomerReturnTypeRef",CustomerReturnTypeRef=new TypeRef("sys","CustomerReturn")),_export("CustomerReturnTypeRef",CustomerReturnTypeRef),_export("_TypeModel",_TypeModel={name:"CustomerReturn",since:1,type:"DATA_TRANSFER_TYPE",id:370,rootId:"A3N5cwABcg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:371,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{adminUser:{name:"adminUser",id:372,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!1,external:!1},adminUserGroup:{name:"adminUserGroup",id:373,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/DomainInfo.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DomainInfoTypeRef,_TypeModel;return _export("createDomainInfo",function(values){return Object.assign(create(_TypeModel,DomainInfoTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DomainInfoTypeRef",DomainInfoTypeRef=new TypeRef("sys","DomainInfo")),_export("DomainInfoTypeRef",DomainInfoTypeRef),_export("_TypeModel",_TypeModel={name:"DomainInfo",since:9,type:"AGGREGATED_TYPE",id:696,rootId:"A3N5cwACuA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:697,since:9,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},domain:{name:"domain",id:698,since:9,type:"String",cardinality:"One",final:!0,encrypted:!1},validatedMxRecord:{name:"validatedMxRecord",id:699,since:9,type:"Boolean",cardinality:"One",final:!0,encrypted:!1}},associations:{catchAllMailGroup:{name:"catchAllMailGroup",id:1044,since:18,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"Group",final:!0,external:!1},whitelabelConfig:{name:"whitelabelConfig",id:1136,since:22,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"WhitelabelConfig",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/DomainsRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DomainsRefTypeRef,_TypeModel;return _export("createDomainsRef",function(values){return Object.assign(create(_TypeModel,DomainsRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DomainsRefTypeRef",DomainsRefTypeRef=new TypeRef("sys","DomainsRef")),_export("DomainsRefTypeRef",DomainsRefTypeRef),_export("_TypeModel",_TypeModel={name:"DomainsRef",since:21,type:"AGGREGATED_TYPE",id:1096,rootId:"A3N5cwAESA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1097,since:21,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{items:{name:"items",id:1098,since:21,type:"LIST_ASSOCIATION",cardinality:"One",refType:"Domain",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/EntityUpdate.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,EntityUpdateTypeRef,_TypeModel;return _export("createEntityUpdate",function(values){return Object.assign(create(_TypeModel,EntityUpdateTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("EntityUpdateTypeRef",EntityUpdateTypeRef=new TypeRef("sys","EntityUpdate")),_export("EntityUpdateTypeRef",EntityUpdateTypeRef),_export("_TypeModel",_TypeModel={name:"EntityUpdate",since:1,type:"AGGREGATED_TYPE",id:462,rootId:"A3N5cwABzg",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:463,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},application:{name:"application",id:464,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},instanceId:{name:"instanceId",id:467,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},instanceListId:{name:"instanceListId",id:466,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},operation:{name:"operation",id:624,since:4,type:"Number",cardinality:"One",final:!1,encrypted:!1},type:{name:"type",id:465,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Exception.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ExceptionTypeRef,_TypeModel;return _export("createException",function(values){return Object.assign(create(_TypeModel,ExceptionTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ExceptionTypeRef",ExceptionTypeRef=new TypeRef("sys","Exception")),_export("ExceptionTypeRef",ExceptionTypeRef),_export("_TypeModel",_TypeModel={name:"Exception",since:1,type:"AGGREGATED_TYPE",id:468,rootId:"A3N5cwAB1A",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:469,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},msg:{name:"msg",id:471,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},type:{name:"type",id:470,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/ExternalPropertiesReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ExternalPropertiesReturnTypeRef,_TypeModel;return _export("createExternalPropertiesReturn",function(values){return Object.assign(create(_TypeModel,ExternalPropertiesReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ExternalPropertiesReturnTypeRef",ExternalPropertiesReturnTypeRef=new TypeRef("sys","ExternalPropertiesReturn")),_export("ExternalPropertiesReturnTypeRef",ExternalPropertiesReturnTypeRef),_export("_TypeModel",_TypeModel={name:"ExternalPropertiesReturn",since:6,type:"DATA_TRANSFER_TYPE",id:663,rootId:"A3N5cwAClw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:664,since:6,type:"Number",cardinality:"One",final:!1,encrypted:!1},accountType:{name:"accountType",id:666,since:6,type:"Number",cardinality:"One",final:!1,encrypted:!1},message:{name:"message",id:665,since:6,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{bigLogo:{name:"bigLogo",id:925,since:11,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"File",final:!1},smallLogo:{name:"smallLogo",id:924,since:11,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"File",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Feature.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,FeatureTypeRef,_TypeModel;return _export("createFeature",function(values){return Object.assign(create(_TypeModel,FeatureTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("FeatureTypeRef",FeatureTypeRef=new TypeRef("sys","Feature")),_export("FeatureTypeRef",FeatureTypeRef),_export("_TypeModel",_TypeModel={name:"Feature",since:25,type:"AGGREGATED_TYPE",id:1253,rootId:"A3N5cwAE5Q",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1254,since:25,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},feature:{name:"feature",id:1255,since:25,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/File.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,FileTypeRef,_TypeModel;return _export("createFile",function(values){return Object.assign(create(_TypeModel,FileTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("FileTypeRef",FileTypeRef=new TypeRef("sys","File")),_export("FileTypeRef",FileTypeRef),_export("_TypeModel",_TypeModel={name:"File",since:11,type:"AGGREGATED_TYPE",id:917,rootId:"A3N5cwADlQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:918,since:11,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},data:{name:"data",id:921,since:11,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},mimeType:{name:"mimeType",id:920,since:11,type:"String",cardinality:"One",final:!1,encrypted:!1},name:{name:"name",id:919,since:11,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/GeneratedIdWrapper.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,GeneratedIdWrapperTypeRef,_TypeModel;return _export("createGeneratedIdWrapper",function(values){return Object.assign(create(_TypeModel,GeneratedIdWrapperTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("GeneratedIdWrapperTypeRef",GeneratedIdWrapperTypeRef=new TypeRef("sys","GeneratedIdWrapper")),_export("GeneratedIdWrapperTypeRef",GeneratedIdWrapperTypeRef),_export("_TypeModel",_TypeModel={name:"GeneratedIdWrapper",since:32,type:"AGGREGATED_TYPE",id:1349,rootId:"A3N5cwAFRQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1350,since:32,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},value:{name:"value",id:1351,since:32,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/GroupMembership.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,GroupMembershipTypeRef,_TypeModel;return _export("createGroupMembership",function(values){return Object.assign(create(_TypeModel,GroupMembershipTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("GroupMembershipTypeRef",GroupMembershipTypeRef=new TypeRef("sys","GroupMembership")),_export("GroupMembershipTypeRef",GroupMembershipTypeRef),_export("_TypeModel",_TypeModel={name:"GroupMembership",since:1,type:"AGGREGATED_TYPE",id:25,rootId:"A3N5cwAZ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:26,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},admin:{name:"admin",id:28,since:1,type:"Boolean",cardinality:"One",final:!0,encrypted:!1},capability:{name:"capability",id:1626,since:52,type:"Number",cardinality:"ZeroOrOne",final:!0,encrypted:!1},groupType:{name:"groupType",id:1030,since:17,type:"Number",cardinality:"ZeroOrOne",final:!0,encrypted:!1},symEncGKey:{name:"symEncGKey",id:27,since:1,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{group:{name:"group",id:29,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!0,external:!1},groupInfo:{name:"groupInfo",id:30,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"GroupInfo",final:!0,external:!1},groupMember:{name:"groupMember",id:230,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"GroupMember",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Invoice.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,InvoiceTypeRef,_TypeModel;return _export("createInvoice",function(values){return Object.assign(create(_TypeModel,InvoiceTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("InvoiceTypeRef",InvoiceTypeRef=new TypeRef("sys","Invoice")),_export("InvoiceTypeRef",InvoiceTypeRef),_export("_TypeModel",_TypeModel={name:"Invoice",since:52,type:"ELEMENT_TYPE",id:1650,rootId:"A3N5cwAGcg",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:1654,since:52,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:1652,since:52,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerEncSessionKey:{name:"_ownerEncSessionKey",id:1656,since:52,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1655,since:52,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:1653,since:52,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},address:{name:"address",id:1661,since:52,type:"String",cardinality:"One",final:!1,encrypted:!0},adminUser:{name:"adminUser",id:1668,since:52,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!0},business:{name:"business",id:1662,since:52,type:"Boolean",cardinality:"One",final:!0,encrypted:!0},country:{name:"country",id:1660,since:52,type:"String",cardinality:"One",final:!0,encrypted:!0},date:{name:"date",id:1658,since:52,type:"Date",cardinality:"One",final:!0,encrypted:!0},grandTotal:{name:"grandTotal",id:1667,since:52,type:"Number",cardinality:"One",final:!0,encrypted:!0},paymentMethod:{name:"paymentMethod",id:1659,since:52,type:"Number",cardinality:"One",final:!1,encrypted:!0},reason:{name:"reason",id:1669,since:52,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!0},subTotal:{name:"subTotal",id:1666,since:52,type:"Number",cardinality:"One",final:!0,encrypted:!0},type:{name:"type",id:1657,since:52,type:"Number",cardinality:"One",final:!0,encrypted:!0},vat:{name:"vat",id:1665,since:52,type:"Number",cardinality:"One",final:!0,encrypted:!0},vatIdNumber:{name:"vatIdNumber",id:1663,since:52,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!0},vatRate:{name:"vatRate",id:1664,since:52,type:"Number",cardinality:"One",final:!0,encrypted:!0}},associations:{items:{name:"items",id:1670,since:52,type:"AGGREGATION",cardinality:"Any",refType:"InvoiceItem",final:!0},bookings:{name:"bookings",id:1672,since:52,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"Any",refType:"Booking",final:!0,external:!1},customer:{name:"customer",id:1671,since:52,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Customer",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/InvoiceItem.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,InvoiceItemTypeRef,_TypeModel;return _export("createInvoiceItem",function(values){return Object.assign(create(_TypeModel,InvoiceItemTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("InvoiceItemTypeRef",InvoiceItemTypeRef=new TypeRef("sys","InvoiceItem")),_export("InvoiceItemTypeRef",InvoiceItemTypeRef),_export("_TypeModel",_TypeModel={name:"InvoiceItem",since:52,type:"AGGREGATED_TYPE",id:1641,rootId:"A3N5cwAGaQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1642,since:52,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},amount:{name:"amount",id:1643,since:52,type:"Number",cardinality:"One",final:!0,encrypted:!0},endDate:{name:"endDate",id:1648,since:52,type:"Date",cardinality:"ZeroOrOne",final:!0,encrypted:!0},singlePrice:{name:"singlePrice",id:1645,since:52,type:"Number",cardinality:"ZeroOrOne",final:!0,encrypted:!0},singleType:{name:"singleType",id:1649,since:52,type:"Boolean",cardinality:"One",final:!0,encrypted:!0},startDate:{name:"startDate",id:1647,since:52,type:"Date",cardinality:"ZeroOrOne",final:!0,encrypted:!0},totalPrice:{name:"totalPrice",id:1646,since:52,type:"Number",cardinality:"One",final:!0,encrypted:!0},type:{name:"type",id:1644,since:52,type:"Number",cardinality:"One",final:!0,encrypted:!0}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/KeyPair.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,KeyPairTypeRef,_TypeModel;return _export("createKeyPair",function(values){return Object.assign(create(_TypeModel,KeyPairTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("KeyPairTypeRef",KeyPairTypeRef=new TypeRef("sys","KeyPair")),_export("KeyPairTypeRef",KeyPairTypeRef),_export("_TypeModel",_TypeModel={name:"KeyPair",since:1,type:"AGGREGATED_TYPE",id:0,rootId:"A3N5cwAA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},pubKey:{name:"pubKey",id:2,since:1,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},symEncPrivKey:{name:"symEncPrivKey",id:3,since:1,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},version:{name:"version",id:4,since:1,type:"Number",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Login.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,LoginTypeRef,_TypeModel;return _export("createLogin",function(values){return Object.assign(create(_TypeModel,LoginTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("LoginTypeRef",LoginTypeRef=new TypeRef("sys","Login")),_export("LoginTypeRef",LoginTypeRef),_export("_TypeModel",_TypeModel={name:"Login",since:1,type:"LIST_ELEMENT_TYPE",id:48,rootId:"A3N5cwAw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:52,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:50,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:993,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:51,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},time:{name:"time",id:53,since:1,type:"Date",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/MailAddressAlias.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MailAddressAliasTypeRef,_TypeModel;return _export("createMailAddressAlias",function(values){return Object.assign(create(_TypeModel,MailAddressAliasTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MailAddressAliasTypeRef",MailAddressAliasTypeRef=new TypeRef("sys","MailAddressAlias")),_export("MailAddressAliasTypeRef",MailAddressAliasTypeRef),_export("_TypeModel",_TypeModel={name:"MailAddressAlias",since:8,type:"AGGREGATED_TYPE",id:684,rootId:"A3N5cwACrA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:685,since:8,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},enabled:{name:"enabled",id:784,since:9,type:"Boolean",cardinality:"One",final:!0,encrypted:!1},mailAddress:{name:"mailAddress",id:686,since:8,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/MailAddressToGroup.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MailAddressToGroupTypeRef,_TypeModel;return _export("createMailAddressToGroup",function(values){return Object.assign(create(_TypeModel,MailAddressToGroupTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MailAddressToGroupTypeRef",MailAddressToGroupTypeRef=new TypeRef("sys","MailAddressToGroup")),_export("MailAddressToGroupTypeRef",MailAddressToGroupTypeRef),_export("_TypeModel",_TypeModel={name:"MailAddressToGroup",since:1,type:"ELEMENT_TYPE",id:204,rootId:"A3N5cwAAzA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:208,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:206,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1019,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:207,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1}},associations:{internalGroup:{name:"internalGroup",id:209,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/MissedNotification.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MissedNotificationTypeRef,_TypeModel;return _export("createMissedNotification",function(values){return Object.assign(create(_TypeModel,MissedNotificationTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MissedNotificationTypeRef",MissedNotificationTypeRef=new TypeRef("sys","MissedNotification")),_export("MissedNotificationTypeRef",MissedNotificationTypeRef),_export("_TypeModel",_TypeModel={name:"MissedNotification",since:53,type:"ELEMENT_TYPE",id:1693,rootId:"A3N5cwAGnQ",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:1697,since:53,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:1695,since:53,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},_ownerEncSessionKey:{name:"_ownerEncSessionKey",id:1699,since:53,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1698,since:53,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:1696,since:53,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},changeTime:{name:"changeTime",id:1701,since:53,type:"Date",cardinality:"One",final:!0,encrypted:!1},confirmationId:{name:"confirmationId",id:1700,since:53,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},lastProcessedNotificationId:{name:"lastProcessedNotificationId",id:1722,since:55,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1}},associations:{alarmNotifications:{name:"alarmNotifications",id:1703,since:53,type:"AGGREGATION",cardinality:"Any",refType:"AlarmNotification",final:!1},notificationInfos:{name:"notificationInfos",id:1702,since:53,type:"AGGREGATION",cardinality:"Any",refType:"NotificationInfo",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/NotificationInfo.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,NotificationInfoTypeRef,_TypeModel;return _export("createNotificationInfo",function(values){return Object.assign(create(_TypeModel,NotificationInfoTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("NotificationInfoTypeRef",NotificationInfoTypeRef=new TypeRef("sys","NotificationInfo")),_export("NotificationInfoTypeRef",NotificationInfoTypeRef),_export("_TypeModel",_TypeModel={name:"NotificationInfo",since:32,type:"AGGREGATED_TYPE",id:1364,rootId:"A3N5cwAFVA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1365,since:32,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},counter:{name:"counter",id:1367,since:32,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:1366,since:32,type:"String",cardinality:"One",final:!1,encrypted:!1},userId:{name:"userId",id:1368,since:32,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/OtpChallenge.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,OtpChallengeTypeRef,_TypeModel;return _export("createOtpChallenge",function(values){return Object.assign(create(_TypeModel,OtpChallengeTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("OtpChallengeTypeRef",OtpChallengeTypeRef=new TypeRef("sys","OtpChallenge")),_export("OtpChallengeTypeRef",OtpChallengeTypeRef),_export("_TypeModel",_TypeModel={name:"OtpChallenge",since:24,type:"AGGREGATED_TYPE",id:1244,rootId:"A3N5cwAE3A",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1245,since:24,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{secondFactors:{name:"secondFactors",id:1246,since:24,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"Any",refType:"SecondFactor",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PaymentErrorInfo.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PaymentErrorInfoTypeRef,_TypeModel;return _export("createPaymentErrorInfo",function(values){return Object.assign(create(_TypeModel,PaymentErrorInfoTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PaymentErrorInfoTypeRef",PaymentErrorInfoTypeRef=new TypeRef("sys","PaymentErrorInfo")),_export("PaymentErrorInfoTypeRef",PaymentErrorInfoTypeRef),_export("_TypeModel",_TypeModel={name:"PaymentErrorInfo",since:52,type:"AGGREGATED_TYPE",id:1632,rootId:"A3N5cwAGYA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1633,since:52,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},errorCode:{name:"errorCode",id:1635,since:52,type:"String",cardinality:"One",final:!0,encrypted:!1},errorTime:{name:"errorTime",id:1634,since:52,type:"Date",cardinality:"One",final:!0,encrypted:!1},thirdPartyErrorId:{name:"thirdPartyErrorId",id:1636,since:52,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PhoneNumber.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PhoneNumberTypeRef,_TypeModel;return _export("createPhoneNumber",function(values){return Object.assign(create(_TypeModel,PhoneNumberTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PhoneNumberTypeRef",PhoneNumberTypeRef=new TypeRef("sys","PhoneNumber")),_export("PhoneNumberTypeRef",PhoneNumberTypeRef),_export("_TypeModel",_TypeModel={name:"PhoneNumber",since:1,type:"AGGREGATED_TYPE",id:63,rootId:"A3N5cwA_",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:64,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},number:{name:"number",id:65,since:1,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PremiumFeatureData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PremiumFeatureDataTypeRef,_TypeModel;return _export("createPremiumFeatureData",function(values){return Object.assign(create(_TypeModel,PremiumFeatureDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PremiumFeatureDataTypeRef",PremiumFeatureDataTypeRef=new TypeRef("sys","PremiumFeatureData")),_export("PremiumFeatureDataTypeRef",PremiumFeatureDataTypeRef),_export("_TypeModel",_TypeModel={name:"PremiumFeatureData",since:6,type:"DATA_TRANSFER_TYPE",id:651,rootId:"A3N5cwACiw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:652,since:6,type:"Number",cardinality:"One",final:!1,encrypted:!1},activationCode:{name:"activationCode",id:654,since:6,type:"String",cardinality:"One",final:!1,encrypted:!1},featureName:{name:"featureName",id:653,since:6,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PremiumFeatureReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PremiumFeatureReturnTypeRef,_TypeModel;return _export("createPremiumFeatureReturn",function(values){return Object.assign(create(_TypeModel,PremiumFeatureReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PremiumFeatureReturnTypeRef",PremiumFeatureReturnTypeRef=new TypeRef("sys","PremiumFeatureReturn")),_export("PremiumFeatureReturnTypeRef",PremiumFeatureReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PremiumFeatureReturn",since:16,type:"DATA_TRANSFER_TYPE",id:978,rootId:"A3N5cwAD0g",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:979,since:16,type:"Number",cardinality:"One",final:!1,encrypted:!1},activatedFeature:{name:"activatedFeature",id:980,since:16,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PriceData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PriceDataTypeRef,_TypeModel;return _export("createPriceData",function(values){return Object.assign(create(_TypeModel,PriceDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PriceDataTypeRef",PriceDataTypeRef=new TypeRef("sys","PriceData")),_export("PriceDataTypeRef",PriceDataTypeRef),_export("_TypeModel",_TypeModel={name:"PriceData",since:9,type:"AGGREGATED_TYPE",id:853,rootId:"A3N5cwADVQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:854,since:9,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},paymentInterval:{name:"paymentInterval",id:857,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},price:{name:"price",id:855,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},taxIncluded:{name:"taxIncluded",id:856,since:9,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{items:{name:"items",id:858,since:9,type:"AGGREGATION",cardinality:"Any",refType:"PriceItemData",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PriceItemData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PriceItemDataTypeRef,_TypeModel;return _export("createPriceItemData",function(values){return Object.assign(create(_TypeModel,PriceItemDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PriceItemDataTypeRef",PriceItemDataTypeRef=new TypeRef("sys","PriceItemData")),_export("PriceItemDataTypeRef",PriceItemDataTypeRef),_export("_TypeModel",_TypeModel={name:"PriceItemData",since:9,type:"AGGREGATED_TYPE",id:847,rootId:"A3N5cwADTw",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:848,since:9,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},count:{name:"count",id:850,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},featureType:{name:"featureType",id:849,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},price:{name:"price",id:851,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},singleType:{name:"singleType",id:852,since:9,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PushIdentifierList.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PushIdentifierListTypeRef,_TypeModel;return _export("createPushIdentifierList",function(values){return Object.assign(create(_TypeModel,PushIdentifierListTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PushIdentifierListTypeRef",PushIdentifierListTypeRef=new TypeRef("sys","PushIdentifierList")),_export("PushIdentifierListTypeRef",PushIdentifierListTypeRef),_export("_TypeModel",_TypeModel={name:"PushIdentifierList",since:5,type:"AGGREGATED_TYPE",id:635,rootId:"A3N5cwACew",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:636,since:5,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{list:{name:"list",id:637,since:5,type:"LIST_ASSOCIATION",cardinality:"One",refType:"PushIdentifier",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/RegistrationConfigReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,RegistrationConfigReturnTypeRef,_TypeModel;return _export("createRegistrationConfigReturn",function(values){return Object.assign(create(_TypeModel,RegistrationConfigReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("RegistrationConfigReturnTypeRef",RegistrationConfigReturnTypeRef=new TypeRef("sys","RegistrationConfigReturn")),_export("RegistrationConfigReturnTypeRef",RegistrationConfigReturnTypeRef),_export("_TypeModel",_TypeModel={name:"RegistrationConfigReturn",since:2,type:"DATA_TRANSFER_TYPE",id:606,rootId:"A3N5cwACXg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:607,since:2,type:"Number",cardinality:"One",final:!1,encrypted:!1},freeEnabled:{name:"freeEnabled",id:609,since:2,type:"Boolean",cardinality:"One",final:!1,encrypted:!1},starterEnabled:{name:"starterEnabled",id:608,since:2,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/RegistrationReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,RegistrationReturnTypeRef,_TypeModel;return _export("createRegistrationReturn",function(values){return Object.assign(create(_TypeModel,RegistrationReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("RegistrationReturnTypeRef",RegistrationReturnTypeRef=new TypeRef("sys","RegistrationReturn")),_export("RegistrationReturnTypeRef",RegistrationReturnTypeRef),_export("_TypeModel",_TypeModel={name:"RegistrationReturn",since:1,type:"DATA_TRANSFER_TYPE",id:326,rootId:"A3N5cwABRg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:327,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},authToken:{name:"authToken",id:328,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/RegistrationServiceData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,RegistrationServiceDataTypeRef,_TypeModel;return _export("createRegistrationServiceData",function(values){return Object.assign(create(_TypeModel,RegistrationServiceDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("RegistrationServiceDataTypeRef",RegistrationServiceDataTypeRef=new TypeRef("sys","RegistrationServiceData")),_export("RegistrationServiceDataTypeRef",RegistrationServiceDataTypeRef),_export("_TypeModel",_TypeModel={name:"RegistrationServiceData",since:1,type:"DATA_TRANSFER_TYPE",id:316,rootId:"A3N5cwABPA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:317,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},starterDomain:{name:"starterDomain",id:322,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},source:{name:"source",id:874,since:9,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},state:{name:"state",id:325,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/SecondFactorAuthAllowedReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SecondFactorAuthAllowedReturnTypeRef,_TypeModel;return _export("createSecondFactorAuthAllowedReturn",function(values){return Object.assign(create(_TypeModel,SecondFactorAuthAllowedReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SecondFactorAuthAllowedReturnTypeRef",SecondFactorAuthAllowedReturnTypeRef=new TypeRef("sys","SecondFactorAuthAllowedReturn")),_export("SecondFactorAuthAllowedReturnTypeRef",SecondFactorAuthAllowedReturnTypeRef),_export("_TypeModel",_TypeModel={name:"SecondFactorAuthAllowedReturn",since:1,type:"DATA_TRANSFER_TYPE",id:546,rootId:"A3N5cwACIg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:547,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},allowed:{name:"allowed",id:548,since:1,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/SecondFactorAuthentication.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SecondFactorAuthenticationTypeRef,_TypeModel;return _export("createSecondFactorAuthentication",function(values){return Object.assign(create(_TypeModel,SecondFactorAuthenticationTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SecondFactorAuthenticationTypeRef",SecondFactorAuthenticationTypeRef=new TypeRef("sys","SecondFactorAuthentication")),_export("SecondFactorAuthenticationTypeRef",SecondFactorAuthenticationTypeRef),_export("_TypeModel",_TypeModel={name:"SecondFactorAuthentication",since:1,type:"LIST_ELEMENT_TYPE",id:54,rootId:"A3N5cwA2",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:58,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:56,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:994,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:57,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},code:{name:"code",id:59,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},finished:{name:"finished",id:61,since:1,type:"Boolean",cardinality:"One",final:!1,encrypted:!1},service:{name:"service",id:62,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},verifyCount:{name:"verifyCount",id:60,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/SendRegistrationCodeData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SendRegistrationCodeDataTypeRef,_TypeModel;return _export("createSendRegistrationCodeData",function(values){return Object.assign(create(_TypeModel,SendRegistrationCodeDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SendRegistrationCodeDataTypeRef",SendRegistrationCodeDataTypeRef=new TypeRef("sys","SendRegistrationCodeData")),_export("SendRegistrationCodeDataTypeRef",SendRegistrationCodeDataTypeRef),_export("_TypeModel",_TypeModel={name:"SendRegistrationCodeData",since:1,type:"DATA_TRANSFER_TYPE",id:341,rootId:"A3N5cwABVQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:342,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},accountType:{name:"accountType",id:345,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},authToken:{name:"authToken",id:343,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},language:{name:"language",id:344,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},mobilePhoneNumber:{name:"mobilePhoneNumber",id:346,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/SendRegistrationCodeReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SendRegistrationCodeReturnTypeRef,_TypeModel;return _export("createSendRegistrationCodeReturn",function(values){return Object.assign(create(_TypeModel,SendRegistrationCodeReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SendRegistrationCodeReturnTypeRef",SendRegistrationCodeReturnTypeRef=new TypeRef("sys","SendRegistrationCodeReturn")),_export("SendRegistrationCodeReturnTypeRef",SendRegistrationCodeReturnTypeRef),_export("_TypeModel",_TypeModel={name:"SendRegistrationCodeReturn",since:1,type:"DATA_TRANSFER_TYPE",id:347,rootId:"A3N5cwABWw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:348,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},authToken:{name:"authToken",id:349,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/SseConnectData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SseConnectDataTypeRef,_TypeModel;return _export("createSseConnectData",function(values){return Object.assign(create(_TypeModel,SseConnectDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SseConnectDataTypeRef",SseConnectDataTypeRef=new TypeRef("sys","SseConnectData")),_export("SseConnectDataTypeRef",SseConnectDataTypeRef),_export("_TypeModel",_TypeModel={name:"SseConnectData",since:32,type:"DATA_TRANSFER_TYPE",id:1352,rootId:"A3N5cwAFSA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1353,since:32,type:"Number",cardinality:"One",final:!1,encrypted:!1},identifier:{name:"identifier",id:1354,since:32,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{userIds:{name:"userIds",id:1355,since:32,type:"AGGREGATION",cardinality:"Any",refType:"GeneratedIdWrapper",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/StringConfigValue.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,StringConfigValueTypeRef,_TypeModel;return _export("createStringConfigValue",function(values){return Object.assign(create(_TypeModel,StringConfigValueTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("StringConfigValueTypeRef",StringConfigValueTypeRef=new TypeRef("sys","StringConfigValue")),_export("StringConfigValueTypeRef",StringConfigValueTypeRef),_export("_TypeModel",_TypeModel={name:"StringConfigValue",since:1,type:"AGGREGATED_TYPE",id:515,rootId:"A3N5cwACAw",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:516,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},name:{name:"name",id:517,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},value:{name:"value",id:518,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/U2fChallenge.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,U2fChallengeTypeRef,_TypeModel;return _export("createU2fChallenge",function(values){return Object.assign(create(_TypeModel,U2fChallengeTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("U2fChallengeTypeRef",U2fChallengeTypeRef=new TypeRef("sys","U2fChallenge")),_export("U2fChallengeTypeRef",U2fChallengeTypeRef),_export("_TypeModel",_TypeModel={name:"U2fChallenge",since:23,type:"AGGREGATED_TYPE",id:1183,rootId:"A3N5cwAEnw",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1184,since:23,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},challenge:{name:"challenge",id:1185,since:23,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{keys:{name:"keys",id:1186,since:23,type:"AGGREGATION",cardinality:"Any",refType:"U2fKey",final:!0}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/U2fKey.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,U2fKeyTypeRef,_TypeModel;return _export("createU2fKey",function(values){return Object.assign(create(_TypeModel,U2fKeyTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("U2fKeyTypeRef",U2fKeyTypeRef=new TypeRef("sys","U2fKey")),_export("U2fKeyTypeRef",U2fKeyTypeRef),_export("_TypeModel",_TypeModel={name:"U2fKey",since:23,type:"AGGREGATED_TYPE",id:1178,rootId:"A3N5cwAEmg",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1179,since:23,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},appId:{name:"appId",id:1181,since:23,type:"String",cardinality:"One",final:!0,encrypted:!1},keyHandle:{name:"keyHandle",id:1180,since:23,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{secondFactor:{name:"secondFactor",id:1182,since:23,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"SecondFactor",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserAlarmInfoListType.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserAlarmInfoListTypeTypeRef,_TypeModel;return _export("createUserAlarmInfoListType",function(values){return Object.assign(create(_TypeModel,UserAlarmInfoListTypeTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserAlarmInfoListTypeTypeRef",UserAlarmInfoListTypeTypeRef=new TypeRef("sys","UserAlarmInfoListType")),_export("UserAlarmInfoListTypeTypeRef",UserAlarmInfoListTypeTypeRef),_export("_TypeModel",_TypeModel={name:"UserAlarmInfoListType",since:48,type:"AGGREGATED_TYPE",id:1549,rootId:"A3N5cwAGDQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1550,since:48,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{alarms:{name:"alarms",id:1551,since:48,type:"LIST_ASSOCIATION",cardinality:"One",refType:"UserAlarmInfo",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserAreaGroups.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserAreaGroupsTypeRef,_TypeModel;return _export("createUserAreaGroups",function(values){return Object.assign(create(_TypeModel,UserAreaGroupsTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserAreaGroupsTypeRef",UserAreaGroupsTypeRef=new TypeRef("sys","UserAreaGroups")),_export("UserAreaGroupsTypeRef",UserAreaGroupsTypeRef),_export("_TypeModel",_TypeModel={name:"UserAreaGroups",since:17,type:"AGGREGATED_TYPE",id:988,rootId:"A3N5cwAD3A",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:989,since:17,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{list:{name:"list",id:990,since:17,type:"LIST_ASSOCIATION",cardinality:"One",refType:"GroupInfo",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserAuthentication.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserAuthenticationTypeRef,_TypeModel;return _export("createUserAuthentication",function(values){return Object.assign(create(_TypeModel,UserAuthenticationTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserAuthenticationTypeRef",UserAuthenticationTypeRef=new TypeRef("sys","UserAuthentication")),_export("UserAuthenticationTypeRef",UserAuthenticationTypeRef),_export("_TypeModel",_TypeModel={name:"UserAuthentication",since:23,type:"AGGREGATED_TYPE",id:1206,rootId:"A3N5cwAEtg",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1207,since:23,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{recoverCode:{name:"recoverCode",id:1416,since:36,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"RecoverCode",final:!1,external:!1},secondFactors:{name:"secondFactors",id:1209,since:23,type:"LIST_ASSOCIATION",cardinality:"One",refType:"SecondFactor",final:!0,external:!1},sessions:{name:"sessions",id:1208,since:23,type:"LIST_ASSOCIATION",cardinality:"One",refType:"Session",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserDataTypeRef,_TypeModel;return _export("createUserData",function(values){return Object.assign(create(_TypeModel,UserDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserDataTypeRef",UserDataTypeRef=new TypeRef("sys","UserData")),_export("UserDataTypeRef",UserDataTypeRef),_export("_TypeModel",_TypeModel={name:"UserData",since:1,type:"DATA_TRANSFER_TYPE",id:396,rootId:"A3N5cwABjA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:397,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},date:{name:"date",id:878,since:9,type:"Date",cardinality:"ZeroOrOne",final:!1,encrypted:!1},mobilePhoneNumber:{name:"mobilePhoneNumber",id:403,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},salt:{name:"salt",id:401,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncClientKey:{name:"userEncClientKey",id:398,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncCustomerGroupKey:{name:"userEncCustomerGroupKey",id:399,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},verifier:{name:"verifier",id:402,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{userGroupData:{name:"userGroupData",id:400,since:1,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"CreateGroupData",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserExternalAuthInfo.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserExternalAuthInfoTypeRef,_TypeModel;return _export("createUserExternalAuthInfo",function(values){return Object.assign(create(_TypeModel,UserExternalAuthInfoTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserExternalAuthInfoTypeRef",UserExternalAuthInfoTypeRef=new TypeRef("sys","UserExternalAuthInfo")),_export("UserExternalAuthInfoTypeRef",UserExternalAuthInfoTypeRef),_export("_TypeModel",_TypeModel={name:"UserExternalAuthInfo",since:1,type:"AGGREGATED_TYPE",id:77,rootId:"A3N5cwBN",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:78,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},authUpdateCounter:{name:"authUpdateCounter",id:82,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},autoAuthenticationId:{name:"autoAuthenticationId",id:79,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},autoTransmitPassword:{name:"autoTransmitPassword",id:81,since:1,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},latestSaltHash:{name:"latestSaltHash",id:80,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1}},associations:{variableAuthInfo:{name:"variableAuthInfo",id:83,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"VariableExternalAuthInfo",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserIdData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserIdDataTypeRef,_TypeModel;return _export("createUserIdData",function(values){return Object.assign(create(_TypeModel,UserIdDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserIdDataTypeRef",UserIdDataTypeRef=new TypeRef("sys","UserIdData")),_export("UserIdDataTypeRef",UserIdDataTypeRef),_export("_TypeModel",_TypeModel={name:"UserIdData",since:1,type:"DATA_TRANSFER_TYPE",id:424,rootId:"A3N5cwABqA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:425,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:426,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserIdReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserIdReturnTypeRef,_TypeModel;return _export("createUserIdReturn",function(values){return Object.assign(create(_TypeModel,UserIdReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserIdReturnTypeRef",UserIdReturnTypeRef=new TypeRef("sys","UserIdReturn")),_export("UserIdReturnTypeRef",UserIdReturnTypeRef),_export("_TypeModel",_TypeModel={name:"UserIdReturn",since:1,type:"DATA_TRANSFER_TYPE",id:427,rootId:"A3N5cwABqw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:428,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{userId:{name:"userId",id:429,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserReturnTypeRef,_TypeModel;return _export("createUserReturn",function(values){return Object.assign(create(_TypeModel,UserReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserReturnTypeRef",UserReturnTypeRef=new TypeRef("sys","UserReturn")),_export("UserReturnTypeRef",UserReturnTypeRef),_export("_TypeModel",_TypeModel={name:"UserReturn",since:1,type:"DATA_TRANSFER_TYPE",id:392,rootId:"A3N5cwABiA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:393,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{user:{name:"user",id:394,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!1,external:!1},userGroup:{name:"userGroup",id:395,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/VariableExternalAuthInfo.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,VariableExternalAuthInfoTypeRef,_TypeModel;return _export("createVariableExternalAuthInfo",function(values){return Object.assign(create(_TypeModel,VariableExternalAuthInfoTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("VariableExternalAuthInfoTypeRef",VariableExternalAuthInfoTypeRef=new TypeRef("sys","VariableExternalAuthInfo")),_export("VariableExternalAuthInfoTypeRef",VariableExternalAuthInfoTypeRef),_export("_TypeModel",_TypeModel={name:"VariableExternalAuthInfo",since:1,type:"ELEMENT_TYPE",id:66,rootId:"A3N5cwBC",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:70,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:68,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:995,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:69,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},authUpdateCounter:{name:"authUpdateCounter",id:76,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},lastSentTimestamp:{name:"lastSentTimestamp",id:75,since:1,type:"Date",cardinality:"One",final:!1,encrypted:!1},loggedInIpAddressHash:{name:"loggedInIpAddressHash",id:73,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},loggedInTimestamp:{name:"loggedInTimestamp",id:72,since:1,type:"Date",cardinality:"ZeroOrOne",final:!1,encrypted:!1},loggedInVerifier:{name:"loggedInVerifier",id:71,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},sentCount:{name:"sentCount",id:74,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/VerifyRegistrationCodeData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,VerifyRegistrationCodeDataTypeRef,_TypeModel;return _export("createVerifyRegistrationCodeData",function(values){return Object.assign(create(_TypeModel,VerifyRegistrationCodeDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("VerifyRegistrationCodeDataTypeRef",VerifyRegistrationCodeDataTypeRef=new TypeRef("sys","VerifyRegistrationCodeData")),_export("VerifyRegistrationCodeDataTypeRef",VerifyRegistrationCodeDataTypeRef),_export("_TypeModel",_TypeModel={name:"VerifyRegistrationCodeData",since:1,type:"DATA_TRANSFER_TYPE",id:351,rootId:"A3N5cwABXw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:352,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},authToken:{name:"authToken",id:353,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},code:{name:"code",id:354,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Version.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,VersionTypeRef,_TypeModel;return _export("createVersion",function(values){return Object.assign(create(_TypeModel,VersionTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("VersionTypeRef",VersionTypeRef=new TypeRef("sys","Version")),_export("VersionTypeRef",VersionTypeRef),_export("_TypeModel",_TypeModel={name:"Version",since:1,type:"AGGREGATED_TYPE",id:480,rootId:"A3N5cwAB4A",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:481,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},operation:{name:"operation",id:484,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},timestamp:{name:"timestamp",id:483,since:1,type:"Date",cardinality:"One",final:!1,encrypted:!1},version:{name:"version",id:482,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{author:{name:"author",id:485,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!1,external:!1},authorGroupInfo:{name:"authorGroupInfo",id:486,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"GroupInfo",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/VersionInfo.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,VersionInfoTypeRef,_TypeModel;return _export("createVersionInfo",function(values){return Object.assign(create(_TypeModel,VersionInfoTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("VersionInfoTypeRef",VersionInfoTypeRef=new TypeRef("sys","VersionInfo")),_export("VersionInfoTypeRef",VersionInfoTypeRef),_export("_TypeModel",_TypeModel={name:"VersionInfo",since:1,type:"LIST_ELEMENT_TYPE",id:237,rootId:"A3N5cwAA7Q",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:241,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:239,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1023,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:240,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},app:{name:"app",id:242,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},operation:{name:"operation",id:246,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},referenceList:{name:"referenceList",id:244,since:1,type:"GeneratedId",cardinality:"ZeroOrOne",final:!1,encrypted:!1},timestamp:{name:"timestamp",id:245,since:1,type:"Date",cardinality:"One",final:!1,encrypted:!1},type:{name:"type",id:243,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},versionData:{name:"versionData",id:247,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1}},associations:{author:{name:"author",id:248,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!1,external:!1},authorGroupInfo:{name:"authorGroupInfo",id:249,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"GroupInfo",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/WebsocketCounterData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,WebsocketCounterDataTypeRef,_TypeModel;return _export("createWebsocketCounterData",function(values){return Object.assign(create(_TypeModel,WebsocketCounterDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("WebsocketCounterDataTypeRef",WebsocketCounterDataTypeRef=new TypeRef("sys","WebsocketCounterData")),_export("WebsocketCounterDataTypeRef",WebsocketCounterDataTypeRef),_export("_TypeModel",_TypeModel={name:"WebsocketCounterData",since:41,type:"DATA_TRANSFER_TYPE",id:1492,rootId:"A3N5cwAF1A",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1493,since:41,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailGroup:{name:"mailGroup",id:1494,since:41,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{counterValues:{name:"counterValues",id:1495,since:41,type:"AGGREGATION",cardinality:"Any",refType:"WebsocketCounterValue",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/WebsocketCounterValue.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,WebsocketCounterValueTypeRef,_TypeModel;return _export("createWebsocketCounterValue",function(values){return Object.assign(create(_TypeModel,WebsocketCounterValueTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("WebsocketCounterValueTypeRef",WebsocketCounterValueTypeRef=new TypeRef("sys","WebsocketCounterValue")),_export("WebsocketCounterValueTypeRef",WebsocketCounterValueTypeRef),_export("_TypeModel",_TypeModel={name:"WebsocketCounterValue",since:41,type:"AGGREGATED_TYPE",id:1488,rootId:"A3N5cwAF0A",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1489,since:41,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},count:{name:"count",id:1491,since:41,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailListId:{name:"mailListId",id:1490,since:41,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/WhitelabelChildrenRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,WhitelabelChildrenRefTypeRef,_TypeModel;return _export("createWhitelabelChildrenRef",function(values){return Object.assign(create(_TypeModel,WhitelabelChildrenRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("WhitelabelChildrenRefTypeRef",WhitelabelChildrenRefTypeRef=new TypeRef("sys","WhitelabelChildrenRef")),_export("WhitelabelChildrenRefTypeRef",WhitelabelChildrenRefTypeRef),_export("_TypeModel",_TypeModel={name:"WhitelabelChildrenRef",since:26,type:"AGGREGATED_TYPE",id:1269,rootId:"A3N5cwAE9Q",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1270,since:26,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{items:{name:"items",id:1271,since:26,type:"LIST_ASSOCIATION",cardinality:"One",refType:"WhitelabelChild",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/WhitelabelParent.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,WhitelabelParentTypeRef,_TypeModel;return _export("createWhitelabelParent",function(values){return Object.assign(create(_TypeModel,WhitelabelParentTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("WhitelabelParentTypeRef",WhitelabelParentTypeRef=new TypeRef("sys","WhitelabelParent")),_export("WhitelabelParentTypeRef",WhitelabelParentTypeRef),_export("_TypeModel",_TypeModel={name:"WhitelabelParent",since:26,type:"AGGREGATED_TYPE",id:1272,rootId:"A3N5cwAE-A",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1273,since:26,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{customer:{name:"customer",id:1274,since:26,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Customer",final:!0,external:!1},whitelabelChildInParent:{name:"whitelabelChildInParent",id:1275,since:26,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"WhitelabelChild",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ContactFormEncryptedStatisticsField.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ContactFormEncryptedStatisticsFieldTypeRef,_TypeModel;return _export("createContactFormEncryptedStatisticsField",function(values){return Object.assign(create(_TypeModel,ContactFormEncryptedStatisticsFieldTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ContactFormEncryptedStatisticsFieldTypeRef",ContactFormEncryptedStatisticsFieldTypeRef=new TypeRef("tutanota","ContactFormEncryptedStatisticsField")),_export("ContactFormEncryptedStatisticsFieldTypeRef",ContactFormEncryptedStatisticsFieldTypeRef),_export("_TypeModel",_TypeModel={name:"ContactFormEncryptedStatisticsField",since:19,type:"AGGREGATED_TYPE",id:769,rootId:"CHR1dGFub3RhAAMB",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:770,since:19,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},name:{name:"name",id:771,since:19,type:"String",cardinality:"One",final:!0,encrypted:!0},value:{name:"value",id:772,since:19,type:"String",cardinality:"One",final:!0,encrypted:!0}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/CreateFileData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateFileDataTypeRef,_TypeModel;return _export("createCreateFileData",function(values){return Object.assign(create(_TypeModel,CreateFileDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateFileDataTypeRef",CreateFileDataTypeRef=new TypeRef("tutanota","CreateFileData")),_export("CreateFileDataTypeRef",CreateFileDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateFileData",since:1,type:"DATA_TRANSFER_TYPE",id:346,rootId:"CHR1dGFub3RhAAFa",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:347,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},fileName:{name:"fileName",id:348,since:1,type:"String",cardinality:"One",final:!0,encrypted:!0},group:{name:"group",id:350,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1},ownerEncSessionKey:{name:"ownerEncSessionKey",id:351,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},mimeType:{name:"mimeType",id:349,since:1,type:"String",cardinality:"One",final:!0,encrypted:!0}},associations:{fileData:{name:"fileData",id:352,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"FileData",final:!0,external:!1},parentFolder:{name:"parentFolder",id:353,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"File",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/CreateMailFolderReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateMailFolderReturnTypeRef,_TypeModel;return _export("createCreateMailFolderReturn",function(values){return Object.assign(create(_TypeModel,CreateMailFolderReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateMailFolderReturnTypeRef",CreateMailFolderReturnTypeRef=new TypeRef("tutanota","CreateMailFolderReturn")),_export("CreateMailFolderReturnTypeRef",CreateMailFolderReturnTypeRef),_export("_TypeModel",_TypeModel={name:"CreateMailFolderReturn",since:7,type:"DATA_TRANSFER_TYPE",id:455,rootId:"CHR1dGFub3RhAAHH",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:456,since:7,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{newFolder:{name:"newFolder",id:457,since:7,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"MailFolder",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DataBlock.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DataBlockTypeRef,_TypeModel;return _export("createDataBlock",function(values){return Object.assign(create(_TypeModel,DataBlockTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DataBlockTypeRef",DataBlockTypeRef=new TypeRef("tutanota","DataBlock")),_export("DataBlockTypeRef",DataBlockTypeRef),_export("_TypeModel",_TypeModel={name:"DataBlock",since:1,type:"AGGREGATED_TYPE",id:0,rootId:"CHR1dGFub3RhAAA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},blockData:{name:"blockData",id:3,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1},size:{name:"size",id:2,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DeleteContactFormConversationIndex.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DeleteContactFormConversationIndexTypeRef,_TypeModel;return _export("createDeleteContactFormConversationIndex",function(values){return Object.assign(create(_TypeModel,DeleteContactFormConversationIndexTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DeleteContactFormConversationIndexTypeRef",DeleteContactFormConversationIndexTypeRef=new TypeRef("tutanota","DeleteContactFormConversationIndex")),_export("DeleteContactFormConversationIndexTypeRef",DeleteContactFormConversationIndexTypeRef),_export("_TypeModel",_TypeModel={name:"DeleteContactFormConversationIndex",since:22,type:"AGGREGATED_TYPE",id:838,rootId:"CHR1dGFub3RhAANG",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:839,since:22,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{items:{name:"items",id:840,since:22,type:"LIST_ASSOCIATION",cardinality:"One",refType:"DeleteContactFormConversationIndexEntry",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DeleteContactFormConversationIndexEntry.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DeleteContactFormConversationIndexEntryTypeRef,_TypeModel;return _export("createDeleteContactFormConversationIndexEntry",function(values){return Object.assign(create(_TypeModel,DeleteContactFormConversationIndexEntryTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DeleteContactFormConversationIndexEntryTypeRef",DeleteContactFormConversationIndexEntryTypeRef=new TypeRef("tutanota","DeleteContactFormConversationIndexEntry")),_export("DeleteContactFormConversationIndexEntryTypeRef",DeleteContactFormConversationIndexEntryTypeRef),_export("_TypeModel",_TypeModel={name:"DeleteContactFormConversationIndexEntry",since:22,type:"LIST_ELEMENT_TYPE",id:832,rootId:"CHR1dGFub3RhAANA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:836,since:22,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:834,since:22,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:837,since:22,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:835,since:22,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/FileData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,FileDataTypeRef,_TypeModel;return _export("createFileData",function(values){return Object.assign(create(_TypeModel,FileDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("FileDataTypeRef",FileDataTypeRef=new TypeRef("tutanota","FileData")),_export("FileDataTypeRef",FileDataTypeRef),_export("_TypeModel",_TypeModel={name:"FileData",since:1,type:"ELEMENT_TYPE",id:4,rootId:"CHR1dGFub3RhAAQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:8,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:6,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:579,since:13,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:7,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},size:{name:"size",id:9,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},unreferenced:{name:"unreferenced",id:409,since:2,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{blocks:{name:"blocks",id:10,since:1,type:"AGGREGATION",cardinality:"Any",refType:"DataBlock",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/FileSystem.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,FileSystemTypeRef,_TypeModel;return _export("createFileSystem",function(values){return Object.assign(create(_TypeModel,FileSystemTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("FileSystemTypeRef",FileSystemTypeRef=new TypeRef("tutanota","FileSystem")),_export("FileSystemTypeRef",FileSystemTypeRef),_export("_TypeModel",_TypeModel={name:"FileSystem",since:1,type:"ELEMENT_TYPE",id:28,rootId:"CHR1dGFub3RhABw",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:32,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:30,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerEncSessionKey:{name:"_ownerEncSessionKey",id:582,since:13,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:581,since:13,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:31,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1}},associations:{files:{name:"files",id:35,since:1,type:"LIST_ASSOCIATION",cardinality:"One",refType:"File",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ImapFolder.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ImapFolderTypeRef,_TypeModel;return _export("createImapFolder",function(values){return Object.assign(create(_TypeModel,ImapFolderTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ImapFolderTypeRef",ImapFolderTypeRef=new TypeRef("tutanota","ImapFolder")),_export("ImapFolderTypeRef",ImapFolderTypeRef),_export("_TypeModel",_TypeModel={name:"ImapFolder",since:1,type:"AGGREGATED_TYPE",id:190,rootId:"CHR1dGFub3RhAAC-",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:191,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},lastseenuid:{name:"lastseenuid",id:193,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},name:{name:"name",id:192,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},uidvalidity:{name:"uidvalidity",id:194,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{syncInfo:{name:"syncInfo",id:195,since:1,type:"LIST_ASSOCIATION",cardinality:"One",refType:"RemoteImapSyncInfo",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ImapSyncConfiguration.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ImapSyncConfigurationTypeRef,_TypeModel;return _export("createImapSyncConfiguration",function(values){return Object.assign(create(_TypeModel,ImapSyncConfigurationTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ImapSyncConfigurationTypeRef",ImapSyncConfigurationTypeRef=new TypeRef("tutanota","ImapSyncConfiguration")),_export("ImapSyncConfigurationTypeRef",ImapSyncConfigurationTypeRef),_export("_TypeModel",_TypeModel={name:"ImapSyncConfiguration",since:1,type:"AGGREGATED_TYPE",id:209,rootId:"CHR1dGFub3RhAADR",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:210,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},host:{name:"host",id:211,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},password:{name:"password",id:214,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},port:{name:"port",id:212,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},user:{name:"user",id:213,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{imapSyncState:{name:"imapSyncState",id:215,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"ImapSyncState",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ImapSyncState.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ImapSyncStateTypeRef,_TypeModel;return _export("createImapSyncState",function(values){return Object.assign(create(_TypeModel,ImapSyncStateTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ImapSyncStateTypeRef",ImapSyncStateTypeRef=new TypeRef("tutanota","ImapSyncState")),_export("ImapSyncStateTypeRef",ImapSyncStateTypeRef),_export("_TypeModel",_TypeModel={name:"ImapSyncState",since:1,type:"ELEMENT_TYPE",id:196,rootId:"CHR1dGFub3RhAADE",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:200,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:198,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:595,since:13,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:199,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1}},associations:{folders:{name:"folders",id:201,since:1,type:"AGGREGATION",cardinality:"Any",refType:"ImapFolder",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/MailFolderRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MailFolderRefTypeRef,_TypeModel;return _export("createMailFolderRef",function(values){return Object.assign(create(_TypeModel,MailFolderRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MailFolderRefTypeRef",MailFolderRefTypeRef=new TypeRef("tutanota","MailFolderRef")),_export("MailFolderRefTypeRef",MailFolderRefTypeRef),_export("_TypeModel",_TypeModel={name:"MailFolderRef",since:7,type:"AGGREGATED_TYPE",id:440,rootId:"CHR1dGFub3RhAAG4",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:441,since:7,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{folders:{name:"folders",id:442,since:7,type:"LIST_ASSOCIATION",cardinality:"One",refType:"MailFolder",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/MailRestriction.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MailRestrictionTypeRef,_TypeModel;return _export("createMailRestriction",function(values){return Object.assign(create(_TypeModel,MailRestrictionTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MailRestrictionTypeRef",MailRestrictionTypeRef=new TypeRef("tutanota","MailRestriction")),_export("MailRestrictionTypeRef",MailRestrictionTypeRef),_export("_TypeModel",_TypeModel={name:"MailRestriction",since:19,type:"AGGREGATED_TYPE",id:719,rootId:"CHR1dGFub3RhAALP",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:720,since:19,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{delegationGroups_removed:{name:"delegationGroups_removed",id:722,since:19,type:"ELEMENT_ASSOCIATION",cardinality:"Any",refType:"Group",final:!0,external:!0},participantGroupInfos:{name:"participantGroupInfos",id:820,since:21,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"Any",refType:"GroupInfo",final:!0,external:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/NotificationMail.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,NotificationMailTypeRef,_TypeModel;return _export("createNotificationMail",function(values){return Object.assign(create(_TypeModel,NotificationMailTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("NotificationMailTypeRef",NotificationMailTypeRef=new TypeRef("tutanota","NotificationMail")),_export("NotificationMailTypeRef",NotificationMailTypeRef),_export("_TypeModel",_TypeModel={name:"NotificationMail",since:1,type:"AGGREGATED_TYPE",id:223,rootId:"CHR1dGFub3RhAADf",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:224,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},bodyText:{name:"bodyText",id:226,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},mailboxLink:{name:"mailboxLink",id:417,since:3,type:"String",cardinality:"One",final:!1,encrypted:!1},recipientMailAddress:{name:"recipientMailAddress",id:227,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},recipientName:{name:"recipientName",id:228,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},subject:{name:"subject",id:225,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/PasswordAutoAuthenticationReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PasswordAutoAuthenticationReturnTypeRef,_TypeModel;return _export("createPasswordAutoAuthenticationReturn",function(values){return Object.assign(create(_TypeModel,PasswordAutoAuthenticationReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PasswordAutoAuthenticationReturnTypeRef",PasswordAutoAuthenticationReturnTypeRef=new TypeRef("tutanota","PasswordAutoAuthenticationReturn")),_export("PasswordAutoAuthenticationReturnTypeRef",PasswordAutoAuthenticationReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PasswordAutoAuthenticationReturn",since:1,type:"DATA_TRANSFER_TYPE",id:317,rootId:"CHR1dGFub3RhAAE9",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:318,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/PasswordChannelPhoneNumber.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PasswordChannelPhoneNumberTypeRef,_TypeModel;return _export("createPasswordChannelPhoneNumber",function(values){return Object.assign(create(_TypeModel,PasswordChannelPhoneNumberTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PasswordChannelPhoneNumberTypeRef",PasswordChannelPhoneNumberTypeRef=new TypeRef("tutanota","PasswordChannelPhoneNumber")),_export("PasswordChannelPhoneNumberTypeRef",PasswordChannelPhoneNumberTypeRef),_export("_TypeModel",_TypeModel={name:"PasswordChannelPhoneNumber",since:1,type:"AGGREGATED_TYPE",id:135,rootId:"CHR1dGFub3RhAACH",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:136,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},number:{name:"number",id:137,since:1,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/PasswordRetrievalData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PasswordRetrievalDataTypeRef,_TypeModel;return _export("createPasswordRetrievalData",function(values){return Object.assign(create(_TypeModel,PasswordRetrievalDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PasswordRetrievalDataTypeRef",PasswordRetrievalDataTypeRef=new TypeRef("tutanota","PasswordRetrievalData")),_export("PasswordRetrievalDataTypeRef",PasswordRetrievalDataTypeRef),_export("_TypeModel",_TypeModel={name:"PasswordRetrievalData",since:1,type:"DATA_TRANSFER_TYPE",id:320,rootId:"CHR1dGFub3RhAAFA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:321,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},autoAuthenticationId:{name:"autoAuthenticationId",id:322,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/PasswordRetrievalReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PasswordRetrievalReturnTypeRef,_TypeModel;return _export("createPasswordRetrievalReturn",function(values){return Object.assign(create(_TypeModel,PasswordRetrievalReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PasswordRetrievalReturnTypeRef",PasswordRetrievalReturnTypeRef=new TypeRef("tutanota","PasswordRetrievalReturn")),_export("PasswordRetrievalReturnTypeRef",PasswordRetrievalReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PasswordRetrievalReturn",since:1,type:"DATA_TRANSFER_TYPE",id:323,rootId:"CHR1dGFub3RhAAFD",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:324,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},transmissionKeyEncryptedPassword:{name:"transmissionKeyEncryptedPassword",id:325,since:1,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/PhotosRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PhotosRefTypeRef,_TypeModel;return _export("createPhotosRef",function(values){return Object.assign(create(_TypeModel,PhotosRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PhotosRefTypeRef",PhotosRefTypeRef=new TypeRef("tutanota","PhotosRef")),_export("PhotosRefTypeRef",PhotosRefTypeRef),_export("_TypeModel",_TypeModel={name:"PhotosRef",since:23,type:"AGGREGATED_TYPE",id:853,rootId:"CHR1dGFub3RhAANV",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:854,since:23,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{files:{name:"files",id:855,since:23,type:"LIST_ASSOCIATION",cardinality:"One",refType:"File",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/RemoteImapSyncInfo.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,RemoteImapSyncInfoTypeRef,_TypeModel;return _export("createRemoteImapSyncInfo",function(values){return Object.assign(create(_TypeModel,RemoteImapSyncInfoTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("RemoteImapSyncInfoTypeRef",RemoteImapSyncInfoTypeRef=new TypeRef("tutanota","RemoteImapSyncInfo")),_export("RemoteImapSyncInfoTypeRef",RemoteImapSyncInfoTypeRef),_export("_TypeModel",_TypeModel={name:"RemoteImapSyncInfo",since:1,type:"LIST_ELEMENT_TYPE",id:183,rootId:"CHR1dGFub3RhAAC3",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:187,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:185,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:594,since:13,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:186,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},seen:{name:"seen",id:189,since:1,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{message:{name:"message",id:188,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"Mail",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/SendDraftReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SendDraftReturnTypeRef,_TypeModel;return _export("createSendDraftReturn",function(values){return Object.assign(create(_TypeModel,SendDraftReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SendDraftReturnTypeRef",SendDraftReturnTypeRef=new TypeRef("tutanota","SendDraftReturn")),_export("SendDraftReturnTypeRef",SendDraftReturnTypeRef),_export("_TypeModel",_TypeModel={name:"SendDraftReturn",since:11,type:"DATA_TRANSFER_TYPE",id:557,rootId:"CHR1dGFub3RhAAIt",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:558,since:11,type:"Number",cardinality:"One",final:!1,encrypted:!1},messageId:{name:"messageId",id:559,since:11,type:"String",cardinality:"One",final:!1,encrypted:!1},sentDate:{name:"sentDate",id:560,since:11,type:"Date",cardinality:"One",final:!1,encrypted:!1}},associations:{notifications:{name:"notifications",id:561,since:11,type:"AGGREGATION",cardinality:"Any",refType:"NotificationMail",final:!1},sentMail:{name:"sentMail",id:562,since:11,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"Mail",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/StatisticLogRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,StatisticLogRefTypeRef,_TypeModel;return _export("createStatisticLogRef",function(values){return Object.assign(create(_TypeModel,StatisticLogRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("StatisticLogRefTypeRef",StatisticLogRefTypeRef=new TypeRef("tutanota","StatisticLogRef")),_export("StatisticLogRefTypeRef",StatisticLogRefTypeRef),_export("_TypeModel",_TypeModel={name:"StatisticLogRef",since:25,type:"AGGREGATED_TYPE",id:875,rootId:"CHR1dGFub3RhAANr",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:876,since:25,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{items:{name:"items",id:877,since:25,type:"LIST_ASSOCIATION",cardinality:"One",refType:"StatisticLogEntry",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/Subfiles.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SubfilesTypeRef,_TypeModel;return _export("createSubfiles",function(values){return Object.assign(create(_TypeModel,SubfilesTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SubfilesTypeRef",SubfilesTypeRef=new TypeRef("tutanota","Subfiles")),_export("SubfilesTypeRef",SubfilesTypeRef),_export("_TypeModel",_TypeModel={name:"Subfiles",since:1,type:"AGGREGATED_TYPE",id:11,rootId:"CHR1dGFub3RhAAs",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:12,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{files:{name:"files",id:27,since:1,type:"LIST_ASSOCIATION",cardinality:"One",refType:"File",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/UnencryptedStatisticLogRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UnencryptedStatisticLogRefTypeRef,_TypeModel;return _export("createUnencryptedStatisticLogRef",function(values){return Object.assign(create(_TypeModel,UnencryptedStatisticLogRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UnencryptedStatisticLogRefTypeRef",UnencryptedStatisticLogRefTypeRef=new TypeRef("tutanota","UnencryptedStatisticLogRef")),_export("UnencryptedStatisticLogRefTypeRef",UnencryptedStatisticLogRefTypeRef),_export("_TypeModel",_TypeModel={name:"UnencryptedStatisticLogRef",since:25,type:"AGGREGATED_TYPE",id:887,rootId:"CHR1dGFub3RhAAN3",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:888,since:25,type:"CustomId",cardinality:"One",final:!0,encrypted:!1}},associations:{items:{name:"items",id:889,since:25,type:"LIST_ASSOCIATION",cardinality:"One",refType:"UnencryptedStatisticLogEntry",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/CreateMailGroupData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateMailGroupDataTypeRef,_TypeModel;return _export("createCreateMailGroupData",function(values){return Object.assign(create(_TypeModel,CreateMailGroupDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateMailGroupDataTypeRef",CreateMailGroupDataTypeRef=new TypeRef("tutanota","CreateMailGroupData")),_export("CreateMailGroupDataTypeRef",CreateMailGroupDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateMailGroupData",since:19,type:"DATA_TRANSFER_TYPE",id:707,rootId:"CHR1dGFub3RhAALD",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:708,since:19,type:"Number",cardinality:"One",final:!1,encrypted:!1},encryptedName:{name:"encryptedName",id:710,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:709,since:19,type:"String",cardinality:"One",final:!1,encrypted:!1},mailEncMailboxSessionKey:{name:"mailEncMailboxSessionKey",id:711,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{groupData:{name:"groupData",id:712,since:19,type:"AGGREGATION",cardinality:"One",refType:"InternalGroupData",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/InternalGroupData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,InternalGroupDataTypeRef,_TypeModel;return _export("createInternalGroupData",function(values){return Object.assign(create(_TypeModel,InternalGroupDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("InternalGroupDataTypeRef",InternalGroupDataTypeRef=new TypeRef("tutanota","InternalGroupData")),_export("InternalGroupDataTypeRef",InternalGroupDataTypeRef),_export("_TypeModel",_TypeModel={name:"InternalGroupData",since:16,type:"AGGREGATED_TYPE",id:642,rootId:"CHR1dGFub3RhAAKC",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:643,since:16,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},adminEncGroupKey:{name:"adminEncGroupKey",id:646,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},groupEncPrivateKey:{name:"groupEncPrivateKey",id:645,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},ownerEncGroupInfoSessionKey:{name:"ownerEncGroupInfoSessionKey",id:647,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},publicKey:{name:"publicKey",id:644,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{adminGroup:{name:"adminGroup",id:874,since:25,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"Group",final:!0,external:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/CreateLocalAdminGroupData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateLocalAdminGroupDataTypeRef,_TypeModel;return _export("createCreateLocalAdminGroupData",function(values){return Object.assign(create(_TypeModel,CreateLocalAdminGroupDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateLocalAdminGroupDataTypeRef",CreateLocalAdminGroupDataTypeRef=new TypeRef("tutanota","CreateLocalAdminGroupData")),_export("CreateLocalAdminGroupDataTypeRef",CreateLocalAdminGroupDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateLocalAdminGroupData",since:19,type:"DATA_TRANSFER_TYPE",id:703,rootId:"CHR1dGFub3RhAAK_",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:704,since:19,type:"Number",cardinality:"One",final:!1,encrypted:!1},encryptedName:{name:"encryptedName",id:705,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{groupData:{name:"groupData",id:706,since:19,type:"AGGREGATION",cardinality:"One",refType:"InternalGroupData",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DeleteGroupData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DeleteGroupDataTypeRef,_TypeModel;return _export("createDeleteGroupData",function(values){return Object.assign(create(_TypeModel,DeleteGroupDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DeleteGroupDataTypeRef",DeleteGroupDataTypeRef=new TypeRef("tutanota","DeleteGroupData")),_export("DeleteGroupDataTypeRef",DeleteGroupDataTypeRef),_export("_TypeModel",_TypeModel={name:"DeleteGroupData",since:19,type:"DATA_TRANSFER_TYPE",id:713,rootId:"CHR1dGFub3RhAALJ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:714,since:19,type:"Number",cardinality:"One",final:!1,encrypted:!1},restore:{name:"restore",id:715,since:19,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{group:{name:"group",id:716,since:19,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!0,external:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/GroupManagementFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../Env","../../common/TutanotaConstants","../../entities/tutanota/CreateMailGroupData","../crypto/Rsa","../../entities/tutanota/InternalGroupData","../../common/utils/Encoding","../crypto/CryptoFacade","../EntityWorker","../../entities/tutanota/Services","../../common/EntityFunctions","../crypto/Aes","../../entities/tutanota/CreateLocalAdminGroupData","../../entities/sys/Group","../../entities/sys/MembershipAddData","../../common/utils/Utils","../../entities/sys/MembershipRemoveData","../../entities/tutanota/DeleteGroupData","./CounterFacade","../../entities/sys/Services"],function(_export,_context){"use strict";var _classCallCheck,_createClass,assertWorkerOrNode,Const,GroupType,createCreateMailGroupData,generateRsaKey,publicKeyToHex,createInternalGroupData,hexToUint8Array,decryptKey,encryptKey,encryptRsaKey,encryptString,load,serviceRequestVoid,TutanotaService,HttpMethod,aes128RandomKey,createCreateLocalAdminGroupData,GroupTypeRef,createMembershipAddData,neverNull,createMembershipRemoveData,createDeleteGroupData,SysService,GroupManagementFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonTutanotaConstants){Const=_commonTutanotaConstants.Const,GroupType=_commonTutanotaConstants.GroupType},function(_entitiesTutanotaCreateMailGroupData){createCreateMailGroupData=_entitiesTutanotaCreateMailGroupData.createCreateMailGroupData},function(_cryptoRsa){generateRsaKey=_cryptoRsa.generateRsaKey,publicKeyToHex=_cryptoRsa.publicKeyToHex},function(_entitiesTutanotaInternalGroupData){createInternalGroupData=_entitiesTutanotaInternalGroupData.createInternalGroupData},function(_commonUtilsEncoding){hexToUint8Array=_commonUtilsEncoding.hexToUint8Array},function(_cryptoCryptoFacade){decryptKey=_cryptoCryptoFacade.decryptKey,encryptKey=_cryptoCryptoFacade.encryptKey,encryptRsaKey=_cryptoCryptoFacade.encryptRsaKey,encryptString=_cryptoCryptoFacade.encryptString},function(_EntityWorker){load=_EntityWorker.load,serviceRequestVoid=_EntityWorker.serviceRequestVoid},function(_entitiesTutanotaServices){TutanotaService=_entitiesTutanotaServices.TutanotaService},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod},function(_cryptoAes){aes128RandomKey=_cryptoAes.aes128RandomKey},function(_entitiesTutanotaCreateLocalAdminGroupData){createCreateLocalAdminGroupData=_entitiesTutanotaCreateLocalAdminGroupData.createCreateLocalAdminGroupData},function(_entitiesSysGroup){GroupTypeRef=_entitiesSysGroup.GroupTypeRef},function(_entitiesSysMembershipAddData){createMembershipAddData=_entitiesSysMembershipAddData.createMembershipAddData},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull},function(_entitiesSysMembershipRemoveData){createMembershipRemoveData=_entitiesSysMembershipRemoveData.createMembershipRemoveData},function(_entitiesTutanotaDeleteGroupData){createDeleteGroupData=_entitiesTutanotaDeleteGroupData.createDeleteGroupData},function(_CounterFacade){_CounterFacade.CounterFacade},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService}],execute:function(){assertWorkerOrNode(),_export("GroupManagementFacade",GroupManagementFacade=function(){function GroupManagementFacade(login,counters){_classCallCheck(this,GroupManagementFacade),this._login=login,this._counters=counters}return _createClass(GroupManagementFacade,[{key:"readUsedGroupStorage",value:function(groupId){return this._counters.readCounterValue(Const.COUNTER_USED_MEMORY,groupId).then(function(usedStorage){return Number(usedStorage)})}},{key:"createMailGroup",value:function(name,mailAddress){var _this=this,adminGroupIds=this._login.getGroupIds(GroupType.Admin);0===adminGroupIds.length&&(adminGroupIds=this._login.getGroupIds(GroupType.LocalAdmin));var adminGroupKey=this._login.getGroupKey(adminGroupIds[0]),customerGroupKey=this._login.getGroupKey(this._login.getGroupId(GroupType.Customer)),mailGroupKey=aes128RandomKey(),mailGroupInfoSessionKey=aes128RandomKey(),mailboxSessionKey=aes128RandomKey();return generateRsaKey().then(function(keyPair){return _this.generateInternalGroupData(keyPair,mailGroupKey,mailGroupInfoSessionKey,adminGroupIds[0],adminGroupKey,customerGroupKey)}).then(function(mailGroupData){var data=createCreateMailGroupData();return data.mailAddress=mailAddress,data.encryptedName=encryptString(mailGroupInfoSessionKey,name),data.mailEncMailboxSessionKey=encryptKey(mailGroupKey,mailboxSessionKey),data.groupData=mailGroupData,serviceRequestVoid(TutanotaService.MailGroupService,HttpMethod.POST,data)})}},{key:"createLocalAdminGroup",value:function(name){var _this2=this,adminGroupId=this._login.getGroupId(GroupType.Admin),adminGroupKey=this._login.getGroupKey(adminGroupId),customerGroupKey=this._login.getGroupKey(this._login.getGroupId(GroupType.Customer)),groupKey=aes128RandomKey(),groupInfoSessionKey=aes128RandomKey();return generateRsaKey().then(function(keyPair){return _this2.generateInternalGroupData(keyPair,groupKey,groupInfoSessionKey,adminGroupId,adminGroupKey,customerGroupKey)}).then(function(mailGroupData){var data=createCreateLocalAdminGroupData();return data.encryptedName=encryptString(groupInfoSessionKey,name),data.groupData=mailGroupData,serviceRequestVoid(TutanotaService.LocalAdminGroupService,HttpMethod.POST,data)})}},{key:"generateInternalGroupData",value:function(keyPair,groupKey,groupInfoSessionKey,adminGroupId,adminGroupKey,ownerGroupKey){var groupData=createInternalGroupData();return groupData.publicKey=hexToUint8Array(publicKeyToHex(keyPair.publicKey)),groupData.groupEncPrivateKey=encryptRsaKey(groupKey,keyPair.privateKey),groupData.adminGroup=adminGroupId,groupData.adminEncGroupKey=encryptKey(adminGroupKey,groupKey),groupData.ownerEncGroupInfoSessionKey=encryptKey(ownerGroupKey,groupInfoSessionKey),groupData}},{key:"addUserToGroup",value:function(user,groupId){var _this3=this;return this.getGroupKeyAsAdmin(user.userGroup.group).then(function(userGroupKey){return _this3.getGroupKeyAsAdmin(groupId).then(function(groupKey){var data=createMembershipAddData();return data.user=user._id,data.group=groupId,data.symEncGKey=encryptKey(userGroupKey,groupKey),serviceRequestVoid(SysService.MembershipService,HttpMethod.POST,data)})})}},{key:"removeUserFromGroup",value:function(userId,groupId){var data=createMembershipRemoveData();return data.user=userId,data.group=groupId,serviceRequestVoid(SysService.MembershipService,HttpMethod.DELETE,data)}},{key:"deactivateGroup",value:function(group,restore){var data=createDeleteGroupData();return data.group=group._id,data.restore=restore,group.type===GroupType.Mail?serviceRequestVoid(TutanotaService.MailGroupService,HttpMethod.DELETE,data):group.type===GroupType.LocalAdmin?serviceRequestVoid(TutanotaService.LocalAdminGroupService,HttpMethod.DELETE,data):Promise.reject(new Error("invalid group type for deactivation"))}},{key:"getGroupKeyAsAdmin",value:function(groupId){var _this4=this;return this._login.hasGroup(groupId)?Promise.resolve(this._login.getGroupKey(neverNull(groupId))):load(GroupTypeRef,groupId).then(function(group){return Promise.resolve().then(function(){if(group.admin&&_this4._login.hasGroup(group.admin))return _this4._login.getGroupKey(neverNull(group.admin));var globalAdminGroupId=_this4._login.getGroupId(GroupType.Admin),globalAdminGroupKey=_this4._login.getGroupKey(globalAdminGroupId);return load(GroupTypeRef,neverNull(group.admin)).then(function(localAdminGroup){if(localAdminGroup.admin===globalAdminGroupId)return decryptKey(globalAdminGroupKey,neverNull(localAdminGroup.adminGroupEncGKey));throw new Error("local admin group "+localAdminGroup._id+" is not administrated by global admin group "+globalAdminGroupId)})}).then(function(adminGroupKey){return decryptKey(adminGroupKey,neverNull(group.adminGroupEncGKey))})})}}]),GroupManagementFacade}()),_export("GroupManagementFacade",GroupManagementFacade)}}}),System.register("src/api/entities/tutanota/CreateMailFolderData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateMailFolderDataTypeRef,_TypeModel;return _export("createCreateMailFolderData",function(values){return Object.assign(create(_TypeModel,CreateMailFolderDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateMailFolderDataTypeRef",CreateMailFolderDataTypeRef=new TypeRef("tutanota","CreateMailFolderData")),_export("CreateMailFolderDataTypeRef",CreateMailFolderDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateMailFolderData",since:7,type:"DATA_TRANSFER_TYPE",id:450,rootId:"CHR1dGFub3RhAAHC",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:451,since:7,type:"Number",cardinality:"One",final:!1,encrypted:!1},folderName:{name:"folderName",id:453,since:7,type:"String",cardinality:"One",final:!0,encrypted:!0},ownerEncSessionKey:{name:"ownerEncSessionKey",id:454,since:7,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{parentFolder:{name:"parentFolder",id:452,since:7,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"MailFolder",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DraftCreateData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DraftCreateDataTypeRef,_TypeModel;return _export("createDraftCreateData",function(values){return Object.assign(create(_TypeModel,DraftCreateDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DraftCreateDataTypeRef",DraftCreateDataTypeRef=new TypeRef("tutanota","DraftCreateData")),_export("DraftCreateDataTypeRef",DraftCreateDataTypeRef),_export("_TypeModel",_TypeModel={name:"DraftCreateData",since:11,type:"DATA_TRANSFER_TYPE",id:508,rootId:"CHR1dGFub3RhAAH8",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:509,since:11,type:"Number",cardinality:"One",final:!1,encrypted:!1},conversationType:{name:"conversationType",id:511,since:11,type:"Number",cardinality:"One",final:!0,encrypted:!1},ownerEncSessionKey:{name:"ownerEncSessionKey",id:512,since:11,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},previousMessageId:{name:"previousMessageId",id:510,since:11,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!1},symEncSessionKey:{name:"symEncSessionKey",id:513,since:11,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{draftData:{name:"draftData",id:515,since:11,type:"AGGREGATION",cardinality:"One",refType:"DraftData",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DraftData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DraftDataTypeRef,_TypeModel;return _export("createDraftData",function(values){return Object.assign(create(_TypeModel,DraftDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DraftDataTypeRef",DraftDataTypeRef=new TypeRef("tutanota","DraftData")),_export("DraftDataTypeRef",DraftDataTypeRef),_export("_TypeModel",_TypeModel={name:"DraftData",since:11,type:"AGGREGATED_TYPE",id:496,rootId:"CHR1dGFub3RhAAHw",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:497,since:11,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},bodyText:{name:"bodyText",id:499,since:11,type:"String",cardinality:"One",final:!0,encrypted:!0},confidential:{name:"confidential",id:502,since:11,type:"Boolean",cardinality:"One",final:!0,encrypted:!0},senderMailAddress:{name:"senderMailAddress",id:500,since:11,type:"String",cardinality:"One",final:!0,encrypted:!1},senderName:{name:"senderName",id:501,since:11,type:"String",cardinality:"One",final:!0,encrypted:!0},subject:{name:"subject",id:498,since:11,type:"String",cardinality:"One",final:!0,encrypted:!0}},associations:{addedAttachments:{name:"addedAttachments",id:506,since:11,type:"AGGREGATION",cardinality:"Any",refType:"DraftAttachment",final:!0},bccRecipients:{name:"bccRecipients",id:505,since:11,type:"AGGREGATION",cardinality:"Any",refType:"DraftRecipient",final:!0},ccRecipients:{name:"ccRecipients",id:504,since:11,type:"AGGREGATION",cardinality:"Any",refType:"DraftRecipient",final:!0},replyTos:{name:"replyTos",id:819,since:21,type:"AGGREGATION",cardinality:"Any",refType:"EncryptedMailAddress",final:!1},toRecipients:{name:"toRecipients",id:503,since:11,type:"AGGREGATION",cardinality:"Any",refType:"DraftRecipient",final:!0},removedAttachments:{name:"removedAttachments",id:507,since:11,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"Any",refType:"File",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DraftCreateReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DraftCreateReturnTypeRef,_TypeModel;return _export("createDraftCreateReturn",function(values){return Object.assign(create(_TypeModel,DraftCreateReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DraftCreateReturnTypeRef",DraftCreateReturnTypeRef=new TypeRef("tutanota","DraftCreateReturn")),_export("DraftCreateReturnTypeRef",DraftCreateReturnTypeRef),_export("_TypeModel",_TypeModel={name:"DraftCreateReturn",since:11,type:"DATA_TRANSFER_TYPE",id:516,rootId:"CHR1dGFub3RhAAIE",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:517,since:11,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{draft:{name:"draft",id:518,since:11,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"Mail",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DraftRecipient.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DraftRecipientTypeRef,_TypeModel;return _export("createDraftRecipient",function(values){return Object.assign(create(_TypeModel,DraftRecipientTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DraftRecipientTypeRef",DraftRecipientTypeRef=new TypeRef("tutanota","DraftRecipient")),_export("DraftRecipientTypeRef",DraftRecipientTypeRef),_export("_TypeModel",_TypeModel={name:"DraftRecipient",since:11,type:"AGGREGATED_TYPE",id:482,rootId:"CHR1dGFub3RhAAHi",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:483,since:11,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},mailAddress:{name:"mailAddress",id:485,since:11,type:"String",cardinality:"One",final:!0,encrypted:!1},name:{name:"name",id:484,since:11,type:"String",cardinality:"One",final:!0,encrypted:!0}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DraftUpdateData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DraftUpdateDataTypeRef,_TypeModel;return _export("createDraftUpdateData",function(values){return Object.assign(create(_TypeModel,DraftUpdateDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DraftUpdateDataTypeRef",DraftUpdateDataTypeRef=new TypeRef("tutanota","DraftUpdateData")),_export("DraftUpdateDataTypeRef",DraftUpdateDataTypeRef),_export("_TypeModel",_TypeModel={name:"DraftUpdateData",since:11,type:"DATA_TRANSFER_TYPE",id:519,rootId:"CHR1dGFub3RhAAIH",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:520,since:11,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{draftData:{name:"draftData",id:521,since:11,type:"AGGREGATION",cardinality:"One",refType:"DraftData",final:!1},draft:{name:"draft",id:522,since:11,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"Mail",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DraftUpdateReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DraftUpdateReturnTypeRef,_TypeModel;return _export("createDraftUpdateReturn",function(values){return Object.assign(create(_TypeModel,DraftUpdateReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DraftUpdateReturnTypeRef",DraftUpdateReturnTypeRef=new TypeRef("tutanota","DraftUpdateReturn")),_export("DraftUpdateReturnTypeRef",DraftUpdateReturnTypeRef),_export("_TypeModel",_TypeModel={name:"DraftUpdateReturn",since:11,type:"DATA_TRANSFER_TYPE",id:523,rootId:"CHR1dGFub3RhAAIL",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:524,since:11,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{attachments:{name:"attachments",id:525,since:11,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"Any",refType:"File",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/SendDraftData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SendDraftDataTypeRef,_TypeModel;return _export("createSendDraftData",function(values){return Object.assign(create(_TypeModel,SendDraftDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SendDraftDataTypeRef",SendDraftDataTypeRef=new TypeRef("tutanota","SendDraftData")),_export("SendDraftDataTypeRef",SendDraftDataTypeRef),_export("_TypeModel",_TypeModel={name:"SendDraftData",since:11,type:"DATA_TRANSFER_TYPE",id:547,rootId:"CHR1dGFub3RhAAIj",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:548,since:11,type:"Number",cardinality:"One",final:!1,encrypted:!1},bucketEncMailSessionKey:{name:"bucketEncMailSessionKey",id:551,since:11,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},language:{name:"language",id:549,since:11,type:"String",cardinality:"One",final:!0,encrypted:!1},mailSessionKey:{name:"mailSessionKey",id:550,since:11,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},plaintext:{name:"plaintext",id:675,since:18,type:"Boolean",cardinality:"One",final:!0,encrypted:!1},senderNameUnencrypted:{name:"senderNameUnencrypted",id:552,since:11,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!1}},associations:{attachmentKeyData:{name:"attachmentKeyData",id:555,since:11,type:"AGGREGATION",cardinality:"Any",refType:"AttachmentKeyData",final:!0},internalRecipientKeyData:{name:"internalRecipientKeyData",id:553,since:11,type:"AGGREGATION",cardinality:"Any",refType:"InternalRecipientKeyData",final:!0},secureExternalRecipientKeyData:{name:"secureExternalRecipientKeyData",id:554,since:11,type:"AGGREGATION",cardinality:"Any",refType:"SecureExternalRecipientKeyData",final:!0},mail:{name:"mail",id:556,since:11,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"Mail",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/GroupRoot.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,GroupRootTypeRef,_TypeModel;return _export("createGroupRoot",function(values){return Object.assign(create(_TypeModel,GroupRootTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("GroupRootTypeRef",GroupRootTypeRef=new TypeRef("sys","GroupRoot")),_export("GroupRootTypeRef",GroupRootTypeRef),_export("_TypeModel",_TypeModel={name:"GroupRoot",since:1,type:"ELEMENT_TYPE",id:110,rootId:"A3N5cwBu",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:114,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:112,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:998,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:113,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1}},associations:{externalUserAreaGroupInfos:{name:"externalUserAreaGroupInfos",id:999,since:17,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"UserAreaGroups",final:!0},externalGroupInfos:{name:"externalGroupInfos",id:116,since:1,type:"LIST_ASSOCIATION",cardinality:"One",refType:"GroupInfo",final:!0,external:!1},externalUserReferences:{name:"externalUserReferences",id:117,since:1,type:"LIST_ASSOCIATION",cardinality:"One",refType:"ExternalUserReference",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/ExternalUserReference.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ExternalUserReferenceTypeRef,_TypeModel;return _export("createExternalUserReference",function(values){return Object.assign(create(_TypeModel,ExternalUserReferenceTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ExternalUserReferenceTypeRef",ExternalUserReferenceTypeRef=new TypeRef("sys","ExternalUserReference")),_export("ExternalUserReferenceTypeRef",ExternalUserReferenceTypeRef),_export("_TypeModel",_TypeModel={name:"ExternalUserReference",since:1,type:"LIST_ELEMENT_TYPE",id:103,rootId:"A3N5cwBn",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:107,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:105,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:997,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:106,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1}},associations:{user:{name:"user",id:108,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!0,external:!1},userGroup:{name:"userGroup",id:109,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ExternalUserData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ExternalUserDataTypeRef,_TypeModel;return _export("createExternalUserData",function(values){return Object.assign(create(_TypeModel,ExternalUserDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ExternalUserDataTypeRef",ExternalUserDataTypeRef=new TypeRef("tutanota","ExternalUserData")),_export("ExternalUserDataTypeRef",ExternalUserDataTypeRef),_export("_TypeModel",_TypeModel={name:"ExternalUserData",since:1,type:"DATA_TRANSFER_TYPE",id:145,rootId:"CHR1dGFub3RhAACR",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:146,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},externalMailEncMailBoxSessionKey:{name:"externalMailEncMailBoxSessionKey",id:673,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},externalMailEncMailGroupInfoSessionKey:{name:"externalMailEncMailGroupInfoSessionKey",id:670,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},externalUserEncEntropy:{name:"externalUserEncEntropy",id:412,since:2,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},externalUserEncMailGroupKey:{name:"externalUserEncMailGroupKey",id:148,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},externalUserEncTutanotaPropertiesSessionKey:{name:"externalUserEncTutanotaPropertiesSessionKey",id:672,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},externalUserEncUserGroupInfoSessionKey:{name:"externalUserEncUserGroupInfoSessionKey",id:150,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},internalMailEncMailGroupInfoSessionKey:{name:"internalMailEncMailGroupInfoSessionKey",id:671,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},internalMailEncUserGroupInfoSessionKey:{name:"internalMailEncUserGroupInfoSessionKey",id:669,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncClientKey:{name:"userEncClientKey",id:147,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},verifier:{name:"verifier",id:149,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{userGroupData:{name:"userGroupData",id:151,since:1,type:"AGGREGATION",cardinality:"One",refType:"CreateExternalUserGroupData",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/CreateExternalUserGroupData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateExternalUserGroupDataTypeRef,_TypeModel;return _export("createCreateExternalUserGroupData",function(values){return Object.assign(create(_TypeModel,CreateExternalUserGroupDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateExternalUserGroupDataTypeRef",CreateExternalUserGroupDataTypeRef=new TypeRef("tutanota","CreateExternalUserGroupData")),_export("CreateExternalUserGroupDataTypeRef",CreateExternalUserGroupDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateExternalUserGroupData",since:1,type:"AGGREGATED_TYPE",id:138,rootId:"CHR1dGFub3RhAACK",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:139,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},internalUserEncUserGroupKey:{name:"internalUserEncUserGroupKey",id:143,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:141,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},externalPwEncUserGroupKey:{name:"externalPwEncUserGroupKey",id:142,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/SecureExternalRecipientKeyData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SecureExternalRecipientKeyDataTypeRef,_TypeModel;return _export("createSecureExternalRecipientKeyData",function(values){return Object.assign(create(_TypeModel,SecureExternalRecipientKeyDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SecureExternalRecipientKeyDataTypeRef",SecureExternalRecipientKeyDataTypeRef=new TypeRef("tutanota","SecureExternalRecipientKeyData")),_export("SecureExternalRecipientKeyDataTypeRef",SecureExternalRecipientKeyDataTypeRef),_export("_TypeModel",_TypeModel={name:"SecureExternalRecipientKeyData",since:11,type:"AGGREGATED_TYPE",id:532,rootId:"CHR1dGFub3RhAAIU",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:533,since:11,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},autoTransmitPassword:{name:"autoTransmitPassword",id:537,since:11,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!1},mailAddress:{name:"mailAddress",id:534,since:11,type:"String",cardinality:"One",final:!0,encrypted:!1},ownerEncBucketKey:{name:"ownerEncBucketKey",id:599,since:13,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},passwordVerifier:{name:"passwordVerifier",id:536,since:11,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},pwEncCommunicationKey:{name:"pwEncCommunicationKey",id:540,since:11,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},salt:{name:"salt",id:538,since:11,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},saltHash:{name:"saltHash",id:539,since:11,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},symEncBucketKey:{name:"symEncBucketKey",id:535,since:11,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1}},associations:{passwordChannelPhoneNumbers:{name:"passwordChannelPhoneNumbers",id:541,since:11,type:"AGGREGATION",cardinality:"Any",refType:"PasswordChannelPhoneNumber",final:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/DraftAttachment.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DraftAttachmentTypeRef,_TypeModel;return _export("createDraftAttachment",function(values){return Object.assign(create(_TypeModel,DraftAttachmentTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DraftAttachmentTypeRef",DraftAttachmentTypeRef=new TypeRef("tutanota","DraftAttachment")),_export("DraftAttachmentTypeRef",DraftAttachmentTypeRef),_export("_TypeModel",_TypeModel={name:"DraftAttachment",since:11,type:"AGGREGATED_TYPE",id:491,rootId:"CHR1dGFub3RhAAHr",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:492,since:11,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},ownerEncFileSessionKey:{name:"ownerEncFileSessionKey",id:493,since:11,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{newFile:{name:"newFile",id:494,since:11,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"NewDraftAttachment",final:!0},existingFile:{name:"existingFile",id:495,since:11,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"File",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/NewDraftAttachment.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,NewDraftAttachmentTypeRef,_TypeModel;return _export("createNewDraftAttachment",function(values){return Object.assign(create(_TypeModel,NewDraftAttachmentTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("NewDraftAttachmentTypeRef",NewDraftAttachmentTypeRef=new TypeRef("tutanota","NewDraftAttachment")),_export("NewDraftAttachmentTypeRef",NewDraftAttachmentTypeRef),_export("_TypeModel",_TypeModel={name:"NewDraftAttachment",since:11,type:"AGGREGATED_TYPE",id:486,rootId:"CHR1dGFub3RhAAHm",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:487,since:11,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},encCid:{name:"encCid",id:925,since:32,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},encFileName:{name:"encFileName",id:488,since:11,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},encMimeType:{name:"encMimeType",id:489,since:11,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{fileData:{name:"fileData",id:490,since:11,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"FileData",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/AttachmentKeyData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AttachmentKeyDataTypeRef,_TypeModel;return _export("createAttachmentKeyData",function(values){return Object.assign(create(_TypeModel,AttachmentKeyDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AttachmentKeyDataTypeRef",AttachmentKeyDataTypeRef=new TypeRef("tutanota","AttachmentKeyData")),_export("AttachmentKeyDataTypeRef",AttachmentKeyDataTypeRef),_export("_TypeModel",_TypeModel={name:"AttachmentKeyData",since:11,type:"AGGREGATED_TYPE",id:542,rootId:"CHR1dGFub3RhAAIe",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:543,since:11,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},bucketEncFileSessionKey:{name:"bucketEncFileSessionKey",id:544,since:11,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},fileSessionKey:{name:"fileSessionKey",id:545,since:11,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1}},associations:{file:{name:"file",id:546,since:11,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"File",final:!0,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/MailFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/slicedToArray.js","node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../crypto/CryptoFacade","../crypto/Aes","../EntityWorker","../../entities/tutanota/Services","../../common/TutanotaConstants","../../entities/tutanota/CreateMailFolderData","../../entities/tutanota/DraftCreateData","../../entities/tutanota/DraftData","../../entities/tutanota/DraftCreateReturn","../../entities/tutanota/Mail","../../entities/tutanota/DraftRecipient","../../entities/tutanota/DraftUpdateData","../../entities/tutanota/DraftUpdateReturn","../../entities/tutanota/SendDraftData","../../common/RecipientInfo","../../common/error/RecipientsNotFoundError","../crypto/Bcrypt","../crypto/CryptoConstants","../crypto/CryptoUtils","../../common/error/RestError","../../entities/sys/GroupRoot","../../common/EntityFunctions","../../entities/sys/ExternalUserReference","../../common/utils/Utils","../../entities/sys/User","../../entities/sys/Group","../crypto/Randomizer","../../entities/tutanota/ExternalUserData","../../entities/tutanota/CreateExternalUserGroupData","../../entities/tutanota/SecureExternalRecipientKeyData","../crypto/Sha256","../../entities/tutanota/DraftAttachment","../../entities/tutanota/NewDraftAttachment","../../entities/tutanota/File","../../entities/tutanota/AttachmentKeyData","../../Env","../../entities/tutanota/TutanotaProperties","../../entities/sys/GroupInfo","../../common/utils/ArrayUtils","../../entities/tutanota/EncryptedMailAddress","../../../native/FileApp","./ReceipientKeyDataUtils"],function(_export,_context){"use strict";var _slicedToArray,_classCallCheck,_createClass,decryptKey,encryptBytes,encryptKey,encryptString,resolveSessionKey,aes128RandomKey,load,loadRoot,serviceRequest,serviceRequestVoid,TutanotaService,GroupType,OperationType,createCreateMailFolderData,createDraftCreateData,createDraftData,DraftCreateReturnTypeRef,MailTypeModel,MailTypeRef,createDraftRecipient,createDraftUpdateData,DraftUpdateReturnTypeRef,createSendDraftData,isExternalSecureRecipient,recipientInfoType,RecipientsNotFoundError,generateKeyFromPassphrase,generateRandomSalt,KeyLength,bitArrayToUint8Array,createAuthVerifier,keyToUint8Array,NotFoundError,GroupRootTypeRef,containsId,getLetId,HttpMethod,isSameId,isSameTypeRefByAttr,stringToCustomId,ExternalUserReferenceTypeRef,defer,getEnabledMailAddressesForGroupInfo,getUserGroupMemberships,neverNull,UserTypeRef,GroupTypeRef,random,createExternalUserData,createCreateExternalUserGroupData,createSecureExternalRecipientKeyData,hash,createDraftAttachment,createNewDraftAttachment,FileTypeModel,FileTypeRef,createAttachmentKeyData,assertWorkerOrNode,isApp,TutanotaPropertiesTypeRef,GroupInfoTypeRef,contains,createEncryptedMailAddress,fileApp,encryptBucketKeyForInternalRecipient,MailFacade;function getMailGroupIdForMailAddress(user,mailAddress){return Promise.filter(getUserGroupMemberships(user,GroupType.Mail),function(groupMembership){return load(GroupTypeRef,groupMembership.group).then(function(mailGroup){return null==mailGroup.user?load(GroupInfoTypeRef,groupMembership.groupInfo).then(function(mailGroupInfo){return contains(getEnabledMailAddressesForGroupInfo(mailGroupInfo),mailAddress)}):!!isSameId(mailGroup.user,user._id)&&load(GroupInfoTypeRef,user.userGroup.groupInfo).then(function(userGroupInfo){return contains(getEnabledMailAddressesForGroupInfo(userGroupInfo),mailAddress)})})}).then(function(filteredMemberships){if(1===filteredMemberships.length)return filteredMemberships[0].group;throw new NotFoundError("group for mail address not found "+mailAddress)})}return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs){_slicedToArray=_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_cryptoCryptoFacade){decryptKey=_cryptoCryptoFacade.decryptKey,encryptBytes=_cryptoCryptoFacade.encryptBytes,encryptKey=_cryptoCryptoFacade.encryptKey,encryptString=_cryptoCryptoFacade.encryptString,resolveSessionKey=_cryptoCryptoFacade.resolveSessionKey},function(_cryptoAes){aes128RandomKey=_cryptoAes.aes128RandomKey},function(_EntityWorker){load=_EntityWorker.load,loadRoot=_EntityWorker.loadRoot,serviceRequest=_EntityWorker.serviceRequest,serviceRequestVoid=_EntityWorker.serviceRequestVoid},function(_entitiesTutanotaServices){TutanotaService=_entitiesTutanotaServices.TutanotaService},function(_commonTutanotaConstants){GroupType=_commonTutanotaConstants.GroupType,OperationType=_commonTutanotaConstants.OperationType},function(_entitiesTutanotaCreateMailFolderData){createCreateMailFolderData=_entitiesTutanotaCreateMailFolderData.createCreateMailFolderData},function(_entitiesTutanotaDraftCreateData){createDraftCreateData=_entitiesTutanotaDraftCreateData.createDraftCreateData},function(_entitiesTutanotaDraftData){createDraftData=_entitiesTutanotaDraftData.createDraftData},function(_entitiesTutanotaDraftCreateReturn){DraftCreateReturnTypeRef=_entitiesTutanotaDraftCreateReturn.DraftCreateReturnTypeRef},function(_entitiesTutanotaMail){MailTypeModel=_entitiesTutanotaMail._TypeModel,MailTypeRef=_entitiesTutanotaMail.MailTypeRef},function(_entitiesTutanotaDraftRecipient){createDraftRecipient=_entitiesTutanotaDraftRecipient.createDraftRecipient},function(_entitiesTutanotaDraftUpdateData){createDraftUpdateData=_entitiesTutanotaDraftUpdateData.createDraftUpdateData},function(_entitiesTutanotaDraftUpdateReturn){DraftUpdateReturnTypeRef=_entitiesTutanotaDraftUpdateReturn.DraftUpdateReturnTypeRef},function(_entitiesTutanotaSendDraftData){createSendDraftData=_entitiesTutanotaSendDraftData.createSendDraftData},function(_commonRecipientInfo){isExternalSecureRecipient=_commonRecipientInfo.isExternalSecureRecipient,recipientInfoType=_commonRecipientInfo.recipientInfoType},function(_commonErrorRecipientsNotFoundError){RecipientsNotFoundError=_commonErrorRecipientsNotFoundError.RecipientsNotFoundError},function(_cryptoBcrypt){generateKeyFromPassphrase=_cryptoBcrypt.generateKeyFromPassphrase,generateRandomSalt=_cryptoBcrypt.generateRandomSalt},function(_cryptoCryptoConstants){KeyLength=_cryptoCryptoConstants.KeyLength},function(_cryptoCryptoUtils){bitArrayToUint8Array=_cryptoCryptoUtils.bitArrayToUint8Array,createAuthVerifier=_cryptoCryptoUtils.createAuthVerifier,keyToUint8Array=_cryptoCryptoUtils.keyToUint8Array},function(_commonErrorRestError){NotFoundError=_commonErrorRestError.NotFoundError},function(_entitiesSysGroupRoot){GroupRootTypeRef=_entitiesSysGroupRoot.GroupRootTypeRef},function(_commonEntityFunctions){containsId=_commonEntityFunctions.containsId,getLetId=_commonEntityFunctions.getLetId,HttpMethod=_commonEntityFunctions.HttpMethod,isSameId=_commonEntityFunctions.isSameId,isSameTypeRefByAttr=_commonEntityFunctions.isSameTypeRefByAttr,stringToCustomId=_commonEntityFunctions.stringToCustomId},function(_entitiesSysExternalUserReference){ExternalUserReferenceTypeRef=_entitiesSysExternalUserReference.ExternalUserReferenceTypeRef},function(_commonUtilsUtils){defer=_commonUtilsUtils.defer,getEnabledMailAddressesForGroupInfo=_commonUtilsUtils.getEnabledMailAddressesForGroupInfo,getUserGroupMemberships=_commonUtilsUtils.getUserGroupMemberships,neverNull=_commonUtilsUtils.neverNull},function(_entitiesSysUser){UserTypeRef=_entitiesSysUser.UserTypeRef},function(_entitiesSysGroup){GroupTypeRef=_entitiesSysGroup.GroupTypeRef},function(_cryptoRandomizer){random=_cryptoRandomizer.random},function(_entitiesTutanotaExternalUserData){createExternalUserData=_entitiesTutanotaExternalUserData.createExternalUserData},function(_entitiesTutanotaCreateExternalUserGroupData){createCreateExternalUserGroupData=_entitiesTutanotaCreateExternalUserGroupData.createCreateExternalUserGroupData},function(_entitiesTutanotaSecureExternalRecipientKeyData){createSecureExternalRecipientKeyData=_entitiesTutanotaSecureExternalRecipientKeyData.createSecureExternalRecipientKeyData},function(_cryptoSha){hash=_cryptoSha.hash},function(_entitiesTutanotaDraftAttachment){createDraftAttachment=_entitiesTutanotaDraftAttachment.createDraftAttachment},function(_entitiesTutanotaNewDraftAttachment){createNewDraftAttachment=_entitiesTutanotaNewDraftAttachment.createNewDraftAttachment},function(_entitiesTutanotaFile){FileTypeModel=_entitiesTutanotaFile._TypeModel,FileTypeRef=_entitiesTutanotaFile.FileTypeRef},function(_entitiesTutanotaAttachmentKeyData){createAttachmentKeyData=_entitiesTutanotaAttachmentKeyData.createAttachmentKeyData},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode,isApp=_Env.isApp},function(_entitiesTutanotaTutanotaProperties){TutanotaPropertiesTypeRef=_entitiesTutanotaTutanotaProperties.TutanotaPropertiesTypeRef},function(_entitiesSysGroupInfo){GroupInfoTypeRef=_entitiesSysGroupInfo.GroupInfoTypeRef},function(_commonUtilsArrayUtils){contains=_commonUtilsArrayUtils.contains},function(_entitiesTutanotaEncryptedMailAddress){createEncryptedMailAddress=_entitiesTutanotaEncryptedMailAddress.createEncryptedMailAddress},function(_nativeFileApp){fileApp=_nativeFileApp.fileApp},function(_ReceipientKeyDataUtils){encryptBucketKeyForInternalRecipient=_ReceipientKeyDataUtils.encryptBucketKeyForInternalRecipient}],execute:function(){assertWorkerOrNode(),_export("MailFacade",MailFacade=function(){function MailFacade(login,fileFacade){_classCallCheck(this,MailFacade),this._getExternalGroupKey=function(recipientInfo,externalUserPwKey,verifier){var _this=this;return loadRoot(GroupRootTypeRef,this._login.getUserGroupId()).then(function(groupRoot){var cleanedMailAddress=recipientInfo.mailAddress.trim().toLocaleLowerCase(),mailAddressId=stringToCustomId(cleanedMailAddress);return load(ExternalUserReferenceTypeRef,[groupRoot.externalUserReferences,mailAddressId]).then(function(externalUserReference){return load(UserTypeRef,externalUserReference.user).then(function(externalUser){var mailGroupId=neverNull(externalUser.memberships.find(function(m){return m.groupType===GroupType.Mail})).group;return Promise.all([load(GroupTypeRef,mailGroupId),load(GroupTypeRef,externalUserReference.userGroup)]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),externalMailGroup=_ref2[0],externalUserGroup=_ref2[1],externalUserGroupKey=decryptKey(_this._login.getUserGroupKey(),neverNull(externalUserGroup.adminGroupEncGKey));return{externalUserGroupKey:externalUserGroupKey,externalMailGroupKey:decryptKey(externalUserGroupKey,neverNull(externalMailGroup.adminGroupEncGKey))}})})}).catch(NotFoundError,function(e){var internalMailGroupKey=_this._login.getGroupKey(_this._login.getGroupId(GroupType.Mail)),externalUserGroupKey=aes128RandomKey(),externalMailGroupKey=aes128RandomKey(),externalUserGroupInfoSessionKey=aes128RandomKey(),externalMailGroupInfoSessionKey=aes128RandomKey(),clientKey=aes128RandomKey(),tutanotaPropertiesSessionKey=aes128RandomKey(),mailboxSessionKey=aes128RandomKey(),userEncEntropy=encryptBytes(externalUserGroupKey,random.generateRandomData(32)),d=createExternalUserData();d.verifier=verifier,d.userEncClientKey=encryptKey(externalUserGroupKey,clientKey),d.externalUserEncUserGroupInfoSessionKey=encryptKey(externalUserGroupKey,externalUserGroupInfoSessionKey),d.internalMailEncUserGroupInfoSessionKey=encryptKey(internalMailGroupKey,externalUserGroupInfoSessionKey),d.externalUserEncMailGroupKey=encryptKey(externalUserGroupKey,externalMailGroupKey),d.externalMailEncMailGroupInfoSessionKey=encryptKey(externalMailGroupKey,externalMailGroupInfoSessionKey),d.internalMailEncMailGroupInfoSessionKey=encryptKey(internalMailGroupKey,externalMailGroupInfoSessionKey),d.externalUserEncEntropy=userEncEntropy,d.externalUserEncTutanotaPropertiesSessionKey=encryptKey(externalUserGroupKey,tutanotaPropertiesSessionKey),d.externalMailEncMailBoxSessionKey=encryptKey(externalMailGroupKey,mailboxSessionKey);var userGroupData=createCreateExternalUserGroupData();return userGroupData.mailAddress=cleanedMailAddress,userGroupData.externalPwEncUserGroupKey=encryptKey(externalUserPwKey,externalUserGroupKey),userGroupData.internalUserEncUserGroupKey=encryptKey(_this._login.getUserGroupKey(),externalUserGroupKey),d.userGroupData=userGroupData,serviceRequestVoid(TutanotaService.ExternalUserService,HttpMethod.POST,d).then(function(){return{externalUserGroupKey:externalUserGroupKey,externalMailGroupKey:externalMailGroupKey}})})})},this._login=login,this._file=fileFacade,this._deferredDraftId=null,this._deferredDraftUpdate=null}return _createClass(MailFacade,[{key:"createMailFolder",value:function(name,parent,ownerGroupId){var mailGroupKey=this._login.getGroupKey(ownerGroupId),sk=aes128RandomKey(),newFolder=createCreateMailFolderData();return newFolder.folderName=name,newFolder.parentFolder=parent,newFolder.ownerEncSessionKey=encryptKey(mailGroupKey,sk),serviceRequestVoid(TutanotaService.MailFolderService,HttpMethod.POST,newFolder,null,sk)}},{key:"createDraft",value:function(subject,body,senderAddress,senderName,toRecipients,ccRecipients,bccRecipients,conversationType,previousMessageId,attachments,confidential,replyTos){var _this2=this;return getMailGroupIdForMailAddress(this._login.getLoggedInUser(),senderAddress).then(function(senderMailGroupId){var userGroupKey=_this2._login.getUserGroupKey(),mailGroupKey=_this2._login.getGroupKey(senderMailGroupId),sk=aes128RandomKey(),service=createDraftCreateData();service.previousMessageId=previousMessageId,service.conversationType=conversationType,service.ownerEncSessionKey=encryptKey(mailGroupKey,sk),service.symEncSessionKey=encryptKey(userGroupKey,sk);var draftData=createDraftData();return draftData.subject=subject,draftData.bodyText=body,draftData.senderMailAddress=senderAddress,draftData.senderName=senderName,draftData.confidential=confidential,draftData.toRecipients=_this2._recipientInfoToDraftRecipient(toRecipients),draftData.ccRecipients=_this2._recipientInfoToDraftRecipient(ccRecipients),draftData.bccRecipients=_this2._recipientInfoToDraftRecipient(bccRecipients),draftData.replyTos=replyTos.map(function(recipient){var ema=createEncryptedMailAddress();return ema.address=recipient.mailAddress,ema.name=recipient.name,ema}),_this2._createAddedAttachments(attachments,[],mailGroupKey).then(function(addedAttachments){return draftData.addedAttachments=addedAttachments,service.draftData=draftData,serviceRequest(TutanotaService.DraftService,HttpMethod.POST,service,DraftCreateReturnTypeRef,null,sk).then(function(createDraftReturn){return load(MailTypeRef,createDraftReturn.draft)})})})}},{key:"_recipientInfoToDraftRecipient",value:function(toRecipients){return toRecipients.map(function(ri){var draftRecipient=createDraftRecipient();return draftRecipient.mailAddress=ri.mailAddress,draftRecipient.name=ri.name,draftRecipient})}},{key:"updateDraft",value:function(subject,body,senderAddress,senderName,toRecipients,ccRecipients,bccRecipients,attachments,confidential,draft){var _this3=this;return getMailGroupIdForMailAddress(this._login.getLoggedInUser(),senderAddress).then(function(senderMailGroupId){var mailGroupKey=_this3._login.getGroupKey(senderMailGroupId),sk=decryptKey(mailGroupKey,draft._ownerEncSessionKey),service=createDraftUpdateData();service.draft=draft._id;var draftData=createDraftData();return draftData.subject=subject,draftData.bodyText=body,draftData.senderMailAddress=senderAddress,draftData.senderName=senderName,draftData.confidential=confidential,draftData.toRecipients=_this3._recipientInfoToDraftRecipient(toRecipients),draftData.ccRecipients=_this3._recipientInfoToDraftRecipient(ccRecipients),draftData.bccRecipients=_this3._recipientInfoToDraftRecipient(bccRecipients),draftData.replyTos=draft.replyTos,draftData.removedAttachments=_this3._getRemovedAttachments(attachments,draft.attachments),_this3._createAddedAttachments(attachments,draft.attachments,mailGroupKey).then(function(addedAttachments){draftData.addedAttachments=addedAttachments,service.draftData=draftData,_this3._deferredDraftId=draft._id,_this3._deferredDraftUpdate=defer();var deferredUpdatePromiseWrapper=_this3._deferredDraftUpdate;return serviceRequest(TutanotaService.DraftService,HttpMethod.PUT,service,DraftUpdateReturnTypeRef,null,sk).then(function(){return deferredUpdatePromiseWrapper.promise})})})}},{key:"_getRemovedAttachments",value:function(providedFiles,existingFileIds){var removedAttachmentIds=[];if(providedFiles){var attachments=neverNull(providedFiles);existingFileIds.forEach(function(fileId){attachments.find(function(attachment){return"DataFile"!==attachment._type&&"FileReference"!==attachment._type&&isSameId(getLetId(attachment),fileId)})||removedAttachmentIds.push(fileId)})}return removedAttachmentIds}},{key:"_createAddedAttachments",value:function(providedFiles,existingFileIds,mailGroupKey){var _this4=this;return providedFiles?Promise.map(providedFiles,function(providedFile){if("DataFile"===providedFile._type){var fileSessionKey=aes128RandomKey(),dataFile=providedFile;return _this4._file.uploadFileData(dataFile,fileSessionKey).then(function(fileDataId){return _this4.createAndEncryptDraftAttachment(fileDataId,fileSessionKey,providedFile,mailGroupKey)})}if("FileReference"===providedFile._type){var _fileSessionKey=aes128RandomKey(),fileRef=providedFile;return _this4._file.uploadFileDataNative(fileRef,_fileSessionKey).then(function(fileDataId){return _this4.createAndEncryptDraftAttachment(fileDataId,_fileSessionKey,providedFile,mailGroupKey)})}return containsId(existingFileIds,getLetId(providedFile))?null:resolveSessionKey(FileTypeModel,providedFile).then(function(fileSessionKey){var attachment=createDraftAttachment();return attachment.existingFile=getLetId(providedFile),attachment.ownerEncFileSessionKey=encryptKey(mailGroupKey,neverNull(fileSessionKey)),attachment})},{concurrency:1}).filter(function(attachment){return null!=attachment}).tap(function(){isApp()&&fileApp.clearFileData().catch(function(e){return console.warn("Failed to clear files",e)})}):Promise.resolve([])}},{key:"createAndEncryptDraftAttachment",value:function(fileDataId,fileSessionKey,providedFile,mailGroupKey){var attachment=createDraftAttachment(),newAttachmentData=createNewDraftAttachment();return newAttachmentData.encFileName=encryptString(fileSessionKey,providedFile.name),newAttachmentData.encMimeType=encryptString(fileSessionKey,providedFile.mimeType),newAttachmentData.fileData=fileDataId,newAttachmentData.encCid=null==providedFile.cid?null:encryptString(fileSessionKey,providedFile.cid),attachment.newFile=newAttachmentData,attachment.ownerEncFileSessionKey=encryptKey(mailGroupKey,fileSessionKey),attachment}},{key:"sendDraft",value:function(draft,recipientInfos,language){var _this5=this;return getMailGroupIdForMailAddress(this._login.getLoggedInUser(),draft.sender.address).then(function(senderMailGroupId){var bucketKey=aes128RandomKey(),service=createSendDraftData();return service.language=language,service.mail=draft._id,Promise.each(draft.attachments,function(fileId){return load(FileTypeRef,fileId).then(function(file){return resolveSessionKey(FileTypeModel,file).then(function(fileSessionKey){var data=createAttachmentKeyData();data.file=fileId,draft.confidential?data.bucketEncFileSessionKey=encryptKey(bucketKey,neverNull(fileSessionKey)):data.fileSessionKey=keyToUint8Array(neverNull(fileSessionKey)),service.attachmentKeyData.push(data)})})}).then(function(){return Promise.all([loadRoot(TutanotaPropertiesTypeRef,_this5._login.getUserGroupId()).then(function(tutanotaProperties){service.plaintext=tutanotaProperties.sendPlaintextOnly}),resolveSessionKey(MailTypeModel,draft).then(function(mailSessionkey){var sk=neverNull(mailSessionkey);if(draft.confidential)return service.bucketEncMailSessionKey=encryptKey(bucketKey,sk),null!=recipientInfos.find(function(r){return isExternalSecureRecipient(r)})&&(service.senderNameUnencrypted=draft.sender.name),_this5._addRecipientKeyData(bucketKey,service,recipientInfos,senderMailGroupId);service.mailSessionKey=bitArrayToUint8Array(sk)})])}).then(function(){return serviceRequestVoid(TutanotaService.SendDraftService,HttpMethod.POST,service)})})}},{key:"_addRecipientKeyData",value:function(bucketKey,service,recipientInfos,senderMailGroupId){var _this6=this,notFoundRecipients=[];return Promise.all(recipientInfos.map(function(recipientInfo){if("system@tutanota.de"===recipientInfo.mailAddress||!recipientInfo)return notFoundRecipients.push(recipientInfo.mailAddress),Promise.resolve();if(recipientInfo.type===recipientInfoType.external&&recipientInfo.contact){var password=recipientInfo.contact.presharedPassword;if(null==password&&""!==recipientInfo.contact.autoTransmitPassword&&(password=recipientInfo.contact.autoTransmitPassword),null==password||!isSameId(_this6._login.getGroupId(GroupType.Mail),senderMailGroupId))return notFoundRecipients.push(recipientInfo.mailAddress),Promise.resolve();var salt=generateRandomSalt(),passwordKey=generateKeyFromPassphrase(password,salt,KeyLength.b128),passwordVerifier=createAuthVerifier(passwordKey);return _this6._getExternalGroupKey(recipientInfo,passwordKey,passwordVerifier).then(function(externalGroupKeys){var data=createSecureExternalRecipientKeyData();data.mailAddress=recipientInfo.mailAddress,data.symEncBucketKey=null,data.ownerEncBucketKey=encryptKey(externalGroupKeys.externalMailGroupKey,bucketKey),data.passwordVerifier=passwordVerifier,data.salt=salt,data.saltHash=hash(salt),data.pwEncCommunicationKey=encryptKey(passwordKey,externalGroupKeys.externalUserGroupKey),service.secureExternalRecipientKeyData.push(data)})}return encryptBucketKeyForInternalRecipient(bucketKey,recipientInfo,notFoundRecipients).then(function(keyData){keyData&&service.internalRecipientKeyData.push(keyData)})})).then(function(){if(notFoundRecipients.length>0)throw new RecipientsNotFoundError(notFoundRecipients)})}},{key:"entityEventsReceived",value:function(data){var _this7=this;return Promise.each(data,function(update){return _this7._deferredDraftUpdate&&_this7._deferredDraftId&&update.operation===OperationType.UPDATE&&isSameTypeRefByAttr(MailTypeRef,update.application,update.type)&&isSameId(_this7._deferredDraftId,[update.instanceListId,update.instanceId])?load(MailTypeRef,neverNull(_this7._deferredDraftId)).then(function(mail){var deferredPromiseWrapper=neverNull(_this7._deferredDraftUpdate);_this7._deferredDraftUpdate=null,deferredPromiseWrapper.resolve(mail)}):Promise.resolve()}).return()}}]),MailFacade}()),_export("MailFacade",MailFacade)}}}),System.register("src/api/entities/sys/MailAddressAliasServiceDataDelete.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MailAddressAliasServiceDataDeleteTypeRef,_TypeModel;return _export("createMailAddressAliasServiceDataDelete",function(values){return Object.assign(create(_TypeModel,MailAddressAliasServiceDataDeleteTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MailAddressAliasServiceDataDeleteTypeRef",MailAddressAliasServiceDataDeleteTypeRef=new TypeRef("sys","MailAddressAliasServiceDataDelete")),_export("MailAddressAliasServiceDataDeleteTypeRef",MailAddressAliasServiceDataDeleteTypeRef),_export("_TypeModel",_TypeModel={name:"MailAddressAliasServiceDataDelete",since:9,type:"DATA_TRANSFER_TYPE",id:785,rootId:"A3N5cwADEQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:786,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:787,since:9,type:"String",cardinality:"One",final:!1,encrypted:!1},restore:{name:"restore",id:788,since:9,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{group:{name:"group",id:789,since:9,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/MailAddressAliasServiceData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MailAddressAliasServiceDataTypeRef,_TypeModel;return _export("createMailAddressAliasServiceData",function(values){return Object.assign(create(_TypeModel,MailAddressAliasServiceDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MailAddressAliasServiceDataTypeRef",MailAddressAliasServiceDataTypeRef=new TypeRef("sys","MailAddressAliasServiceData")),_export("MailAddressAliasServiceDataTypeRef",MailAddressAliasServiceDataTypeRef),_export("_TypeModel",_TypeModel={name:"MailAddressAliasServiceData",since:8,type:"DATA_TRANSFER_TYPE",id:688,rootId:"A3N5cwACsA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:689,since:8,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:690,since:8,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{group:{name:"group",id:691,since:8,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/DomainMailAddressAvailabilityData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DomainMailAddressAvailabilityDataTypeRef,_TypeModel;return _export("createDomainMailAddressAvailabilityData",function(values){return Object.assign(create(_TypeModel,DomainMailAddressAvailabilityDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DomainMailAddressAvailabilityDataTypeRef",DomainMailAddressAvailabilityDataTypeRef=new TypeRef("sys","DomainMailAddressAvailabilityData")),_export("DomainMailAddressAvailabilityDataTypeRef",DomainMailAddressAvailabilityDataTypeRef),_export("_TypeModel",_TypeModel={name:"DomainMailAddressAvailabilityData",since:2,type:"DATA_TRANSFER_TYPE",id:599,rootId:"A3N5cwACVw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:600,since:2,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:601,since:2,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/MailAddressAvailabilityData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MailAddressAvailabilityDataTypeRef,_TypeModel;return _export("createMailAddressAvailabilityData",function(values){return Object.assign(create(_TypeModel,MailAddressAvailabilityDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MailAddressAvailabilityDataTypeRef",MailAddressAvailabilityDataTypeRef=new TypeRef("sys","MailAddressAvailabilityData")),_export("MailAddressAvailabilityDataTypeRef",MailAddressAvailabilityDataTypeRef),_export("_TypeModel",_TypeModel={name:"MailAddressAvailabilityData",since:1,type:"DATA_TRANSFER_TYPE",id:309,rootId:"A3N5cwABNQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:310,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:311,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/DomainMailAddressAvailabilityReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DomainMailAddressAvailabilityReturnTypeRef,_TypeModel;return _export("createDomainMailAddressAvailabilityReturn",function(values){return Object.assign(create(_TypeModel,DomainMailAddressAvailabilityReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DomainMailAddressAvailabilityReturnTypeRef",DomainMailAddressAvailabilityReturnTypeRef=new TypeRef("sys","DomainMailAddressAvailabilityReturn")),_export("DomainMailAddressAvailabilityReturnTypeRef",DomainMailAddressAvailabilityReturnTypeRef),_export("_TypeModel",_TypeModel={name:"DomainMailAddressAvailabilityReturn",since:2,type:"DATA_TRANSFER_TYPE",id:602,rootId:"A3N5cwACWg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:603,since:2,type:"Number",cardinality:"One",final:!1,encrypted:!1},available:{name:"available",id:604,since:2,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/MailAddressAvailabilityReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MailAddressAvailabilityReturnTypeRef,_TypeModel;return _export("createMailAddressAvailabilityReturn",function(values){return Object.assign(create(_TypeModel,MailAddressAvailabilityReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MailAddressAvailabilityReturnTypeRef",MailAddressAvailabilityReturnTypeRef=new TypeRef("sys","MailAddressAvailabilityReturn")),_export("MailAddressAvailabilityReturnTypeRef",MailAddressAvailabilityReturnTypeRef),_export("_TypeModel",_TypeModel={name:"MailAddressAvailabilityReturn",since:1,type:"DATA_TRANSFER_TYPE",id:312,rootId:"A3N5cwABOA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:313,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},available:{name:"available",id:314,since:1,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/MailAddressFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../Env","../../entities/sys/MailAddressAliasServiceDataDelete","../rest/ServiceRestClient","../../common/EntityFunctions","../../entities/sys/MailAddressAliasServiceData","../../entities/sys/DomainMailAddressAvailabilityData","../../entities/sys/MailAddressAvailabilityData","../../entities/sys/DomainMailAddressAvailabilityReturn","../../entities/sys/MailAddressAvailabilityReturn","../../entities/sys/MailAddressAliasServiceReturn","../../entities/sys/Services"],function(_export,_context){"use strict";var _classCallCheck,_createClass,assertWorkerOrNode,createMailAddressAliasServiceDataDelete,_service,HttpMethod,createMailAddressAliasServiceData,createDomainMailAddressAvailabilityData,createMailAddressAvailabilityData,DomainMailAddressAvailabilityReturnTypeRef,MailAddressAvailabilityReturnTypeRef,MailAddressAliasServiceReturnTypeRef,SysService,MailAddressFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_entitiesSysMailAddressAliasServiceDataDelete){createMailAddressAliasServiceDataDelete=_entitiesSysMailAddressAliasServiceDataDelete.createMailAddressAliasServiceDataDelete},function(_restServiceRestClient){_service=_restServiceRestClient._service},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod},function(_entitiesSysMailAddressAliasServiceData){createMailAddressAliasServiceData=_entitiesSysMailAddressAliasServiceData.createMailAddressAliasServiceData},function(_entitiesSysDomainMailAddressAvailabilityData){createDomainMailAddressAvailabilityData=_entitiesSysDomainMailAddressAvailabilityData.createDomainMailAddressAvailabilityData},function(_entitiesSysMailAddressAvailabilityData){createMailAddressAvailabilityData=_entitiesSysMailAddressAvailabilityData.createMailAddressAvailabilityData},function(_entitiesSysDomainMailAddressAvailabilityReturn){DomainMailAddressAvailabilityReturnTypeRef=_entitiesSysDomainMailAddressAvailabilityReturn.DomainMailAddressAvailabilityReturnTypeRef},function(_entitiesSysMailAddressAvailabilityReturn){MailAddressAvailabilityReturnTypeRef=_entitiesSysMailAddressAvailabilityReturn.MailAddressAvailabilityReturnTypeRef},function(_entitiesSysMailAddressAliasServiceReturn){MailAddressAliasServiceReturnTypeRef=_entitiesSysMailAddressAliasServiceReturn.MailAddressAliasServiceReturnTypeRef},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService}],execute:function(){assertWorkerOrNode(),_export("MailAddressFacade",MailAddressFacade=function(){function MailAddressFacade(login){_classCallCheck(this,MailAddressFacade),this._login=login}return _createClass(MailAddressFacade,[{key:"getAliasCounters",value:function(){return _service(SysService.MailAddressAliasService,HttpMethod.GET,null,MailAddressAliasServiceReturnTypeRef)}},{key:"isMailAddressAvailable",value:function(mailAddress){if(this._login.isLoggedIn()){var data=createDomainMailAddressAvailabilityData();return data.mailAddress=mailAddress,_service(SysService.DomainMailAddressAvailabilityService,HttpMethod.GET,data,DomainMailAddressAvailabilityReturnTypeRef).then(function(result){return result.available})}var _data=createMailAddressAvailabilityData();return _data.mailAddress=mailAddress,_service(SysService.MailAddressAvailabilityService,HttpMethod.GET,_data,MailAddressAvailabilityReturnTypeRef).then(function(result){return result.available})}},{key:"addMailAlias",value:function(groupId,alias){var data=createMailAddressAliasServiceData();return data.group=groupId,data.mailAddress=alias,_service(SysService.MailAddressAliasService,HttpMethod.POST,data)}},{key:"setMailAliasStatus",value:function(groupId,alias,restore){var deleteData=createMailAddressAliasServiceDataDelete();return deleteData.mailAddress=alias,deleteData.restore=restore,deleteData.group=groupId,_service(SysService.MailAddressAliasService,HttpMethod.DELETE,deleteData)}}]),MailAddressFacade}()),_export("MailAddressFacade",MailAddressFacade)}}}),System.register("src/api/entities/tutanota/FileDataDataGet.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,FileDataDataGetTypeRef,_TypeModel;return _export("createFileDataDataGet",function(values){return Object.assign(create(_TypeModel,FileDataDataGetTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("FileDataDataGetTypeRef",FileDataDataGetTypeRef=new TypeRef("tutanota","FileDataDataGet")),_export("FileDataDataGetTypeRef",FileDataDataGetTypeRef),_export("_TypeModel",_TypeModel={name:"FileDataDataGet",since:1,type:"DATA_TRANSFER_TYPE",id:331,rootId:"CHR1dGFub3RhAAFL",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:332,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},base64:{name:"base64",id:333,since:1,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{file:{name:"file",id:334,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"File",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/FileDataDataPost.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,FileDataDataPostTypeRef,_TypeModel;return _export("createFileDataDataPost",function(values){return Object.assign(create(_TypeModel,FileDataDataPostTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("FileDataDataPostTypeRef",FileDataDataPostTypeRef=new TypeRef("tutanota","FileDataDataPost")),_export("FileDataDataPostTypeRef",FileDataDataPostTypeRef),_export("_TypeModel",_TypeModel={name:"FileDataDataPost",since:1,type:"DATA_TRANSFER_TYPE",id:335,rootId:"CHR1dGFub3RhAAFP",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:336,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},group:{name:"group",id:337,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1},size:{name:"size",id:338,since:1,type:"Number",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/FileDataReturnPost.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,FileDataReturnPostTypeRef,_TypeModel;return _export("createFileDataReturnPost",function(values){return Object.assign(create(_TypeModel,FileDataReturnPostTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("FileDataReturnPostTypeRef",FileDataReturnPostTypeRef=new TypeRef("tutanota","FileDataReturnPost")),_export("FileDataReturnPostTypeRef",FileDataReturnPostTypeRef),_export("_TypeModel",_TypeModel={name:"FileDataReturnPost",since:1,type:"DATA_TRANSFER_TYPE",id:342,rootId:"CHR1dGFub3RhAAFW",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:343,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{fileData:{name:"fileData",id:344,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"FileData",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/FileDataDataReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,FileDataDataReturnTypeRef,_TypeModel;return _export("createFileDataDataReturn",function(values){return Object.assign(create(_TypeModel,FileDataDataReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("FileDataDataReturnTypeRef",FileDataDataReturnTypeRef=new TypeRef("tutanota","FileDataDataReturn")),_export("FileDataDataReturnTypeRef",FileDataDataReturnTypeRef),_export("_TypeModel",_TypeModel={name:"FileDataDataReturn",since:1,type:"DATA_TRANSFER_TYPE",id:339,rootId:"CHR1dGFub3RhAAFT",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:340,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},size:{name:"size",id:341,since:1,type:"Number",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/native/AesApp.js",["../api/common/utils/Encoding","./NativeWrapper","../api/common/WorkerProtocol","../api/worker/crypto/CryptoUtils"],function(_export,_context){"use strict";var uint8ArrayToBase64,nativeApp,Request,keyToBase64;return _export("aesEncryptFile",function(key,fileUrl,iv){var encodedKey=keyToBase64(key);return nativeApp.invokeNative(new Request("aesEncryptFile",[encodedKey,fileUrl,uint8ArrayToBase64(iv)]))}),_export("aesDecryptFile",function(key,fileUrl){var encodedKey=keyToBase64(key);return nativeApp.invokeNative(new Request("aesDecryptFile",[encodedKey,fileUrl]))}),{setters:[function(_apiCommonUtilsEncoding){uint8ArrayToBase64=_apiCommonUtilsEncoding.uint8ArrayToBase64},function(_NativeWrapper){nativeApp=_NativeWrapper.nativeApp},function(_apiCommonWorkerProtocol){Request=_apiCommonWorkerProtocol.Request},function(_apiWorkerCryptoCryptoUtils){keyToBase64=_apiWorkerCryptoCryptoUtils.keyToBase64}],execute:function(){}}}),System.register("src/api/worker/facades/FileFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../entities/tutanota/FileDataDataGet","../rest/RestClient","../crypto/CryptoFacade","../crypto/Aes","../../entities/tutanota/File","../../common/utils/Utils","../../entities/tutanota/FileDataDataPost","../rest/ServiceRestClient","../../entities/tutanota/FileDataReturnPost","../../common/TutanotaConstants","../crypto/Randomizer","../../entities/tutanota/FileDataDataReturn","../../common/EntityFunctions","../../Env","../../../native/AesApp","../../common/error/RestError","../../../native/FileApp","../../common/DataFile"],function(_export,_context){"use strict";var _classCallCheck,_createClass,FileDataDataGetTypModel,createFileDataDataGet,addParamsToUrl,restClient,encryptAndMapToLiteral,encryptBytes,resolveSessionKey,aes128Decrypt,FileTypeModel,neverNull,createFileDataDataPost,_service,FileDataReturnPostTypeRef,GroupType,random,FileDataDataReturnTypeModel,HttpMethod,MediaType,assertWorkerOrNode,getHttpOrigin,Mode,aesDecryptFile,aesEncryptFile,handleRestError,fileApp,createDataFile,FileFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_entitiesTutanotaFileDataDataGet){FileDataDataGetTypModel=_entitiesTutanotaFileDataDataGet._TypeModel,createFileDataDataGet=_entitiesTutanotaFileDataDataGet.createFileDataDataGet},function(_restRestClient){addParamsToUrl=_restRestClient.addParamsToUrl,restClient=_restRestClient.restClient},function(_cryptoCryptoFacade){encryptAndMapToLiteral=_cryptoCryptoFacade.encryptAndMapToLiteral,encryptBytes=_cryptoCryptoFacade.encryptBytes,resolveSessionKey=_cryptoCryptoFacade.resolveSessionKey},function(_cryptoAes){aes128Decrypt=_cryptoAes.aes128Decrypt},function(_entitiesTutanotaFile){FileTypeModel=_entitiesTutanotaFile._TypeModel},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull},function(_entitiesTutanotaFileDataDataPost){createFileDataDataPost=_entitiesTutanotaFileDataDataPost.createFileDataDataPost},function(_restServiceRestClient){_service=_restServiceRestClient._service},function(_entitiesTutanotaFileDataReturnPost){FileDataReturnPostTypeRef=_entitiesTutanotaFileDataReturnPost.FileDataReturnPostTypeRef},function(_commonTutanotaConstants){GroupType=_commonTutanotaConstants.GroupType},function(_cryptoRandomizer){random=_cryptoRandomizer.random},function(_entitiesTutanotaFileDataDataReturn){FileDataDataReturnTypeModel=_entitiesTutanotaFileDataDataReturn._TypeModel},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod,MediaType=_commonEntityFunctions.MediaType},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode,getHttpOrigin=_Env.getHttpOrigin,Mode=_Env.Mode},function(_nativeAesApp){aesDecryptFile=_nativeAesApp.aesDecryptFile,aesEncryptFile=_nativeAesApp.aesEncryptFile},function(_commonErrorRestError){handleRestError=_commonErrorRestError.handleRestError},function(_nativeFileApp){fileApp=_nativeFileApp.fileApp},function(_commonDataFile){createDataFile=_commonDataFile.createDataFile}],execute:function(){assertWorkerOrNode(),_export("FileFacade",FileFacade=function(){function FileFacade(login){_classCallCheck(this,FileFacade),this._login=login}return _createClass(FileFacade,[{key:"downloadFileContent",value:function(file){var _this=this,requestData=createFileDataDataGet();return requestData.file=file._id,requestData.base64=!1,resolveSessionKey(FileTypeModel,file).then(function(sessionKey){return encryptAndMapToLiteral(FileDataDataGetTypModel,requestData,null).then(function(entityToSend){var headers=_this._login.createAuthHeaders();headers.v=FileDataDataGetTypModel.version;var body=JSON.stringify(entityToSend);return restClient.request("/rest/tutanota/filedataservice",HttpMethod.GET,{},headers,body,MediaType.Binary).then(function(data){return createDataFile(file,aes128Decrypt(neverNull(sessionKey),data))})})})}},{key:"downloadFileContentNative",value:function(file){var _this2=this;if(![Mode.App,Mode.Desktop].includes(env.mode))return Promise.reject("Environment is not app or Desktop!");var requestData=createFileDataDataGet();return requestData.file=file._id,requestData.base64=!1,resolveSessionKey(FileTypeModel,file).then(function(sessionKey){return encryptAndMapToLiteral(FileDataDataGetTypModel,requestData,null).then(function(entityToSend){var headers=_this2._login.createAuthHeaders();headers.v=FileDataDataGetTypModel.version;var body=JSON.stringify(entityToSend),queryParams={_body:encodeURIComponent(body)},url=addParamsToUrl(getHttpOrigin()+"/rest/tutanota/filedataservice",queryParams);return fileApp.download(url,file.name,headers).then(function(_ref){var statusCode=_ref.statusCode,encryptedFileUri=_ref.encryptedFileUri,errorId=_ref.errorId,precondition=_ref.precondition;return(200===statusCode&&null!=encryptedFileUri?aesDecryptFile(neverNull(sessionKey),encryptedFileUri).then(function(decryptedFileUrl){return{_type:"FileReference",name:file.name,mimeType:file.mimeType,location:decryptedFileUrl,size:file.size}}):Promise.reject(handleRestError(statusCode," | GET "+url+" failed to natively download attachment",errorId,precondition))).finally(function(){return null!=encryptedFileUri&&fileApp.deleteFile(encryptedFileUri).catch(function(){return console.log("Failed to delete encrypted file",encryptedFileUri)})})})})})}},{key:"uploadFileData",value:function(dataFile,sessionKey){var _this3=this,encryptedData=encryptBytes(sessionKey,dataFile.data),fileData=createFileDataDataPost();return fileData.size=dataFile.data.byteLength.toString(),fileData.group=this._login.getGroupId(GroupType.Mail),_service("filedataservice",HttpMethod.POST,fileData,FileDataReturnPostTypeRef,null,sessionKey).then(function(fileDataPostReturn){var fileDataId=fileDataPostReturn.fileData,headers=_this3._login.createAuthHeaders();return headers.v=FileDataDataReturnTypeModel.version,restClient.request("/rest/tutanota/filedataservice",HttpMethod.PUT,{fileDataId:fileDataId},headers,encryptedData,MediaType.Binary).then(function(){return fileDataId})})}},{key:"uploadFileDataNative",value:function(fileReference,sessionKey){var _this4=this;return aesEncryptFile(sessionKey,fileReference.location,random.generateRandomData(16)).then(function(encryptedFileInfo){var fileData=createFileDataDataPost();return fileData.size=encryptedFileInfo.unencSize.toString(),fileData.group=_this4._login.getGroupId(GroupType.Mail),_service("filedataservice",HttpMethod.POST,fileData,FileDataReturnPostTypeRef,null,sessionKey).then(function(fileDataPostReturn){var fileDataId=fileDataPostReturn.fileData,headers=_this4._login.createAuthHeaders();headers.v=FileDataDataReturnTypeModel.version;var url=addParamsToUrl(getHttpOrigin()+"/rest/tutanota/filedataservice",{fileDataId:fileDataId});return fileApp.upload(encryptedFileInfo.uri,url,headers).then(function(_ref2){var statusCode=_ref2.statusCode,errorId=(_ref2.uri,_ref2.errorId),precondition=_ref2.precondition;if(200===statusCode)return fileDataId;throw handleRestError(statusCode," | PUT "+url+" failed to natively upload attachment",errorId,precondition)})})})}}]),FileFacade}()),_export("FileFacade",FileFacade)}}}),System.register("src/api/worker/search/ContactIndexer.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../common/error/RestError","../../entities/tutanota/Contact","../EntityWorker","./IndexUtils","../../common/utils/Utils","./DbFacade","../../common/TutanotaConstants","../../entities/tutanota/ContactList","./IndexerCore","./SuggestionFacade","./Tokenizer"],function(_export,_context){"use strict";var _classCallCheck,_createClass,NotAuthorizedError,NotFoundError,ContactModel,ContactTypeRef,_createNewIndexUpdate,typeRefToTypeInfo,neverNull,GroupDataOS,MetaDataOS,FULL_INDEXED_TIMESTAMP,NOTHING_INDEXED_TIMESTAMP,OperationType,ContactListTypeRef,tokenize,ContactIndexer;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonErrorRestError){NotAuthorizedError=_commonErrorRestError.NotAuthorizedError,NotFoundError=_commonErrorRestError.NotFoundError},function(_entitiesTutanotaContact){ContactModel=_entitiesTutanotaContact._TypeModel,ContactTypeRef=_entitiesTutanotaContact.ContactTypeRef},function(_EntityWorker){_EntityWorker.EntityWorker},function(_IndexUtils){_createNewIndexUpdate=_IndexUtils._createNewIndexUpdate,typeRefToTypeInfo=_IndexUtils.typeRefToTypeInfo},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull},function(_DbFacade){GroupDataOS=_DbFacade.GroupDataOS,MetaDataOS=_DbFacade.MetaDataOS},function(_commonTutanotaConstants){FULL_INDEXED_TIMESTAMP=_commonTutanotaConstants.FULL_INDEXED_TIMESTAMP,NOTHING_INDEXED_TIMESTAMP=_commonTutanotaConstants.NOTHING_INDEXED_TIMESTAMP,OperationType=_commonTutanotaConstants.OperationType},function(_entitiesTutanotaContactList){ContactListTypeRef=_entitiesTutanotaContactList.ContactListTypeRef},function(_IndexerCore){_IndexerCore.IndexerCore},function(_SuggestionFacade){_SuggestionFacade.SuggestionFacade},function(_Tokenizer){tokenize=_Tokenizer.tokenize}],execute:function(){_export("ContactIndexer",ContactIndexer=function(){function ContactIndexer(core,db,entity,suggestionFacade){_classCallCheck(this,ContactIndexer),this._core=core,this._db=db,this._entity=entity,this.suggestionFacade=suggestionFacade}return _createClass(ContactIndexer,[{key:"createContactIndexEntries",value:function(contact){var keyToIndexEntries=this._core.createIndexEntriesForAttributes(ContactModel,contact,[{attribute:ContactModel.values.firstName,value:function(){return contact.firstName}},{attribute:ContactModel.values.lastName,value:function(){return contact.lastName}},{attribute:ContactModel.values.nickname,value:function(){return contact.nickname||""}},{attribute:ContactModel.values.role,value:function(){return contact.role}},{attribute:ContactModel.values.title,value:function(){return contact.title||""}},{attribute:ContactModel.values.comment,value:function(){return contact.comment}},{attribute:ContactModel.values.company,value:function(){return contact.company}},{attribute:ContactModel.associations.addresses,value:function(){return contact.addresses.map(function(a){return a.address}).join(",")}},{attribute:ContactModel.associations.mailAddresses,value:function(){return contact.mailAddresses.map(function(cma){return cma.address}).join(",")}},{attribute:ContactModel.associations.phoneNumbers,value:function(){return contact.phoneNumbers.map(function(pn){return pn.number}).join(",")}},{attribute:ContactModel.associations.socialIds,value:function(){return contact.socialIds.map(function(s){return s.socialId}).join(",")}}]);return this.suggestionFacade.addSuggestions(this._getSuggestionWords(contact)),keyToIndexEntries}},{key:"_getSuggestionWords",value:function(contact){return tokenize(contact.firstName+" "+contact.lastName+" "+contact.mailAddresses.map(function(ma){return ma.address}).join(" "))}},{key:"processNewContact",value:function(event){var _this=this;return this._entity.load(ContactTypeRef,[event.instanceListId,event.instanceId]).then(function(contact){var keyToIndexEntries=_this.createContactIndexEntries(contact);return _this.suggestionFacade.store().then(function(){return{contact:contact,keyToIndexEntries:keyToIndexEntries}})}).catch(NotFoundError,function(){return console.log("tried to index non existing contact"),null}).catch(NotAuthorizedError,function(){return console.log("tried to index contact without permission"),null})}},{key:"indexFullContactList",value:function(userGroupId){var _this2=this;return this._entity.loadRoot(ContactListTypeRef,userGroupId).then(function(contactList){return _this2._db.dbFacade.createTransaction(!0,[MetaDataOS,GroupDataOS]).then(function(t){var groupId=neverNull(contactList._ownerGroup),indexUpdate=_createNewIndexUpdate(typeRefToTypeInfo(ContactTypeRef));return t.get(GroupDataOS,groupId).then(function(groupData){if(groupData&&groupData.indexTimestamp===NOTHING_INDEXED_TIMESTAMP)return _this2._entity.loadAll(ContactTypeRef,contactList.contacts).then(function(contacts){return contacts.forEach(function(contact){var keyToIndexEntries=_this2.createContactIndexEntries(contact);_this2._core.encryptSearchIndexEntries(contact._id,neverNull(contact._ownerGroup),keyToIndexEntries,indexUpdate)}),Promise.all([_this2._core.writeIndexUpdate([{groupId:groupId,indexTimestamp:FULL_INDEXED_TIMESTAMP}],indexUpdate),_this2.suggestionFacade.store()])})})})}).catch(NotFoundError,function(e){return Promise.resolve()})}},{key:"processEntityEvents",value:function(events,groupId,batchId,indexUpdate){var _this3=this;return Promise.each(events,function(event,index){return event.operation===OperationType.CREATE?_this3.processNewContact(event).then(function(result){result&&_this3._core.encryptSearchIndexEntries(result.contact._id,neverNull(result.contact._ownerGroup),result.keyToIndexEntries,indexUpdate)}):event.operation===OperationType.UPDATE?Promise.all([_this3._core._processDeleted(event,indexUpdate),_this3.processNewContact(event).then(function(result){result&&_this3._core.encryptSearchIndexEntries(result.contact._id,neverNull(result.contact._ownerGroup),result.keyToIndexEntries,indexUpdate)})]):event.operation===OperationType.DELETE?_this3._core._processDeleted(event,indexUpdate):void 0}).return()}}]),ContactIndexer}()),_export("ContactIndexer",ContactIndexer)}}}),System.register("src/api/worker/search/GroupInfoIndexer.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../common/TutanotaConstants","../EntityWorker","../../common/error/RestError","../../entities/sys/GroupInfo","../../common/utils/Utils","./IndexUtils","../../entities/sys/Customer","./DbFacade","./IndexerCore","./SuggestionFacade","./Tokenizer"],function(_export,_context){"use strict";var _classCallCheck,_createClass,FULL_INDEXED_TIMESTAMP,NOTHING_INDEXED_TIMESTAMP,OperationType,NotFoundError,GroupInfoModel,GroupInfoTypeRef,neverNull,_createNewIndexUpdate,typeRefToTypeInfo,userIsLocalOrGlobalAdmin,CustomerTypeRef,GroupDataOS,tokenize,GroupInfoIndexer;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonTutanotaConstants){FULL_INDEXED_TIMESTAMP=_commonTutanotaConstants.FULL_INDEXED_TIMESTAMP,NOTHING_INDEXED_TIMESTAMP=_commonTutanotaConstants.NOTHING_INDEXED_TIMESTAMP,OperationType=_commonTutanotaConstants.OperationType},function(_EntityWorker){_EntityWorker.EntityWorker},function(_commonErrorRestError){NotFoundError=_commonErrorRestError.NotFoundError},function(_entitiesSysGroupInfo){GroupInfoModel=_entitiesSysGroupInfo._TypeModel,GroupInfoTypeRef=_entitiesSysGroupInfo.GroupInfoTypeRef},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull},function(_IndexUtils){_createNewIndexUpdate=_IndexUtils._createNewIndexUpdate,typeRefToTypeInfo=_IndexUtils.typeRefToTypeInfo,userIsLocalOrGlobalAdmin=_IndexUtils.userIsLocalOrGlobalAdmin},function(_entitiesSysCustomer){CustomerTypeRef=_entitiesSysCustomer.CustomerTypeRef},function(_DbFacade){GroupDataOS=_DbFacade.GroupDataOS},function(_IndexerCore){_IndexerCore.IndexerCore},function(_SuggestionFacade){_SuggestionFacade.SuggestionFacade},function(_Tokenizer){tokenize=_Tokenizer.tokenize}],execute:function(){_export("GroupInfoIndexer",GroupInfoIndexer=function(){function GroupInfoIndexer(core,db,entity,suggestionFacade){_classCallCheck(this,GroupInfoIndexer),this._core=core,this._db=db,this._entity=entity,this.suggestionFacade=suggestionFacade}return _createClass(GroupInfoIndexer,[{key:"createGroupInfoIndexEntries",value:function(groupInfo){return this.suggestionFacade.addSuggestions(this._getSuggestionWords(groupInfo)),this._core.createIndexEntriesForAttributes(GroupInfoModel,groupInfo,[{attribute:GroupInfoModel.values.name,value:function(){return groupInfo.name}},{attribute:GroupInfoModel.values.mailAddress,value:function(){return groupInfo.mailAddress?groupInfo.mailAddress:""}},{attribute:GroupInfoModel.associations.mailAddressAliases,value:function(){return groupInfo.mailAddressAliases.map(function(maa){return maa.mailAddress}).join(",")}}])}},{key:"_getSuggestionWords",value:function(groupInfo){return tokenize(groupInfo.name+" "+(groupInfo.mailAddress?groupInfo.mailAddress:"")+" "+groupInfo.mailAddressAliases.map(function(alias){return alias.mailAddress}).join(" "))}},{key:"processNewGroupInfo",value:function(event){var _this=this;return this._entity.load(GroupInfoTypeRef,[event.instanceListId,event.instanceId]).then(function(groupInfo){var keyToIndexEntries=_this.createGroupInfoIndexEntries(groupInfo);return _this.suggestionFacade.store().then(function(){return{groupInfo:groupInfo,keyToIndexEntries:keyToIndexEntries}})}).catch(NotFoundError,function(){return console.log("tried to index non existing group info"),null})}},{key:"indexAllUserAndTeamGroupInfosForAdmin",value:function(user){var _this2=this;return userIsLocalOrGlobalAdmin(user)?this._entity.load(CustomerTypeRef,neverNull(user.customer)).then(function(customer){return _this2._db.dbFacade.createTransaction(!0,[GroupDataOS]).then(function(t){return t.get(GroupDataOS,customer.customerGroup).then(function(groupData){if(groupData&&groupData.indexTimestamp===NOTHING_INDEXED_TIMESTAMP)return Promise.all([_this2._entity.loadAll(GroupInfoTypeRef,customer.userGroups),_this2._entity.loadAll(GroupInfoTypeRef,customer.teamGroups)]).spread(function(allUserGroupInfos,allTeamGroupInfos){var indexUpdate=_createNewIndexUpdate(typeRefToTypeInfo(GroupInfoTypeRef));return allUserGroupInfos.concat(allTeamGroupInfos).forEach(function(groupInfo){var keyToIndexEntries=_this2.createGroupInfoIndexEntries(groupInfo);_this2._core.encryptSearchIndexEntries(groupInfo._id,neverNull(groupInfo._ownerGroup),keyToIndexEntries,indexUpdate)}),Promise.all([_this2._core.writeIndexUpdate([{groupId:customer.customerGroup,indexTimestamp:FULL_INDEXED_TIMESTAMP}],indexUpdate),_this2.suggestionFacade.store()])})})})}):Promise.resolve()}},{key:"processEntityEvents",value:function(events,groupId,batchId,indexUpdate,user){var _this3=this;return Promise.each(events,function(event,index){if(userIsLocalOrGlobalAdmin(user)){if(event.operation===OperationType.CREATE)return _this3.processNewGroupInfo(event).then(function(result){result&&_this3._core.encryptSearchIndexEntries(result.groupInfo._id,neverNull(result.groupInfo._ownerGroup),result.keyToIndexEntries,indexUpdate)});if(event.operation===OperationType.UPDATE)return Promise.all([_this3._core._processDeleted(event,indexUpdate),_this3.processNewGroupInfo(event).then(function(result){result&&_this3._core.encryptSearchIndexEntries(result.groupInfo._id,neverNull(result.groupInfo._ownerGroup),result.keyToIndexEntries,indexUpdate)})]);if(event.operation===OperationType.DELETE)return _this3._core._processDeleted(event,indexUpdate)}}).return()}}]),GroupInfoIndexer}()),_export("GroupInfoIndexer",GroupInfoIndexer)}}}),System.register("src/api/worker/search/IndexUtils.js",["../../common/utils/Encoding","../crypto/Aes","../../common/utils/ArrayUtils","../crypto/Randomizer","../../common/TutanotaConstants","./SearchIndexEncoding","../../entities/tutanota/Mail","../../entities/tutanota/Contact","../../entities/sys/GroupInfo","../../entities/sys/WhitelabelChild","../../common/EntityFunctions","../../Env"],function(_export,_context){"use strict";var stringToUtf8Uint8Array,uint8ArrayToBase64,utf8Uint8ArrayToString,aes256Decrypt,aes256Encrypt,IV_BYTE_LENGTH,concat,random,GroupType,calculateNeededSpaceForNumber,calculateNeededSpaceForNumbers,decodeNumberBlock,decodeNumbers,encodeNumbers,MailModel,ContactModel,GroupInfoModel,WhitelabelChildModel,isTest,metaEntryFieldsNumber,typeInfos,HTML_ENTITIES;function encryptIndexKeyUint8Array(key,indexKey,dbIv){return aes256Encrypt(key,stringToUtf8Uint8Array(indexKey),dbIv,!0,!1).slice(dbIv.length)}function decryptIndexKey(key,encIndexKey,dbIv){return utf8Uint8ArrayToString(aes256Decrypt(key,concat(dbIv,encIndexKey),!0,!1))}function getAttributeIds(model){return Object.keys(model.values).map(function(name){return model.values[name].id}).concat(Object.keys(model.associations).map(function(name){return model.associations[name].id}))}function getIdFromEncSearchIndexEntry(entry){return entry.subarray(0,16)}function shouldMeasure(){return!env.dist&&!isTest()}return _export("encryptIndexKeyBase64",function(key,indexKey,dbIv){return uint8ArrayToBase64(encryptIndexKeyUint8Array(key,indexKey,dbIv))}),_export("encryptIndexKeyUint8Array",encryptIndexKeyUint8Array),_export("decryptIndexKey",decryptIndexKey),_export("encryptSearchIndexEntry",function(key,entry,encryptedInstanceId){var searchIndexEntryNumberValues=[entry.attribute].concat(entry.positions),neededSpace=calculateNeededSpaceForNumbers(searchIndexEntryNumberValues),block=new Uint8Array(neededSpace);encodeNumbers(searchIndexEntryNumberValues,block,0);var encData=aes256Encrypt(key,block,random.generateRandomData(IV_BYTE_LENGTH),!0,!1),resultArray=new Uint8Array(encryptedInstanceId.length+encData.length);return resultArray.set(encryptedInstanceId),resultArray.set(encData,16),resultArray}),_export("decryptSearchIndexEntry",function(key,entry,dbIv){var encId=getIdFromEncSearchIndexEntry(entry),id=decryptIndexKey(key,encId,dbIv),data=aes256Decrypt(key,entry.subarray(16),!0,!1),offset=0,attribute=decodeNumberBlock(data,offset);return offset+=calculateNeededSpaceForNumber(attribute),{id:id,encId:encId,attribute:attribute,positions:decodeNumbers(data,offset)}}),_export("encryptMetaData",function(key,metaData){for(var numbers=new Array(metaData.rows.length*metaEntryFieldsNumber),i=0;i<metaData.rows.length;i++){var entry=metaData.rows[i],offset=i*metaEntryFieldsNumber;numbers[offset]=entry.app,numbers[offset+1]=entry.type,numbers[offset+2]=entry.key,numbers[offset+3]=entry.size,numbers[offset+4]=entry.oldestElementTimestamp}var numberBlock=new Uint8Array(calculateNeededSpaceForNumbers(numbers));encodeNumbers(numbers,numberBlock);var encryptedRows=aes256Encrypt(key,numberBlock,random.generateRandomData(IV_BYTE_LENGTH),!0,!1);return{id:metaData.id,word:metaData.word,rows:encryptedRows}}),_export("decryptMetaData",function(key,encryptedMeta){if(0===encryptedMeta.rows.length)return{id:encryptedMeta.id,word:encryptedMeta.word,rows:[]};for(var numbersBlock=aes256Decrypt(key,encryptedMeta.rows,!0,!1),numbers=decodeNumbers(numbersBlock),rows=[],i=0;i<numbers.length;i+=metaEntryFieldsNumber)rows.push({app:numbers[i],type:numbers[i+1],key:numbers[i+2],size:numbers[i+3],oldestElementTimestamp:numbers[i+4]});return{id:encryptedMeta.id,word:encryptedMeta.word,rows:rows}}),_export("typeRefToTypeInfo",function(typeRef){var app=typeInfos[typeRef.app];if(!app)throw new Error("No TypeInfo for app: "+app);if(!app[typeRef.type])throw new Error("No TypeInfo for TypeRef "+typeRef.app+" : "+typeRef.type);return typeInfos[typeRef.app][typeRef.type]}),_export("userIsLocalOrGlobalAdmin",function(user){return null!=user.memberships.find(function(m){return m.groupType===GroupType.Admin||m.groupType===GroupType.LocalAdmin})}),_export("userIsGlobalAdmin",function(user){return null!=user.memberships.find(function(m){return m.groupType===GroupType.Admin})}),_export("filterIndexMemberships",function(user){return user.memberships.filter(function(m){return m.groupType===GroupType.Mail||m.groupType===GroupType.Contact||m.groupType===GroupType.Customer||m.groupType===GroupType.Admin})}),_export("filterMailMemberships",function(user){return user.memberships.filter(function(m){return m.groupType===GroupType.Mail})}),_export("byteLength",function(str){if(null==str)return 0;for(var s=str.length,i=str.length-1;i>=0;i--){var code=str.charCodeAt(i);code>127&&code<=2047?s++:code>2047&&code<=65535&&(s+=2),code>=56320&&code<=57343&&i--}return s}),_export("_createNewIndexUpdate",function(typeInfo){return{typeInfo:typeInfo,create:{encInstanceIdToElementData:new Map,indexMap:new Map},move:[],delete:{searchMetaRowToEncInstanceIds:new Map,encInstanceIds:[]}}}),_export("htmlToText",function(html){return null==html?"":html.replace(/<[^>]*>?/gm," ").replace(/&[#0-9a-zA-Z]+;/g,function(match){var replacement=void 0;if(match.startsWith("&#")){var charCode=match.substring(2,match.length-1);isNaN(charCode)||(replacement=String.fromCharCode(Number(charCode)))}else replacement=HTML_ENTITIES[match];return replacement||match})}),_export("getPerformanceTimestamp",function(){return"undefined"==typeof performance?Date.now():performance.now()}),_export("getIdFromEncSearchIndexEntry",getIdFromEncSearchIndexEntry),_export("compareMetaEntriesOldest",function(left,right){return left.oldestElementTimestamp-right.oldestElementTimestamp}),_export("printMeasure",function(prefix,names){if(shouldMeasure()){var measures={},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=names[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var name=_step.value;try{measures[name]=performance.getEntriesByName(name,"measure").reduce(function(acc,entry){return acc+entry.duration},0),performance.clearMeasures(name),performance.clearMarks(name+"-end"),performance.clearMarks(name+"-start")}catch(e){}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}console.log(prefix,JSON.stringify(measures))}}),_export("markStart",function(name){shouldMeasure()&&performance.mark(name+"-start")}),_export("markEnd",function(name){if(shouldMeasure())try{performance.mark(name+"-end"),performance.measure(name,name+"-start",name+"-end")}catch(e){}}),_export("shouldMeasure",shouldMeasure),{setters:[function(_commonUtilsEncoding){stringToUtf8Uint8Array=_commonUtilsEncoding.stringToUtf8Uint8Array,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64,utf8Uint8ArrayToString=_commonUtilsEncoding.utf8Uint8ArrayToString},function(_cryptoAes){aes256Decrypt=_cryptoAes.aes256Decrypt,aes256Encrypt=_cryptoAes.aes256Encrypt,IV_BYTE_LENGTH=_cryptoAes.IV_BYTE_LENGTH},function(_commonUtilsArrayUtils){concat=_commonUtilsArrayUtils.concat},function(_cryptoRandomizer){random=_cryptoRandomizer.random},function(_commonTutanotaConstants){GroupType=_commonTutanotaConstants.GroupType},function(_SearchIndexEncoding){calculateNeededSpaceForNumber=_SearchIndexEncoding.calculateNeededSpaceForNumber,calculateNeededSpaceForNumbers=_SearchIndexEncoding.calculateNeededSpaceForNumbers,decodeNumberBlock=_SearchIndexEncoding.decodeNumberBlock,decodeNumbers=_SearchIndexEncoding.decodeNumbers,encodeNumbers=_SearchIndexEncoding.encodeNumbers},function(_entitiesTutanotaMail){MailModel=_entitiesTutanotaMail._TypeModel},function(_entitiesTutanotaContact){ContactModel=_entitiesTutanotaContact._TypeModel},function(_entitiesSysGroupInfo){GroupInfoModel=_entitiesSysGroupInfo._TypeModel},function(_entitiesSysWhitelabelChild){WhitelabelChildModel=_entitiesSysWhitelabelChild._TypeModel},function(_commonEntityFunctions){_commonEntityFunctions.TypeRef},function(_Env){isTest=_Env.isTest}],execute:function(){metaEntryFieldsNumber=5,typeInfos={tutanota:{Mail:{appId:1,typeId:MailModel.id,attributeIds:getAttributeIds(MailModel)},Contact:{appId:1,typeId:ContactModel.id,attributeIds:getAttributeIds(ContactModel)}},sys:{GroupInfo:{appId:0,typeId:GroupInfoModel.id,attributeIds:getAttributeIds(GroupInfoModel)},WhitelabelChild:{appId:0,typeId:WhitelabelChildModel.id,attributeIds:getAttributeIds(WhitelabelChildModel)}}},HTML_ENTITIES={"&nbsp;":" ","&amp;":"&","&lt;":"<","&gt;":">","&Agrave;":"À","&Aacute;":"Á","&Acirc;":"Â","&Atilde;":"Ã","&Auml;":"Ä","&Aring;":"Å","&AElig;":"Æ","&Ccedil;":"Ç","&Egrave;":"È","&Eacute;":"É","&Ecirc;":"Ê","&Euml;":"Ë","&Igrave;":"Ì","&Iacute;":"Í","&Icirc;":"Î","&Iuml;":"Ï","&ETH;":"Ð","&Ntilde;":"Ñ","&Ograve;":"Ò","&Oacute;":"Ó","&Ocirc;":"Ô","&Otilde;":"Õ","&Ouml;":"Ö","&Oslash;":"Ø","&Ugrave;":"Ù","&Uacute;":"Ú","&Ucirc;":"Û","&Uuml;":"Ü","&Yacute;":"Ý","&THORN;":"Þ","&szlig;":"ß","&agrave;":"à","&aacute;":"á","&acirc;":"â","&atilde;":"ã","&auml;":"ä","&aring;":"å","&aelig;":"æ","&ccedil;":"ç","&egrave;":"è","&eacute;":"é","&ecirc;":"ê","&euml;":"ë","&igrave;":"ì","&iacute;":"í","&icirc;":"î","&iuml;":"ï","&eth;":"ð","&ntilde;":"ñ","&ograve;":"ò","&oacute;":"ó","&ocirc;":"ô","&otilde;":"õ","&ouml;":"ö","&oslash;":"ø","&ugrave;":"ù","&uacute;":"ú","&ucirc;":"û","&uuml;":"ü","&yacute;":"ý","&thorn;":"þ","&yuml;":"ÿ","&Alpha;":"Α","&Beta;":"Β","&Gamma;":"Γ","&Delta;":"Δ","&Epsilon;":"Ε","&Zeta;":"Ζ","&Eta;":"Η","&Theta;":"Θ","&Iota;":"Ι","&Kappa;":"Κ","&Lambda;":"Λ","&Mu;":"Μ","&Nu;":"Ν","&Xi;":"Ξ","&Omicron;":"Ο","&Pi;":"Π","&Rho;":"Ρ","&Sigma;":"Σ","&Tau;":"Τ","&Upsilon;":"Υ","&Phi;":"Φ","&Chi;":"Χ","&Psi;":"Ψ","&Omega;":"Ω","&alpha;":"α","&beta;":"β","&gamma;":"γ","&delta;":"δ","&epsilon;":"ε","&zeta;":"ζ","&eta;":"η","&theta;":"θ","&iota;":"ι","&kappa;":"κ","&lambda;":"λ","&mu;":"μ","&nu;":"ν","&xi;":"ξ","&omicron;":"ο","&pi;":"π","&rho;":"ρ","&sigmaf;":"ς","&sigma;":"σ","&tau;":"τ","&upsilon;":"υ","&phi;":"φ","&chi;":"χ","&psi;":"ψ","&omega;":"ω","&thetasym;":"ϑ","&upsih;":"ϒ","&piv;":"ϖ"}}}}),System.register("src/api/worker/rest/ServiceRestClient.js",["./RestClient","../WorkerLocator","../crypto/CryptoFacade","../../common/EntityFunctions","../../Env","../../common/utils/Utils"],function(_export,_context){"use strict";var restClient,locator,decryptAndMapToInstance,encryptAndMapToLiteral,resolveServiceSessionKey,MediaType,resolveTypeReference,assertWorkerOrNode,neverNull;return _export("_service",function(service,method,requestEntity,responseTypeRef,queryParameter,sk,extraHeaders){return resolveTypeReference(requestEntity?requestEntity._type:responseTypeRef).then(function(modelForAppAndVersion){var path="/rest/"+modelForAppAndVersion.app.toLowerCase()+"/"+service,queryParams=null!=queryParameter?queryParameter:{},headers=Object.assign(locator.login.createAuthHeaders(),extraHeaders);return headers.v=modelForAppAndVersion.version,(null!=requestEntity?resolveTypeReference(requestEntity._type).then(function(requestTypeModel){return requestTypeModel.encrypted&&null==sk?Promise.reject(new Error("must provide a session key for an encrypted data transfer type!: "+service)):encryptAndMapToLiteral(requestTypeModel,requestEntity,sk)}):Promise.resolve(null)).then(function(encryptedEntity){return restClient.request(path,method,queryParams,neverNull(headers),encryptedEntity?JSON.stringify(encryptedEntity):null,MediaType.Json).then(function(data){if(responseTypeRef)return resolveTypeReference(responseTypeRef).then(function(responseTypeModel){var instance=JSON.parse(data);return resolveServiceSessionKey(responseTypeModel,instance).then(function(resolvedSessionKey){return decryptAndMapToInstance(responseTypeModel,instance,resolvedSessionKey||sk)})})})})})}),{setters:[function(_RestClient){restClient=_RestClient.restClient},function(_WorkerLocator){locator=_WorkerLocator.locator},function(_cryptoCryptoFacade){decryptAndMapToInstance=_cryptoCryptoFacade.decryptAndMapToInstance,encryptAndMapToLiteral=_cryptoCryptoFacade.encryptAndMapToLiteral,resolveServiceSessionKey=_cryptoCryptoFacade.resolveServiceSessionKey},function(_commonEntityFunctions){MediaType=_commonEntityFunctions.MediaType,resolveTypeReference=_commonEntityFunctions.resolveTypeReference,_commonEntityFunctions.TypeRef},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull}],execute:function(){assertWorkerOrNode()}}}),System.register("src/api/worker/crypto/TotpVerifier.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./lib/crypto-sjcl-1.0.7","./CryptoUtils","../../common/utils/Encoding","./Randomizer"],function(_export,_context){"use strict";var _classCallCheck,_createClass,sjcl,uint8ArrayToBitArray,bitArrayToUint8Array,hexToUint8Array,random,DIGITS,DIGITS_POWER,base32,TotpVerifier;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_libCryptoSjcl){sjcl=_libCryptoSjcl.default},function(_CryptoUtils){uint8ArrayToBitArray=_CryptoUtils.uint8ArrayToBitArray,bitArrayToUint8Array=_CryptoUtils.bitArrayToUint8Array},function(_commonUtilsEncoding){hexToUint8Array=_commonUtilsEncoding.hexToUint8Array},function(_Randomizer){random=_Randomizer.random}],execute:function(){_export("DIGITS",DIGITS=6),_export("DIGITS",DIGITS),DIGITS_POWER=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8],base32=sjcl.codec.base32,_export("TotpVerifier",TotpVerifier=function(){function TotpVerifier(){var digits=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DIGITS;_classCallCheck(this,TotpVerifier),this._digits=digits}return _createClass(TotpVerifier,[{key:"generateSecret",value:function(){var key=random.generateRandomData(16);return{key:key,readableKey:this.readableKey(key)}}},{key:"generateTotp",value:function(time,key){for(var timeHex=time.toString(16);timeHex.length<16;)timeHex="0"+timeHex;var msg=hexToUint8Array(timeHex),hash=this.hmac_sha(key,msg),offset=15&hash[hash.length-1];return((127&hash[offset])<<24|(255&hash[offset+1])<<16|(255&hash[offset+2])<<8|255&hash[offset+3])%DIGITS_POWER[this._digits]}},{key:"hmac_sha",value:function(key,text){var hmac=new sjcl.misc.hmac(uint8ArrayToBitArray(key),sjcl.hash.sha1);return bitArrayToUint8Array(hmac.encrypt(uint8ArrayToBitArray(text)))}},{key:"readableKey",value:function(key){return base32.fromBits(uint8ArrayToBitArray(key)).toLowerCase().replace(/(.{4})/g,"$1 ").replace(/=/g,"").trim()}}]),TotpVerifier}()),_export("TotpVerifier",TotpVerifier)}}}),System.register("src/api/worker/facades/ContactFormFacade.js",["../../Env","../rest/RestClient","../../common/EntityFunctions","../rest/EntityRestClient","../../entities/tutanota/ContactForm","../crypto/CryptoFacade"],function(_export,_context){"use strict";var assertWorkerOrNode,restClient,HttpMethod,resolveTypeReference,typeRefToPath,ContactFormTypeRef,decryptAndMapToInstance;return _export("loadContactForm",function(formId){return resolveTypeReference(ContactFormTypeRef).then(function(model){var path=typeRefToPath(ContactFormTypeRef);return restClient.request(path+"/"+formId,HttpMethod.GET,{},{v:model.version},null,"application/json",null).then(function(json){var data=JSON.parse(json);return decryptAndMapToInstance(model,data)})})}),{setters:[function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_restRestClient){restClient=_restRestClient.restClient},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod,resolveTypeReference=_commonEntityFunctions.resolveTypeReference},function(_restEntityRestClient){typeRefToPath=_restEntityRestClient.typeRefToPath},function(_entitiesTutanotaContactForm){ContactFormTypeRef=_entitiesTutanotaContactForm.ContactFormTypeRef},function(_cryptoCryptoFacade){decryptAndMapToInstance=_cryptoCryptoFacade.decryptAndMapToInstance}],execute:function(){assertWorkerOrNode()}}}),System.register("src/api/worker/WorkerImpl.js",["node_modules/systemjs-plugin-babel/babel-helpers/toConsumableArray.js","node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../common/WorkerProtocol","../common/error/CryptoError","./facades/BookingFacade","../common/error/RestError","../common/error/ProgrammingError","./WorkerLocator","./rest/ServiceRestClient","./crypto/Randomizer","../Env","../../native/NativeWrapper","./rest/RestClient","./crypto/TotpVerifier","./facades/ContactFormFacade","./crypto/CryptoUtils","./crypto/Aes","./crypto/CryptoFacade","../common/Logger","../common/utils/Utils"],function(_export,_context){"use strict";var _toConsumableArray,_classCallCheck,_createClass,errorToObj,Queue,Request,CryptoError,bookingFacade,NotAuthenticatedError,ProgrammingError,initLocator,locator,resetLocator,_service,random,assertWorkerOrNode,nativeApp,restClient,TotpVerifier,loadContactForm,keyToBase64,aes256RandomKey,_resolveSessionKey,Logger,replaceNativeLogger,downcast,WorkerImpl;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs){_toConsumableArray=_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonWorkerProtocol){errorToObj=_commonWorkerProtocol.errorToObj,Queue=_commonWorkerProtocol.Queue,Request=_commonWorkerProtocol.Request},function(_commonErrorCryptoError){CryptoError=_commonErrorCryptoError.CryptoError},function(_facadesBookingFacade){bookingFacade=_facadesBookingFacade.bookingFacade},function(_commonErrorRestError){NotAuthenticatedError=_commonErrorRestError.NotAuthenticatedError},function(_commonErrorProgrammingError){ProgrammingError=_commonErrorProgrammingError.ProgrammingError},function(_WorkerLocator){initLocator=_WorkerLocator.initLocator,locator=_WorkerLocator.locator,resetLocator=_WorkerLocator.resetLocator},function(_restServiceRestClient){_service=_restServiceRestClient._service},function(_cryptoRandomizer){random=_cryptoRandomizer.random},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_nativeNativeWrapper){nativeApp=_nativeNativeWrapper.nativeApp},function(_restRestClient){restClient=_restRestClient.restClient},function(_cryptoTotpVerifier){TotpVerifier=_cryptoTotpVerifier.TotpVerifier},function(_facadesContactFormFacade){loadContactForm=_facadesContactFormFacade.loadContactForm},function(_cryptoCryptoUtils){keyToBase64=_cryptoCryptoUtils.keyToBase64},function(_cryptoAes){aes256RandomKey=_cryptoAes.aes256RandomKey},function(_cryptoCryptoFacade){_resolveSessionKey=_cryptoCryptoFacade.resolveSessionKey},function(_commonLogger){Logger=_commonLogger.Logger,replaceNativeLogger=_commonLogger.replaceNativeLogger},function(_commonUtilsUtils){downcast=_commonUtilsUtils.downcast}],execute:function(){assertWorkerOrNode(),"undefined"!=typeof self&&replaceNativeLogger(self,new Logger),_export("WorkerImpl",WorkerImpl=function(){function WorkerImpl(self,browserData){var _this=this;if(_classCallCheck(this,WorkerImpl),null==browserData)throw new ProgrammingError("Browserdata is not passed");var workerScope=self;this._queue=new Queue(workerScope),nativeApp.setWorkerQueue(this._queue),this._newEntropy=-1,this._lastEntropyUpdate=(new Date).getTime(),initLocator(this,browserData),this._queue.setCommands({testEcho:function(message){return Promise.resolve({msg:">>> "+message.args[0].msg})},testError:function(message){var ErrorType={ProgrammingError:ProgrammingError,CryptoError:CryptoError,NotAuthenticatedError:NotAuthenticatedError}[message.args[0].errorType];return Promise.reject(new ErrorType("wtf: "+message.args[0].errorType))},generateSignupKeys:function(message){return locator.customer.generateSignupKeys.apply(locator.customer,message.args)},signup:function(message){return locator.customer.signup.apply(locator.customer,message.args)},createContactFormUserGroupData:function(message){return locator.customer.createContactFormUserGroupData.apply(locator.customer,message.args)},createContactFormUser:function(message){return locator.customer.createContactFormUser.apply(locator.customer,message.args)},createSession:function(message){return locator.login.createSession.apply(locator.login,message.args)},createExternalSession:function(message){return locator.login.createExternalSession.apply(locator.login,message.args)},loadExternalPasswordChannels:function(message){return locator.login.loadExternalPasswordChannels.apply(locator.login,message.args)},sendExternalPasswordSms:function(message){return locator.login.sendExternalPasswordSms.apply(locator.login,message.args)},reset:function(message){return resetLocator()},resumeSession:function(message){return locator.login.resumeSession.apply(locator.login,message.args)},deleteSession:function(message){return locator.login.deleteSession.apply(locator.login,message.args)},changePassword:function(message){return locator.login.changePassword.apply(locator.login,message.args)},deleteAccount:function(message){return locator.login.deleteAccount.apply(locator.login,message.args)},createMailFolder:function(message){return locator.mail.createMailFolder.apply(locator.mail,message.args)},createMailDraft:function(message){return locator.mail.createDraft.apply(locator.mail,message.args)},updateMailDraft:function(message){return locator.mail.updateDraft.apply(locator.mail,message.args)},sendMailDraft:function(message){return locator.mail.sendDraft.apply(locator.mail,message.args)},readAvailableCustomerStorage:function(message){return locator.customer.readAvailableCustomerStorage.apply(locator.customer,message.args)},readUsedCustomerStorage:function(message){return locator.customer.readUsedCustomerStorage.apply(locator.customer,message.args)},restRequest:function(message){return message.args[3]=Object.assign(locator.login.createAuthHeaders(),message.args[3]),restClient.request.apply(restClient,message.args)},entityRequest:function(message){return locator.cache.entityRequest.apply(locator.cache,message.args)},serviceRequest:function(message){return _service.apply(null,message.args)},downloadFileContent:function(message){return locator.file.downloadFileContent.apply(locator.file,message.args)},downloadFileContentNative:function(message){return locator.file.downloadFileContentNative.apply(locator.file,message.args)},addMailAlias:function(message){return locator.mailAddress.addMailAlias.apply(locator.mailAddress,message.args)},setMailAliasStatus:function(message){return locator.mailAddress.setMailAliasStatus.apply(locator.mailAddress,message.args)},isMailAddressAvailable:function(message){return locator.mailAddress.isMailAddressAvailable.apply(locator.mailAddress,message.args)},getAliasCounters:function(message){return locator.mailAddress.getAliasCounters.apply(locator.mailAddress,message.args)},changeUserPassword:function(message){return locator.userManagement.changeUserPassword.apply(locator.userManagement,message.args)},changeAdminFlag:function(message){return locator.userManagement.changeAdminFlag.apply(locator.userManagement,message.args)},updateAdminship:function(message){return locator.userManagement.updateAdminship.apply(locator.userManagement,message.args)},switchFreeToPremiumGroup:function(message){return locator.customer.switchFreeToPremiumGroup.apply(locator.customer,message.args)},switchPremiumToFreeGroup:function(message){return locator.customer.switchPremiumToFreeGroup.apply(locator.customer,message.args)},updatePaymentData:function(message){return locator.customer.updatePaymentData.apply(locator.customer,message.args)},downloadInvoice:function(message){return locator.customer.downloadInvoice.apply(locator.customer,message.args)},readUsedUserStorage:function(message){return locator.userManagement.readUsedUserStorage.apply(locator.userManagement,message.args)},deleteUser:function(message){return locator.userManagement.deleteUser.apply(locator.userManagement,message.args)},getPrice:function(message){return bookingFacade.getPrice.apply(bookingFacade,message.args)},getCurrentPrice:function(message){return bookingFacade.getCurrentPrice()},loadCustomerServerProperties:function(message){return locator.customer.loadCustomerServerProperties.apply(locator.customer,message.args)},addSpamRule:function(message){var _locator$customer;return(_locator$customer=locator.customer).addSpamRule.apply(_locator$customer,_toConsumableArray(message.args))},editSpamRule:function(message){var _locator$customer2;return(_locator$customer2=locator.customer).editSpamRule.apply(_locator$customer2,_toConsumableArray(message.args))},createUser:function(message){return locator.userManagement.createUser.apply(locator.userManagement,message.args)},readUsedGroupStorage:function(message){return locator.groupManagement.readUsedGroupStorage.apply(locator.groupManagement,message.args)},createMailGroup:function(message){return locator.groupManagement.createMailGroup.apply(locator.groupManagement,message.args)},createLocalAdminGroup:function(message){return locator.groupManagement.createLocalAdminGroup.apply(locator.groupManagement,message.args)},addUserToGroup:function(message){return locator.groupManagement.addUserToGroup.apply(locator.groupManagement,message.args)},removeUserFromGroup:function(message){return locator.groupManagement.removeUserFromGroup.apply(locator.groupManagement,message.args)},deactivateGroup:function(message){return locator.groupManagement.deactivateGroup.apply(locator.groupManagement,message.args)},loadContactFormByPath:function(message){return loadContactForm.apply(null,message.args)},addDomain:function(message){return locator.customer.addDomain.apply(locator.customer,message.args)},removeDomain:function(message){return locator.customer.removeDomain.apply(locator.customer,message.args)},setCatchAllGroup:function(message){return locator.customer.setCatchAllGroup.apply(locator.customer,message.args)},uploadCertificate:function(message){return locator.customer.uploadCertificate.apply(locator.customer,message.args)},deleteCertificate:function(message){return locator.customer.deleteCertificate.apply(locator.customer,message.args)},generateTotpSecret:function(message){return _this.getTotpVerifier().then(function(totp){return totp.generateSecret.apply(totp,message.args)})},generateTotpCode:function(message){return _this.getTotpVerifier().then(function(totp){return totp.generateTotp.apply(totp,message.args)})},search:function(message){return locator.search.search.apply(locator.search,message.args)},enableMailIndexing:function(message){return locator.indexer.enableMailIndexing()},disableMailIndexing:function(message){return locator.indexer.disableMailIndexing()},extendMailIndex:function(message){return locator.indexer.extendMailIndex.apply(locator.indexer,message.args)},cancelMailIndexing:function(message){return locator.indexer.cancelMailIndexing()},readCounterValue:function(message){return locator.counters.readCounterValue.apply(locator.counters,message.args)},cancelCreateSession:function(message){return locator.login.cancelCreateSession(),Promise.resolve()},entropy:function(message){return _this.addEntropy(message.args[0])},tryReconnectEventBus:function(message){return locator.eventBusClient.tryReconnect.apply(locator.eventBusClient,message.args),Promise.resolve()},generateSsePushIdentifer:function(){return Promise.resolve(keyToBase64(aes256RandomKey()))},decryptUserPassword:function(message){return locator.login.decryptUserPassword.apply(locator.login,message.args)},closeEventBus:function(message){return locator.eventBusClient.close(message.args[0]),Promise.resolve()},getMoreSearchResults:function(message){return locator.search.getMoreSearchResults.apply(locator.search,message.args).return(message.args[0])},getRecoveryCode:function(message){return locator.login.getRecoverCode.apply(locator.login,message.args)},createRecoveryCode:function(message){return locator.login.createRecoveryCode.apply(locator.login,message.args)},recoverLogin:function(message){return locator.login.recoverLogin.apply(locator.login,message.args)},resetSecondFactors:function(message){return locator.login.resetSecondFactors.apply(locator.login,message.args)},resetSession:function(){return locator.login.reset()},createCalendarEvent:function(message){return locator.calendar.createCalendarEvent.apply(locator.calendar,message.args)},updateCalendarEvent:function(message){return locator.calendar.updateCalendarEvent.apply(locator.calendar,message.args)},resolveSessionKey:function(message){return _resolveSessionKey.apply(null,message.args).then(function(sk){return sk?keyToBase64(sk):null})},addCalendar:function(message){return locator.calendar.addCalendar.apply(locator.calendar,message.args)},scheduleAlarmsForNewDevice:function(message){var _locator$calendar;return(_locator$calendar=locator.calendar).scheduleAlarmsForNewDevice.apply(_locator$calendar,_toConsumableArray(message.args))},loadAlarmEvents:function(message){var _locator$calendar2;return(_locator$calendar2=locator.calendar).loadAlarmEvents.apply(_locator$calendar2,_toConsumableArray(message.args))},getDomainValidationRecord:function(message){var _locator$customer3;return(_locator$customer3=locator.customer).getDomainValidationRecord.apply(_locator$customer3,_toConsumableArray(message.args))},visibilityChange:function(message){var _locator$indexer;return(_locator$indexer=locator.indexer).onVisibilityChanged.apply(_locator$indexer,_toConsumableArray(message.args)),Promise.resolve()},getLog:function(){var global=downcast(self);return global.logger?Promise.resolve(global.logger.getEntries()):Promise.resolve([])},sendGroupInvitation:function(message){var _locator$share;return(_locator$share=locator.share).sendGroupInvitation.apply(_locator$share,_toConsumableArray(message.args))},acceptGroupInvitation:function(message){var _locator$share2;return(_locator$share2=locator.share).acceptGroupInvitation.apply(_locator$share2,_toConsumableArray(message.args))},rejectGroupInvitation:function(message){var _locator$share3;return(_locator$share3=locator.share).rejectGroupInvitation.apply(_locator$share3,_toConsumableArray(message.args))}}),Promise.onPossiblyUnhandledRejection(function(e){return _this.sendError(e)}),workerScope&&(workerScope.onerror=function(e,source,lineno,colno,error){if(console.error("workerImpl.onerror",e,source,lineno,colno,error),error instanceof Error)_this.sendError(error);else{var err=new Error(e);err.lineNumber=lineno,err.columnNumber=colno,err.fileName=source,_this.sendError(err)}return!0})}return _createClass(WorkerImpl,[{key:"getTotpVerifier",value:function(){return Promise.resolve(new TotpVerifier)}},{key:"addEntropy",value:function(entropy){try{return random.addEntropy(entropy)}finally{this._newEntropy=this._newEntropy+entropy.reduce(function(sum,value){return value.entropy+sum},0);var now=(new Date).getTime();this._newEntropy>5e3&&now-this._lastEntropyUpdate>3e5&&(this._lastEntropyUpdate=now,this._newEntropy=0,locator.login.storeEntropy())}}},{key:"entityEventsReceived",value:function(data,eventOwnerGroupId){return this._queue.postMessage(new Request("entityEvent",[data,eventOwnerGroupId]))}},{key:"sendError",value:function(e){return this._queue.postMessage(new Request("error",[errorToObj(e)]))}},{key:"sendProgress",value:function(progressPercentage){return this._queue.postMessage(new Request("progress",[progressPercentage])).then(function(){return Promise.fromCallback(function(cb){setTimeout(function(){cb()},0)})})}},{key:"sendIndexState",value:function(state){return this._queue.postMessage(new Request("updateIndexState",[state]))}},{key:"updateWebSocketState",value:function(state){return console.log("ws displayed state: ",state),this._queue.postMessage(new Request("updateWebSocketState",[state]))}},{key:"updateCounter",value:function(update){return this._queue.postMessage(new Request("counterUpdate",[update]))}},{key:"infoMessage",value:function(message){return this._queue.postMessage(new Request("infoMessage",[message]))}}]),WorkerImpl}()),_export("WorkerImpl",WorkerImpl)}}}),System.register("src/api/worker/search/EventQueue.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../common/TutanotaConstants","../../common/utils/Utils","../../common/error/RestError","../WorkerImpl"],function(_export,_context){"use strict";var _classCallCheck,_createClass,OperationType,containsEventOfType,ConnectionError,ServiceUnavailableError,EventQueue;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonTutanotaConstants){OperationType=_commonTutanotaConstants.OperationType},function(_commonUtilsUtils){containsEventOfType=_commonUtilsUtils.containsEventOfType},function(_commonErrorRestError){ConnectionError=_commonErrorRestError.ConnectionError,ServiceUnavailableError=_commonErrorRestError.ServiceUnavailableError},function(_WorkerImpl){_WorkerImpl.WorkerImpl}],execute:function(){_export("EventQueue",EventQueue=function(){function EventQueue(worker,processNextQueueElement){_classCallCheck(this,EventQueue),this._worker=worker,this._processingActive=!1,this._eventQueue=[],this._processNextQueueElement=processNextQueueElement,this._futureActions={deleted:new Map,moved:new Map},this._paused=!1}return _createClass(EventQueue,[{key:"start",value:function(){this._processingActive||this._processNext()}},{key:"_processNext",value:function(){var _this=this;this._paused||this._eventQueue.length>0&&(this._processingActive=!0,this._processNextQueueElement(this._eventQueue[0],this._futureActions).then(function(){_this._eventQueue.shift(),_this._processingActive=!1,_this._processNext()}).catch(ServiceUnavailableError,function(e){_this._processingActive=!1}).catch(ConnectionError,function(e){_this._processingActive=!1}).catch(function(e){_this._processingActive=!1,_this._worker.sendError(e)}))}},{key:"addBatches",value:function(batches){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=batches[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var batch=_step.value,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=batch.events[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var event=_step3.value;event.operation===OperationType.DELETE?containsEventOfType(batch.events,OperationType.CREATE,event.instanceId)||this._futureActions.deleted.set(event.instanceId,event):event.operation===OperationType.CREATE&&containsEventOfType(batch.events,OperationType.DELETE,event.instanceId)&&this._futureActions.moved.set(event.instanceId,event)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=batches[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var el=_step2.value;this._eventQueue.push(el)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}},{key:"clear",value:function(){this._eventQueue.splice(0)}},{key:"pause",value:function(){this._paused=!0}},{key:"resume",value:function(){this._paused=!1,this.start()}}]),EventQueue}()),_export("EventQueue",EventQueue)}}}),System.register("src/api/worker/search/IndexerCore.js",["node_modules/systemjs-plugin-babel/babel-helpers/toConsumableArray.js","node_modules/systemjs-plugin-babel/babel-helpers/slicedToArray.js","node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./DbFacade","../../common/EntityFunctions","./Tokenizer","../../common/utils/MapUtils","../../common/utils/Utils","../../common/utils/Encoding","../crypto/Aes","./IndexUtils","./EventQueue","../../common/error/CancelledError","../../common/error/ProgrammingError","../../common/utils/PromiseUtils","../../common/error/InvalidDatabaseStateError","../../common/utils/ArrayUtils","./SearchIndexEncoding","../crypto/Randomizer"],function(_export,_context){"use strict";var _toConsumableArray,_slicedToArray,_classCallCheck,_createClass,ElementDataOS,GroupDataOS,MetaDataOS,SearchIndexMetaDataOS,SearchIndexOS,SearchIndexWordsIndex,elementIdPart,firstBiggerThanSecond,listIdPart,TypeRef,tokenize,getFromMap,mergeMaps,defer,neverNull,noOp,generatedIdToTimestamp,uint8ArrayToBase64,aes256Decrypt,aes256Encrypt,IV_BYTE_LENGTH,byteLength,compareMetaEntriesOldest,decryptIndexKey,decryptMetaData,encryptIndexKeyBase64,encryptIndexKeyUint8Array,encryptMetaData,encryptSearchIndexEntry,getIdFromEncSearchIndexEntry,getPerformanceTimestamp,typeRefToTypeInfo,CancelledError,ProgrammingError,PromisableWrapper,promiseMapCompat,InvalidDatabaseStateError,arrayHash,findLastIndex,groupByAndMap,lastThrow,appendBinaryBlocks,calculateNeededSpaceForNumbers,decodeNumbers,encodeNumbers,iterateBinaryBlocks,removeBinaryBlockRanges,random,IndexerCore;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs){_toConsumableArray=_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs){_slicedToArray=_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_DbFacade){ElementDataOS=_DbFacade.ElementDataOS,GroupDataOS=_DbFacade.GroupDataOS,MetaDataOS=_DbFacade.MetaDataOS,SearchIndexMetaDataOS=_DbFacade.SearchIndexMetaDataOS,SearchIndexOS=_DbFacade.SearchIndexOS,SearchIndexWordsIndex=_DbFacade.SearchIndexWordsIndex},function(_commonEntityFunctions){elementIdPart=_commonEntityFunctions.elementIdPart,firstBiggerThanSecond=_commonEntityFunctions.firstBiggerThanSecond,listIdPart=_commonEntityFunctions.listIdPart,TypeRef=_commonEntityFunctions.TypeRef},function(_Tokenizer){tokenize=_Tokenizer.tokenize},function(_commonUtilsMapUtils){getFromMap=_commonUtilsMapUtils.getFromMap,mergeMaps=_commonUtilsMapUtils.mergeMaps},function(_commonUtilsUtils){defer=_commonUtilsUtils.defer,neverNull=_commonUtilsUtils.neverNull,noOp=_commonUtilsUtils.noOp},function(_commonUtilsEncoding){generatedIdToTimestamp=_commonUtilsEncoding.generatedIdToTimestamp,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64},function(_cryptoAes){aes256Decrypt=_cryptoAes.aes256Decrypt,aes256Encrypt=_cryptoAes.aes256Encrypt,IV_BYTE_LENGTH=_cryptoAes.IV_BYTE_LENGTH},function(_IndexUtils){byteLength=_IndexUtils.byteLength,compareMetaEntriesOldest=_IndexUtils.compareMetaEntriesOldest,decryptIndexKey=_IndexUtils.decryptIndexKey,decryptMetaData=_IndexUtils.decryptMetaData,encryptIndexKeyBase64=_IndexUtils.encryptIndexKeyBase64,encryptIndexKeyUint8Array=_IndexUtils.encryptIndexKeyUint8Array,encryptMetaData=_IndexUtils.encryptMetaData,encryptSearchIndexEntry=_IndexUtils.encryptSearchIndexEntry,getIdFromEncSearchIndexEntry=_IndexUtils.getIdFromEncSearchIndexEntry,getPerformanceTimestamp=_IndexUtils.getPerformanceTimestamp,typeRefToTypeInfo=_IndexUtils.typeRefToTypeInfo},function(_EventQueue){_EventQueue.EventQueue},function(_commonErrorCancelledError){CancelledError=_commonErrorCancelledError.CancelledError},function(_commonErrorProgrammingError){ProgrammingError=_commonErrorProgrammingError.ProgrammingError},function(_commonUtilsPromiseUtils){PromisableWrapper=_commonUtilsPromiseUtils.PromisableWrapper,promiseMapCompat=_commonUtilsPromiseUtils.promiseMapCompat},function(_commonErrorInvalidDatabaseStateError){InvalidDatabaseStateError=_commonErrorInvalidDatabaseStateError.InvalidDatabaseStateError},function(_commonUtilsArrayUtils){arrayHash=_commonUtilsArrayUtils.arrayHash,findLastIndex=_commonUtilsArrayUtils.findLastIndex,groupByAndMap=_commonUtilsArrayUtils.groupByAndMap,lastThrow=_commonUtilsArrayUtils.lastThrow},function(_SearchIndexEncoding){appendBinaryBlocks=_SearchIndexEncoding.appendBinaryBlocks,calculateNeededSpaceForNumbers=_SearchIndexEncoding.calculateNeededSpaceForNumbers,decodeNumbers=_SearchIndexEncoding.decodeNumbers,encodeNumbers=_SearchIndexEncoding.encodeNumbers,iterateBinaryBlocks=_SearchIndexEncoding.iterateBinaryBlocks,removeBinaryBlockRanges=_SearchIndexEncoding.removeBinaryBlockRanges},function(_cryptoRandomizer){random=_cryptoRandomizer.random}],execute:function(){1e3,_export("IndexerCore",IndexerCore=function(){function IndexerCore(db,queue,browserData){_classCallCheck(this,IndexerCore),this.queue=queue,this.db=db,this._isStopped=!1,this._promiseMapCompat=promiseMapCompat(browserData.needsMicrotaskHack),this._needsExplicitIds=browserData.needsExplicitIDBIds,this._explicitIdStart=Date.now(),this.resetStats()}return _createClass(IndexerCore,[{key:"createIndexEntriesForAttributes",value:function(model,instance,attributes){var _this=this,indexEntries=attributes.map(function(attributeHandler){if("function"!=typeof attributeHandler.value)throw new ProgrammingError("Value for attributeHandler is not a function: "+JSON.stringify(attributeHandler.attribute));var value=attributeHandler.value(),tokens=tokenize(value);_this._stats.indexedBytes+=byteLength(value);for(var attributeKeyToIndexMap=new Map,index=0;index<tokens.length;index++){var token=tokens[index];attributeKeyToIndexMap.has(token)?neverNull(attributeKeyToIndexMap.get(token)).positions.push(index):attributeKeyToIndexMap.set(token,{id:instance._id instanceof Array?instance._id[1]:instance._id,attribute:attributeHandler.attribute.id,positions:[index]})}return attributeKeyToIndexMap});return mergeMaps(indexEntries)}},{key:"encryptSearchIndexEntries",value:function(id,ownerGroup,keyToIndexEntries,indexUpdate){var _this2=this,encryptionTimeStart=getPerformanceTimestamp(),listId=listIdPart(id),encInstanceId=encryptIndexKeyUint8Array(this.db.key,elementIdPart(id),this.db.iv),encInstanceIdB64=uint8ArrayToBase64(encInstanceId),elementIdTimestamp=generatedIdToTimestamp(elementIdPart(id)),encWordsB64=[];keyToIndexEntries.forEach(function(value,indexKey){var encWordB64=encryptIndexKeyBase64(_this2.db.key,indexKey,_this2.db.iv);encWordsB64.push(encWordB64);var encIndexEntries=getFromMap(indexUpdate.create.indexMap,encWordB64,function(){return[]});value.forEach(function(indexEntry){return encIndexEntries.push({entry:encryptSearchIndexEntry(_this2.db.key,indexEntry,encInstanceId),timestamp:elementIdTimestamp})})}),indexUpdate.create.encInstanceIdToElementData.set(encInstanceIdB64,{listId:listId,encWordsB64:encWordsB64,ownerGroup:ownerGroup}),this._stats.encryptionTime+=getPerformanceTimestamp()-encryptionTimeStart}},{key:"_processDeleted",value:function(event,indexUpdate){var _this3=this,encInstanceIdPlain=encryptIndexKeyUint8Array(this.db.key,event.instanceId,this.db.iv),encInstanceIdB64=uint8ArrayToBase64(encInstanceIdPlain),_typeRefToTypeInfo=typeRefToTypeInfo(new TypeRef(event.application,event.type)),appId=_typeRefToTypeInfo.appId,typeId=_typeRefToTypeInfo.typeId;return this.db.dbFacade.createTransaction(!0,[ElementDataOS]).then(function(transaction){return transaction.get(ElementDataOS,encInstanceIdB64).then(function(elementData){if(elementData){var metaDataRowKeysBinary=aes256Decrypt(_this3.db.key,elementData[1],!0,!1);decodeNumbers(metaDataRowKeysBinary).forEach(function(metaDataRowKey){getFromMap(indexUpdate.delete.searchMetaRowToEncInstanceIds,metaDataRowKey,function(){return[]}).push({encInstanceId:encInstanceIdPlain,appId:appId,typeId:typeId,timestamp:generatedIdToTimestamp(event.instanceId)})}),indexUpdate.delete.encInstanceIds.push(encInstanceIdB64)}})})}},{key:"stopProcessing",value:function(){this._isStopped=!0,this.queue.clear()}},{key:"isStoppedProcessing",value:function(){return this._isStopped}},{key:"startProcessing",value:function(){this._isStopped=!1}},{key:"addBatchesToQueue",value:function(batches){this._isStopped||this.queue.addBatches(batches)}},{key:"writeIndexUpdate",value:function(dataPerGroup,indexUpdate){var _this4=this;return this._writeIndexUpdate(indexUpdate,function(t){return _this4._updateGroupDataIndexTimestamp(dataPerGroup,t)})}},{key:"writeIndexUpdateWithBatchId",value:function(groupId,batchId,indexUpdate){var _this5=this;return this._writeIndexUpdate(indexUpdate,function(t){return _this5._updateGroupDataBatchId(groupId,batchId,t)})}},{key:"_writeIndexUpdate",value:function(indexUpdate,updateGroupData){var _this6=this;return this._executeOperation({transaction:null,transactionFactory:function(){return _this6.db.dbFacade.createTransaction(!1,[SearchIndexOS,SearchIndexMetaDataOS,ElementDataOS,MetaDataOS,GroupDataOS])},operation:function(transaction){var startTimeStorage=getPerformanceTimestamp();return _this6._isStopped?Promise.reject(new CancelledError("mail indexing cancelled")):_this6._moveIndexedInstance(indexUpdate,transaction).thenOrApply(function(){return _this6._deleteIndexedInstance(indexUpdate,transaction)}).thenOrApply(function(){return _this6._insertNewIndexEntries(indexUpdate,transaction)}).thenOrApply(function(rowKeys){return rowKeys&&_this6._insertNewElementData(indexUpdate,transaction,rowKeys)}).thenOrApply(function(){return updateGroupData(transaction)}).thenOrApply(function(){return transaction.wait().then(function(){_this6._stats.storageTime+=getPerformanceTimestamp()-startTimeStorage})}).thenOrApply(noOp,function(e){try{!transaction.aborted&&transaction.abort()}catch(e){console.warn("abort has failed: ",e)}throw e}).toPromise()},deferred:defer(),isAbortedForBackgroundMode:!1})}},{key:"_executeOperation",value:function(operation){var _this7=this;return this._currentWriteOperation=operation,operation.transactionFactory().then(function(transaction){return operation.transaction=transaction,operation.operation(transaction).tap(function(){_this7._currentWriteOperation=null,operation.deferred.resolve()}).catch(function(e){operation.isAbortedForBackgroundMode?console.log("transaction has been aborted because of background mode"):("Test"!==env.mode&&console.log("rejecting operation with error",e),operation.deferred.reject(e))}),operation.deferred.promise})}},{key:"onVisibilityChanged",value:function(visible){var operation=this._currentWriteOperation;if(!visible&&operation&&operation.transaction){console.log("abort indexedDb transaction operation because background mode");try{neverNull(operation.transaction).abort()}catch(e){console.log("Error when aborting on visibility change",e)}operation.isAbortedForBackgroundMode=!0}visible&&operation&&(console.log("restart indexedDb transaction operation after background mode"),operation.isAbortedForBackgroundMode=!1,this._executeOperation(operation))}},{key:"_moveIndexedInstance",value:function(indexUpdate,transaction){if(this._cancelIfNeeded(),0===indexUpdate.move.length)return PromisableWrapper.from();var promise=Promise.all(indexUpdate.move.map(function(moveInstance){return transaction.get(ElementDataOS,moveInstance.encInstanceId).then(function(elementData){elementData&&(elementData[0]=moveInstance.newListId,transaction.put(ElementDataOS,moveInstance.encInstanceId,elementData))})})).return();return PromisableWrapper.from(promise)}},{key:"_deleteIndexedInstance",value:function(indexUpdate,transaction){var _this8=this;if(this._cancelIfNeeded(),0===indexUpdate.delete.searchMetaRowToEncInstanceIds.size)return null;var deleteElementDataPromise=Promise.all(indexUpdate.delete.encInstanceIds.map(function(encInstanceId){return transaction.delete(ElementDataOS,encInstanceId)}));return Promise.all(Array.from(indexUpdate.delete.searchMetaRowToEncInstanceIds).map(function(_ref){var _ref2=_slicedToArray(_ref,2),metaRowKey=_ref2[0],encInstanceIds=_ref2[1];return _this8._deleteSearchIndexEntries(transaction,metaRowKey,encInstanceIds)})).then(function(){return deleteElementDataPromise}).return()}},{key:"_deleteSearchIndexEntries",value:function(transaction,metaRowKey,instanceInfos){var _this9=this;this._cancelIfNeeded();var encInstanceIdSet=new Set(instanceInfos.map(function(e){return arrayHash(e.encInstanceId)}));return transaction.get(SearchIndexMetaDataOS,metaRowKey).then(function(encMetaDataRow){if(encMetaDataRow){var metaDataRow=decryptMetaData(_this9.db.key,encMetaDataRow),metaDataEntriesSet=new Set;return instanceInfos.forEach(function(info){var entryIndex=_this9._findMetaDataEntryByTimestamp(metaDataRow,info.timestamp,info.appId,info.typeId);-1===entryIndex?console.warn("could not find MetaDataEntry, info:",info,"rows: ",metaDataRow.rows.map(function(r){return JSON.stringify(r)})):metaDataEntriesSet.add(metaDataRow.rows[entryIndex])}),_this9._promiseMapCompat(Array.from(metaDataEntriesSet),function(metaEntry){return transaction.get(SearchIndexOS,metaEntry.key).then(function(indexEntriesRow){if(indexEntriesRow){var rangesToRemove=[];if(iterateBinaryBlocks(indexEntriesRow,function(block,start,end){encInstanceIdSet.has(arrayHash(getIdFromEncSearchIndexEntry(block)))&&rangesToRemove.push([start,end])}),0!==rangesToRemove.length){if(metaEntry.size===rangesToRemove.length)return metaEntry.size=0,transaction.delete(SearchIndexOS,metaEntry.key);var trimmed=removeBinaryBlockRanges(indexEntriesRow,rangesToRemove);return metaEntry.size-=rangesToRemove.length,transaction.put(SearchIndexOS,metaEntry.key,trimmed)}}})}).thenOrApply(function(){return metaDataRow.rows=metaDataRow.rows.filter(function(r){return r.size>0}),0===metaDataRow.rows.length?transaction.delete(SearchIndexMetaDataOS,metaDataRow.id):transaction.put(SearchIndexMetaDataOS,null,encryptMetaData(_this9.db.key,metaDataRow))}).value}})}},{key:"_insertNewElementData",value:function(indexUpdate,transaction,encWordToMetaRow){var _this10=this;if(this._cancelIfNeeded(),0===indexUpdate.create.encInstanceIdToElementData.size)return null;var promises=[];return indexUpdate.create.encInstanceIdToElementData.forEach(function(elementDataSurrogate,b64EncInstanceId){var metaRows=elementDataSurrogate.encWordsB64.map(function(w){return encWordToMetaRow[w]}),rowKeysBinary=new Uint8Array(calculateNeededSpaceForNumbers(metaRows));encodeNumbers(metaRows,rowKeysBinary);var encMetaRowKeys=aes256Encrypt(_this10.db.key,rowKeysBinary,random.generateRandomData(IV_BYTE_LENGTH),!0,!1);promises.push(transaction.put(ElementDataOS,b64EncInstanceId,[elementDataSurrogate.listId,encMetaRowKeys,elementDataSurrogate.ownerGroup]))}),Promise.all(promises)}},{key:"_insertNewIndexEntries",value:function(indexUpdate,transaction){var _this11=this;this._cancelIfNeeded();var keys=[].concat(_toConsumableArray(indexUpdate.create.indexMap.keys())),encWordToMetaRow={},result=this._promiseMapCompat(keys,function(encWordB64){var encryptedEntries=neverNull(indexUpdate.create.indexMap.get(encWordB64));return _this11._putEncryptedEntity(indexUpdate.typeInfo.appId,indexUpdate.typeInfo.typeId,transaction,encWordB64,encWordToMetaRow,encryptedEntries)},{concurrency:2}).value;return result instanceof Promise?result.return(encWordToMetaRow):null}},{key:"_putEncryptedEntity",value:function(appId,typeId,transaction,encWordB64,encWordToMetaRow,encryptedEntries){var _this12=this;if(this._cancelIfNeeded(),!(encryptedEntries.length<=0))return this._getOrCreateSearchIndexMeta(transaction,encWordB64).then(function(metaData){return encryptedEntries.sort(function(a,b){return a.timestamp-b.timestamp}),_this12._writeEntries(transaction,encryptedEntries,metaData,appId,typeId).thenOrApply(function(){return metaData}).value}).then(function(metaData){var columnSize=metaData.rows.reduce(function(result,metaDataEntry){return result+metaDataEntry.size},0);return _this12._stats.writeRequests+=1,_this12._stats.largestColumn=columnSize>_this12._stats.largestColumn?columnSize:_this12._stats.largestColumn,_this12._stats.storedBytes+=encryptedEntries.reduce(function(sum,e){return sum+e.entry.length},0),encWordToMetaRow[encWordB64]=metaData.id,transaction.put(SearchIndexMetaDataOS,null,encryptMetaData(_this12.db.key,metaData))})}},{key:"_writeEntries",value:function(transaction,entries,metaData,appId,typeId){var _this13=this;if(0===entries.length)return PromisableWrapper.from();var oldestTimestamp=entries[0].timestamp,indexOfMetaEntry=this._findMetaDataEntryByTimestamp(metaData,oldestTimestamp,appId,typeId);if(-1!==indexOfMetaEntry){var nextEntry=this._nextEntryOfType(metaData,indexOfMetaEntry+1,appId,typeId);if(nextEntry){var _splitByTimestamp2=this._splitByTimestamp(entries,nextEntry.oldestElementTimestamp),_splitByTimestamp3=_slicedToArray(_splitByTimestamp2,2),toCurrentOne=_splitByTimestamp3[0],toNextOnes=_splitByTimestamp3[1];return this._appendIndexEntriesToRow(transaction,metaData,indexOfMetaEntry,toCurrentOne).thenOrApply(function(){return _this13._writeEntries(transaction,toNextOnes,metaData,appId,typeId)})}return this._appendIndexEntriesToRow(transaction,metaData,indexOfMetaEntry,entries)}var firstEntry=this._nextEntryOfType(metaData,0,appId,typeId);if(firstEntry){var indexOfFirstEntry=metaData.rows.indexOf(firstEntry),secondEntry=this._nextEntryOfType(metaData,indexOfFirstEntry+1,appId,typeId),_ref3=secondEntry?this._splitByTimestamp(entries,secondEntry.oldestElementTimestamp):[entries,[]],_ref4=_slicedToArray(_ref3,2),toFirstOne=_ref4[0],_toNextOnes=_ref4[1];if(firstEntry.size+toFirstOne.length<1e3)return this._appendIndexEntriesToRow(transaction,metaData,indexOfFirstEntry,toFirstOne).thenOrApply(function(){return _this13._writeEntries(transaction,_toNextOnes,metaData,appId,typeId)});var _splitByTimestamp4=this._splitByTimestamp(toFirstOne,firstEntry.oldestElementTimestamp),_splitByTimestamp5=_slicedToArray(_splitByTimestamp4,2),toNewOne=_splitByTimestamp5[0],_toCurrentOne=_splitByTimestamp5[1];return PromisableWrapper.from(this._createNewRow(transaction,metaData,toNewOne,oldestTimestamp,appId,typeId)).thenOrApply(function(){return _this13._writeEntries(transaction,_toCurrentOne.concat(_toNextOnes),metaData,appId,typeId)})}return this._createNewRow(transaction,metaData,entries,oldestTimestamp,appId,typeId)}},{key:"_nextEntryOfType",value:function(metaData,startIndex,appId,typeId){for(var i=startIndex;i<metaData.rows.length;i++)if(metaData.rows[i].app===appId&&metaData.rows[i].type===typeId)return metaData.rows[i];return null}},{key:"_splitByTimestamp",value:function(entries,timestamp){var indexOfSplit=entries.findIndex(function(entry){return entry.timestamp>=timestamp});return-1===indexOfSplit?[entries,[]]:[entries.slice(0,indexOfSplit),entries.slice(indexOfSplit)]}},{key:"_appendIndexEntriesToRow",value:function(transaction,metaData,metaEntryIndex,entries){var _this14=this;if(0===entries.length)return new PromisableWrapper;var metaEntry=metaData.rows[metaEntryIndex];return metaEntry.size+entries.length>1e3?PromisableWrapper.from(transaction.get(SearchIndexOS,metaEntry.key).then(function(binaryBlock){if(!binaryBlock)throw new InvalidDatabaseStateError("non existing index row");var timestampToEntries=new Map,existingIds=new Set;iterateBinaryBlocks(binaryBlock,function(encSearchIndexEntry){var encId=getIdFromEncSearchIndexEntry(encSearchIndexEntry);existingIds.add(arrayHash(encId));var decId=decryptIndexKey(_this14.db.key,encId,_this14.db.iv),timeStamp=generatedIdToTimestamp(decId);getFromMap(timestampToEntries,timeStamp,function(){return[]}).push(encSearchIndexEntry)}),entries.forEach(function(_ref5){var entry=_ref5.entry,timestamp=_ref5.timestamp;getFromMap(timestampToEntries,timestamp,function(){return[]}).push(entry)});var isLastEntry=null==_this14._nextEntryOfType(metaData,metaEntryIndex+1,metaEntry.app,metaEntry.type),rows=_this14._distributeEntities(timestampToEntries,isLastEntry),_ref6=[rows[0],rows.slice(1)],appendRow=_ref6[0],newRows=_ref6[1],firstRowBinary=appendBinaryBlocks(appendRow.row);return Promise.all([transaction.put(SearchIndexOS,metaEntry.key,firstRowBinary).then(function(){return metaEntry.size=appendRow.row.length,metaEntry.oldestElementTimestamp=appendRow.oldestElementTimestamp,metaEntry.key})].concat(_this14._promiseMapCompat(newRows,function(row){var binaryRow=appendBinaryBlocks(row.row);return transaction.put(SearchIndexOS,null,binaryRow).then(function(newSearchIndexRowId){metaData.rows.push({key:newSearchIndexRowId,size:row.row.length,app:metaEntry.app,type:metaEntry.type,oldestElementTimestamp:row.oldestElementTimestamp})})},{concurrency:2}).value)).then(function(){metaData.rows.sort(compareMetaEntriesOldest)})})):PromisableWrapper.from(transaction.get(SearchIndexOS,metaEntry.key).then(function(indexEntriesRow){var safeRow=indexEntriesRow||new Uint8Array(0),resultRow=appendBinaryBlocks(entries.map(function(e){return e.entry}),safeRow);return transaction.put(SearchIndexOS,metaEntry.key,resultRow).then(function(){metaEntry.size+=entries.length,metaEntry.oldestElementTimestamp=Math.min(entries[0].timestamp,metaEntry.oldestElementTimestamp)})}))}},{key:"_distributeEntities",value:function(timestampToEntries,preferFirst){var sortedTimestamps=Array.from(timestampToEntries.keys()).sort(function(l,r){return l-r});if(preferFirst){var rows=[{row:[],oldestElementTimestamp:sortedTimestamps[0]}];return sortedTimestamps.forEach(function(id){var _lastThrow$row,encryptedEntries=neverNull(timestampToEntries.get(id));lastThrow(rows).row.length+encryptedEntries.length>1e3&&rows.push({row:[],oldestElementTimestamp:id}),(_lastThrow$row=lastThrow(rows).row).push.apply(_lastThrow$row,_toConsumableArray(encryptedEntries))}),rows}var _rows=[{row:[],oldestElementTimestamp:Number.MAX_SAFE_INTEGER}];return sortedTimestamps.slice().reverse().forEach(function(id){var _rows$0$row,encryptedEntries=neverNull(timestampToEntries.get(id));_rows[0].row.length+encryptedEntries.length>1e3&&_rows.unshift({row:[],oldestElementTimestamp:id}),(_rows$0$row=_rows[0].row).unshift.apply(_rows$0$row,_toConsumableArray(encryptedEntries)),_rows[0].oldestElementTimestamp=Math.min(_rows[0].oldestElementTimestamp,id)}),_rows}},{key:"_createNewRow",value:function(transaction,metaData,encryptedSearchIndexEntries,oldestTimestamp,appId,typeId){var byTimestamp=groupByAndMap(encryptedSearchIndexEntries,function(e){return e.timestamp},function(e){return e.entry}),distributed=this._distributeEntities(byTimestamp,!1);return this._promiseMapCompat(distributed,function(_ref7){var row=_ref7.row,oldestElementTimestamp=_ref7.oldestElementTimestamp,binaryRow=appendBinaryBlocks(row);return transaction.put(SearchIndexOS,null,binaryRow).then(function(newRowId){metaData.rows.push({key:newRowId,size:row.length,app:appId,type:typeId,oldestElementTimestamp:oldestElementTimestamp})})},{concurrency:2}).thenOrApply(function(){metaData.rows.sort(compareMetaEntriesOldest)})}},{key:"_findMetaDataEntryByTimestamp",value:function(metaData,oldestTimestamp,appId,typeId){return findLastIndex(metaData.rows,function(r){return r.app===appId&&r.type===typeId&&r.oldestElementTimestamp<=oldestTimestamp})}},{key:"_getOrCreateSearchIndexMeta",value:function(transaction,encWordBase64){var _this15=this;return transaction.get(SearchIndexMetaDataOS,encWordBase64,SearchIndexWordsIndex).then(function(metaData){if(metaData)return decryptMetaData(_this15.db.key,metaData);var metaTemplate={word:encWordBase64,rows:new Uint8Array(0)};return _this15._needsExplicitIds&&(metaTemplate.id=_this15._explicitIdStart++),transaction.put(SearchIndexMetaDataOS,null,metaTemplate).then(function(rowId){return _this15._stats.words+=1,{id:rowId,word:encWordBase64,rows:[]}})})}},{key:"_updateGroupDataIndexTimestamp",value:function(dataPerGroup,transaction){return this._promiseMapCompat(dataPerGroup,function(data){var groupId=data.groupId,indexTimestamp=data.indexTimestamp;return transaction.get(GroupDataOS,groupId).then(function(groupData){if(!groupData)throw new InvalidDatabaseStateError("GroupData not available for group "+groupId);return groupData.indexTimestamp=indexTimestamp,transaction.put(GroupDataOS,groupId,groupData)})}).thenOrApply(function(){}).value}},{key:"_updateGroupDataBatchId",value:function(groupId,batchId,transaction){return transaction.get(GroupDataOS,groupId).then(function(groupData){if(!groupData)throw new InvalidDatabaseStateError("GroupData not available for group "+groupId);if(!(groupData.lastBatchIds.length>0&&-1!==groupData.lastBatchIds.indexOf(batchId))){var newIndex=groupData.lastBatchIds.findIndex(function(indexedBatchId){return firstBiggerThanSecond(batchId,indexedBatchId)});return-1!==newIndex?groupData.lastBatchIds.splice(newIndex,0,batchId):groupData.lastBatchIds.push(batchId),groupData.lastBatchIds.length>1e3&&(groupData.lastBatchIds=groupData.lastBatchIds.slice(0,1e3)),transaction.put(GroupDataOS,groupId,groupData)}console.warn("Abort transaction on updating group data: concurrent access",groupId,batchId),transaction.abort()})}},{key:"_cancelIfNeeded",value:function(){if(this._isStopped)throw new CancelledError("indexing cancelled")}},{key:"resetStats",value:function(){this._stats={indexingTime:0,storageTime:0,preparingTime:0,mailcount:0,storedBytes:0,encryptionTime:0,writeRequests:0,largestColumn:0,words:0,indexedBytes:0}}},{key:"printStatus",value:function(){var totalTime=this._stats.storageTime+this._stats.preparingTime,statsWithDownloading=Object.assign({},this._stats,{downloadingTime:this._stats.preparingTime-this._stats.indexingTime-this._stats.encryptionTime});console.log(JSON.stringify(statsWithDownloading),"total time: ",totalTime)}}]),IndexerCore}()),_export("IndexerCore",IndexerCore)}}}),System.register("src/api/worker/search/Tokenizer.js",[],function(_export,_context){"use strict";function addCurrentWord(currentWord,words){for(;currentWord.length>0&&"'"===currentWord[0];)currentWord.shift();for(;currentWord.length>0&&"'"===currentWord[currentWord.length-1];)currentWord.pop();currentWord.length>0&&words.push(currentWord.join("").toLowerCase())}function isEndOfWord(char){switch(char){case" ":case"\n":case"\r":case"\t":case"\v":case"\f":case".":case",":case":":case";":case"!":case"?":case"&":case'"':case"<":case">":case"-":case"+":case"=":case"(":case")":case"[":case"]":case"{":case"}":case"/":case"\\":case"^":case"_":case"`":case"~":case"|":case"@":return!0;default:return!1}}return _export("tokenize",function(text){if(null==text)return[];for(var currentWord=[],words=[],i=0;i<text.length;i++){var currentChar=text.charAt(i);isEndOfWord(currentChar)?(addCurrentWord(currentWord,words),currentWord=[]):currentWord.push(currentChar)}return addCurrentWord(currentWord,words),words}),{setters:[],execute:function(){}}}),System.register("src/api/worker/search/WhitelabelChildIndexer.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../common/TutanotaConstants","../EntityWorker","../../common/error/RestError","../../entities/sys/WhitelabelChild","../../common/utils/Utils","./IndexUtils","../../entities/sys/Customer","./DbFacade","./IndexerCore","./SuggestionFacade","./Tokenizer"],function(_export,_context){"use strict";var _classCallCheck,_createClass,FULL_INDEXED_TIMESTAMP,NOTHING_INDEXED_TIMESTAMP,OperationType,NotFoundError,WhitelabelChildModel,WhitelabelChildTypeRef,neverNull,_createNewIndexUpdate,typeRefToTypeInfo,userIsGlobalAdmin,CustomerTypeRef,GroupDataOS,tokenize,WhitelabelChildIndexer;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonTutanotaConstants){FULL_INDEXED_TIMESTAMP=_commonTutanotaConstants.FULL_INDEXED_TIMESTAMP,NOTHING_INDEXED_TIMESTAMP=_commonTutanotaConstants.NOTHING_INDEXED_TIMESTAMP,OperationType=_commonTutanotaConstants.OperationType},function(_EntityWorker){_EntityWorker.EntityWorker},function(_commonErrorRestError){NotFoundError=_commonErrorRestError.NotFoundError},function(_entitiesSysWhitelabelChild){WhitelabelChildModel=_entitiesSysWhitelabelChild._TypeModel,WhitelabelChildTypeRef=_entitiesSysWhitelabelChild.WhitelabelChildTypeRef},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull},function(_IndexUtils){_createNewIndexUpdate=_IndexUtils._createNewIndexUpdate,typeRefToTypeInfo=_IndexUtils.typeRefToTypeInfo,userIsGlobalAdmin=_IndexUtils.userIsGlobalAdmin},function(_entitiesSysCustomer){CustomerTypeRef=_entitiesSysCustomer.CustomerTypeRef},function(_DbFacade){GroupDataOS=_DbFacade.GroupDataOS},function(_IndexerCore){_IndexerCore.IndexerCore},function(_SuggestionFacade){_SuggestionFacade.SuggestionFacade},function(_Tokenizer){tokenize=_Tokenizer.tokenize}],execute:function(){_export("WhitelabelChildIndexer",WhitelabelChildIndexer=function(){function WhitelabelChildIndexer(core,db,entity,suggestionFacade){_classCallCheck(this,WhitelabelChildIndexer),this._core=core,this._db=db,this._entity=entity,this.suggestionFacade=suggestionFacade}return _createClass(WhitelabelChildIndexer,[{key:"createWhitelabelChildIndexEntries",value:function(whitelabelChild){return this.suggestionFacade.addSuggestions(this._getSuggestionWords(whitelabelChild)),this._core.createIndexEntriesForAttributes(WhitelabelChildModel,whitelabelChild,[{attribute:WhitelabelChildModel.values.mailAddress,value:function(){return whitelabelChild.mailAddress}},{attribute:WhitelabelChildModel.values.comment,value:function(){return whitelabelChild.comment}}])}},{key:"_getSuggestionWords",value:function(whitelabelChild){return tokenize(whitelabelChild.mailAddress)}},{key:"processNewWhitelabelChild",value:function(event){var _this=this;return this._entity.load(WhitelabelChildTypeRef,[event.instanceListId,event.instanceId]).then(function(whitelabelChild){var keyToIndexEntries=_this.createWhitelabelChildIndexEntries(whitelabelChild);return _this.suggestionFacade.store().then(function(){return{whitelabelChild:whitelabelChild,keyToIndexEntries:keyToIndexEntries}})}).catch(NotFoundError,function(){return console.log("tried to index non existing whitelabel child"),null})}},{key:"indexAllWhitelabelChildrenForAdmin",value:function(user){var _this2=this;return userIsGlobalAdmin(user)?this._entity.load(CustomerTypeRef,neverNull(user.customer)).then(function(customer){return _this2._db.dbFacade.createTransaction(!0,[GroupDataOS]).then(function(t){return t.get(GroupDataOS,customer.adminGroup).then(function(groupData){if(groupData&&groupData.indexTimestamp===NOTHING_INDEXED_TIMESTAMP){var children=Promise.resolve([]);return customer.whitelabelChildren&&(children=_this2._entity.loadAll(WhitelabelChildTypeRef,customer.whitelabelChildren.items)),children.then(function(allChildren){var indexUpdate=_createNewIndexUpdate(typeRefToTypeInfo(WhitelabelChildTypeRef));return allChildren.forEach(function(child){var keyToIndexEntries=_this2.createWhitelabelChildIndexEntries(child);_this2._core.encryptSearchIndexEntries(child._id,neverNull(child._ownerGroup),keyToIndexEntries,indexUpdate)}),Promise.all([_this2._core.writeIndexUpdate([{groupId:customer.adminGroup,indexTimestamp:FULL_INDEXED_TIMESTAMP}],indexUpdate),_this2.suggestionFacade.store()]).return()})}})})}):Promise.resolve()}},{key:"processEntityEvents",value:function(events,groupId,batchId,indexUpdate,user){var _this3=this;return Promise.each(events,function(event,index){if(userIsGlobalAdmin(user)){if(event.operation===OperationType.CREATE)return _this3.processNewWhitelabelChild(event).then(function(result){result&&_this3._core.encryptSearchIndexEntries(result.whitelabelChild._id,neverNull(result.whitelabelChild._ownerGroup),result.keyToIndexEntries,indexUpdate)});if(event.operation===OperationType.UPDATE)return Promise.all([_this3._core._processDeleted(event,indexUpdate),_this3.processNewWhitelabelChild(event).then(function(result){result&&_this3._core.encryptSearchIndexEntries(result.whitelabelChild._id,neverNull(result.whitelabelChild._ownerGroup),result.keyToIndexEntries,indexUpdate)})]);if(event.operation===OperationType.DELETE)return _this3._core._processDeleted(event,indexUpdate)}}).return()}}]),WhitelabelChildIndexer}()),_export("WhitelabelChildIndexer",WhitelabelChildIndexer)}}}),System.register("src/api/common/error/MembershipRemovedError.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/possibleConstructorReturn.js","node_modules/systemjs-plugin-babel/babel-helpers/inherits.js","./TutanotaError"],function(_export,_context){"use strict";var _classCallCheck,_possibleConstructorReturn,_inherits,TutanotaError,MembershipRemovedError;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersPossibleConstructorReturnJs){_possibleConstructorReturn=_node_modulesSystemjsPluginBabelBabelHelpersPossibleConstructorReturnJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersInheritsJs){_inherits=_node_modulesSystemjsPluginBabelBabelHelpersInheritsJs.default},function(_TutanotaError2){TutanotaError=_TutanotaError2.TutanotaError}],execute:function(){_export("MembershipRemovedError",MembershipRemovedError=function(_TutanotaError){function MembershipRemovedError(message){return _classCallCheck(this,MembershipRemovedError),_possibleConstructorReturn(this,(MembershipRemovedError.__proto__||Object.getPrototypeOf(MembershipRemovedError)).call(this,"MembershipRemovedError",message))}return _inherits(MembershipRemovedError,TutanotaError),MembershipRemovedError}()),_export("MembershipRemovedError",MembershipRemovedError)}}}),System.register("src/api/worker/DateProvider.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../common/utils/DateUtils"],function(_export,_context){"use strict";var _classCallCheck,_createClass,getDayShifted,getStartOfDay,LocalTimeDateProvider;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonUtilsDateUtils){getDayShifted=_commonUtilsDateUtils.getDayShifted,getStartOfDay=_commonUtilsDateUtils.getStartOfDay}],execute:function(){_export("LocalTimeDateProvider",LocalTimeDateProvider=function(){function LocalTimeDateProvider(){_classCallCheck(this,LocalTimeDateProvider)}return _createClass(LocalTimeDateProvider,[{key:"getStartOfDayShiftedBy",value:function(shiftByDays){return getStartOfDay(getDayShifted(new Date,shiftByDays))}}]),LocalTimeDateProvider}()),_export("LocalTimeDateProvider",LocalTimeDateProvider)}}}),System.register("src/api/worker/search/Indexer.js",["node_modules/systemjs-plugin-babel/babel-helpers/slicedToArray.js","node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../common/TutanotaConstants","../EntityWorker","../../common/error/RestError","../../entities/sys/EntityEventBatch","./DbFacade","../../common/EntityFunctions","../../common/utils/Utils","../crypto/Sha256","../../common/utils/Encoding","../crypto/Aes","../crypto/CryptoFacade","./IndexUtils","./ContactIndexer","../../entities/tutanota/Mail","../../entities/tutanota/Contact","../../entities/sys/GroupInfo","../../entities/sys/User","./GroupInfoIndexer","./MailIndexer","./IndexerCore","../../common/error/OutOfSyncError","./SuggestionFacade","../../common/error/DbError","./EventQueue","../../entities/sys/WhitelabelChild","./WhitelabelChildIndexer","../../common/utils/ArrayUtils","../../common/error/CancelledError","../crypto/Randomizer","../../common/error/MembershipRemovedError","../../common/error/InvalidDatabaseStateError","../../common/utils/MapUtils","../DateProvider"],function(_export,_context){"use strict";var _slicedToArray,_classCallCheck,_createClass,getMembershipGroupType,GroupType,NOTHING_INDEXED_TIMESTAMP,OperationType,EntityWorker,NotAuthorizedError,EntityEventBatchTypeRef,DbFacade,GroupDataOS,MetaDataOS,firstBiggerThanSecond,GENERATED_MAX_ID,getElementId,isSameId,isSameTypeRef,isSameTypeRefByAttr,defer,downcast,neverNull,noOp,hash,generatedIdToTimestamp,stringToUtf8Uint8Array,timestampToGeneratedId,uint8ArrayToBase64,aes256Decrypt,aes256Encrypt,aes256RandomKey,IV_BYTE_LENGTH,decrypt256Key,encrypt256Key,_createNewIndexUpdate,filterIndexMemberships,markEnd,markStart,typeRefToTypeInfo,ContactIndexer,MailTypeRef,ContactTypeRef,GroupInfoTypeRef,UserTypeRef,GroupInfoIndexer,MailIndexer,IndexerCore,OutOfSyncError,SuggestionFacade,DbError,EventQueue,WhitelabelChildTypeRef,WhitelabelChildIndexer,contains,CancelledError,random,MembershipRemovedError,InvalidDatabaseStateError,getFromMap,LocalTimeDateProvider,Metadata,Indexer;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs){_slicedToArray=_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonTutanotaConstants){getMembershipGroupType=_commonTutanotaConstants.getMembershipGroupType,GroupType=_commonTutanotaConstants.GroupType,NOTHING_INDEXED_TIMESTAMP=_commonTutanotaConstants.NOTHING_INDEXED_TIMESTAMP,OperationType=_commonTutanotaConstants.OperationType},function(_EntityWorker){EntityWorker=_EntityWorker.EntityWorker},function(_commonErrorRestError){NotAuthorizedError=_commonErrorRestError.NotAuthorizedError},function(_entitiesSysEntityEventBatch){EntityEventBatchTypeRef=_entitiesSysEntityEventBatch.EntityEventBatchTypeRef},function(_DbFacade){DbFacade=_DbFacade.DbFacade,GroupDataOS=_DbFacade.GroupDataOS,MetaDataOS=_DbFacade.MetaDataOS},function(_commonEntityFunctions){firstBiggerThanSecond=_commonEntityFunctions.firstBiggerThanSecond,GENERATED_MAX_ID=_commonEntityFunctions.GENERATED_MAX_ID,getElementId=_commonEntityFunctions.getElementId,isSameId=_commonEntityFunctions.isSameId,isSameTypeRef=_commonEntityFunctions.isSameTypeRef,isSameTypeRefByAttr=_commonEntityFunctions.isSameTypeRefByAttr,_commonEntityFunctions.TypeRef},function(_commonUtilsUtils){defer=_commonUtilsUtils.defer,downcast=_commonUtilsUtils.downcast,neverNull=_commonUtilsUtils.neverNull,noOp=_commonUtilsUtils.noOp},function(_cryptoSha){hash=_cryptoSha.hash},function(_commonUtilsEncoding){generatedIdToTimestamp=_commonUtilsEncoding.generatedIdToTimestamp,stringToUtf8Uint8Array=_commonUtilsEncoding.stringToUtf8Uint8Array,timestampToGeneratedId=_commonUtilsEncoding.timestampToGeneratedId,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64},function(_cryptoAes){aes256Decrypt=_cryptoAes.aes256Decrypt,aes256Encrypt=_cryptoAes.aes256Encrypt,aes256RandomKey=_cryptoAes.aes256RandomKey,IV_BYTE_LENGTH=_cryptoAes.IV_BYTE_LENGTH},function(_cryptoCryptoFacade){decrypt256Key=_cryptoCryptoFacade.decrypt256Key,encrypt256Key=_cryptoCryptoFacade.encrypt256Key},function(_IndexUtils){_createNewIndexUpdate=_IndexUtils._createNewIndexUpdate,filterIndexMemberships=_IndexUtils.filterIndexMemberships,markEnd=_IndexUtils.markEnd,markStart=_IndexUtils.markStart,typeRefToTypeInfo=_IndexUtils.typeRefToTypeInfo},function(_ContactIndexer){ContactIndexer=_ContactIndexer.ContactIndexer},function(_entitiesTutanotaMail){MailTypeRef=_entitiesTutanotaMail.MailTypeRef},function(_entitiesTutanotaContact){ContactTypeRef=_entitiesTutanotaContact.ContactTypeRef},function(_entitiesSysGroupInfo){GroupInfoTypeRef=_entitiesSysGroupInfo.GroupInfoTypeRef},function(_entitiesSysUser){UserTypeRef=_entitiesSysUser.UserTypeRef},function(_GroupInfoIndexer){GroupInfoIndexer=_GroupInfoIndexer.GroupInfoIndexer},function(_MailIndexer){MailIndexer=_MailIndexer.MailIndexer},function(_IndexerCore){IndexerCore=_IndexerCore.IndexerCore},function(_commonErrorOutOfSyncError){OutOfSyncError=_commonErrorOutOfSyncError.OutOfSyncError},function(_SuggestionFacade){SuggestionFacade=_SuggestionFacade.SuggestionFacade},function(_commonErrorDbError){DbError=_commonErrorDbError.DbError},function(_EventQueue){EventQueue=_EventQueue.EventQueue},function(_entitiesSysWhitelabelChild){WhitelabelChildTypeRef=_entitiesSysWhitelabelChild.WhitelabelChildTypeRef},function(_WhitelabelChildIndexer){WhitelabelChildIndexer=_WhitelabelChildIndexer.WhitelabelChildIndexer},function(_commonUtilsArrayUtils){contains=_commonUtilsArrayUtils.contains},function(_commonErrorCancelledError){CancelledError=_commonErrorCancelledError.CancelledError},function(_cryptoRandomizer){random=_cryptoRandomizer.random},function(_commonErrorMembershipRemovedError){MembershipRemovedError=_commonErrorMembershipRemovedError.MembershipRemovedError},function(_commonErrorInvalidDatabaseStateError){InvalidDatabaseStateError=_commonErrorInvalidDatabaseStateError.InvalidDatabaseStateError},function(_commonUtilsMapUtils){getFromMap=_commonUtilsMapUtils.getFromMap},function(_DateProvider){LocalTimeDateProvider=_DateProvider.LocalTimeDateProvider}],execute:function(){_export("Metadata",Metadata={userEncDbKey:"userEncDbKey",mailIndexingEnabled:"mailIndexingEnabled",excludedListIds:"excludedListIds",encDbIv:"encDbIv"}),_export("Metadata",Metadata),Array.from(Object.keys(OperationType)).reduce(function(acc,k){return acc[OperationType[k]]=k,acc},{}),_export("Indexer",Indexer=function(){function Indexer(entityRestClient,worker,browserData,defaultEntityRestCache){var _this=this;_classCallCheck(this,Indexer);var deferred=defer();this._dbInitializedDeferredObject=deferred,this.db={dbFacade:new DbFacade(browserData.indexedDbSupported,function(){worker.infoMessage({translationKey:"indexDeleted_msg",args:{}})}),key:neverNull(null),iv:neverNull(null),initialized:deferred.promise},this._worker=worker,this._core=new IndexerCore(this.db,new EventQueue(worker,function(batch,futureActions){return _this._processEntityEvents(batch,futureActions)}),browserData),this._entity=new EntityWorker(entityRestClient),this._contact=new ContactIndexer(this._core,this.db,this._entity,new SuggestionFacade(ContactTypeRef,this.db)),this._whitelabelChildIndexer=new WhitelabelChildIndexer(this._core,this.db,this._entity,new SuggestionFacade(WhitelabelChildTypeRef,this.db));var dateProvider=new LocalTimeDateProvider;this._mail=new MailIndexer(this._core,this.db,worker,entityRestClient,defaultEntityRestCache,dateProvider),this._groupInfo=new GroupInfoIndexer(this._core,this.db,this._entity,new SuggestionFacade(GroupInfoTypeRef,this.db)),this._indexedGroupIds=[]}return _createClass(Indexer,[{key:"init",value:function(user,userGroupKey){var _this2=this,retryOnError=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._initParams={user:user,groupKey:userGroupKey},this.db.dbFacade.open(uint8ArrayToBase64(hash(stringToUtf8Uint8Array(user._id)))).then(function(){return _this2.db.dbFacade.createTransaction(!0,[MetaDataOS]).then(function(t){return t.get(MetaDataOS,Metadata.userEncDbKey).then(function(userEncDbKey){return userEncDbKey?_this2._loadIndexTables(t,user,userGroupKey,userEncDbKey):_this2._createIndexTables(user,userGroupKey)}).then(function(){return t.wait()})}).then(function(){return _this2._worker.sendIndexState({initializing:!1,mailIndexEnabled:_this2._mail.mailIndexingEnabled,progress:0,currentMailIndexTimestamp:_this2._mail.currentIndexTimestamp,indexedMailCount:0,failedIndexingUpTo:null}),_this2._core.startProcessing(),_this2._contact.indexFullContactList(user.userGroup.group).then(function(){return _this2._groupInfo.indexAllUserAndTeamGroupInfosForAdmin(user)}).then(function(){return _this2._whitelabelChildIndexer.indexAllWhitelabelChildrenForAdmin(user)}).then(function(){return _this2._mail.mailboxIndexingPromise.then(function(){return _this2._mail.indexMailboxes(user,_this2._mail.currentIndexTimestamp)})}).then(function(){return _this2._loadPersistentGroupData(user).then(function(groupIdToEventBatches){return _this2._loadNewEntities(groupIdToEventBatches)})}).catch(OutOfSyncError,function(e){return console.log("out of sync - delete database and disable mail indexing"),_this2.disableMailIndexing()})}).catch(function(e){if(retryOnError&&(e instanceof MembershipRemovedError||e instanceof InvalidDatabaseStateError))return console.log("disable mail indexing and init again",e),_this2._reCreateIndex();throw e})}).catch(function(e){throw _this2._worker.sendIndexState({initializing:!1,mailIndexEnabled:_this2._mail.mailIndexingEnabled,progress:0,currentMailIndexTimestamp:_this2._mail.currentIndexTimestamp,indexedMailCount:0,failedIndexingUpTo:_this2._mail.currentIndexTimestamp}),_this2._dbInitializedDeferredObject.reject(e),e})}},{key:"enableMailIndexing",value:function(){var _this3=this;return this.db.initialized.then(function(){return _this3._mail.enableMailIndexing(_this3._initParams.user).then(function(){_this3._mail.mailboxIndexingPromise.catch(CancelledError,noOp)})})}},{key:"disableMailIndexing",value:function(){var _this4=this;return this.db.initialized.then(function(){if(!_this4._core.isStoppedProcessing())return _this4._core.stopProcessing(),_this4._mail.disableMailIndexing().then(function(){return _this4.init(_this4._initParams.user,_this4._initParams.groupKey)})})}},{key:"extendMailIndex",value:function(newOldestTimestamp){return this._mail.extendIndexIfNeeded(this._initParams.user,newOldestTimestamp)}},{key:"cancelMailIndexing",value:function(){return this._mail.cancelMailIndexing()}},{key:"addBatchesToQueue",value:function(batches){this._core.addBatchesToQueue(batches)}},{key:"startProcessing",value:function(){this._core.queue.start()}},{key:"onVisibilityChanged",value:function(visible){this._core.onVisibilityChanged(visible)}},{key:"_reCreateIndex",value:function(){var _this5=this,mailIndexingWasEnabled=this._mail.mailIndexingEnabled;return this._mail.disableMailIndexing().then(function(){return _this5.init(_this5._initParams.user,_this5._initParams.groupKey,!1).then(function(){if(mailIndexingWasEnabled)return _this5.enableMailIndexing()})})}},{key:"_createIndexTables",value:function(user,userGroupKey){var _this6=this;return this._loadGroupData(user).then(function(groupBatches){return _this6.db.dbFacade.createTransaction(!1,[MetaDataOS,GroupDataOS]).then(function(t2){return _this6.db.key=aes256RandomKey(),_this6.db.iv=random.generateRandomData(IV_BYTE_LENGTH),t2.put(MetaDataOS,Metadata.userEncDbKey,encrypt256Key(userGroupKey,_this6.db.key)),t2.put(MetaDataOS,Metadata.mailIndexingEnabled,_this6._mail.mailIndexingEnabled),t2.put(MetaDataOS,Metadata.excludedListIds,_this6._mail._excludedListIds),t2.put(MetaDataOS,Metadata.encDbIv,aes256Encrypt(_this6.db.key,_this6.db.iv,random.generateRandomData(IV_BYTE_LENGTH),!0,!1)),_this6._initGroupData(groupBatches,t2)})}).then(function(){return _this6._updateIndexedGroups()}).then(function(){_this6._dbInitializedDeferredObject.resolve()})}},{key:"_loadIndexTables",value:function(t,user,userGroupKey,userEncDbKey){var _this7=this;return this.db.key=decrypt256Key(userGroupKey,userEncDbKey),t.get(MetaDataOS,Metadata.encDbIv).then(function(encDbIv){_this7.db.iv=aes256Decrypt(_this7.db.key,neverNull(encDbIv),!0,!1)}).then(function(){return Promise.all([t.get(MetaDataOS,Metadata.mailIndexingEnabled).then(function(mailIndexingEnabled){_this7._mail.mailIndexingEnabled=neverNull(mailIndexingEnabled)}),t.get(MetaDataOS,Metadata.excludedListIds).then(function(excludedListIds){_this7._mail._excludedListIds=neverNull(excludedListIds)}),_this7._loadGroupDiff(user).then(function(groupDiff){return _this7._updateGroups(user,groupDiff)}).then(function(){return _this7._mail.updateCurrentIndexTimestamp(user)})]).then(function(){return _this7._updateIndexedGroups()}).then(function(){_this7._dbInitializedDeferredObject.resolve()}).then(function(){return Promise.all([_this7._contact.suggestionFacade.load(),_this7._groupInfo.suggestionFacade.load(),_this7._whitelabelChildIndexer.suggestionFacade.load()])})}).return()}},{key:"_updateIndexedGroups",value:function(){var _this8=this;return this.db.dbFacade.createTransaction(!0,[GroupDataOS]).then(function(t){return t.getAll(GroupDataOS).map(function(groupDataEntry){return groupDataEntry.key})}).then(function(indexedGroupIds){0===indexedGroupIds.length&&(console.log("no group ids in database, disabling indexer"),_this8.disableMailIndexing()),_this8._indexedGroupIds=indexedGroupIds})}},{key:"_loadGroupDiff",value:function(user){var currentGroups=filterIndexMemberships(user).map(function(m){return{id:m.group,type:getMembershipGroupType(m)}});return this.db.dbFacade.createTransaction(!0,[GroupDataOS]).then(function(t){return t.getAll(GroupDataOS).then(function(loadedGroups){var oldGroups=loadedGroups.map(function(group){return{id:downcast(group.key),type:group.value.groupType}});return{deletedGroups:oldGroups.filter(function(oldGroup){return null==currentGroups.find(function(m){return m.id===oldGroup.id})}),newGroups:currentGroups.filter(function(m){return null==oldGroups.find(function(oldGroup){return m.id===oldGroup.id})})}})})}},{key:"_updateGroups",value:function(user,groupDiff){var _this9=this;return groupDiff.deletedGroups.filter(function(g){return g.type===GroupType.Mail||g.type===GroupType.Contact}).length>0?Promise.reject(new MembershipRemovedError("user has been removed from contact or mail group")):groupDiff.newGroups.length>0?this._loadGroupData(user,groupDiff.newGroups.map(function(g){return g.id})).then(function(groupBatches){return _this9.db.dbFacade.createTransaction(!1,[GroupDataOS]).then(function(t){return _this9._initGroupData(groupBatches,t)})}):Promise.resolve()}},{key:"_loadGroupData",value:function(user,restrictToTheseGroups){var _this10=this,memberships=filterIndexMemberships(user),restrictTo=restrictToTheseGroups;return restrictTo&&(memberships=memberships.filter(function(membership){return contains(restrictTo,membership.group)})),Promise.map(memberships,function(membership){return _this10._entity.loadRange(EntityEventBatchTypeRef,membership.group,GENERATED_MAX_ID,1,!0).then(function(eventBatches){return{groupId:membership.group,groupData:{lastBatchIds:eventBatches.map(function(eventBatch){return eventBatch._id[1]}),indexTimestamp:NOTHING_INDEXED_TIMESTAMP,groupType:getMembershipGroupType(membership)}}}).catch(NotAuthorizedError,function(){return console.log("could not download entity updates => lost permission on list"),null})}).filter(function(r){return null!=r})}},{key:"_initGroupData",value:function(groupBatches,t2){return groupBatches.forEach(function(groupIdToLastBatchId){t2.put(GroupDataOS,groupIdToLastBatchId.groupId,groupIdToLastBatchId.groupData)}),t2.wait()}},{key:"_loadNewEntities",value:function(groupIdToEventBatches){var _this11=this,batchesOfAllGroups=[];return Promise.each(groupIdToEventBatches,function(groupIdToEventBatch){if(groupIdToEventBatch.eventBatchIds.length>0){var startId=_this11._getStartIdForLoadingMissedEventBatches(groupIdToEventBatch.eventBatchIds);return _this11._entity.loadAll(EntityEventBatchTypeRef,groupIdToEventBatch.groupId,startId).then(function(eventBatchesOnServer){var batchesToQueue=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=eventBatchesOnServer[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var batch=_step.value,batchId=getElementId(batch);-1===groupIdToEventBatch.eventBatchIds.indexOf(batchId)&&firstBiggerThanSecond(batchId,startId)&&batchesToQueue.push({groupId:groupIdToEventBatch.groupId,batchId:batchId,events:batch.events})}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}if(eventBatchesOnServer.length===batchesToQueue.length)throw new OutOfSyncError;batchesOfAllGroups.push.apply(batchesOfAllGroups,batchesToQueue)}).catch(NotAuthorizedError,function(){console.log("could not download entity updates => lost permission on list")})}}).then(function(){_this11.addBatchesToQueue(batchesOfAllGroups),_this11.startProcessing()})}},{key:"_getStartIdForLoadingMissedEventBatches",value:function(lastEventBatchIds){var newestBatchId=lastEventBatchIds[0],oldestBatchId=lastEventBatchIds[lastEventBatchIds.length-1],startId=timestampToGeneratedId(generatedIdToTimestamp(newestBatchId)-6e4);return firstBiggerThanSecond(startId,oldestBatchId)||(startId=timestampToGeneratedId(generatedIdToTimestamp(oldestBatchId)-1)),startId}},{key:"_loadPersistentGroupData",value:function(user){var _this12=this;return this.db.dbFacade.createTransaction(!0,[GroupDataOS]).then(function(t){return Promise.all(filterIndexMemberships(user).map(function(membership){return t.get(GroupDataOS,membership.group).then(function(groupData){if(groupData)return{groupId:membership.group,eventBatchIds:groupData.lastBatchIds};throw new InvalidDatabaseStateError("no group data for group "+membership.group+" indexedGroupIds: "+_this12._indexedGroupIds.join(","))})}))})}},{key:"_processEntityEvents",value:function(batch,futureActions){var _this13=this,events=batch.events,groupId=batch.groupId,batchId=batch.batchId;return this.db.initialized.then(function(){if(!_this13.db.dbFacade.indexingSupported)return Promise.resolve();if(-1===filterIndexMemberships(_this13._initParams.user).map(function(m){return m.group}).indexOf(groupId))return Promise.resolve();if(-1===_this13._indexedGroupIds.indexOf(groupId))return Promise.resolve();markStart("processEntityEvents");var groupedEvents=events.reduce(function(all,update){return isSameTypeRefByAttr(MailTypeRef,update.application,update.type)?getFromMap(all,MailTypeRef,function(){return[]}).push(update):isSameTypeRefByAttr(ContactTypeRef,update.application,update.type)?getFromMap(all,ContactTypeRef,function(){return[]}).push(update):isSameTypeRefByAttr(GroupInfoTypeRef,update.application,update.type)?getFromMap(all,GroupInfoTypeRef,function(){return[]}).push(update):isSameTypeRefByAttr(UserTypeRef,update.application,update.type)?getFromMap(all,UserTypeRef,function(){return[]}).push(update):isSameTypeRefByAttr(WhitelabelChildTypeRef,update.application,update.type)&&getFromMap(all,WhitelabelChildTypeRef,function(){return[]}).push(update),all},new Map);return markStart("processEvent"),Promise.each(groupedEvents.entries(),function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1],promise=Promise.resolve();if(isSameTypeRef(UserTypeRef,key))return _this13._processUserEntityEvents(value);var indexUpdate=_createNewIndexUpdate(typeRefToTypeInfo(key));return isSameTypeRef(MailTypeRef,key)?promise=_this13._mail.processEntityEvents(value,groupId,batchId,indexUpdate,futureActions):isSameTypeRef(ContactTypeRef,key)?promise=_this13._contact.processEntityEvents(value,groupId,batchId,indexUpdate):isSameTypeRef(GroupInfoTypeRef,key)?promise=_this13._groupInfo.processEntityEvents(value,groupId,batchId,indexUpdate,_this13._initParams.user):isSameTypeRef(UserTypeRef,key)?promise=_this13._processUserEntityEvents(value):isSameTypeRef(WhitelabelChildTypeRef,key)&&(promise=_this13._whitelabelChildIndexer.processEntityEvents(value,groupId,batchId,indexUpdate,_this13._initParams.user)),promise.then(function(){return markEnd("processEvent"),markStart("writeIndexUpdate"),_this13._core.writeIndexUpdateWithBatchId(groupId,batchId,indexUpdate)}).then(function(){markEnd("writeIndexUpdate"),markEnd("processEntityEvents")})})}).catch(CancelledError,noOp).catch(DbError,function(e){if(!_this13._core.isStoppedProcessing())throw e;console.log("Ignoring DBerror when indexing is disabled",e)}).catch(InvalidDatabaseStateError,function(e){return console.log("InvalidDatabaseStateError during _processEntityEvents"),_this13._core.stopProcessing(),_this13._reCreateIndex()})}},{key:"_processUserEntityEvents",value:function(events){var _this14=this;return Promise.all(events.map(function(event){return event.operation===OperationType.UPDATE&&isSameId(_this14._initParams.user._id,event.instanceId)?_this14._entity.load(UserTypeRef,event.instanceId).then(function(updatedUser){_this14._initParams.user=updatedUser}):Promise.resolve()})).return()}}]),Indexer}()),_export("Indexer",Indexer)}}}),System.register("src/api/common/error/InvalidDatabaseStateError.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/possibleConstructorReturn.js","node_modules/systemjs-plugin-babel/babel-helpers/inherits.js","./TutanotaError"],function(_export,_context){"use strict";var _classCallCheck,_possibleConstructorReturn,_inherits,TutanotaError,InvalidDatabaseStateError;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersPossibleConstructorReturnJs){_possibleConstructorReturn=_node_modulesSystemjsPluginBabelBabelHelpersPossibleConstructorReturnJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersInheritsJs){_inherits=_node_modulesSystemjsPluginBabelBabelHelpersInheritsJs.default},function(_TutanotaError2){TutanotaError=_TutanotaError2.TutanotaError}],execute:function(){_export("InvalidDatabaseStateError",InvalidDatabaseStateError=function(_TutanotaError){function InvalidDatabaseStateError(message){return _classCallCheck(this,InvalidDatabaseStateError),_possibleConstructorReturn(this,(InvalidDatabaseStateError.__proto__||Object.getPrototypeOf(InvalidDatabaseStateError)).call(this,"InvalidDatabaseStateError",message))}return _inherits(InvalidDatabaseStateError,TutanotaError),InvalidDatabaseStateError}()),_export("InvalidDatabaseStateError",InvalidDatabaseStateError)}}}),System.register("src/api/worker/search/MailIndexer.js",["node_modules/systemjs-plugin-babel/babel-helpers/toConsumableArray.js","node_modules/systemjs-plugin-babel/babel-helpers/slicedToArray.js","node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../common/TutanotaConstants","../EntityWorker","../../entities/tutanota/MailBody","../../common/error/RestError","../../entities/tutanota/MailboxGroupRoot","../../entities/tutanota/MailBox","../../entities/tutanota/MailFolder","../../entities/tutanota/Mail","./DbFacade","../../common/EntityFunctions","../../common/utils/Utils","../../common/utils/Encoding","./IndexUtils","../../entities/tutanota/File","../../common/error/CancelledError","./IndexerCore","./Indexer","../../common/utils/ArrayUtils","../../common/utils/PromiseUtils","../../common/error/DbError","../rest/EntityRestCache","../../common/error/InvalidDatabaseStateError"],function(_export,_context){"use strict";var _toConsumableArray,_slicedToArray,_classCallCheck,_createClass,FULL_INDEXED_TIMESTAMP,MailFolderType,MailState,NOTHING_INDEXED_TIMESTAMP,OperationType,EntityWorker,load,loadAll,MailBodyTypeRef,NotAuthorizedError,NotFoundError,MailboxGroupRootTypeRef,MailBoxTypeRef,MailFolderTypeRef,MailModel,MailTypeRef,ElementDataOS,GroupDataOS,MetaDataOS,elementIdPart,isSameId,listIdPart,readOnlyHeaders,containsEventOfType,getMailBodyText,neverNull,ProgressMonitor,timestampToGeneratedId,_createNewIndexUpdate,encryptIndexKeyBase64,filterMailMemberships,getPerformanceTimestamp,htmlToText,typeRefToTypeInfo,FileTypeRef,CancelledError,Metadata,contains,flat,groupBy,splitInChunks,promises,DbError,EntityRestCache,InvalidDatabaseStateError,MailIndexer,IndexLoader;function _getCurrentIndexTimestamp(groupIndexTimestamps){var currentIndexTimestamp=NOTHING_INDEXED_TIMESTAMP;return groupIndexTimestamps.forEach(function(t,index){0===index?currentIndexTimestamp=t:t===NOTHING_INDEXED_TIMESTAMP||t===FULL_INDEXED_TIMESTAMP&&currentIndexTimestamp!==FULL_INDEXED_TIMESTAMP&&currentIndexTimestamp!==NOTHING_INDEXED_TIMESTAMP||(currentIndexTimestamp===FULL_INDEXED_TIMESTAMP&&t!==currentIndexTimestamp?currentIndexTimestamp=t:t<currentIndexTimestamp&&(currentIndexTimestamp=t))}),currentIndexTimestamp}return _export("_getCurrentIndexTimestamp",_getCurrentIndexTimestamp),{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs){_toConsumableArray=_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs){_slicedToArray=_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonTutanotaConstants){FULL_INDEXED_TIMESTAMP=_commonTutanotaConstants.FULL_INDEXED_TIMESTAMP,MailFolderType=_commonTutanotaConstants.MailFolderType,MailState=_commonTutanotaConstants.MailState,NOTHING_INDEXED_TIMESTAMP=_commonTutanotaConstants.NOTHING_INDEXED_TIMESTAMP,OperationType=_commonTutanotaConstants.OperationType},function(_EntityWorker){EntityWorker=_EntityWorker.EntityWorker,load=_EntityWorker.load,loadAll=_EntityWorker.loadAll},function(_entitiesTutanotaMailBody){MailBodyTypeRef=_entitiesTutanotaMailBody.MailBodyTypeRef},function(_commonErrorRestError){NotAuthorizedError=_commonErrorRestError.NotAuthorizedError,NotFoundError=_commonErrorRestError.NotFoundError},function(_entitiesTutanotaMailboxGroupRoot){MailboxGroupRootTypeRef=_entitiesTutanotaMailboxGroupRoot.MailboxGroupRootTypeRef},function(_entitiesTutanotaMailBox){MailBoxTypeRef=_entitiesTutanotaMailBox.MailBoxTypeRef},function(_entitiesTutanotaMailFolder){MailFolderTypeRef=_entitiesTutanotaMailFolder.MailFolderTypeRef},function(_entitiesTutanotaMail){MailModel=_entitiesTutanotaMail._TypeModel,MailTypeRef=_entitiesTutanotaMail.MailTypeRef},function(_DbFacade){ElementDataOS=_DbFacade.ElementDataOS,GroupDataOS=_DbFacade.GroupDataOS,MetaDataOS=_DbFacade.MetaDataOS},function(_commonEntityFunctions){elementIdPart=_commonEntityFunctions.elementIdPart,isSameId=_commonEntityFunctions.isSameId,listIdPart=_commonEntityFunctions.listIdPart,readOnlyHeaders=_commonEntityFunctions.readOnlyHeaders,_commonEntityFunctions.TypeRef},function(_commonUtilsUtils){containsEventOfType=_commonUtilsUtils.containsEventOfType,getMailBodyText=_commonUtilsUtils.getMailBodyText,neverNull=_commonUtilsUtils.neverNull,ProgressMonitor=_commonUtilsUtils.ProgressMonitor},function(_commonUtilsEncoding){timestampToGeneratedId=_commonUtilsEncoding.timestampToGeneratedId},function(_IndexUtils){_createNewIndexUpdate=_IndexUtils._createNewIndexUpdate,encryptIndexKeyBase64=_IndexUtils.encryptIndexKeyBase64,filterMailMemberships=_IndexUtils.filterMailMemberships,getPerformanceTimestamp=_IndexUtils.getPerformanceTimestamp,htmlToText=_IndexUtils.htmlToText,typeRefToTypeInfo=_IndexUtils.typeRefToTypeInfo},function(_entitiesTutanotaFile){FileTypeRef=_entitiesTutanotaFile.FileTypeRef},function(_commonErrorCancelledError){CancelledError=_commonErrorCancelledError.CancelledError},function(_IndexerCore){_IndexerCore.IndexerCore},function(_Indexer){Metadata=_Indexer.Metadata},function(_commonUtilsArrayUtils){contains=_commonUtilsArrayUtils.contains,flat=_commonUtilsArrayUtils.flat,groupBy=_commonUtilsArrayUtils.groupBy,splitInChunks=_commonUtilsArrayUtils.splitInChunks},function(_commonUtilsPromiseUtils){promises=_commonUtilsPromiseUtils},function(_commonErrorDbError){DbError=_commonErrorDbError.DbError},function(_restEntityRestCache){EntityRestCache=_restEntityRestCache.EntityRestCache},function(_commonErrorInvalidDatabaseStateError){InvalidDatabaseStateError=_commonErrorInvalidDatabaseStateError.InvalidDatabaseStateError}],execute:function(){_export("INITIAL_MAIL_INDEX_INTERVAL_DAYS",28),_export("INITIAL_MAIL_INDEX_INTERVAL_DAYS",28),20,_export("MAIL_INDEXER_CHUNK",100),_export("MAIL_INDEXER_CHUNK",100),864e5,_export("MailIndexer",MailIndexer=function(){function MailIndexer(core,db,worker,entityRestClient,defaultCachingRestClient,dateProvider){_classCallCheck(this,MailIndexer),this._core=core,this._db=db,this._defaultCachingClient=new EntityWorker(defaultCachingRestClient),this._worker=worker,this.currentIndexTimestamp=NOTHING_INDEXED_TIMESTAMP,this.mailIndexingEnabled=!1,this.mailboxIndexingPromise=Promise.resolve(),this._indexingCancelled=!1,this._excludedListIds=[],this._entityRestClient=entityRestClient,this._dateProvider=dateProvider}return _createClass(MailIndexer,[{key:"createMailIndexEntries",value:function(mail,mailBody,files){var startTimeIndex=getPerformanceTimestamp(),keyToIndexEntries=this._core.createIndexEntriesForAttributes(MailModel,mail,[{attribute:MailModel.values.subject,value:function(){return mail.subject}},{attribute:MailModel.associations.toRecipients,value:function(){return mail.toRecipients.map(function(r){return r.name+" <"+r.address+">"}).join(",")}},{attribute:MailModel.associations.ccRecipients,value:function(){return mail.ccRecipients.map(function(r){return r.name+" <"+r.address+">"}).join(",")}},{attribute:MailModel.associations.bccRecipients,value:function(){return mail.bccRecipients.map(function(r){return r.name+" <"+r.address+">"}).join(",")}},{attribute:MailModel.associations.sender,value:function(){return mail.sender?mail.sender.name+" <"+mail.sender.address+">":""}},{attribute:MailModel.associations.body,value:function(){return null!=mailBody?htmlToText(getMailBodyText(mailBody)):""}},{attribute:MailModel.associations.attachments,value:function(){return files.map(function(file){return file.name}).join(" ")}}]);return this._core._stats.indexingTime+=getPerformanceTimestamp()-startTimeIndex,keyToIndexEntries}},{key:"processNewMail",value:function(event){var _this=this;return this._isExcluded(event)?Promise.resolve():this._defaultCachingClient.load(MailTypeRef,[event.instanceListId,event.instanceId],null,readOnlyHeaders()).then(function(mail){return Promise.all([Promise.map(mail.attachments,function(attachmentId){return _this._defaultCachingClient.load(FileTypeRef,attachmentId,null,readOnlyHeaders())}),_this._defaultCachingClient.load(MailBodyTypeRef,mail.body,null,readOnlyHeaders())]).spread(function(files,body){var keyToIndexEntries=_this.createMailIndexEntries(mail,body,files);return{mail:mail,keyToIndexEntries:keyToIndexEntries}})}).catch(NotFoundError,function(){return console.log("tried to index non existing mail"),null}).catch(NotAuthorizedError,function(){return console.log("tried to index contact without permission"),null})}},{key:"processMovedMail",value:function(event,indexUpdate){var _this2=this,encInstanceId=encryptIndexKeyBase64(this._db.key,event.instanceId,this._db.iv);return this._db.dbFacade.createTransaction(!0,[ElementDataOS]).then(function(transaction){return transaction.get(ElementDataOS,encInstanceId).then(function(elementData){return elementData?_this2._isExcluded(event)?_this2._core._processDeleted(event,indexUpdate):void indexUpdate.move.push({encInstanceId:encInstanceId,newListId:event.instanceListId}):_this2.processNewMail(event).then(function(result){result&&_this2._core.encryptSearchIndexEntries(result.mail._id,neverNull(result.mail._ownerGroup),result.keyToIndexEntries,indexUpdate)})})})}},{key:"enableMailIndexing",value:function(user){var _this3=this;return this._db.dbFacade.createTransaction(!0,[MetaDataOS]).then(function(t){return t.get(MetaDataOS,Metadata.mailIndexingEnabled).then(function(enabled){return enabled?t.get(MetaDataOS,Metadata.excludedListIds).then(function(excludedListIds){_this3.mailIndexingEnabled=!0,_this3._excludedListIds=excludedListIds||[]}):Promise.map(filterMailMemberships(user),function(mailGroupMembership){return _this3._getSpamFolder(mailGroupMembership)}).then(function(spamFolders){return _this3._excludedListIds=spamFolders.map(function(folder){return folder.mails}),_this3.mailIndexingEnabled=!0,_this3._db.dbFacade.createTransaction(!1,[MetaDataOS]).then(function(t2){t2.put(MetaDataOS,Metadata.mailIndexingEnabled,!0),t2.put(MetaDataOS,Metadata.excludedListIds,_this3._excludedListIds);var oldestTimestamp=_this3._dateProvider.getStartOfDayShiftedBy(-28).getTime();return _this3.indexMailboxes(user,oldestTimestamp).catch(CancelledError,function(e){console.log("cancelled initial indexing",e)}),t2.wait()})})})})}},{key:"disableMailIndexing",value:function(){return this.mailIndexingEnabled=!1,this._indexingCancelled=!0,this._excludedListIds=[],this._db.dbFacade.deleteDatabase()}},{key:"cancelMailIndexing",value:function(){return this._indexingCancelled=!0,Promise.resolve()}},{key:"extendIndexIfNeeded",value:function(user,newOldestTimestamp){var _this4=this;return this.mailboxIndexingPromise.then(function(){if(_this4.currentIndexTimestamp>FULL_INDEXED_TIMESTAMP&&_this4.currentIndexTimestamp>newOldestTimestamp)return _this4.indexMailboxes(user,newOldestTimestamp).catch(CancelledError,function(e){console.log("extend mail index has been cancelled",e)}),_this4.mailboxIndexingPromise}).catch(CancelledError,function(e){console.log("extend mail index has been cancelled",e)})}},{key:"indexMailboxes",value:function(user,oldestTimestamp){var _this5=this;if(!this.mailIndexingEnabled)return Promise.resolve();this._indexingCancelled=!1,this._core.resetStats(),this._worker.sendIndexState({initializing:!1,mailIndexEnabled:this.mailIndexingEnabled,progress:1,currentMailIndexTimestamp:this.currentIndexTimestamp,indexedMailCount:0,failedIndexingUpTo:null});var memberships=filterMailMemberships(user);return this._core.queue.pause(),this.mailboxIndexingPromise=Promise.map(memberships,function(mailGroupMembership){var mailGroupId=mailGroupMembership.group;return _this5._defaultCachingClient.load(MailboxGroupRootTypeRef,mailGroupId).then(function(mailGroupRoot){return _this5._defaultCachingClient.load(MailBoxTypeRef,mailGroupRoot.mailbox)}).then(function(mbox){return _this5._db.dbFacade.createTransaction(!0,[GroupDataOS]).then(function(t){return t.get(GroupDataOS,mailGroupId).then(function(groupData){if(groupData){var _newestTimestamp=groupData.indexTimestamp===NOTHING_INDEXED_TIMESTAMP?_this5._dateProvider.getStartOfDayShiftedBy(1):groupData.indexTimestamp;return _newestTimestamp>oldestTimestamp?{mbox:mbox,newestTimestamp:_newestTimestamp}:null}return null})})})}).then(function(mailBoxes){var filtered=mailBoxes.filter(Boolean);if(filtered.length>0)return _this5._indexMailLists(filtered,oldestTimestamp)}).then(function(){return _this5._core.printStatus(),_this5.updateCurrentIndexTimestamp(user).then(function(){return _this5._worker.sendIndexState({initializing:!1,mailIndexEnabled:_this5.mailIndexingEnabled,progress:0,currentMailIndexTimestamp:_this5.currentIndexTimestamp,indexedMailCount:_this5._core._stats.mailcount,failedIndexingUpTo:null})})}).catch(function(e){return console.warn("Mail indexing failed: ",e),_this5.mailboxIndexingPromise=Promise.resolve(),_this5.updateCurrentIndexTimestamp(user).then(function(){_this5._worker.sendIndexState({initializing:!1,mailIndexEnabled:_this5.mailIndexingEnabled,progress:0,currentMailIndexTimestamp:_this5.currentIndexTimestamp,indexedMailCount:_this5._core._stats.mailcount,failedIndexingUpTo:_this5._core.isStoppedProcessing()||e instanceof CancelledError?null:oldestTimestamp})})}).finally(function(){_this5._core.queue.resume()}),this.mailboxIndexingPromise.return()}},{key:"_indexMailLists",value:function(mailBoxes,oldestTimestamp){var _this6=this,newestTimestamp=mailBoxes.reduce(function(acc,data){return Math.max(acc,data.newestTimestamp)},0),progress=new ProgressMonitor(newestTimestamp-oldestTimestamp,function(progress){_this6._worker.sendIndexState({initializing:!1,mailIndexEnabled:_this6.mailIndexingEnabled,progress:progress,currentMailIndexTimestamp:_this6.currentIndexTimestamp,indexedMailCount:_this6._core._stats.mailcount,failedIndexingUpTo:null})}),indexUpdate=_createNewIndexUpdate(typeRefToTypeInfo(MailTypeRef)),indexLoader=new IndexLoader(this._entityRestClient);return Promise.map(mailBoxes,function(mBoxData){return _this6._loadMailListIds(mBoxData.mbox).then(function(mailListIds){return{mailListIds:mailListIds,newestTimestamp:mBoxData.newestTimestamp,ownerGroup:neverNull(mBoxData.mbox._ownerGroup)}})}).then(function(mailboxData){return _this6._indexMailListsInTimeBatches(mailboxData,[newestTimestamp,oldestTimestamp],indexUpdate,progress,indexLoader)})}},{key:"_processedEnough",value:function(indexUpdate){return indexUpdate.create.encInstanceIdToElementData.size>500}},{key:"_indexMailListsInTimeBatches",value:function(dataPerMailbox,timeRange,indexUpdate,progress,indexLoader){var _this7=this,_timeRange=_slicedToArray(timeRange,2),rangeStart=_timeRange[0],rangeEnd=_timeRange[1],batchEnd=rangeStart-864e5;batchEnd<rangeEnd&&(batchEnd=rangeEnd);var mailboxesToWrite=dataPerMailbox.filter(function(mboxData){return batchEnd<mboxData.newestTimestamp}),batchRange=[rangeStart,batchEnd];if(rangeStart<=rangeEnd){var indexTimestampPerGroup=mailboxesToWrite.map(function(data){return{groupId:data.ownerGroup,indexTimestamp:0===data.mailListIds.length?FULL_INDEXED_TIMESTAMP:rangeStart}});return this._writeIndexUpdate(indexTimestampPerGroup,indexUpdate).then(function(){progress.workDone(rangeStart-batchEnd)})}return this._prepareMailDataForTimeBatch(mailboxesToWrite,batchRange,indexUpdate,indexLoader).then(function(){var nextRange=[batchEnd,rangeEnd];if(_this7._processedEnough(indexUpdate)){var _indexTimestampPerGroup=mailboxesToWrite.map(function(data){return{groupId:data.ownerGroup,indexTimestamp:0===data.mailListIds.length?FULL_INDEXED_TIMESTAMP:batchEnd}});return _this7._writeIndexUpdate(_indexTimestampPerGroup,indexUpdate).then(function(){progress.workDone(rangeStart-batchEnd);var newIndexUpdate=_createNewIndexUpdate(indexUpdate.typeInfo);return _this7._indexMailListsInTimeBatches(dataPerMailbox,nextRange,newIndexUpdate,progress,indexLoader)})}return progress.workDone(rangeStart-batchEnd),_this7._indexMailListsInTimeBatches(dataPerMailbox,nextRange,indexUpdate,progress,indexLoader)})}},{key:"_updateIndexTimeStamp",value:function(mailGroupId,indexTimestamp){var _this8=this;return this._db.dbFacade.createTransaction(!1,[GroupDataOS]).then(function(t2){return t2.get(GroupDataOS,mailGroupId).then(function(groupData){if(groupData)return groupData.indexTimestamp=indexTimestamp,t2.put(GroupDataOS,mailGroupId,groupData),t2.wait();throw new InvalidDatabaseStateError("no group data for mail group "+mailGroupId)})}).then(function(){_this8.currentIndexTimestamp=indexTimestamp})}},{key:"_prepareMailDataForTimeBatch",value:function(mboxDataList,timeRange,indexUpdate,indexLoader){var _this9=this,startTimeLoad=getPerformanceTimestamp();return Promise.map(mboxDataList,function(mboxData){return Promise.map(mboxData.mailListIds.slice(),function(listId){return indexLoader.loadMailsWithCache(listId,timeRange).then(function(_ref){var mails=_ref.elements;return _ref.loadedCompletely&&mboxData.mailListIds.splice(mboxData.mailListIds.indexOf(listId),1),_this9._core._stats.mailcount+=mails.length,mails.forEach(function(m){return indexLoader.removeFromCache(m._id)}),_this9._processIndexMails(mails,indexUpdate,indexLoader)})},{concurrency:2})}).then(function(){_this9._core._stats.preparingTime+=getPerformanceTimestamp()-startTimeLoad})}},{key:"_processIndexMails",value:function(mails,indexUpdate,indexLoader){var _this10=this;if(this._indexingCancelled)throw new CancelledError("cancelled indexing in processing index mails");var bodies=indexLoader.loadMailBodies(mails),files=indexLoader.loadAttachments(mails);return promises.all(mails,bodies,files).then(function(_ref2){var _ref3=_slicedToArray(_ref2,3),mails=_ref3[0],bodies=_ref3[1],files=_ref3[2];return mails.map(function(mail){return{mail:mail,body:bodies.find(function(b){return isSameId(b._id,mail.body)}),files:files.filter(function(file){return mail.attachments.find(function(a){return isSameId(a,file._id)})})}})}).then(function(mailWithBodyAndFiles){mailWithBodyAndFiles.forEach(function(element){var keyToIndexEntries=_this10.createMailIndexEntries(element.mail,element.body,element.files);_this10._core.encryptSearchIndexEntries(element.mail._id,neverNull(element.mail._ownerGroup),keyToIndexEntries,indexUpdate)})}).return(mails.length)}},{key:"_writeIndexUpdate",value:function(dataPerGroup,indexUpdate){return this._core.writeIndexUpdate(dataPerGroup,indexUpdate)}},{key:"updateCurrentIndexTimestamp",value:function(user){var _this11=this;return this._db.dbFacade.createTransaction(!0,[GroupDataOS]).then(function(t){return Promise.all(filterMailMemberships(user).map(function(mailGroupMembership){return t.get(GroupDataOS,mailGroupMembership.group).then(function(groupData){return groupData?groupData.indexTimestamp:NOTHING_INDEXED_TIMESTAMP})})).then(function(groupIndexTimestamps){_this11.currentIndexTimestamp=_getCurrentIndexTimestamp(groupIndexTimestamps)})}).catch(function(err){err instanceof DbError&&_this11._core.isStoppedProcessing()&&console.log("The database was closed, do not write currentIndexTimestamp")})}},{key:"_isExcluded",value:function(event){return-1!==this._excludedListIds.indexOf(event.instanceListId)}},{key:"_loadMailListIds",value:function(mailbox){var _this12=this,mailListIds=[];return this._defaultCachingClient.loadAll(MailFolderTypeRef,neverNull(mailbox.systemFolders).folders).filter(function(f){return!contains(_this12._excludedListIds,f.mails)}).map(function(folder){return mailListIds.push(folder.mails),_this12._defaultCachingClient.loadAll(MailFolderTypeRef,folder.subFolders).map(function(folder){mailListIds.push(folder.mails)})}).return(mailListIds)}},{key:"_getSpamFolder",value:function(mailGroup){return load(MailboxGroupRootTypeRef,mailGroup.group).then(function(mailGroupRoot){return load(MailBoxTypeRef,mailGroupRoot.mailbox)}).then(function(mbox){return loadAll(MailFolderTypeRef,neverNull(mbox.systemFolders).folders).then(function(folders){return neverNull(folders.find(function(folder){return folder.folderType===MailFolderType.SPAM}))})})}},{key:"processEntityEvents",value:function(events,groupId,batchId,indexUpdate,futureActions){var _this13=this;return this.mailIndexingEnabled?Promise.each(events,function(event){if(event.operation===OperationType.CREATE){if(containsEventOfType(events,OperationType.DELETE,event.instanceId)){var finalDestinationEvent=futureActions.moved.get(event.instanceId),futureMoveEvent=futureActions.moved.get(event.instanceId);return futureMoveEvent&&isSameId(futureMoveEvent._id,event._id)&&futureActions.moved.delete(futureMoveEvent.instanceId),futureActions.deleted.has(event.instanceId)||finalDestinationEvent&&!isSameId(finalDestinationEvent.instanceListId,event.instanceListId)?Promise.resolve():_this13.processMovedMail(event,indexUpdate)}return futureActions.deleted.has(event.instanceId)||futureActions.moved.has(event.instanceId)?Promise.resolve():_this13.processNewMail(event).then(function(result){result&&_this13._core.encryptSearchIndexEntries(result.mail._id,neverNull(result.mail._ownerGroup),result.keyToIndexEntries,indexUpdate)})}if(event.operation===OperationType.UPDATE)return futureActions.deleted.has(event.instanceId)?Promise.resolve():_this13._defaultCachingClient.load(MailTypeRef,[event.instanceListId,event.instanceId],null,readOnlyHeaders()).then(function(mail){if(mail.state===MailState.DRAFT)return Promise.all([_this13._core._processDeleted(event,indexUpdate),futureActions.moved.get(event.instanceId)?Promise.resolve():_this13.processNewMail(event).then(function(result){result&&_this13._core.encryptSearchIndexEntries(result.mail._id,neverNull(result.mail._ownerGroup),result.keyToIndexEntries,indexUpdate)})])}).catch(NotFoundError,function(){return console.log("tried to index update event for non existing mail")});if(event.operation===OperationType.DELETE){var futureDeleteEvent=futureActions.deleted.get(event.instanceId);if(futureDeleteEvent&&isSameId(futureDeleteEvent._id,event._id)&&futureActions.deleted.delete(futureDeleteEvent.instanceId),!containsEventOfType(events,OperationType.CREATE,event.instanceId))return _this13._core._processDeleted(event,indexUpdate)}}).return():Promise.resolve()}}]),MailIndexer}()),_export("MailIndexer",MailIndexer),IndexLoader=function(){function IndexLoader(restClient){_classCallCheck(this,IndexLoader),this._entityCache=new EntityRestCache(restClient),this._entity=new EntityWorker(restClient),this._cachingEntity=new EntityWorker(this._entityCache)}return _createClass(IndexLoader,[{key:"loadMailsWithCache",value:function(mailListId,_ref4){var _ref5=_slicedToArray(_ref4,2),rangeStart=_ref5[0],rangeEnd=_ref5[1];return this._cachingEntity.loadReverseRangeBetween(MailTypeRef,mailListId,timestampToGeneratedId(rangeStart),timestampToGeneratedId(rangeEnd),100)}},{key:"removeFromCache",value:function(id){this._entityCache._tryRemoveFromCache(MailTypeRef,listIdPart(id),elementIdPart(id))}},{key:"loadMailBodies",value:function(mails){var ids=mails.map(function(m){return m.body});return this._loadInChunks(MailBodyTypeRef,null,ids)}},{key:"loadAttachments",value:function(mails){var _this14=this,attachmentIds=[];mails.forEach(function(mail){attachmentIds.push.apply(attachmentIds,_toConsumableArray(mail.attachments))});var filesByList=groupBy(attachmentIds,function(a){return a[0]}),fileLoadingPromises=[];return filesByList.forEach(function(fileIds,listId){fileLoadingPromises.push(_this14._loadInChunks(FileTypeRef,listId,fileIds.map(function(f){return f[1]})))}),Promise.all(fileLoadingPromises).then(function(filesResults){return flat(filesResults)})}},{key:"_loadInChunks",value:function(typeRef,listId,ids){var _this15=this,byChunk=splitInChunks(20,ids);return Promise.map(byChunk,function(chunk){return chunk.length>0?_this15._entity.loadMultipleEntities(typeRef,listId,chunk):Promise.resolve([])},{concurrency:2}).then(function(entityResults){return flat(entityResults)})}}]),IndexLoader}()}}}),System.register("src/api/worker/search/DbFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../common/error/DbError","../../common/utils/LazyLoaded","../../common/error/IndexingNotSupportedError","../../common/error/QuotaExceededError"],function(_export,_context){"use strict";var _classCallCheck,_createClass,DbError,LazyLoaded,IndexingNotSupportedError,QuotaExceededError,SearchIndexOS,SearchIndexMetaDataOS,ElementDataOS,MetaDataOS,GroupDataOS,SearchTermSuggestionsOS,osName,SearchIndexWordsIndex,indexName,DB_VERSION,DbFacade,IndexedDbTransaction;function extractErrorProperties(e){var requestErrorEntries={};for(var _key in e)requestErrorEntries[_key]=e[_key];return JSON.stringify(requestErrorEntries)}return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonErrorDbError){DbError=_commonErrorDbError.DbError},function(_commonUtilsLazyLoaded){LazyLoaded=_commonUtilsLazyLoaded.LazyLoaded},function(_commonErrorIndexingNotSupportedError){IndexingNotSupportedError=_commonErrorIndexingNotSupportedError.IndexingNotSupportedError},function(_commonErrorQuotaExceededError){QuotaExceededError=_commonErrorQuotaExceededError.QuotaExceededError}],execute:function(){_export("SearchIndexOS",SearchIndexOS="SearchIndex"),_export("SearchIndexOS",SearchIndexOS),_export("SearchIndexMetaDataOS",SearchIndexMetaDataOS="SearchIndexMeta"),_export("SearchIndexMetaDataOS",SearchIndexMetaDataOS),_export("ElementDataOS",ElementDataOS="ElementData"),_export("ElementDataOS",ElementDataOS),_export("MetaDataOS",MetaDataOS="MetaData"),_export("MetaDataOS",MetaDataOS),_export("GroupDataOS",GroupDataOS="GroupMetaData"),_export("GroupDataOS",GroupDataOS),_export("SearchTermSuggestionsOS",SearchTermSuggestionsOS="SearchTermSuggestions"),_export("SearchTermSuggestionsOS",SearchTermSuggestionsOS),_export("osName",osName=function(objectStoreName){return objectStoreName}),_export("osName",osName),_export("SearchIndexWordsIndex",SearchIndexWordsIndex="SearchIndexWords"),_export("SearchIndexWordsIndex",SearchIndexWordsIndex),_export("indexName",indexName=function(_indexName){return _indexName}),_export("indexName",indexName),DB_VERSION=3,_export("DbFacade",DbFacade=function(){function DbFacade(supported,onupgrade){var _this=this;_classCallCheck(this,DbFacade),this._activeTransactions=0,this.indexingSupported=supported,this._db=new LazyLoaded(function(){return _this.indexingSupported?Promise.fromCallback(function(callback){var DBOpenRequest=void 0;try{(DBOpenRequest=indexedDB.open(_this._id,DB_VERSION)).onerror=function(event){var requestErrorEntries=extractErrorProperties(DBOpenRequest.error),eventProperties=extractErrorProperties(event);_this.indexingSupported=!1;var message="DbFacade.open.onerror: "+_this._id+"\nrequest.error: "+requestErrorEntries+"\nevent: "+eventProperties+"\nevent.target.error: "+(event.target?event.target.error:"[none]");event.target&&event.target.error&&"QuotaExceededError"===event.target.error.name?(console.log("Storage Quota is exceeded"),callback(new QuotaExceededError(message,DBOpenRequest.error||event.target.error))):callback(new IndexingNotSupportedError(message,DBOpenRequest.error||event.target.error))},DBOpenRequest.onupgradeneeded=function(event){var db=event.target.result;event.oldVersion!==DB_VERSION&&0!==event.oldVersion&&(onupgrade&&onupgrade(),_this._deleteObjectStores(db,SearchIndexOS,ElementDataOS,MetaDataOS,GroupDataOS,SearchTermSuggestionsOS,SearchIndexMetaDataOS));try{db.createObjectStore(SearchIndexOS,{autoIncrement:!0});var metaOS=db.createObjectStore(SearchIndexMetaDataOS,{autoIncrement:!0,keyPath:"id"});db.createObjectStore(ElementDataOS),db.createObjectStore(MetaDataOS),db.createObjectStore(GroupDataOS),db.createObjectStore(SearchTermSuggestionsOS),metaOS.createIndex(SearchIndexWordsIndex,"word",{unique:!0})}catch(e){callback(new DbError("could not create object store searchindex",e))}},DBOpenRequest.onsuccess=function(event){DBOpenRequest.result.onabort=function(event){return console.log("db aborted",event)},DBOpenRequest.result.onclose=function(event){console.log("db closed",event),_this._db.reset()},DBOpenRequest.result.onerror=function(event){return console.log("db error",event)},callback(null,DBOpenRequest.result)}}catch(e){_this.indexingSupported=!1,callback(new IndexingNotSupportedError("exception when accessing indexeddb "+_this._id,e))}}):Promise.reject(new IndexingNotSupportedError("indexedDB not supported"))})}return _createClass(DbFacade,[{key:"_deleteObjectStores",value:function(db){for(var _len=arguments.length,oss=Array(_len>1?_len-1:0),_key2=1;_key2<_len;_key2++)oss[_key2-1]=arguments[_key2];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=oss[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var os=_step.value;try{db.deleteObjectStore(os)}catch(e){console.log("Error while deleting old os",os,"ignoring",e)}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"open",value:function(id){return this._id=id,this._db.getAsync().return()}},{key:"deleteDatabase",value:function(){var _this2=this;return this._db.isLoaded()?this._activeTransactions>0?Promise.delay(150).then(function(){return _this2.deleteDatabase()}):(this._db.getLoaded().close(),Promise.fromCallback(function(cb){var deleteRequest=indexedDB.deleteDatabase(_this2._db.getLoaded().name);deleteRequest.onerror=function(event){cb(new DbError("could not delete database "+_this2._db.getLoaded().name,event))},deleteRequest.onsuccess=function(event){_this2._db.reset(),cb()}})):Promise.resolve()}},{key:"createTransaction",value:function(readOnly,objectStores){var _this3=this;return this._db.getAsync().then(function(db){try{var idbTransaction=db.transaction(objectStores,readOnly?"readonly":"readwrite"),transaction=new IndexedDbTransaction(idbTransaction,function(){_this3.indexingSupported=!1,_this3._db.reset()});return _this3._activeTransactions++,transaction.wait().finally(function(){_this3._activeTransactions--}),transaction}catch(e){throw new DbError("could not create transaction",e)}})}}]),DbFacade}()),_export("DbFacade",DbFacade),_export("IndexedDbTransaction",IndexedDbTransaction=function(){function IndexedDbTransaction(transaction,onUnknownError){var _this4=this;_classCallCheck(this,IndexedDbTransaction),this._transaction=transaction,this._onUnknownError=onUnknownError,this._promise=Promise.fromCallback(function(callback){transaction.onerror=function(event){_this4._promise.isPending()?_this4._handleDbError(event,_this4._transaction,"transaction.onerror",function(e){callback(e)}):console.log("ignore error of aborted/fullfilled transaction",event)},transaction.oncomplete=function(event){callback()},transaction.onabort=function(event){event.stopPropagation(),callback()}})}return _createClass(IndexedDbTransaction,[{key:"getAll",value:function(objectStore){var _this5=this;return Promise.fromCallback(function(callback){try{var keys=[],request=_this5._transaction.objectStore(objectStore).openCursor();request.onerror=function(event){_this5._handleDbError(event,request,"getAll().onError "+objectStore,callback)},request.onsuccess=function(event){var cursor=request.result;cursor?(keys.push({key:cursor.key,value:cursor.value}),cursor.continue()):callback(null,keys)}}catch(e){_this5._handleDbError(e,null,"getAll().catch",callback)}})}},{key:"get",value:function(objectStore,key,indexName){var _this6=this;return Promise.fromCallback(function(callback){try{var os=_this6._transaction.objectStore(objectStore),request=void 0;(request=indexName?os.index(indexName).get(key):os.get(key)).onerror=function(event){_this6._handleDbError(event,request,"get().onerror "+objectStore,callback)},request.onsuccess=function(event){callback(null,event.target.result)}}catch(e){_this6._handleDbError(e,null,"get().catch",callback)}})}},{key:"getAsList",value:function(objectStore,key,indexName){return this.get(objectStore,key,indexName).then(function(result){return result||[]})}},{key:"put",value:function(objectStore,key,value){var _this7=this;return Promise.fromCallback(function(callback){try{var request=key?_this7._transaction.objectStore(objectStore).put(value,key):_this7._transaction.objectStore(objectStore).put(value);request.onerror=function(event){_this7._handleDbError(event,request,"put().onerror "+objectStore,callback)},request.onsuccess=function(event){callback(null,event.target.result)}}catch(e){_this7._handleDbError(e,null,"put().catch",callback)}})}},{key:"delete",value:function(objectStore,key){var _this8=this;return Promise.fromCallback(function(callback){try{var request=_this8._transaction.objectStore(objectStore).delete(key);request.onerror=function(event){_this8._handleDbError(event,request,"delete().onerror "+objectStore,callback)},request.onsuccess=function(event){callback()}}catch(e){_this8._handleDbError(e,null,".delete().catch "+objectStore,callback)}})}},{key:"abort",value:function(){this.aborted=!0,this._transaction.abort()}},{key:"wait",value:function(){return this._promise}},{key:"_handleDbError",value:function(event,customTarget,prefix,callback){var errorEntries=extractErrorProperties(event),eventTargetEntries=event.target?extractErrorProperties(event.target):"<null>",eventTargetErrorEntries=event.target&&event.target.error?extractErrorProperties(event.target.error):"<null>",customTargetEntries=customTarget?extractErrorProperties(customTarget):"<null>",customTargetErrorEntries=customTarget&&customTarget.error?extractErrorProperties(customTarget.error):"<null>",msg="IndexedDbTransaction "+prefix+"\nOSes: "+JSON.stringify(this._transaction.objectStoreNames)+"\nevent:"+errorEntries+"\ntransaction.error: "+(this._transaction.error?this._transaction.error.message:"<null>")+"\nevent.target: "+eventTargetEntries+"\nevent.target.error: "+eventTargetErrorEntries+"\ncustom.target: "+customTargetEntries+"\ncustom.target.error: "+customTargetErrorEntries;if("function"==typeof event.stopPropagation&&event.stopPropagation(),customTarget&&customTarget.error&&("UnknownError"===customTarget.error.name||"string"==typeof customTarget.error.message&&customTarget.error.message.includes("UnknownError")))this._onUnknownError(customTarget.error),callback(new IndexingNotSupportedError(msg,this._transaction.error));else{var _e=this._transaction.error||(customTarget?customTarget.error:null);_e&&_e.name&&"QuotaExceededError"===_e.name?(console.warn("Storage Quota exceeded"),callback(new QuotaExceededError(msg,_e))):callback(new DbError(msg,_e))}}}]),IndexedDbTransaction}()),_export("IndexedDbTransaction",IndexedDbTransaction)}}}),System.register("src/api/worker/search/SuggestionFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./DbFacade","../crypto/Aes","../../common/utils/Encoding","../crypto/Randomizer","../../common/EntityFunctions"],function(_export,_context){"use strict";var _classCallCheck,_createClass,SearchTermSuggestionsOS,aes256Decrypt,aes256Encrypt,IV_BYTE_LENGTH,utf8Uint8ArrayToString,stringToUtf8Uint8Array,random,SuggestionFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_DbFacade){SearchTermSuggestionsOS=_DbFacade.SearchTermSuggestionsOS},function(_cryptoAes){aes256Decrypt=_cryptoAes.aes256Decrypt,aes256Encrypt=_cryptoAes.aes256Encrypt,IV_BYTE_LENGTH=_cryptoAes.IV_BYTE_LENGTH},function(_commonUtilsEncoding){utf8Uint8ArrayToString=_commonUtilsEncoding.utf8Uint8ArrayToString,stringToUtf8Uint8Array=_commonUtilsEncoding.stringToUtf8Uint8Array},function(_cryptoRandomizer){random=_cryptoRandomizer.random},function(_commonEntityFunctions){_commonEntityFunctions.TypeRef}],execute:function(){_export("SuggestionFacade",SuggestionFacade=function(){function SuggestionFacade(type,db){_classCallCheck(this,SuggestionFacade),this.type=type,this._db=db,this._suggestions={}}return _createClass(SuggestionFacade,[{key:"load",value:function(){var _this=this;return this._db.initialized.then(function(){return _this._db.dbFacade.createTransaction(!0,[SearchTermSuggestionsOS]).then(function(t){return t.get(SearchTermSuggestionsOS,_this.type.type.toLowerCase()).then(function(encSuggestions){_this._suggestions=encSuggestions?JSON.parse(utf8Uint8ArrayToString(aes256Decrypt(_this._db.key,encSuggestions,!0,!1))):{}})})})}},{key:"addSuggestions",value:function(words){var _this2=this;words.forEach(function(word){if(word.length>0){var _key=word.charAt(0);if(_this2._suggestions[_key]){var existingValues=_this2._suggestions[_key];if(-1===existingValues.indexOf(word)){var insertIndex=existingValues.findIndex(function(v){return word<v});-1===insertIndex?existingValues.push(word):existingValues.splice(insertIndex,0,word)}}else _this2._suggestions[_key]=[word]}})}},{key:"getSuggestions",value:function(word){if(word.length>0){var _key2=word.charAt(0),result=this._suggestions[_key2];return result?result.filter(function(r){return r.startsWith(word)}):[]}return[]}},{key:"store",value:function(){var _this3=this;return this._db.initialized.then(function(){return _this3._db.dbFacade.createTransaction(!1,[SearchTermSuggestionsOS]).then(function(t){var encSuggestions=aes256Encrypt(_this3._db.key,stringToUtf8Uint8Array(JSON.stringify(_this3._suggestions)),random.generateRandomData(IV_BYTE_LENGTH),!0,!1);return t.put(SearchTermSuggestionsOS,_this3.type.type.toLowerCase(),encSuggestions),t.wait()})})}}]),SuggestionFacade}()),_export("SuggestionFacade",SuggestionFacade)}}}),System.register("src/api/worker/search/SearchIndexEncoding.js",["node_modules/systemjs-plugin-babel/babel-helpers/slicedToArray.js"],function(_export,_context){"use strict";var _slicedToArray;function encodeBinaryBlock(entityData,target,offset){var lengthOfPrefix=encodeNumberBlock(entityData.length,target,offset);return target.set(entityData,offset+lengthOfPrefix),lengthOfPrefix+entityData.length}function encodeNumberBlock(value,target,offset){if(value<=127)return target[offset]=value,1;var length=numberOfBytes(value),remainingValue=value;target[offset]=128|length;for(var i=0;i<length;i++){var bytePosition=offset+length-i;remainingValue>255?(target[bytePosition]=remainingValue%256,remainingValue=Math.floor(remainingValue/256)):target[bytePosition]=remainingValue}return length+1}function decodeBinaryBlock(source,offset){var blockLength=decodeNumberBlock(source,offset),numberLength=calculateNeededSpaceForNumber(blockLength);return source.subarray(offset+numberLength,offset+numberLength+blockLength)}function decodeNumberBlock(source,offset){if(128===(128&source[offset])){for(var numberLength=127&source[offset],value=0,i=0;i<numberLength;i++)value*=256,value+=source[offset+i+1];return value}return source[offset]}function calculateNeededSpace(data){return data.reduce(function(acc,entry){var lengthOfPrefix=calculateNeededSpaceForNumber(entry.length);return acc+entry.length+lengthOfPrefix},0)}function calculateNeededSpaceForNumber(value){return value<=127?1:numberOfBytes(value)+1}function numberOfBytes(number){return Math.ceil(Math.log2(number+1)/8)}return _export("iterateBinaryBlocks",function(row,cb){for(var offset=0,iterations=0;offset<row.length;){var _block=decodeBinaryBlock(row,offset);cb(_block,offset,offset=_block.byteOffset+_block.length,iterations++)}return iterations}),_export("removeBinaryBlockRanges",function(row,ranges){for(var reducedLength=0,i=ranges.length-1;i>=0;i--){var _ranges$i=_slicedToArray(ranges[i],2),_start2=_ranges$i[0],_end=_ranges$i[1];row.copyWithin(_start2,_end),reducedLength+=_end-_start2}return row.subarray(0,row.length-reducedLength)}),_export("appendBinaryBlocks",function(source,destination){var neededSpace=calculateNeededSpace(source),target=void 0,offset=void 0;destination?(offset=destination.length,(target=new Uint8Array(destination.length+neededSpace)).set(destination)):(target=new Uint8Array(neededSpace),offset=0);for(var i=0;i<source.length;i++)offset+=encodeBinaryBlock(source[i],target,offset);return target}),_export("encodeBinaryBlock",encodeBinaryBlock),_export("encodeNumberBlock",encodeNumberBlock),_export("decodeBinaryBlock",decodeBinaryBlock),_export("decodeNumberBlock",decodeNumberBlock),_export("calculateNeededSpace",calculateNeededSpace),_export("calculateNeededSpaceForNumber",calculateNeededSpaceForNumber),_export("calculateNeededSpaceForNumbers",function(numbers){return numbers.reduce(function(acc,n){return acc+calculateNeededSpaceForNumber(n)},0)}),_export("numberOfBytes",numberOfBytes),_export("decodeNumbers",function(binaryNumbers){for(var offset=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,numbers=[];offset<binaryNumbers.length;){var number=decodeNumberBlock(binaryNumbers,offset);numbers.push(number),offset+=calculateNeededSpaceForNumber(number)}return numbers}),_export("encodeNumbers",function(numbers,target){var offset=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;numbers.forEach(function(number){offset+=encodeNumberBlock(number,target,offset)})}),{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs){_slicedToArray=_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs.default}],execute:function(){}}}),System.register("src/api/common/utils/PromiseUtils.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./Utils"],function(_export,_context){"use strict";var _classCallCheck,_createClass,downcast,all,promiseMapCompat,PromisableWrapper;function mapInCallContext(values,callback){return new PromisableWrapper(function _mapInCallContext(values,callback,index,acc){if(index>=values.length)return acc;var mappedValue=callback(values[index],index);return mappedValue instanceof Promise?mappedValue.then(function(v){return acc.push(v),_mapInCallContext(values,callback,index+1,acc)}):(acc.push(mappedValue),_mapInCallContext(values,callback,index+1,acc))}(values,callback,0,[]))}function flatWrapper(value){return value instanceof PromisableWrapper?value.value:value}return _export("mapInCallContext",mapInCallContext),{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_Utils){downcast=_Utils.downcast}],execute:function(){_export("all",all=downcast(function(){for(var _len=arguments.length,promises=Array(_len),_key=0;_key<_len;_key++)promises[_key]=arguments[_key];return Promise.all(promises)})),_export("all",all),_export("promiseMapCompat",promiseMapCompat=function(useMapInCallContext){return useMapInCallContext?mapInCallContext:function(values,callback,concurrency){return PromisableWrapper.from(Promise.map(values,callback,concurrency))}}),_export("promiseMapCompat",promiseMapCompat),_export("PromisableWrapper",PromisableWrapper=function(){function PromisableWrapper(value){_classCallCheck(this,PromisableWrapper),this.value=value instanceof Promise?value.then(flatWrapper):flatWrapper(value)}return _createClass(PromisableWrapper,null,[{key:"from",value:function(value){return new PromisableWrapper(value)}}]),_createClass(PromisableWrapper,[{key:"thenOrApply",value:function(onFulfill,onReject){if(this.value instanceof Promise)return new PromisableWrapper(this.value.then(onFulfill,onReject));try{return new PromisableWrapper(onFulfill(this.value))}catch(e){if(onReject)return new PromisableWrapper<R>onReject(e);throw e}}},{key:"toPromise",value:function(){return Promise.resolve(this.value)}}]),PromisableWrapper}()),_export("PromisableWrapper",PromisableWrapper)}}}),System.register("src/api/worker/search/SearchFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/slicedToArray.js","node_modules/systemjs-plugin-babel/babel-helpers/toConsumableArray.js","node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../entities/tutanota/Mail","./DbFacade","../../common/EntityFunctions","./Tokenizer","../../common/utils/ArrayUtils","../../common/utils/Utils","./IndexUtils","../../common/TutanotaConstants","../../common/utils/Encoding","./MailIndexer","../facades/LoginFacade","./SuggestionFacade","../EntityWorker","../../common/EntityConstants","../../common/error/RestError","./SearchIndexEncoding","../../common/utils/DateUtils","../../common/utils/PromiseUtils"],function(_export,_context){"use strict";var _slicedToArray,_toConsumableArray,_classCallCheck,_createClass,MailTypeRef,ElementDataOS,SearchIndexMetaDataOS,SearchIndexOS,SearchIndexWordsIndex,compareNewestFirst,firstBiggerThanSecond,isSameTypeRef,resolveTypeReference,TypeRef,tokenize,arrayHash,contains,flat,asyncFind,defer,downcast,neverNull,decryptMetaData,decryptSearchIndexEntry,encryptIndexKeyBase64,getIdFromEncSearchIndexEntry,getPerformanceTimestamp,markEnd,markStart,printMeasure,typeRefToTypeInfo,FULL_INDEXED_TIMESTAMP,NOTHING_INDEXED_TIMESTAMP,timestampToGeneratedId,uint8ArrayToBase64,INITIAL_MAIL_INDEX_INTERVAL_DAYS,load,EC,NotAuthorizedError,NotFoundError,iterateBinaryBlocks,getDayShifted,getStartOfDay,promiseMapCompat,ValueType,Cardinality,AssociationType,SearchFacade;function normalizeQuery(query){return tokenize(query).join(" ")}return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs){_slicedToArray=_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs){_toConsumableArray=_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_entitiesTutanotaMail){MailTypeRef=_entitiesTutanotaMail.MailTypeRef},function(_DbFacade){_DbFacade.DbTransaction,ElementDataOS=_DbFacade.ElementDataOS,SearchIndexMetaDataOS=_DbFacade.SearchIndexMetaDataOS,SearchIndexOS=_DbFacade.SearchIndexOS,SearchIndexWordsIndex=_DbFacade.SearchIndexWordsIndex},function(_commonEntityFunctions){compareNewestFirst=_commonEntityFunctions.compareNewestFirst,firstBiggerThanSecond=_commonEntityFunctions.firstBiggerThanSecond,isSameTypeRef=_commonEntityFunctions.isSameTypeRef,resolveTypeReference=_commonEntityFunctions.resolveTypeReference,TypeRef=_commonEntityFunctions.TypeRef},function(_Tokenizer){tokenize=_Tokenizer.tokenize},function(_commonUtilsArrayUtils){arrayHash=_commonUtilsArrayUtils.arrayHash,contains=_commonUtilsArrayUtils.contains,flat=_commonUtilsArrayUtils.flat},function(_commonUtilsUtils){asyncFind=_commonUtilsUtils.asyncFind,defer=_commonUtilsUtils.defer,downcast=_commonUtilsUtils.downcast,neverNull=_commonUtilsUtils.neverNull},function(_IndexUtils){decryptMetaData=_IndexUtils.decryptMetaData,decryptSearchIndexEntry=_IndexUtils.decryptSearchIndexEntry,encryptIndexKeyBase64=_IndexUtils.encryptIndexKeyBase64,getIdFromEncSearchIndexEntry=_IndexUtils.getIdFromEncSearchIndexEntry,getPerformanceTimestamp=_IndexUtils.getPerformanceTimestamp,markEnd=_IndexUtils.markEnd,markStart=_IndexUtils.markStart,printMeasure=_IndexUtils.printMeasure,typeRefToTypeInfo=_IndexUtils.typeRefToTypeInfo},function(_commonTutanotaConstants){FULL_INDEXED_TIMESTAMP=_commonTutanotaConstants.FULL_INDEXED_TIMESTAMP,NOTHING_INDEXED_TIMESTAMP=_commonTutanotaConstants.NOTHING_INDEXED_TIMESTAMP},function(_commonUtilsEncoding){timestampToGeneratedId=_commonUtilsEncoding.timestampToGeneratedId,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64},function(_MailIndexer){INITIAL_MAIL_INDEX_INTERVAL_DAYS=_MailIndexer.INITIAL_MAIL_INDEX_INTERVAL_DAYS,_MailIndexer.MailIndexer},function(_facadesLoginFacade){_facadesLoginFacade.LoginFacade},function(_SuggestionFacade){_SuggestionFacade.SuggestionFacade},function(_EntityWorker){load=_EntityWorker.load},function(_commonEntityConstants){EC=_commonEntityConstants.default},function(_commonErrorRestError){NotAuthorizedError=_commonErrorRestError.NotAuthorizedError,NotFoundError=_commonErrorRestError.NotFoundError},function(_SearchIndexEncoding){iterateBinaryBlocks=_SearchIndexEncoding.iterateBinaryBlocks},function(_commonUtilsDateUtils){getDayShifted=_commonUtilsDateUtils.getDayShifted,getStartOfDay=_commonUtilsDateUtils.getStartOfDay},function(_commonUtilsPromiseUtils){promiseMapCompat=_commonUtilsPromiseUtils.promiseMapCompat}],execute:function(){ValueType=EC.ValueType,Cardinality=EC.Cardinality,AssociationType=EC.AssociationType,_export("SearchFacade",SearchFacade=function(){function SearchFacade(loginFacade,db,mailIndexer,suggestionFacades,browserData){_classCallCheck(this,SearchFacade),this._loginFacade=loginFacade,this._db=db,this._mailIndexer=mailIndexer,this._suggestionFacades=suggestionFacades,this._promiseMapCompat=promiseMapCompat(browserData.needsMicrotaskHack)}return _createClass(SearchFacade,[{key:"search",value:function(query,restriction,minSuggestionCount,maxResults){var _this=this;return this._db.initialized.then(function(){var searchTokens=tokenize(query),result={query:query,restriction:restriction,results:[],currentIndexTimestamp:_this._getSearchEndTimestamp(restriction),moreResultsEntries:[],lastReadSearchIndexRow:searchTokens.map(function(token){return[token,null]}),matchWordOrder:searchTokens.length>1&&query.startsWith('"')&&query.endsWith('"'),moreResults:[]};if(searchTokens.length>0){var isFirstWordSearch=1===searchTokens.length,suggestionFacade=(getPerformanceTimestamp(),_this._suggestionFacades.find(function(f){return isSameTypeRef(f.type,restriction.type)})),searchPromise=void 0;if(minSuggestionCount>0&&isFirstWordSearch&&suggestionFacade){getPerformanceTimestamp();searchPromise=_this._addSuggestions(searchTokens[0],suggestionFacade,minSuggestionCount,result).then(function(){if(result.results.length<minSuggestionCount){getPerformanceTimestamp();return _this._startOrContinueSearch(result).then(function(result){return result})}})}else if(minSuggestionCount>0&&!isFirstWordSearch&&suggestionFacade){var suggestionToken=neverNull(result.lastReadSearchIndexRow.pop())[0];searchPromise=_this._startOrContinueSearch(result).then(function(){return result.results.sort(compareNewestFirst),_this._loadAndReduce(restriction,result,suggestionToken,minSuggestionCount)})}else searchPromise=_this._startOrContinueSearch(result,maxResults);return searchPromise.then(function(){return result.results.sort(compareNewestFirst),result})}return Promise.resolve(result)})}},{key:"_loadAndReduce",value:function(restriction,result,suggestionToken,minSuggestionCount){var _this2=this;return result.results.length>0?resolveTypeReference(restriction.type).then(function(model){var suggestionQuery=result.matchWordOrder?normalizeQuery(result.query):suggestionToken;return Promise.reduce(result.results,function(finalResults,id){return finalResults.length>=minSuggestionCount?finalResults:load(restriction.type,id).then(function(entity){return _this2._containsSuggestionToken(entity,model,restriction.attributeIds,suggestionQuery,result.matchWordOrder).then(function(found){return found&&finalResults.push(id),finalResults})}).catch(NotFoundError,function(e){return finalResults}).catch(NotAuthorizedError,function(e){return finalResults})},[]).then(function(reducedResults){result.results=reducedResults})}):Promise.resolve()}},{key:"_containsSuggestionToken",value:function(entity,model,attributeIds,suggestionToken,matchWordOrder){var _this3=this,attributeNames=void 0;return attributeNames=attributeIds?attributeIds.map(function(id){return neverNull(Object.keys(model.values).find(function(valueName){return model.values[valueName].id===id})||Object.keys(model.associations).find(function(associationName){return model.associations[associationName].id===id}))}):Object.keys(model.values).concat(Object.keys(model.associations)),asyncFind(attributeNames,function(attributeName){if(model.values[attributeName]&&model.values[attributeName].type===ValueType.String&&entity[attributeName]){if(matchWordOrder)return Promise.resolve(-1!==normalizeQuery(entity[attributeName]).indexOf(suggestionToken));var words=tokenize(entity[attributeName]);return Promise.resolve(null!=words.find(function(w){return w.startsWith(suggestionToken)}))}if(model.associations[attributeName]&&model.associations[attributeName].type===AssociationType.Aggregation&&entity[attributeName]){var aggregates=model.associations[attributeName].cardinality===Cardinality.Any?entity[attributeName]:[entity[attributeName]];return resolveTypeReference(new TypeRef(model.app,model.associations[attributeName].refType)).then(function(refModel){return asyncFind(aggregates,function(aggregate){return _this3._containsSuggestionToken(aggregate,refModel,null,suggestionToken,matchWordOrder)}).then(function(found){return null!=found})})}return Promise.resolve(!1)}).then(function(found){return null!=found})}},{key:"_startOrContinueSearch",value:function(searchResult,maxResults){var _this4=this;markStart("findIndexEntries"),0===searchResult.moreResults.length&&getStartOfDay(getDayShifted(new Date(this._mailIndexer.currentIndexTimestamp),INITIAL_MAIL_INDEX_INTERVAL_DAYS)).getTime()>getStartOfDay(getDayShifted(new Date,1))&&this._mailIndexer.mailboxIndexingPromise.isFulfilled()&&this._mailIndexer.extendIndexIfNeeded(this._loginFacade.getLoggedInUser(),getStartOfDay(getDayShifted(new Date,-INITIAL_MAIL_INDEX_INTERVAL_DAYS)));return(maxResults&&searchResult.moreResults.length>=maxResults?Promise.resolve(searchResult.moreResults):this._findIndexEntries(searchResult,maxResults).then(function(keyToEncryptedIndexEntries){return markEnd("findIndexEntries"),markStart("_filterByEncryptedId"),_this4._filterByEncryptedId(keyToEncryptedIndexEntries)}).then(function(keyToEncryptedIndexEntries){return markEnd("_filterByEncryptedId"),markStart("_decryptSearchResult"),_this4._decryptSearchResult(keyToEncryptedIndexEntries)}).then(function(keyToIndexEntries){return markEnd("_decryptSearchResult"),markStart("_filterByTypeAndAttributeAndTime"),_this4._filterByTypeAndAttributeAndTime(keyToIndexEntries,searchResult.restriction)}).then(function(keyToIndexEntries){return markEnd("_filterByTypeAndAttributeAndTime"),markStart("_reduceWords"),_this4._reduceWords(keyToIndexEntries,searchResult.matchWordOrder)}).then(function(searchIndexEntries){return markEnd("_reduceWords"),markStart("_reduceToUniqueElementIds"),_this4._reduceToUniqueElementIds(searchIndexEntries,searchResult)}).then(function(additionalEntries){return markEnd("_reduceToUniqueElementIds"),additionalEntries.concat(searchResult.moreResults)})).then(function(searchIndexEntries){return markStart("_filterByListIdAndGroupSearchResults"),_this4._filterByListIdAndGroupSearchResults(searchIndexEntries,searchResult,maxResults)}).then(function(result){return markEnd("_filterByListIdAndGroupSearchResults"),"undefined"!=typeof self&&printMeasure("query: "+searchResult.query+", maxResults: "+String(maxResults),["findIndexEntries","_filterByEncryptedId","_decryptSearchResult","_filterByTypeAndAttributeAndTime","_reduceWords","_reduceToUniqueElementIds","_filterByListIdAndGroupSearchResults"]),result})}},{key:"_addSuggestions",value:function(searchToken,suggestionFacade,minSuggestionCount,searchResult){var _this5=this,suggestions=suggestionFacade.getSuggestions(searchToken);return Promise.map(suggestions,function(suggestion){if(searchResult.results.length<minSuggestionCount){var suggestionResult={query:suggestion,restriction:searchResult.restriction,results:[],currentIndexTimestamp:searchResult.currentIndexTimestamp,moreResultsEntries:[],lastReadSearchIndexRow:[[suggestion,null]],matchWordOrder:!1,moreResults:[]};return _this5._startOrContinueSearch(suggestionResult).then(function(){var _searchResult$results;(_searchResult$results=searchResult.results).push.apply(_searchResult$results,_toConsumableArray(suggestionResult.results))})}},{concurrency:1})}},{key:"_findIndexEntries",value:function(searchResult,maxResults){var _this6=this,typeInfo=typeRefToTypeInfo(searchResult.restriction.type),firstSearchTokenInfo=searchResult.lastReadSearchIndexRow[0];return this._db.dbFacade.createTransaction(!0,[SearchIndexOS,SearchIndexMetaDataOS]).then(function(transaction){return _this6._promiseMapCompat(searchResult.lastReadSearchIndexRow,function(tokenInfo,index){var searchToken=_slicedToArray(tokenInfo,1)[0],indexKey=encryptIndexKeyBase64(_this6._db.key,searchToken,_this6._db.iv);return transaction.get(SearchIndexMetaDataOS,indexKey,SearchIndexWordsIndex).then(function(metaData){return metaData?decryptMetaData(_this6._db.key,metaData):(tokenInfo[1]=0,{id:-index,word:indexKey,rows:[]})})}).thenOrApply(function(metaRows){var rowsToReadForIndexKeys=_this6._findRowsToReadFromMetaData(firstSearchTokenInfo,metaRows,typeInfo,maxResults);return _this6._promiseMapCompat(rowsToReadForIndexKeys,function(rowsToRead){return _this6._promiseMapCompat(rowsToRead.rows,function(entry){return _this6._findEntriesForMetadata(transaction,entry)}).thenOrApply(flat).thenOrApply(function(indexEntries){return indexEntries.map(function(entry){return{encEntry:entry,idHash:arrayHash(getIdFromEncSearchIndexEntry(entry))}})}).thenOrApply(function(indexEntries){return{indexKey:rowsToRead.indexKey,indexEntries:indexEntries}}).value}).value}).toPromise()})}},{key:"_findRowsToReadFromMetaData",value:function(firstTokenInfo,safeMetaDataRows,typeInfo,maxResults){var _this7=this,leadingRow=safeMetaDataRows[0],otherRows=safeMetaDataRows.slice(1),rangeForLeadingRow=this._findRowsToRead(leadingRow,typeInfo,firstTokenInfo[1]||Number.MAX_SAFE_INTEGER,maxResults),rowsForLeadingRow=[{indexKey:leadingRow.word,rows:rangeForLeadingRow.metaEntries}];firstTokenInfo[1]=rangeForLeadingRow.oldestTimestamp;var rowsForOtherRows=otherRows.map(function(r){return{indexKey:r.word,rows:_this7._findRowsToReadByTimeRange(r,typeInfo,rangeForLeadingRow.newestRowTimestamp,rangeForLeadingRow.oldestTimestamp)}});return rowsForLeadingRow.concat(rowsForOtherRows)}},{key:"_findEntriesForMetadata",value:function(transaction,entry){return transaction.get(SearchIndexOS,entry.key).then(function(indexEntriesRow){if(!indexEntriesRow)return[];var result=new Array(entry.size);return iterateBinaryBlocks(indexEntriesRow,function(block,s,e,iteration){result[iteration]=block}),result})}},{key:"_findRowsToReadByTimeRange",value:function(metaData,typeInfo,fromNewestTimestamp,toOldestTimestamp){var filteredRows=metaData.rows.filter(function(r){return r.app===typeInfo.appId&&r.type===typeInfo.typeId});filteredRows.reverse();var passedRows=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=filteredRows[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var row=_step.value;if(row.oldestElementTimestamp<fromNewestTimestamp&&(passedRows.push(row),row.oldestElementTimestamp<=toOldestTimestamp))break}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return passedRows}},{key:"_findRowsToRead",value:function(metaData,typeInfo,mustBeOlderThan,maxResults){var filteredRows=metaData.rows.filter(function(r){return r.app===typeInfo.appId&&r.type===typeInfo.typeId});filteredRows.reverse();var entitiesToRead=0,lastReadRowTimestamp=0,newestRowTimestamp=Number.MAX_SAFE_INTEGER,rowsToRead=void 0;if(maxResults){rowsToRead=[];var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=filteredRows[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var r=_step2.value;if(r.oldestElementTimestamp<mustBeOlderThan){if(!(entitiesToRead<1e3))break;entitiesToRead+=r.size,lastReadRowTimestamp=r.oldestElementTimestamp,rowsToRead.push(r)}else newestRowTimestamp=r.oldestElementTimestamp}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}else rowsToRead=filteredRows;return{metaEntries:rowsToRead,oldestTimestamp:lastReadRowTimestamp,newestRowTimestamp:newestRowTimestamp}}},{key:"_filterByEncryptedId",value:function(results){var matchingEncIds=void 0;return results.forEach(function(keyToEncryptedIndexEntry){if(null==matchingEncIds)matchingEncIds=new Set(keyToEncryptedIndexEntry.indexEntries.map(function(entry){return entry.idHash}));else{var filtered=new Set;keyToEncryptedIndexEntry.indexEntries.forEach(function(indexEntry){matchingEncIds.has(indexEntry.idHash)&&filtered.add(indexEntry.idHash)}),matchingEncIds=filtered}}),results.map(function(r){return{indexKey:r.indexKey,indexEntries:r.indexEntries.filter(function(entry){return matchingEncIds.has(entry.idHash)})}})}},{key:"_decryptSearchResult",value:function(results){var _this8=this;return results.map(function(searchResult){return{indexKey:searchResult.indexKey,indexEntries:searchResult.indexEntries.map(function(entry){return decryptSearchIndexEntry(_this8._db.key,entry.encEntry,_this8._db.iv)})}})}},{key:"_filterByTypeAndAttributeAndTime",value:function(results,restriction){var _this9=this,endTimestamp=this._getSearchEndTimestamp(restriction),minIncludedId=timestampToGeneratedId(endTimestamp),maxExcludedId=restriction.start?timestampToGeneratedId(restriction.start+1):null;results.forEach(function(result){result.indexEntries=result.indexEntries.filter(function(entry){return _this9._isValidAttributeAndTime(restriction,entry,minIncludedId,maxExcludedId)})});var matchingIds=void 0;return results.forEach(function(keyToIndexEntry){if(matchingIds){var filtered=new Set;keyToIndexEntry.indexEntries.forEach(function(entry){matchingIds.has(entry.id)&&filtered.add(entry.id)}),matchingIds=filtered}else matchingIds=new Set(keyToIndexEntry.indexEntries.map(function(entry){return entry.id}))}),results.map(function(r){return{indexKey:r.indexKey,indexEntries:r.indexEntries.filter(function(entry){return matchingIds.has(entry.id)})}})}},{key:"_isValidAttributeAndTime",value:function(restriction,entry,minIncludedId,maxExcludedId){return!(restriction.attributeIds&&!contains(restriction.attributeIds,entry.attribute))&&(!(maxExcludedId&&!firstBiggerThanSecond(maxExcludedId,entry.id))&&!firstBiggerThanSecond(minIncludedId,entry.id))}},{key:"_reduceWords",value:function(results,matchWordOrder){return matchWordOrder?results[0].indexEntries.filter(function(firstWordEntry){for(var filteredPositions=firstWordEntry.positions.slice(),_loop=function(i){var entry=results[i].indexEntries.find(function(e){return e.id===firstWordEntry.id&&e.attribute===firstWordEntry.attribute});filteredPositions=entry?filteredPositions.filter(function(firstWordPosition){return neverNull(entry).positions.find(function(position){return position===firstWordPosition+i})}):[]},i=1;i<results.length;i++)_loop(i);return filteredPositions.length>0}):results[0].indexEntries}},{key:"_reduceToUniqueElementIds",value:function(results,previousResult){var uniqueIds={};return results.filter(function(entry){return!uniqueIds[entry.id]&&!previousResult.results.find(function(r){return r[1]===entry.id})&&(uniqueIds[entry.id]=!0,!0)})}},{key:"_filterByListIdAndGroupSearchResults",value:function(indexEntries,searchResult,maxResults){indexEntries.sort(function(l,r){return compareNewestFirst(l.id,r.id)});var _defer=defer(),entriesCopy=(_defer.resolve,_defer.promise,downcast(indexEntries.slice()));return this._db.dbFacade.createTransaction(!0,[ElementDataOS]).then(function(transaction){return Promise.map(indexEntries.slice(0,maxResults||indexEntries.length+1),function(entry,index){return transaction.get(ElementDataOS,uint8ArrayToBase64(entry.encId)).then(function(elementData){return entriesCopy[index]=null,!elementData||searchResult.restriction.listId&&searchResult.restriction.listId!==elementData[0]?null:[elementData[0],entry.id]})},{concurrency:5})}).then(function(newResults){var _searchResult$results2;(_searchResult$results2=searchResult.results).push.apply(_searchResult$results2,_toConsumableArray(newResults.filter(Boolean))),searchResult.moreResults=entriesCopy.filter(Boolean)})}},{key:"getMoreSearchResults",value:function(searchResult,moreResultCount){return this._startOrContinueSearch(searchResult,moreResultCount)}},{key:"_getSearchEndTimestamp",value:function(restriction){return restriction.end?restriction.end:isSameTypeRef(MailTypeRef,restriction.type)?this._mailIndexer.currentIndexTimestamp===NOTHING_INDEXED_TIMESTAMP?Date.now():this._mailIndexer.currentIndexTimestamp:FULL_INDEXED_TIMESTAMP}}]),SearchFacade}()),_export("SearchFacade",SearchFacade)}}}),System.register("src/api/entities/sys/PriceServiceData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PriceServiceDataTypeRef,_TypeModel;return _export("createPriceServiceData",function(values){return Object.assign(create(_TypeModel,PriceServiceDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PriceServiceDataTypeRef",PriceServiceDataTypeRef=new TypeRef("sys","PriceServiceData")),_export("PriceServiceDataTypeRef",PriceServiceDataTypeRef),_export("_TypeModel",_TypeModel={name:"PriceServiceData",since:9,type:"DATA_TRANSFER_TYPE",id:843,rootId:"A3N5cwADSw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:844,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},campaign:{name:"campaign",id:1455,since:38,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},date:{name:"date",id:846,since:9,type:"Date",cardinality:"ZeroOrOne",final:!1,encrypted:!1}},associations:{priceRequest:{name:"priceRequest",id:845,since:9,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"PriceRequestData",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PriceRequestData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PriceRequestDataTypeRef,_TypeModel;return _export("createPriceRequestData",function(values){return Object.assign(create(_TypeModel,PriceRequestDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PriceRequestDataTypeRef",PriceRequestDataTypeRef=new TypeRef("sys","PriceRequestData")),_export("PriceRequestDataTypeRef",PriceRequestDataTypeRef),_export("_TypeModel",_TypeModel={name:"PriceRequestData",since:9,type:"AGGREGATED_TYPE",id:836,rootId:"A3N5cwADRA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:837,since:9,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},accountType:{name:"accountType",id:842,since:9,type:"Number",cardinality:"ZeroOrOne",final:!1,encrypted:!1},business:{name:"business",id:840,since:9,type:"Boolean",cardinality:"ZeroOrOne",final:!1,encrypted:!1},count:{name:"count",id:839,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},featureType:{name:"featureType",id:838,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},paymentInterval:{name:"paymentInterval",id:841,since:9,type:"Number",cardinality:"ZeroOrOne",final:!1,encrypted:!1},reactivate:{name:"reactivate",id:1285,since:26,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PriceServiceReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PriceServiceReturnTypeRef,_TypeModel;return _export("createPriceServiceReturn",function(values){return Object.assign(create(_TypeModel,PriceServiceReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PriceServiceReturnTypeRef",PriceServiceReturnTypeRef=new TypeRef("sys","PriceServiceReturn")),_export("PriceServiceReturnTypeRef",PriceServiceReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PriceServiceReturn",since:9,type:"DATA_TRANSFER_TYPE",id:859,rootId:"A3N5cwADWw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:860,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},currentPeriodAddedPrice:{name:"currentPeriodAddedPrice",id:862,since:9,type:"Number",cardinality:"ZeroOrOne",final:!1,encrypted:!1},periodEndDate:{name:"periodEndDate",id:861,since:9,type:"Date",cardinality:"One",final:!1,encrypted:!1}},associations:{currentPriceNextPeriod:{name:"currentPriceNextPeriod",id:864,since:9,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"PriceData",final:!1},currentPriceThisPeriod:{name:"currentPriceThisPeriod",id:863,since:9,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"PriceData",final:!1},futurePriceNextPeriod:{name:"futurePriceNextPeriod",id:865,since:9,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"PriceData",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/BookingFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../common/TutanotaConstants","../../entities/sys/PriceServiceData","../../entities/sys/PriceRequestData","../EntityWorker","../../entities/sys/PriceServiceReturn","../../common/utils/Utils","../../Env","../../common/EntityFunctions","../../entities/sys/Services"],function(_export,_context){"use strict";var _classCallCheck,_createClass,Const,createPriceServiceData,createPriceRequestData,serviceRequest,PriceServiceReturnTypeRef,neverNull,assertWorkerOrNode,HttpMethod,SysService,BookingFacade,bookingFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonTutanotaConstants){Const=_commonTutanotaConstants.Const,_commonTutanotaConstants.PaymentMethodType},function(_entitiesSysPriceServiceData){createPriceServiceData=_entitiesSysPriceServiceData.createPriceServiceData},function(_entitiesSysPriceRequestData){createPriceRequestData=_entitiesSysPriceRequestData.createPriceRequestData},function(_EntityWorker){serviceRequest=_EntityWorker.serviceRequest},function(_entitiesSysPriceServiceReturn){PriceServiceReturnTypeRef=_entitiesSysPriceServiceReturn.PriceServiceReturnTypeRef},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService}],execute:function(){assertWorkerOrNode(),_export("BookingFacade",BookingFacade=function(){function BookingFacade(){_classCallCheck(this,BookingFacade)}return _createClass(BookingFacade,[{key:"getPrice",value:function(type,count,reactivate){var serviceData=createPriceServiceData();serviceData.date=Const.CURRENT_DATE;var priceRequestData=createPriceRequestData();return priceRequestData.featureType=type,priceRequestData.count=String(count),priceRequestData.reactivate=reactivate,priceRequestData.paymentInterval=null,priceRequestData.accountType=null,priceRequestData.business=null,serviceData.priceRequest=priceRequestData,serviceData.campaign=null,serviceRequest(SysService.PriceService,HttpMethod.GET,serviceData,PriceServiceReturnTypeRef)}},{key:"getCurrentPrice",value:function(){var serviceData=createPriceServiceData();return serviceRequest(SysService.PriceService,HttpMethod.GET,serviceData,PriceServiceReturnTypeRef)}},{key:"getPriceItem",value:function(priceData,featureType){return null!=priceData?neverNull(priceData).items.find(function(p){return p.featureType===featureType}):null}}]),BookingFacade}()),_export("BookingFacade",BookingFacade),_export("bookingFacade",bookingFacade=new BookingFacade),_export("bookingFacade",bookingFacade)}}}),System.register("src/api/entities/sys/CreateCustomerServerPropertiesData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateCustomerServerPropertiesDataTypeRef,_TypeModel;return _export("createCreateCustomerServerPropertiesData",function(values){return Object.assign(create(_TypeModel,CreateCustomerServerPropertiesDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateCustomerServerPropertiesDataTypeRef",CreateCustomerServerPropertiesDataTypeRef=new TypeRef("sys","CreateCustomerServerPropertiesData")),_export("CreateCustomerServerPropertiesDataTypeRef",CreateCustomerServerPropertiesDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateCustomerServerPropertiesData",since:13,type:"DATA_TRANSFER_TYPE",id:961,rootId:"A3N5cwADwQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:962,since:13,type:"Number",cardinality:"One",final:!1,encrypted:!1},adminGroupEncSessionKey:{name:"adminGroupEncSessionKey",id:963,since:13,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CreateCustomerServerPropertiesReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateCustomerServerPropertiesReturnTypeRef,_TypeModel;return _export("createCreateCustomerServerPropertiesReturn",function(values){return Object.assign(create(_TypeModel,CreateCustomerServerPropertiesReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateCustomerServerPropertiesReturnTypeRef",CreateCustomerServerPropertiesReturnTypeRef=new TypeRef("sys","CreateCustomerServerPropertiesReturn")),_export("CreateCustomerServerPropertiesReturnTypeRef",CreateCustomerServerPropertiesReturnTypeRef),_export("_TypeModel",_TypeModel={name:"CreateCustomerServerPropertiesReturn",since:13,type:"DATA_TRANSFER_TYPE",id:964,rootId:"A3N5cwADxA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:965,since:13,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{id:{name:"id",id:966,since:13,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"CustomerServerProperties",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/SystemKeysReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SystemKeysReturnTypeRef,_TypeModel;return _export("createSystemKeysReturn",function(values){return Object.assign(create(_TypeModel,SystemKeysReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SystemKeysReturnTypeRef",SystemKeysReturnTypeRef=new TypeRef("sys","SystemKeysReturn")),_export("SystemKeysReturnTypeRef",SystemKeysReturnTypeRef),_export("_TypeModel",_TypeModel={name:"SystemKeysReturn",since:1,type:"DATA_TRANSFER_TYPE",id:301,rootId:"A3N5cwABLQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:302,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},freeGroupKey:{name:"freeGroupKey",id:305,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},premiumGroupKey:{name:"premiumGroupKey",id:306,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},starterGroupKey:{name:"starterGroupKey",id:307,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},systemAdminPubKey:{name:"systemAdminPubKey",id:303,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},systemAdminPubKeyVersion:{name:"systemAdminPubKeyVersion",id:304,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{freeGroup:{name:"freeGroup",id:880,since:9,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"Group",final:!1,external:!1},premiumGroup:{name:"premiumGroup",id:881,since:9,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/CustomerAccountCreateData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CustomerAccountCreateDataTypeRef,_TypeModel;return _export("createCustomerAccountCreateData",function(values){return Object.assign(create(_TypeModel,CustomerAccountCreateDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CustomerAccountCreateDataTypeRef",CustomerAccountCreateDataTypeRef=new TypeRef("tutanota","CustomerAccountCreateData")),_export("CustomerAccountCreateDataTypeRef",CustomerAccountCreateDataTypeRef),_export("_TypeModel",_TypeModel={name:"CustomerAccountCreateData",since:16,type:"DATA_TRANSFER_TYPE",id:648,rootId:"CHR1dGFub3RhAAKI",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:649,since:16,type:"Number",cardinality:"One",final:!1,encrypted:!1},adminEncAccountingInfoSessionKey:{name:"adminEncAccountingInfoSessionKey",id:659,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},adminEncCustomerServerPropertiesSessionKey:{name:"adminEncCustomerServerPropertiesSessionKey",id:661,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},authToken:{name:"authToken",id:650,since:16,type:"String",cardinality:"One",final:!1,encrypted:!1},code:{name:"code",id:873,since:24,type:"String",cardinality:"One",final:!1,encrypted:!1},date:{name:"date",id:651,since:16,type:"Date",cardinality:"ZeroOrOne",final:!1,encrypted:!1},lang:{name:"lang",id:652,since:16,type:"String",cardinality:"One",final:!1,encrypted:!1},systemAdminPubEncAccountingInfoSessionKey:{name:"systemAdminPubEncAccountingInfoSessionKey",id:660,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncAccountGroupKey:{name:"userEncAccountGroupKey",id:655,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncAdminGroupKey:{name:"userEncAdminGroupKey",id:654,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{adminGroupData:{name:"adminGroupData",id:657,since:16,type:"AGGREGATION",cardinality:"One",refType:"InternalGroupData",final:!1},customerGroupData:{name:"customerGroupData",id:658,since:16,type:"AGGREGATION",cardinality:"One",refType:"InternalGroupData",final:!1},userData:{name:"userData",id:653,since:16,type:"AGGREGATION",cardinality:"One",refType:"UserAccountUserData",final:!1},userGroupData:{name:"userGroupData",id:656,since:16,type:"AGGREGATION",cardinality:"One",refType:"InternalGroupData",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ContactFormAccountData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ContactFormAccountDataTypeRef,_TypeModel;return _export("createContactFormAccountData",function(values){return Object.assign(create(_TypeModel,ContactFormAccountDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ContactFormAccountDataTypeRef",ContactFormAccountDataTypeRef=new TypeRef("tutanota","ContactFormAccountData")),_export("ContactFormAccountDataTypeRef",ContactFormAccountDataTypeRef),_export("_TypeModel",_TypeModel={name:"ContactFormAccountData",since:19,type:"DATA_TRANSFER_TYPE",id:791,rootId:"CHR1dGFub3RhAAMX",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:792,since:19,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{statisticFields:{name:"statisticFields",id:795,since:19,type:"AGGREGATION",cardinality:"Any",refType:"ContactFormStatisticField",final:!1},statistics:{name:"statistics",id:831,since:22,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"ContactFormStatisticEntry",final:!0},userData:{name:"userData",id:793,since:19,type:"AGGREGATION",cardinality:"One",refType:"ContactFormUserData",final:!1},userGroupData:{name:"userGroupData",id:794,since:19,type:"AGGREGATION",cardinality:"One",refType:"InternalGroupData",final:!1},contactForm:{name:"contactForm",id:796,since:19,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"ContactForm",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CustomDomainData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CustomDomainDataTypeRef,_TypeModel;return _export("createCustomDomainData",function(values){return Object.assign(create(_TypeModel,CustomDomainDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CustomDomainDataTypeRef",CustomDomainDataTypeRef=new TypeRef("sys","CustomDomainData")),_export("CustomDomainDataTypeRef",CustomDomainDataTypeRef),_export("_TypeModel",_TypeModel={name:"CustomDomainData",since:9,type:"DATA_TRANSFER_TYPE",id:735,rootId:"A3N5cwAC3w",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:736,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},domain:{name:"domain",id:737,since:9,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{catchAllMailGroup:{name:"catchAllMailGroup",id:1045,since:18,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CustomDomainReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CustomDomainReturnTypeRef,_TypeModel;return _export("createCustomDomainReturn",function(values){return Object.assign(create(_TypeModel,CustomDomainReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CustomDomainReturnTypeRef",CustomDomainReturnTypeRef=new TypeRef("sys","CustomDomainReturn")),_export("CustomDomainReturnTypeRef",CustomDomainReturnTypeRef),_export("_TypeModel",_TypeModel={name:"CustomDomainReturn",since:9,type:"DATA_TRANSFER_TYPE",id:731,rootId:"A3N5cwAC2w",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:732,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},validationResult:{name:"validationResult",id:733,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{invalidDnsRecords:{name:"invalidDnsRecords",id:734,since:9,type:"AGGREGATION",cardinality:"Any",refType:"StringWrapper",final:!0}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ContactFormAccountReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ContactFormAccountReturnTypeRef,_TypeModel;return _export("createContactFormAccountReturn",function(values){return Object.assign(create(_TypeModel,ContactFormAccountReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ContactFormAccountReturnTypeRef",ContactFormAccountReturnTypeRef=new TypeRef("tutanota","ContactFormAccountReturn")),_export("ContactFormAccountReturnTypeRef",ContactFormAccountReturnTypeRef),_export("_TypeModel",_TypeModel={name:"ContactFormAccountReturn",since:19,type:"DATA_TRANSFER_TYPE",id:750,rootId:"CHR1dGFub3RhAALu",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:751,since:19,type:"Number",cardinality:"One",final:!1,encrypted:!1},requestMailAddress:{name:"requestMailAddress",id:752,since:19,type:"String",cardinality:"One",final:!0,encrypted:!1},responseMailAddress:{name:"responseMailAddress",id:753,since:19,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/BrandingDomainDeleteData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,BrandingDomainDeleteDataTypeRef,_TypeModel;return _export("createBrandingDomainDeleteData",function(values){return Object.assign(create(_TypeModel,BrandingDomainDeleteDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("BrandingDomainDeleteDataTypeRef",BrandingDomainDeleteDataTypeRef=new TypeRef("sys","BrandingDomainDeleteData")),_export("BrandingDomainDeleteDataTypeRef",BrandingDomainDeleteDataTypeRef),_export("_TypeModel",_TypeModel={name:"BrandingDomainDeleteData",since:22,type:"DATA_TRANSFER_TYPE",id:1155,rootId:"A3N5cwAEgw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1156,since:22,type:"Number",cardinality:"One",final:!1,encrypted:!1},domain:{name:"domain",id:1157,since:22,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/BrandingDomainData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,BrandingDomainDataTypeRef,_TypeModel;return _export("createBrandingDomainData",function(values){return Object.assign(create(_TypeModel,BrandingDomainDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("BrandingDomainDataTypeRef",BrandingDomainDataTypeRef=new TypeRef("sys","BrandingDomainData")),_export("BrandingDomainDataTypeRef",BrandingDomainDataTypeRef),_export("_TypeModel",_TypeModel={name:"BrandingDomainData",since:22,type:"DATA_TRANSFER_TYPE",id:1149,rootId:"A3N5cwAEfQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1150,since:22,type:"Number",cardinality:"One",final:!1,encrypted:!1},domain:{name:"domain",id:1151,since:22,type:"String",cardinality:"One",final:!0,encrypted:!1},sessionEncPemCertificateChain:{name:"sessionEncPemCertificateChain",id:1152,since:22,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},sessionEncPemPrivateKey:{name:"sessionEncPemPrivateKey",id:1153,since:22,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},systemAdminPubEncSessionKey:{name:"systemAdminPubEncSessionKey",id:1154,since:22,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ContactFormStatisticEntry.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ContactFormStatisticEntryTypeRef,_TypeModel;return _export("createContactFormStatisticEntry",function(values){return Object.assign(create(_TypeModel,ContactFormStatisticEntryTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ContactFormStatisticEntryTypeRef",ContactFormStatisticEntryTypeRef=new TypeRef("tutanota","ContactFormStatisticEntry")),_export("ContactFormStatisticEntryTypeRef",ContactFormStatisticEntryTypeRef),_export("_TypeModel",_TypeModel={name:"ContactFormStatisticEntry",since:22,type:"AGGREGATED_TYPE",id:825,rootId:"CHR1dGFub3RhAAM5",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:826,since:22,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},bucketEncSessionKey:{name:"bucketEncSessionKey",id:827,since:22,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},customerPubEncBucketKey:{name:"customerPubEncBucketKey",id:828,since:22,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},customerPubKeyVersion:{name:"customerPubKeyVersion",id:829,since:22,type:"Number",cardinality:"One",final:!0,encrypted:!1}},associations:{statisticFields:{name:"statisticFields",id:830,since:22,type:"AGGREGATION",cardinality:"Any",refType:"ContactFormStatisticField",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ContactFormStatisticField.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ContactFormStatisticFieldTypeRef,_TypeModel;return _export("createContactFormStatisticField",function(values){return Object.assign(create(_TypeModel,ContactFormStatisticFieldTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ContactFormStatisticFieldTypeRef",ContactFormStatisticFieldTypeRef=new TypeRef("tutanota","ContactFormStatisticField")),_export("ContactFormStatisticFieldTypeRef",ContactFormStatisticFieldTypeRef),_export("_TypeModel",_TypeModel={name:"ContactFormStatisticField",since:19,type:"AGGREGATED_TYPE",id:765,rootId:"CHR1dGFub3RhAAL9",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:766,since:19,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},encryptedName:{name:"encryptedName",id:823,since:22,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},encryptedValue:{name:"encryptedValue",id:824,since:22,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PaymentDataServicePutData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PaymentDataServicePutDataTypeRef,_TypeModel;return _export("createPaymentDataServicePutData",function(values){return Object.assign(create(_TypeModel,PaymentDataServicePutDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PaymentDataServicePutDataTypeRef",PaymentDataServicePutDataTypeRef=new TypeRef("sys","PaymentDataServicePutData")),_export("PaymentDataServicePutDataTypeRef",PaymentDataServicePutDataTypeRef),_export("_TypeModel",_TypeModel={name:"PaymentDataServicePutData",since:9,type:"DATA_TRANSFER_TYPE",id:793,rootId:"A3N5cwADGQ",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:794,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},business:{name:"business",id:795,since:9,type:"Boolean",cardinality:"One",final:!1,encrypted:!1},confirmedCountry:{name:"confirmedCountry",id:804,since:9,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!0},invoiceAddress:{name:"invoiceAddress",id:797,since:9,type:"String",cardinality:"One",final:!1,encrypted:!0},invoiceCountry:{name:"invoiceCountry",id:798,since:9,type:"String",cardinality:"One",final:!1,encrypted:!0},invoiceName:{name:"invoiceName",id:796,since:9,type:"String",cardinality:"One",final:!1,encrypted:!0},invoiceVatIdNo:{name:"invoiceVatIdNo",id:799,since:9,type:"String",cardinality:"One",final:!1,encrypted:!0},paymentInterval:{name:"paymentInterval",id:802,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},paymentMethod:{name:"paymentMethod",id:800,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!0},paymentMethodInfo:{name:"paymentMethodInfo",id:801,since:9,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!0},paymentToken:{name:"paymentToken",id:803,since:9,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!0}},associations:{creditCard:{name:"creditCard",id:1320,since:30,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"CreditCard",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PaymentDataServicePutReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PaymentDataServicePutReturnTypeRef,_TypeModel;return _export("createPaymentDataServicePutReturn",function(values){return Object.assign(create(_TypeModel,PaymentDataServicePutReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PaymentDataServicePutReturnTypeRef",PaymentDataServicePutReturnTypeRef=new TypeRef("sys","PaymentDataServicePutReturn")),_export("PaymentDataServicePutReturnTypeRef",PaymentDataServicePutReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PaymentDataServicePutReturn",since:9,type:"DATA_TRANSFER_TYPE",id:805,rootId:"A3N5cwADJQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:806,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},result:{name:"result",id:807,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PdfInvoiceServiceData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PdfInvoiceServiceDataTypeRef,_TypeModel;return _export("createPdfInvoiceServiceData",function(values){return Object.assign(create(_TypeModel,PdfInvoiceServiceDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PdfInvoiceServiceDataTypeRef",PdfInvoiceServiceDataTypeRef=new TypeRef("sys","PdfInvoiceServiceData")),_export("PdfInvoiceServiceDataTypeRef",PdfInvoiceServiceDataTypeRef),_export("_TypeModel",_TypeModel={name:"PdfInvoiceServiceData",since:9,type:"DATA_TRANSFER_TYPE",id:777,rootId:"A3N5cwADCQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:778,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},invoiceNumber:{name:"invoiceNumber",id:1629,since:52,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{invoice:{name:"invoice",id:779,since:9,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"LegacyInvoice",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/PdfInvoiceServiceReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PdfInvoiceServiceReturnTypeRef,_TypeModel;return _export("createPdfInvoiceServiceReturn",function(values){return Object.assign(create(_TypeModel,PdfInvoiceServiceReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PdfInvoiceServiceReturnTypeRef",PdfInvoiceServiceReturnTypeRef=new TypeRef("sys","PdfInvoiceServiceReturn")),_export("PdfInvoiceServiceReturnTypeRef",PdfInvoiceServiceReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PdfInvoiceServiceReturn",since:9,type:"DATA_TRANSFER_TYPE",id:780,rootId:"A3N5cwADDA",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:781,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1630,since:52,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_ownerPublicEncSessionKey:{name:"_ownerPublicEncSessionKey",id:1631,since:52,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},data:{name:"data",id:782,since:9,type:"Bytes",cardinality:"One",final:!0,encrypted:!0}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/CustomerFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../EntityWorker","../../common/TutanotaConstants","../../entities/sys/Customer","../../entities/sys/CustomerInfo","./BookingFacade","../../Env","../../common/EntityFunctions","../../entities/sys/EmailSenderListElement","../../common/utils/Encoding","../crypto/Sha256","../../entities/sys/CustomerServerProperties","../../common/utils/Utils","../crypto/Aes","../crypto/CryptoFacade","../../entities/sys/CreateCustomerServerPropertiesData","../../entities/sys/CreateCustomerServerPropertiesReturn","../crypto/CryptoUtils","../crypto/Rsa","../../entities/sys/Services","../../entities/sys/SystemKeysReturn","../../entities/tutanota/CustomerAccountCreateData","../../entities/tutanota/ContactFormAccountData","../../entities/tutanota/Services","../../entities/sys/CustomDomainData","../../entities/sys/CustomDomainReturn","../../entities/tutanota/ContactFormAccountReturn","../../entities/sys/BrandingDomainDeleteData","../../entities/sys/BrandingDomainData","../../entities/tutanota/ContactFormStatisticEntry","../../entities/sys/PublicKeyReturn","../../entities/tutanota/ContactFormStatisticField","./CounterFacade","../../entities/sys/MembershipAddData","../../entities/sys/MembershipRemoveData","../../entities/sys/PaymentDataServicePutData","../../entities/sys/PaymentDataServicePutReturn","../../entities/sys/AccountingInfo","../../entities/sys/PdfInvoiceServiceData","../../entities/sys/PdfInvoiceServiceReturn","../../entities/accounting/Services"],function(_export,_context){"use strict";var _classCallCheck,_createClass,load,serviceRequest,serviceRequestVoid,update,AccountType,BookingItemFeatureType,Const,GroupType,CustomerTypeRef,CustomerInfoTypeRef,bookingFacade,assertWorkerOrNode,HttpMethod,createEmailSenderListElement,stringToUtf8Uint8Array,uint8ArrayToBase64,uint8ArrayToHex,hash,CustomerServerPropertiesTypeRef,getWhitelabelDomain,neverNull,aes128RandomKey,encryptKey,encryptString,resolveSessionKey,createCreateCustomerServerPropertiesData,CreateCustomerServerPropertiesReturnTypeRef,bitArrayToUint8Array,uint8ArrayToBitArray,generateRsaKey,hexToPublicKey,rsaEncrypt,SysService,SystemKeysReturnTypeRef,createCustomerAccountCreateData,createContactFormAccountData,TutanotaService,createCustomDomainData,CustomDomainReturnTypeRef,ContactFormAccountReturnTypeRef,createBrandingDomainDeleteData,createBrandingDomainData,createContactFormStatisticEntry,PublicKeyReturnTypeRef,createContactFormStatisticField,createMembershipAddData,createMembershipRemoveData,createPaymentDataServicePutData,PaymentDataServicePutReturnTypeRef,AccountingInfoTypeModel,AccountingInfoTypeRef,createPdfInvoiceServiceData,PdfInvoiceServiceReturnTypeRef,AccountingService,CustomerFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_EntityWorker){load=_EntityWorker.load,serviceRequest=_EntityWorker.serviceRequest,serviceRequestVoid=_EntityWorker.serviceRequestVoid,update=_EntityWorker.update},function(_commonTutanotaConstants){AccountType=_commonTutanotaConstants.AccountType,BookingItemFeatureType=_commonTutanotaConstants.BookingItemFeatureType,Const=_commonTutanotaConstants.Const,GroupType=_commonTutanotaConstants.GroupType},function(_entitiesSysCustomer){CustomerTypeRef=_entitiesSysCustomer.CustomerTypeRef},function(_entitiesSysCustomerInfo){CustomerInfoTypeRef=_entitiesSysCustomerInfo.CustomerInfoTypeRef},function(_BookingFacade){bookingFacade=_BookingFacade.bookingFacade},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod},function(_entitiesSysEmailSenderListElement){createEmailSenderListElement=_entitiesSysEmailSenderListElement.createEmailSenderListElement},function(_commonUtilsEncoding){stringToUtf8Uint8Array=_commonUtilsEncoding.stringToUtf8Uint8Array,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64,uint8ArrayToHex=_commonUtilsEncoding.uint8ArrayToHex},function(_cryptoSha){hash=_cryptoSha.hash},function(_entitiesSysCustomerServerProperties){CustomerServerPropertiesTypeRef=_entitiesSysCustomerServerProperties.CustomerServerPropertiesTypeRef},function(_commonUtilsUtils){getWhitelabelDomain=_commonUtilsUtils.getWhitelabelDomain,neverNull=_commonUtilsUtils.neverNull},function(_cryptoAes){aes128RandomKey=_cryptoAes.aes128RandomKey},function(_cryptoCryptoFacade){encryptKey=_cryptoCryptoFacade.encryptKey,encryptString=_cryptoCryptoFacade.encryptString,resolveSessionKey=_cryptoCryptoFacade.resolveSessionKey},function(_entitiesSysCreateCustomerServerPropertiesData){createCreateCustomerServerPropertiesData=_entitiesSysCreateCustomerServerPropertiesData.createCreateCustomerServerPropertiesData},function(_entitiesSysCreateCustomerServerPropertiesReturn){CreateCustomerServerPropertiesReturnTypeRef=_entitiesSysCreateCustomerServerPropertiesReturn.CreateCustomerServerPropertiesReturnTypeRef},function(_cryptoCryptoUtils){bitArrayToUint8Array=_cryptoCryptoUtils.bitArrayToUint8Array,uint8ArrayToBitArray=_cryptoCryptoUtils.uint8ArrayToBitArray},function(_cryptoRsa){generateRsaKey=_cryptoRsa.generateRsaKey,hexToPublicKey=_cryptoRsa.hexToPublicKey,rsaEncrypt=_cryptoRsa.rsaEncrypt},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService},function(_entitiesSysSystemKeysReturn){SystemKeysReturnTypeRef=_entitiesSysSystemKeysReturn.SystemKeysReturnTypeRef},function(_entitiesTutanotaCustomerAccountCreateData){createCustomerAccountCreateData=_entitiesTutanotaCustomerAccountCreateData.createCustomerAccountCreateData},function(_entitiesTutanotaContactFormAccountData){createContactFormAccountData=_entitiesTutanotaContactFormAccountData.createContactFormAccountData},function(_entitiesTutanotaServices){TutanotaService=_entitiesTutanotaServices.TutanotaService},function(_entitiesSysCustomDomainData){createCustomDomainData=_entitiesSysCustomDomainData.createCustomDomainData},function(_entitiesSysCustomDomainReturn){CustomDomainReturnTypeRef=_entitiesSysCustomDomainReturn.CustomDomainReturnTypeRef},function(_entitiesTutanotaContactFormAccountReturn){ContactFormAccountReturnTypeRef=_entitiesTutanotaContactFormAccountReturn.ContactFormAccountReturnTypeRef},function(_entitiesSysBrandingDomainDeleteData){createBrandingDomainDeleteData=_entitiesSysBrandingDomainDeleteData.createBrandingDomainDeleteData},function(_entitiesSysBrandingDomainData){createBrandingDomainData=_entitiesSysBrandingDomainData.createBrandingDomainData},function(_entitiesTutanotaContactFormStatisticEntry){createContactFormStatisticEntry=_entitiesTutanotaContactFormStatisticEntry.createContactFormStatisticEntry},function(_entitiesSysPublicKeyReturn){PublicKeyReturnTypeRef=_entitiesSysPublicKeyReturn.PublicKeyReturnTypeRef},function(_entitiesTutanotaContactFormStatisticField){createContactFormStatisticField=_entitiesTutanotaContactFormStatisticField.createContactFormStatisticField},function(_CounterFacade){_CounterFacade.CounterFacade},function(_entitiesSysMembershipAddData){createMembershipAddData=_entitiesSysMembershipAddData.createMembershipAddData},function(_entitiesSysMembershipRemoveData){createMembershipRemoveData=_entitiesSysMembershipRemoveData.createMembershipRemoveData},function(_entitiesSysPaymentDataServicePutData){createPaymentDataServicePutData=_entitiesSysPaymentDataServicePutData.createPaymentDataServicePutData},function(_entitiesSysPaymentDataServicePutReturn){PaymentDataServicePutReturnTypeRef=_entitiesSysPaymentDataServicePutReturn.PaymentDataServicePutReturnTypeRef},function(_entitiesSysAccountingInfo){AccountingInfoTypeModel=_entitiesSysAccountingInfo._TypeModel,AccountingInfoTypeRef=_entitiesSysAccountingInfo.AccountingInfoTypeRef},function(_entitiesSysPdfInvoiceServiceData){createPdfInvoiceServiceData=_entitiesSysPdfInvoiceServiceData.createPdfInvoiceServiceData},function(_entitiesSysPdfInvoiceServiceReturn){PdfInvoiceServiceReturnTypeRef=_entitiesSysPdfInvoiceServiceReturn.PdfInvoiceServiceReturnTypeRef},function(_entitiesAccountingServices){AccountingService=_entitiesAccountingServices.AccountingService}],execute:function(){assertWorkerOrNode(),_export("CustomerFacade",CustomerFacade=function(){function CustomerFacade(worker,login,groupManagement,userManagement,counters){_classCallCheck(this,CustomerFacade),this._worker=worker,this._login=login,this._groupManagement=groupManagement,this._userManagement=userManagement,this._counters=counters}return _createClass(CustomerFacade,[{key:"getDomainValidationRecord",value:function(){return Promise.resolve("t-verify="+uint8ArrayToHex(hash(stringToUtf8Uint8Array(neverNull(this._login.getLoggedInUser().customer))).slice(0,16)))}},{key:"addDomain",value:function(domainName){var data=createCustomDomainData();return data.domain=domainName.trim().toLowerCase(),serviceRequest(SysService.CustomDomainService,HttpMethod.POST,data,CustomDomainReturnTypeRef)}},{key:"removeDomain",value:function(domainName){var data=createCustomDomainData();return data.domain=domainName.trim().toLowerCase(),serviceRequestVoid(SysService.CustomDomainService,HttpMethod.DELETE,data)}},{key:"setCatchAllGroup",value:function(domainName,mailGroupId){var data=createCustomDomainData();return data.domain=domainName.trim().toLowerCase(),data.catchAllMailGroup=mailGroupId,serviceRequestVoid(SysService.CustomDomainService,HttpMethod.PUT,data)}},{key:"uploadCertificate",value:function(domainName,pemCertificateChain,pemPrivateKey){return load(CustomerTypeRef,neverNull(this._login.getLoggedInUser().customer)).then(function(customer){return load(CustomerInfoTypeRef,customer.customerInfo).then(function(customerInfo){var existingBrandingDomain=getWhitelabelDomain(customerInfo,domainName);return serviceRequest(SysService.SystemKeysService,HttpMethod.GET,null,SystemKeysReturnTypeRef).then(function(keyData){var systemAdminPubKey=hexToPublicKey(uint8ArrayToHex(keyData.systemAdminPubKey)),sessionKey=aes128RandomKey();return rsaEncrypt(systemAdminPubKey,bitArrayToUint8Array(sessionKey)).then(function(systemAdminPubEncAccountingInfoSessionKey){var data=createBrandingDomainData();return data.domain=domainName,pemCertificateChain&&(data.sessionEncPemCertificateChain=encryptString(sessionKey,pemCertificateChain)),pemPrivateKey&&(data.sessionEncPemPrivateKey=encryptString(sessionKey,pemPrivateKey)),data.systemAdminPubEncSessionKey=systemAdminPubEncAccountingInfoSessionKey,serviceRequestVoid(SysService.BrandingDomainService,existingBrandingDomain?HttpMethod.PUT:HttpMethod.POST,data)})})})})}},{key:"deleteCertificate",value:function(domainName){var data=createBrandingDomainDeleteData();return data.domain=domainName,serviceRequestVoid(SysService.BrandingDomainService,HttpMethod.DELETE,data)}},{key:"readUsedCustomerStorage",value:function(customerId){var _this=this;return this._counters.readCounterValue(Const.COUNTER_USED_MEMORY_INTERNAL,customerId).then(function(usedMemoryInternal){return _this._counters.readCounterValue(Const.COUNTER_USED_MEMORY_EXTERNAL,customerId).then(function(usedMemoryExternal){return Number(usedMemoryInternal)+Number(usedMemoryExternal)})})}},{key:"readAvailableCustomerStorage",value:function(customerId){return load(CustomerTypeRef,customerId).then(function(customer){return load(CustomerInfoTypeRef,customer.customerInfo).then(function(customerInfo){var includedStorage=Number(customerInfo.includedStorageCapacity),promotionStorage=Number(customerInfo.promotionStorageCapacity),availableStorage=Math.max(includedStorage,promotionStorage),bookedStorage=0;return customer.type===AccountType.PREMIUM?bookingFacade.getCurrentPrice().then(function(price){var currentStorageItem=bookingFacade.getPriceItem(price.currentPriceNextPeriod,BookingItemFeatureType.Storage);return null!=currentStorageItem&&(bookedStorage=Number(currentStorageItem.count)),(availableStorage=Math.max(bookedStorage,availableStorage))*Const.MEMORY_GB_FACTOR}):availableStorage*Const.MEMORY_GB_FACTOR})})}},{key:"loadCustomerServerProperties",value:function(){var _this2=this;return load(CustomerTypeRef,neverNull(this._login.getLoggedInUser().customer)).then(function(customer){var p=void 0;if(customer.serverProperties)p=Promise.resolve(customer.serverProperties);else{var sessionKey=aes128RandomKey(),adminGroupKey=_this2._login.getGroupKey(_this2._login.getGroupId(GroupType.Admin)),groupEncSessionKey=encryptKey(adminGroupKey,sessionKey),data=createCreateCustomerServerPropertiesData();data.adminGroupEncSessionKey=groupEncSessionKey,p=serviceRequest(SysService.CreateCustomerServerProperties,HttpMethod.POST,data,CreateCustomerServerPropertiesReturnTypeRef).then(function(returnData){return returnData.id})}return p.then(function(cspId){return load(CustomerServerPropertiesTypeRef,cspId)})})}},{key:"addSpamRule",value:function(field,type,value){return this.loadCustomerServerProperties().then(function(props){value=value.toLowerCase().trim();var newListEntry=createEmailSenderListElement({value:value,hashedValue:uint8ArrayToBase64(hash(stringToUtf8Uint8Array(value))),type:type,field:field});return props.emailSenderList.push(newListEntry),update(props)})}},{key:"editSpamRule",value:function(spamRule){return this.loadCustomerServerProperties().then(function(props){spamRule.value=spamRule.value.toLowerCase().trim();var index=props.emailSenderList.findIndex(function(item){return spamRule._id===item._id});if(-1===index)throw new Error("spam rule does not exist "+JSON.stringify(spamRule));return props.emailSenderList[index]=spamRule,update(props)})}},{key:"generateSignupKeys",value:function(){var _this3=this;return generateRsaKey().then(function(k1){return _this3._worker.sendProgress(33).then(function(){return generateRsaKey().then(function(k2){return _this3._worker.sendProgress(66).then(function(){return generateRsaKey().then(function(k3){return _this3._worker.sendProgress(100).then(function(){return[k1,k2,k3]})})})})})})}},{key:"signup",value:function(keyPairs,accountType,authToken,mailAddress,password,registrationCode,currentLanguage){var _this4=this;return serviceRequest(SysService.SystemKeysService,HttpMethod.GET,null,SystemKeysReturnTypeRef).then(function(keyData){var systemAdminPubKey=hexToPublicKey(uint8ArrayToHex(keyData.systemAdminPubKey)),userGroupKey=aes128RandomKey(),adminGroupKey=aes128RandomKey(),customerGroupKey=aes128RandomKey(),userGroupInfoSessionKey=aes128RandomKey(),adminGroupInfoSessionKey=aes128RandomKey(),customerGroupInfoSessionKey=aes128RandomKey(),accountingInfoSessionKey=aes128RandomKey(),customerServerPropertiesSessionKey=aes128RandomKey();return rsaEncrypt(systemAdminPubKey,bitArrayToUint8Array(accountingInfoSessionKey)).then(function(systemAdminPubEncAccountingInfoSessionKey){var userGroupData=_this4._groupManagement.generateInternalGroupData(keyPairs[0],userGroupKey,userGroupInfoSessionKey,null,adminGroupKey,customerGroupKey),adminGroupData=_this4._groupManagement.generateInternalGroupData(keyPairs[1],adminGroupKey,adminGroupInfoSessionKey,null,adminGroupKey,customerGroupKey),customerGroupData=_this4._groupManagement.generateInternalGroupData(keyPairs[2],customerGroupKey,customerGroupInfoSessionKey,null,adminGroupKey,customerGroupKey),recoverData=_this4._login.generateRecoveryCode(userGroupKey),data=createCustomerAccountCreateData();return data.authToken=authToken,data.date=Const.CURRENT_DATE,data.lang=currentLanguage,data.code=registrationCode,data.userData=_this4._userManagement.generateUserAccountData(userGroupKey,userGroupInfoSessionKey,customerGroupKey,mailAddress,password,"",recoverData),data.userEncAdminGroupKey=encryptKey(userGroupKey,adminGroupKey),data.userEncAccountGroupKey=encryptKey(userGroupKey,_this4._getAccountGroupKey(keyData,accountType)),data.userGroupData=userGroupData,data.adminGroupData=adminGroupData,data.customerGroupData=customerGroupData,data.adminEncAccountingInfoSessionKey=encryptKey(adminGroupKey,accountingInfoSessionKey),data.systemAdminPubEncAccountingInfoSessionKey=systemAdminPubEncAccountingInfoSessionKey,data.adminEncCustomerServerPropertiesSessionKey=encryptKey(adminGroupKey,customerServerPropertiesSessionKey),serviceRequestVoid(AccountingService.CustomerAccountService,HttpMethod.POST,data).return(recoverData.hexCode)})})}},{key:"createContactFormUserGroupData",value:function(){var _this5=this,userGroupKey=aes128RandomKey(),userGroupInfoSessionKey=aes128RandomKey();return this.contactFormUserGroupData=generateRsaKey().then(function(keyPair){return _this5._groupManagement.generateInternalGroupData(keyPair,userGroupKey,userGroupInfoSessionKey,null,userGroupKey,userGroupKey)}).then(function(userGroupData){return{userGroupKey:userGroupKey,userGroupData:userGroupData}}),Promise.resolve()}},{key:"createContactFormUser",value:function(password,contactFormId,statisticFields){var _this6=this;return this.contactFormUserGroupData||this.createContactFormUserGroupData(),neverNull(this.contactFormUserGroupData).then(function(contactFormUserGroupData){var userGroupKey=contactFormUserGroupData.userGroupKey,userGroupData=contactFormUserGroupData.userGroupData;return _this6._worker.sendProgress(35).then(function(){var data=createContactFormAccountData();return data.userData=_this6._userManagement.generateContactFormUserAccountData(userGroupKey,password),_this6._worker.sendProgress(95).then(function(){return serviceRequest(SysService.CustomerPublicKeyService,HttpMethod.GET,null,PublicKeyReturnTypeRef).then(function(publicKeyData){var publicKey=hexToPublicKey(uint8ArrayToHex(publicKeyData.pubKey)),sessionKey=aes128RandomKey(),bucketKey=aes128RandomKey();return rsaEncrypt(publicKey,bitArrayToUint8Array(bucketKey)).then(function(customerPubEncBucketKey){var stats=createContactFormStatisticEntry();return stats.customerPubEncBucketKey=customerPubEncBucketKey,stats.bucketEncSessionKey=encryptKey(bucketKey,sessionKey),stats.customerPubKeyVersion=publicKeyData.pubKeyVersion,stats.statisticFields=statisticFields.map(function(sf){var esf=createContactFormStatisticField();return esf.encryptedName=encryptString(sessionKey,sf.name),esf.encryptedValue=encryptString(sessionKey,sf.value),esf}),data.userGroupData=userGroupData,data.contactForm=contactFormId,data.statistics=stats,serviceRequest(TutanotaService.ContactFormAccountService,HttpMethod.POST,data,ContactFormAccountReturnTypeRef)})})})})}).then(function(result){return _this6.contactFormUserGroupData=null,result})}},{key:"_getAccountGroupKey",value:function(keyData,accountType){if(accountType===AccountType.FREE)return uint8ArrayToBitArray(keyData.freeGroupKey);if(accountType===AccountType.STARTER)return uint8ArrayToBitArray(keyData.starterGroupKey);throw Error("Illegal account type")}},{key:"switchFreeToPremiumGroup",value:function(){var _this7=this;return serviceRequest(SysService.SystemKeysService,HttpMethod.GET,null,SystemKeysReturnTypeRef).then(function(keyData){var membershipAddData=createMembershipAddData();return membershipAddData.user=_this7._login.getLoggedInUser()._id,membershipAddData.group=neverNull(keyData.premiumGroup),membershipAddData.symEncGKey=encryptKey(_this7._login.getUserGroupKey(),uint8ArrayToBitArray(keyData.premiumGroupKey)),serviceRequestVoid(SysService.MembershipService,HttpMethod.POST,membershipAddData).then(function(){var membershipRemoveData=createMembershipRemoveData();return membershipRemoveData.user=_this7._login.getLoggedInUser()._id,membershipRemoveData.group=neverNull(keyData.freeGroup),serviceRequestVoid(SysService.MembershipService,HttpMethod.DELETE,membershipRemoveData)})}).catch(function(e){throw e.message=e.message+" error switching free to premium group",console.log(e),e})}},{key:"switchPremiumToFreeGroup",value:function(){var _this8=this;return serviceRequest(SysService.SystemKeysService,HttpMethod.GET,null,SystemKeysReturnTypeRef).then(function(keyData){var membershipAddData=createMembershipAddData();return membershipAddData.user=_this8._login.getLoggedInUser()._id,membershipAddData.group=neverNull(keyData.freeGroup),membershipAddData.symEncGKey=encryptKey(_this8._login.getUserGroupKey(),uint8ArrayToBitArray(keyData.freeGroupKey)),serviceRequestVoid(SysService.MembershipService,HttpMethod.POST,membershipAddData).then(function(){var membershipRemoveData=createMembershipRemoveData();return membershipRemoveData.user=_this8._login.getLoggedInUser()._id,membershipRemoveData.group=neverNull(keyData.premiumGroup),serviceRequestVoid(SysService.MembershipService,HttpMethod.DELETE,membershipRemoveData)})}).catch(function(e){throw e.message=e.message+" error switching premium to free group",console.log(e),e})}},{key:"updatePaymentData",value:function(businessUse,paymentInterval,invoiceData,paymentData,confirmedInvoiceCountry){return load(CustomerTypeRef,neverNull(this._login.getLoggedInUser().customer)).then(function(customer){return load(CustomerInfoTypeRef,customer.customerInfo).then(function(customerInfo){return load(AccountingInfoTypeRef,customerInfo.accountingInfo).then(function(accountingInfo){return resolveSessionKey(AccountingInfoTypeModel,accountingInfo).then(function(accountingInfoSessionKey){var service=createPaymentDataServicePutData();return service.business=businessUse,service.paymentInterval=paymentInterval.toString(),service.invoiceName="",service.invoiceAddress=invoiceData.invoiceAddress,service.invoiceCountry=invoiceData.country?invoiceData.country.a:"",service.invoiceVatIdNo=invoiceData.vatNumber?invoiceData.vatNumber:"",service.paymentMethod=paymentData?paymentData.paymentMethod:accountingInfo.paymentMethod?accountingInfo.paymentMethod:"",service.paymentMethodInfo=null,service.paymentToken=null,paymentData&&paymentData.creditCardData&&(service.creditCard=paymentData.creditCardData),service.confirmedCountry=confirmedInvoiceCountry?confirmedInvoiceCountry.a:null,serviceRequest(SysService.PaymentDataService,HttpMethod.PUT,service,PaymentDataServicePutReturnTypeRef,null,accountingInfoSessionKey)})})})})}},{key:"downloadInvoice",value:function(invoiceNumber){var data=createPdfInvoiceServiceData();return data.invoiceNumber=invoiceNumber,serviceRequest(SysService.PdfInvoiceService,HttpMethod.GET,data,PdfInvoiceServiceReturnTypeRef).then(function(returnData){return{_type:"DataFile",name:String(invoiceNumber)+".pdf",mimeType:"application/pdf",data:returnData.data,size:returnData.data.byteLength,id:null}})}}]),CustomerFacade}()),_export("CustomerFacade",CustomerFacade)}}}),System.register("src/api/entities/sys/AlarmServicePost.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AlarmServicePostTypeRef,_TypeModel;return _export("createAlarmServicePost",function(values){return Object.assign(create(_TypeModel,AlarmServicePostTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AlarmServicePostTypeRef",AlarmServicePostTypeRef=new TypeRef("sys","AlarmServicePost")),_export("AlarmServicePostTypeRef",AlarmServicePostTypeRef),_export("_TypeModel",_TypeModel={name:"AlarmServicePost",since:48,type:"DATA_TRANSFER_TYPE",id:1576,rootId:"A3N5cwAGKA",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:1577,since:48,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{alarmNotifications:{name:"alarmNotifications",id:1578,since:48,type:"AGGREGATION",cardinality:"Any",refType:"AlarmNotification",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/AlarmNotification.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AlarmNotificationTypeRef,_TypeModel;return _export("createAlarmNotification",function(values){return Object.assign(create(_TypeModel,AlarmNotificationTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AlarmNotificationTypeRef",AlarmNotificationTypeRef=new TypeRef("sys","AlarmNotification")),_export("AlarmNotificationTypeRef",AlarmNotificationTypeRef),_export("_TypeModel",_TypeModel={name:"AlarmNotification",since:48,type:"AGGREGATED_TYPE",id:1564,rootId:"A3N5cwAGHA",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1565,since:48,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},eventEnd:{name:"eventEnd",id:1569,since:48,type:"Date",cardinality:"One",final:!0,encrypted:!0},eventStart:{name:"eventStart",id:1568,since:48,type:"Date",cardinality:"One",final:!0,encrypted:!0},operation:{name:"operation",id:1566,since:48,type:"Number",cardinality:"One",final:!0,encrypted:!1},summary:{name:"summary",id:1567,since:48,type:"String",cardinality:"One",final:!0,encrypted:!0}},associations:{alarmInfo:{name:"alarmInfo",id:1570,since:48,type:"AGGREGATION",cardinality:"One",refType:"AlarmInfo",final:!0},notificationSessionKeys:{name:"notificationSessionKeys",id:1572,since:48,type:"AGGREGATION",cardinality:"Any",refType:"NotificationSessionKey",final:!0},repeatRule:{name:"repeatRule",id:1571,since:48,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"RepeatRule",final:!0},user:{name:"user",id:1573,since:48,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/NotificationSessionKey.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,NotificationSessionKeyTypeRef,_TypeModel;return _export("createNotificationSessionKey",function(values){return Object.assign(create(_TypeModel,NotificationSessionKeyTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("NotificationSessionKeyTypeRef",NotificationSessionKeyTypeRef=new TypeRef("sys","NotificationSessionKey")),_export("NotificationSessionKeyTypeRef",NotificationSessionKeyTypeRef),_export("_TypeModel",_TypeModel={name:"NotificationSessionKey",since:48,type:"AGGREGATED_TYPE",id:1553,rootId:"A3N5cwAGEQ",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1554,since:48,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},pushIdentifierSessionEncSessionKey:{name:"pushIdentifierSessionEncSessionKey",id:1556,since:48,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{pushIdentifier:{name:"pushIdentifier",id:1555,since:48,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"PushIdentifier",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/CalendarPostData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CalendarPostDataTypeRef,_TypeModel;return _export("createCalendarPostData",function(values){return Object.assign(create(_TypeModel,CalendarPostDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CalendarPostDataTypeRef",CalendarPostDataTypeRef=new TypeRef("tutanota","CalendarPostData")),_export("CalendarPostDataTypeRef",CalendarPostDataTypeRef),_export("_TypeModel",_TypeModel={name:"CalendarPostData",since:33,type:"DATA_TRANSFER_TYPE",id:964,rootId:"CHR1dGFub3RhAAPE",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:965,since:33,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{calendarData:{name:"calendarData",id:966,since:33,type:"AGGREGATION",cardinality:"One",refType:"CalendarGroupData",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/ResetPasswordData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ResetPasswordDataTypeRef,_TypeModel;return _export("createResetPasswordData",function(values){return Object.assign(create(_TypeModel,ResetPasswordDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ResetPasswordDataTypeRef",ResetPasswordDataTypeRef=new TypeRef("sys","ResetPasswordData")),_export("ResetPasswordDataTypeRef",ResetPasswordDataTypeRef),_export("_TypeModel",_TypeModel={name:"ResetPasswordData",since:1,type:"DATA_TRANSFER_TYPE",id:584,rootId:"A3N5cwACSA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:585,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},pwEncUserGroupKey:{name:"pwEncUserGroupKey",id:588,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},salt:{name:"salt",id:587,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},verifier:{name:"verifier",id:586,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{user:{name:"user",id:589,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/MembershipAddData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,MembershipAddDataTypeRef,_TypeModel;return _export("createMembershipAddData",function(values){return Object.assign(create(_TypeModel,MembershipAddDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("MembershipAddDataTypeRef",MembershipAddDataTypeRef=new TypeRef("sys","MembershipAddData")),_export("MembershipAddDataTypeRef",MembershipAddDataTypeRef),_export("_TypeModel",_TypeModel={name:"MembershipAddData",since:1,type:"DATA_TRANSFER_TYPE",id:505,rootId:"A3N5cwAB-Q",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:506,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},symEncGKey:{name:"symEncGKey",id:507,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{group:{name:"group",id:509,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!1,external:!1},user:{name:"user",id:508,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UserDataDelete.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserDataDeleteTypeRef,_TypeModel;return _export("createUserDataDelete",function(values){return Object.assign(create(_TypeModel,UserDataDeleteTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserDataDeleteTypeRef",UserDataDeleteTypeRef=new TypeRef("sys","UserDataDelete")),_export("UserDataDeleteTypeRef",UserDataDeleteTypeRef),_export("_TypeModel",_TypeModel={name:"UserDataDelete",since:1,type:"DATA_TRANSFER_TYPE",id:404,rootId:"A3N5cwABlA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:405,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},date:{name:"date",id:879,since:9,type:"Date",cardinality:"ZeroOrOne",final:!1,encrypted:!1},restore:{name:"restore",id:406,since:1,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{user:{name:"user",id:407,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/UserAccountUserData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserAccountUserDataTypeRef,_TypeModel;return _export("createUserAccountUserData",function(values){return Object.assign(create(_TypeModel,UserAccountUserDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserAccountUserDataTypeRef",UserAccountUserDataTypeRef=new TypeRef("tutanota","UserAccountUserData")),_export("UserAccountUserDataTypeRef",UserAccountUserDataTypeRef),_export("_TypeModel",_TypeModel={name:"UserAccountUserData",since:16,type:"AGGREGATED_TYPE",id:622,rootId:"CHR1dGFub3RhAAJu",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:623,since:16,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},contactEncContactListSessionKey:{name:"contactEncContactListSessionKey",id:637,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},customerEncContactGroupInfoSessionKey:{name:"customerEncContactGroupInfoSessionKey",id:640,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},customerEncFileGroupInfoSessionKey:{name:"customerEncFileGroupInfoSessionKey",id:641,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},customerEncMailGroupInfoSessionKey:{name:"customerEncMailGroupInfoSessionKey",id:639,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},encryptedName:{name:"encryptedName",id:625,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},fileEncFileSystemSessionKey:{name:"fileEncFileSystemSessionKey",id:638,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:624,since:16,type:"String",cardinality:"One",final:!1,encrypted:!1},mailEncMailBoxSessionKey:{name:"mailEncMailBoxSessionKey",id:636,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},pwEncUserGroupKey:{name:"pwEncUserGroupKey",id:629,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},recoverCodeEncUserGroupKey:{name:"recoverCodeEncUserGroupKey",id:893,since:29,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},recoverCodeVerifier:{name:"recoverCodeVerifier",id:894,since:29,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},salt:{name:"salt",id:626,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncClientKey:{name:"userEncClientKey",id:628,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncContactGroupKey:{name:"userEncContactGroupKey",id:632,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncCustomerGroupKey:{name:"userEncCustomerGroupKey",id:630,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncEntropy:{name:"userEncEntropy",id:634,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncFileGroupKey:{name:"userEncFileGroupKey",id:633,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncMailGroupKey:{name:"userEncMailGroupKey",id:631,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncRecoverCode:{name:"userEncRecoverCode",id:892,since:29,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncTutanotaPropertiesSessionKey:{name:"userEncTutanotaPropertiesSessionKey",id:635,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},verifier:{name:"verifier",id:627,since:16,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/UserAccountCreateData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UserAccountCreateDataTypeRef,_TypeModel;return _export("createUserAccountCreateData",function(values){return Object.assign(create(_TypeModel,UserAccountCreateDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UserAccountCreateDataTypeRef",UserAccountCreateDataTypeRef=new TypeRef("tutanota","UserAccountCreateData")),_export("UserAccountCreateDataTypeRef",UserAccountCreateDataTypeRef),_export("_TypeModel",_TypeModel={name:"UserAccountCreateData",since:16,type:"DATA_TRANSFER_TYPE",id:663,rootId:"CHR1dGFub3RhAAKX",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:664,since:16,type:"Number",cardinality:"One",final:!1,encrypted:!1},date:{name:"date",id:665,since:16,type:"Date",cardinality:"ZeroOrOne",final:!1,encrypted:!1}},associations:{userData:{name:"userData",id:666,since:16,type:"AGGREGATION",cardinality:"One",refType:"UserAccountUserData",final:!1},userGroupData:{name:"userGroupData",id:667,since:16,type:"AGGREGATION",cardinality:"One",refType:"InternalGroupData",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/ContactFormUserData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ContactFormUserDataTypeRef,_TypeModel;return _export("createContactFormUserData",function(values){return Object.assign(create(_TypeModel,ContactFormUserDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ContactFormUserDataTypeRef",ContactFormUserDataTypeRef=new TypeRef("tutanota","ContactFormUserData")),_export("ContactFormUserDataTypeRef",ContactFormUserDataTypeRef),_export("_TypeModel",_TypeModel={name:"ContactFormUserData",since:19,type:"AGGREGATED_TYPE",id:754,rootId:"CHR1dGFub3RhAALy",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:755,since:19,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},mailEncMailBoxSessionKey:{name:"mailEncMailBoxSessionKey",id:763,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},ownerEncMailGroupInfoSessionKey:{name:"ownerEncMailGroupInfoSessionKey",id:764,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},pwEncUserGroupKey:{name:"pwEncUserGroupKey",id:759,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},salt:{name:"salt",id:756,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncClientKey:{name:"userEncClientKey",id:758,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncEntropy:{name:"userEncEntropy",id:761,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncMailGroupKey:{name:"userEncMailGroupKey",id:760,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncTutanotaPropertiesSessionKey:{name:"userEncTutanotaPropertiesSessionKey",id:762,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},verifier:{name:"verifier",id:757,since:19,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/monitor/ReadCounterReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ReadCounterReturnTypeRef,_TypeModel;return _export("createReadCounterReturn",function(values){return Object.assign(create(_TypeModel,ReadCounterReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ReadCounterReturnTypeRef",ReadCounterReturnTypeRef=new TypeRef("monitor","ReadCounterReturn")),_export("ReadCounterReturnTypeRef",ReadCounterReturnTypeRef),_export("_TypeModel",_TypeModel={name:"ReadCounterReturn",since:1,type:"DATA_TRANSFER_TYPE",id:16,rootId:"B21vbml0b3IAEA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:17,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},value:{name:"value",id:18,since:1,type:"Number",cardinality:"ZeroOrOne",final:!1,encrypted:!1}},associations:{},app:"monitor",version:"14"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/monitor/ReadCounterData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ReadCounterDataTypeRef,_TypeModel;return _export("createReadCounterData",function(values){return Object.assign(create(_TypeModel,ReadCounterDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ReadCounterDataTypeRef",ReadCounterDataTypeRef=new TypeRef("monitor","ReadCounterData")),_export("ReadCounterDataTypeRef",ReadCounterDataTypeRef),_export("_TypeModel",_TypeModel={name:"ReadCounterData",since:1,type:"DATA_TRANSFER_TYPE",id:12,rootId:"B21vbml0b3IADA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:13,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},monitor:{name:"monitor",id:14,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1},owner:{name:"owner",id:15,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"monitor",version:"14"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/CounterFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../entities/monitor/ReadCounterReturn","../../common/EntityFunctions","../../entities/monitor/ReadCounterData","../EntityWorker","../../Env","../../entities/monitor/Services"],function(_export,_context){"use strict";var _classCallCheck,_createClass,ReadCounterReturnTypeRef,HttpMethod,createReadCounterData,serviceRequest,assertWorkerOrNode,MonitorService,CounterFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_entitiesMonitorReadCounterReturn){ReadCounterReturnTypeRef=_entitiesMonitorReadCounterReturn.ReadCounterReturnTypeRef},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod},function(_entitiesMonitorReadCounterData){createReadCounterData=_entitiesMonitorReadCounterData.createReadCounterData},function(_EntityWorker){serviceRequest=_EntityWorker.serviceRequest},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_entitiesMonitorServices){MonitorService=_entitiesMonitorServices.MonitorService}],execute:function(){assertWorkerOrNode(),_export("CounterFacade",CounterFacade=function(){function CounterFacade(){_classCallCheck(this,CounterFacade)}return _createClass(CounterFacade,[{key:"readCounterValue",value:function(monitorValue,ownerId){var counterData=createReadCounterData();return counterData.monitor=monitorValue,counterData.owner=ownerId,serviceRequest(MonitorService.CounterService,HttpMethod.GET,counterData,ReadCounterReturnTypeRef).then(function(counterReturn){return counterReturn.value})}}]),CounterFacade}()),_export("CounterFacade",CounterFacade)}}}),System.register("src/api/entities/sys/UpdateAdminshipData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UpdateAdminshipDataTypeRef,_TypeModel;return _export("createUpdateAdminshipData",function(values){return Object.assign(create(_TypeModel,UpdateAdminshipDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UpdateAdminshipDataTypeRef",UpdateAdminshipDataTypeRef=new TypeRef("sys","UpdateAdminshipData")),_export("UpdateAdminshipDataTypeRef",UpdateAdminshipDataTypeRef),_export("_TypeModel",_TypeModel={name:"UpdateAdminshipData",since:27,type:"DATA_TRANSFER_TYPE",id:1288,rootId:"A3N5cwAFCA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1289,since:27,type:"Number",cardinality:"One",final:!1,encrypted:!1},newAdminGroupEncGKey:{name:"newAdminGroupEncGKey",id:1290,since:27,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{group:{name:"group",id:1291,since:27,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!0,external:!1},newAdminGroup:{name:"newAdminGroup",id:1292,since:27,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/CalendarGroupData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CalendarGroupDataTypeRef,_TypeModel;return _export("createCalendarGroupData",function(values){return Object.assign(create(_TypeModel,CalendarGroupDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CalendarGroupDataTypeRef",CalendarGroupDataTypeRef=new TypeRef("tutanota","CalendarGroupData")),_export("CalendarGroupDataTypeRef",CalendarGroupDataTypeRef),_export("_TypeModel",_TypeModel={name:"CalendarGroupData",since:33,type:"AGGREGATED_TYPE",id:956,rootId:"CHR1dGFub3RhAAO8",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:957,since:33,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},adminEncGroupKey:{name:"adminEncGroupKey",id:959,since:33,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},calendarEncCalendarGroupRootSessionKey:{name:"calendarEncCalendarGroupRootSessionKey",id:958,since:33,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},groupInfoEncName:{name:"groupInfoEncName",id:962,since:33,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},ownerEncGroupInfoSessionKey:{name:"ownerEncGroupInfoSessionKey",id:960,since:33,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},userEncGroupKey:{name:"userEncGroupKey",id:961,since:33,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{adminGroup:{name:"adminGroup",id:963,since:33,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"Group",final:!0,external:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/UserManagementFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../Env","../../common/TutanotaConstants","../EntityWorker","../../entities/sys/Group","../crypto/CryptoFacade","../crypto/Bcrypt","../crypto/CryptoConstants","../../common/utils/Utils","../crypto/CryptoUtils","../../entities/sys/ResetPasswordData","../../common/EntityFunctions","../../entities/sys/MembershipAddData","../../entities/sys/GroupInfo","../../entities/sys/UserDataDelete","../crypto/Aes","../../entities/tutanota/UserAccountUserData","../../entities/tutanota/UserAccountCreateData","../../entities/tutanota/Services","../crypto/Randomizer","../../entities/tutanota/ContactFormUserData","./CounterFacade","../../entities/sys/UpdateAdminshipData","../../entities/sys/Services","../crypto/Rsa","../../entities/tutanota/CalendarGroupData"],function(_export,_context){"use strict";var _classCallCheck,_createClass,assertWorkerOrNode,AccountType,Const,GroupType,load,serviceRequestVoid,GroupTypeRef,decryptKey,encryptBytes,encryptKey,encryptString,generateKeyFromPassphrase,generateRandomSalt,KeyLength,asyncFind,neverNull,createAuthVerifier,createResetPasswordData,HttpMethod,createMembershipAddData,GroupInfoTypeRef,createUserDataDelete,aes128RandomKey,createUserAccountUserData,createUserAccountCreateData,TutanotaService,random,createContactFormUserData,createUpdateAdminshipData,SysService,generateRsaKey,createCalendarGroupData,UserManagementFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonTutanotaConstants){AccountType=_commonTutanotaConstants.AccountType,Const=_commonTutanotaConstants.Const,GroupType=_commonTutanotaConstants.GroupType},function(_EntityWorker){load=_EntityWorker.load,serviceRequestVoid=_EntityWorker.serviceRequestVoid},function(_entitiesSysGroup){GroupTypeRef=_entitiesSysGroup.GroupTypeRef},function(_cryptoCryptoFacade){decryptKey=_cryptoCryptoFacade.decryptKey,encryptBytes=_cryptoCryptoFacade.encryptBytes,encryptKey=_cryptoCryptoFacade.encryptKey,encryptString=_cryptoCryptoFacade.encryptString},function(_cryptoBcrypt){generateKeyFromPassphrase=_cryptoBcrypt.generateKeyFromPassphrase,generateRandomSalt=_cryptoBcrypt.generateRandomSalt},function(_cryptoCryptoConstants){KeyLength=_cryptoCryptoConstants.KeyLength},function(_commonUtilsUtils){asyncFind=_commonUtilsUtils.asyncFind,neverNull=_commonUtilsUtils.neverNull},function(_cryptoCryptoUtils){createAuthVerifier=_cryptoCryptoUtils.createAuthVerifier},function(_entitiesSysResetPasswordData){createResetPasswordData=_entitiesSysResetPasswordData.createResetPasswordData},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod},function(_entitiesSysMembershipAddData){createMembershipAddData=_entitiesSysMembershipAddData.createMembershipAddData},function(_entitiesSysGroupInfo){GroupInfoTypeRef=_entitiesSysGroupInfo.GroupInfoTypeRef},function(_entitiesSysUserDataDelete){createUserDataDelete=_entitiesSysUserDataDelete.createUserDataDelete},function(_cryptoAes){aes128RandomKey=_cryptoAes.aes128RandomKey},function(_entitiesTutanotaUserAccountUserData){createUserAccountUserData=_entitiesTutanotaUserAccountUserData.createUserAccountUserData},function(_entitiesTutanotaUserAccountCreateData){createUserAccountCreateData=_entitiesTutanotaUserAccountCreateData.createUserAccountCreateData},function(_entitiesTutanotaServices){TutanotaService=_entitiesTutanotaServices.TutanotaService},function(_cryptoRandomizer){random=_cryptoRandomizer.random},function(_entitiesTutanotaContactFormUserData){createContactFormUserData=_entitiesTutanotaContactFormUserData.createContactFormUserData},function(_CounterFacade){_CounterFacade.CounterFacade},function(_entitiesSysUpdateAdminshipData){createUpdateAdminshipData=_entitiesSysUpdateAdminshipData.createUpdateAdminshipData},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService},function(_cryptoRsa){generateRsaKey=_cryptoRsa.generateRsaKey},function(_entitiesTutanotaCalendarGroupData){createCalendarGroupData=_entitiesTutanotaCalendarGroupData.createCalendarGroupData}],execute:function(){assertWorkerOrNode(),_export("UserManagementFacade",UserManagementFacade=function(){function UserManagementFacade(worker,login,groupManagement,counters){_classCallCheck(this,UserManagementFacade),this._worker=worker,this._login=login,this._groupManagement=groupManagement,this._counters=counters}return _createClass(UserManagementFacade,[{key:"changeUserPassword",value:function(user,newPassword){return this._groupManagement.getGroupKeyAsAdmin(user.userGroup.group).then(function(userGroupKey){var salt=generateRandomSalt(),passwordKey=generateKeyFromPassphrase(newPassword,salt,KeyLength.b128),pwEncUserGroupKey=encryptKey(passwordKey,userGroupKey),passwordVerifier=createAuthVerifier(passwordKey),data=createResetPasswordData();return data.user=user._id,data.salt=salt,data.verifier=passwordVerifier,data.pwEncUserGroupKey=pwEncUserGroupKey,serviceRequestVoid(SysService.ResetPasswordService,HttpMethod.POST,data)})}},{key:"changeAdminFlag",value:function(user,admin){var _this=this,adminGroupId=this._login.getGroupId(GroupType.Admin),adminGroupKey=this._login.getGroupKey(adminGroupId);return load(GroupTypeRef,user.userGroup.group).then(function(userGroup){var userGroupKey=decryptKey(adminGroupKey,neverNull(userGroup.adminGroupEncGKey));return _this._getAccountGroupMembership().then(function(accountGroupMembership){return admin?_this._groupManagement.addUserToGroup(user,adminGroupId).then(function(){var addAccountGroup=createMembershipAddData();return addAccountGroup.user=user._id,addAccountGroup.group=accountGroupMembership.group,addAccountGroup.symEncGKey=encryptKey(userGroupKey,decryptKey(_this._login.getUserGroupKey(),accountGroupMembership.symEncGKey)),serviceRequestVoid(SysService.MembershipService,HttpMethod.POST,addAccountGroup)}):_this._groupManagement.removeUserFromGroup(user._id,adminGroupId).then(function(){return _this._groupManagement.removeUserFromGroup(user._id,accountGroupMembership.group)})})})}},{key:"_getAccountGroupMembership",value:function(){var mailAddress=this._login.getLoggedInUser().accountType===AccountType.PREMIUM?"premium@tutanota.de":"starter@tutanota.de";return asyncFind(this._login.getLoggedInUser().memberships,function(membership){return load(GroupInfoTypeRef,membership.groupInfo).then(function(groupInfo){return groupInfo.mailAddress===mailAddress})}).then(function(membership){return neverNull(membership)})}},{key:"updateAdminship",value:function(groupId,newAdminGroupId){var _this2=this,adminGroupId=this._login.getGroupId(GroupType.Admin);return load(GroupTypeRef,newAdminGroupId).then(function(newAdminGroup){return load(GroupTypeRef,groupId).then(function(group){return load(GroupTypeRef,neverNull(group.admin)).then(function(oldAdminGroup){var data=createUpdateAdminshipData();data.group=group._id,data.newAdminGroup=newAdminGroup._id;var adminGroupKey=_this2._login.getGroupKey(adminGroupId),groupKey=void 0;if(oldAdminGroup._id===adminGroupId)groupKey=decryptKey(adminGroupKey,neverNull(group.adminGroupEncGKey));else{var localAdminGroupKey=decryptKey(adminGroupKey,neverNull(oldAdminGroup.adminGroupEncGKey));groupKey=decryptKey(localAdminGroupKey,neverNull(group.adminGroupEncGKey))}if(newAdminGroup._id===adminGroupId)data.newAdminGroupEncGKey=encryptKey(adminGroupKey,groupKey);else{var _localAdminGroupKey=decryptKey(adminGroupKey,neverNull(newAdminGroup.adminGroupEncGKey));data.newAdminGroupEncGKey=encryptKey(_localAdminGroupKey,groupKey)}return serviceRequestVoid(SysService.UpdateAdminshipService,HttpMethod.POST,data)})})})}},{key:"readUsedUserStorage",value:function(user){var _this3=this;return this._counters.readCounterValue(Const.COUNTER_USED_MEMORY,this._getGroupId(user,GroupType.Mail)).then(function(mailStorage){return _this3._counters.readCounterValue(Const.COUNTER_USED_MEMORY,_this3._getGroupId(user,GroupType.Contact)).then(function(contactStorage){return _this3._counters.readCounterValue(Const.COUNTER_USED_MEMORY,_this3._getGroupId(user,GroupType.File)).then(function(fileStorage){return Number(mailStorage)+Number(contactStorage)+Number(fileStorage)})})})}},{key:"deleteUser",value:function(user,restore){var data=createUserDataDelete();return data.user=user._id,data.restore=restore,data.date=Const.CURRENT_DATE,serviceRequestVoid(SysService.UserService,HttpMethod.DELETE,data)}},{key:"_getGroupId",value:function(user,groupType){if(groupType===GroupType.User)return user.userGroup.group;var membership=user.memberships.find(function(m){return m.groupType===groupType});if(!membership)throw new Error("could not find groupType "+groupType+" for user "+user._id);return membership.group}},{key:"createUser",value:function(name,mailAddress,password,userIndex,overallNbrOfUsersToCreate){var _this4=this,adminGroupIds=this._login.getGroupIds(GroupType.Admin);0===adminGroupIds.length&&(adminGroupIds=this._login.getGroupIds(GroupType.LocalAdmin));var adminGroupId=adminGroupIds[0],adminGroupKey=this._login.getGroupKey(adminGroupId),customerGroupKey=this._login.getGroupKey(this._login.getGroupId(GroupType.Customer)),userGroupKey=aes128RandomKey(),userGroupInfoSessionKey=aes128RandomKey();return generateRsaKey().then(function(keyPair){return _this4._groupManagement.generateInternalGroupData(keyPair,userGroupKey,userGroupInfoSessionKey,adminGroupId,adminGroupKey,customerGroupKey)}).then(function(userGroupData){return _this4._worker.sendProgress((userIndex+.8)/overallNbrOfUsersToCreate*100).then(function(){var data=createUserAccountCreateData();return data.date=Const.CURRENT_DATE,data.userGroupData=userGroupData,data.userData=_this4.generateUserAccountData(userGroupKey,userGroupInfoSessionKey,customerGroupKey,mailAddress,password,name,_this4._login.generateRecoveryCode(userGroupKey)),serviceRequestVoid(TutanotaService.UserAccountService,HttpMethod.POST,data).then(function(){return _this4._worker.sendProgress((userIndex+1)/overallNbrOfUsersToCreate*100)})})})}},{key:"generateUserAccountData",value:function(userGroupKey,userGroupInfoSessionKey,customerGroupKey,mailAddress,password,userName,recoverData){var salt=generateRandomSalt(),userPassphraseKey=generateKeyFromPassphrase(password,salt,KeyLength.b128),mailGroupKey=aes128RandomKey(),contactGroupKey=aes128RandomKey(),fileGroupKey=aes128RandomKey(),clientKey=aes128RandomKey(),mailboxSessionKey=aes128RandomKey(),contactListSessionKey=aes128RandomKey(),fileSystemSessionKey=aes128RandomKey(),mailGroupInfoSessionKey=aes128RandomKey(),contactGroupInfoSessionKey=aes128RandomKey(),fileGroupInfoSessionKey=aes128RandomKey(),tutanotaPropertiesSessionKey=aes128RandomKey(),userEncEntropy=encryptBytes(userGroupKey,random.generateRandomData(32)),userData=createUserAccountUserData();return userData.mailAddress=mailAddress,userData.encryptedName=encryptString(userGroupInfoSessionKey,userName),userData.salt=salt,userData.verifier=createAuthVerifier(userPassphraseKey),userData.userEncClientKey=encryptKey(userGroupKey,clientKey),userData.pwEncUserGroupKey=encryptKey(userPassphraseKey,userGroupKey),userData.userEncCustomerGroupKey=encryptKey(userGroupKey,customerGroupKey),userData.userEncMailGroupKey=encryptKey(userGroupKey,mailGroupKey),userData.userEncContactGroupKey=encryptKey(userGroupKey,contactGroupKey),userData.userEncFileGroupKey=encryptKey(userGroupKey,fileGroupKey),userData.userEncEntropy=userEncEntropy,userData.userEncTutanotaPropertiesSessionKey=encryptKey(userGroupKey,tutanotaPropertiesSessionKey),userData.mailEncMailBoxSessionKey=encryptKey(mailGroupKey,mailboxSessionKey),userData.contactEncContactListSessionKey=encryptKey(contactGroupKey,contactListSessionKey),userData.fileEncFileSystemSessionKey=encryptKey(fileGroupKey,fileSystemSessionKey),userData.customerEncMailGroupInfoSessionKey=encryptKey(customerGroupKey,mailGroupInfoSessionKey),userData.customerEncContactGroupInfoSessionKey=encryptKey(customerGroupKey,contactGroupInfoSessionKey),userData.customerEncFileGroupInfoSessionKey=encryptKey(customerGroupKey,fileGroupInfoSessionKey),userData.userEncRecoverCode=recoverData.userEncRecoverCode,userData.recoverCodeEncUserGroupKey=recoverData.recoverCodeEncUserGroupKey,userData.recoverCodeVerifier=recoverData.recoveryCodeVerifier,userData}},{key:"generateCalendarGroupData",value:function(adminGroup,adminGroupKey,customerGroupKey,userGroupKey,name){var calendarGroupRootSessionKey=aes128RandomKey(),calendarGroupInfoSessionKey=aes128RandomKey(),calendarGroupKey=aes128RandomKey(),calendarData=createCalendarGroupData();return calendarData.calendarEncCalendarGroupRootSessionKey=encryptKey(calendarGroupKey,calendarGroupRootSessionKey),calendarData.ownerEncGroupInfoSessionKey=encryptKey(customerGroupKey,calendarGroupInfoSessionKey),calendarData.userEncGroupKey=encryptKey(userGroupKey,calendarGroupKey),calendarData.groupInfoEncName=name&&encryptString(calendarGroupInfoSessionKey,name)||new Uint8Array([]),calendarData.adminEncGroupKey=adminGroupKey?encryptKey(adminGroupKey,calendarGroupKey):null,calendarData.adminGroup=adminGroup,calendarData}},{key:"generateContactFormUserAccountData",value:function(userGroupKey,password){var salt=generateRandomSalt(),userPassphraseKey=generateKeyFromPassphrase(password,salt,KeyLength.b128),mailGroupKey=aes128RandomKey(),clientKey=aes128RandomKey(),mailboxSessionKey=aes128RandomKey(),mailGroupInfoSessionKey=aes128RandomKey(),tutanotaPropertiesSessionKey=aes128RandomKey(),userEncEntropy=encryptBytes(userGroupKey,random.generateRandomData(32)),userData=createContactFormUserData();return userData.salt=salt,userData.verifier=createAuthVerifier(userPassphraseKey),userData.userEncClientKey=encryptKey(userGroupKey,clientKey),userData.pwEncUserGroupKey=encryptKey(userPassphraseKey,userGroupKey),userData.userEncMailGroupKey=encryptKey(userGroupKey,mailGroupKey),userData.userEncEntropy=userEncEntropy,userData.userEncTutanotaPropertiesSessionKey=encryptKey(userGroupKey,tutanotaPropertiesSessionKey),userData.mailEncMailBoxSessionKey=encryptKey(mailGroupKey,mailboxSessionKey),userData.ownerEncMailGroupInfoSessionKey=encryptKey(mailGroupKey,mailGroupInfoSessionKey),userData}}]),UserManagementFacade}()),_export("UserManagementFacade",UserManagementFacade)}}}),System.register("src/api/entities/sys/CalendarEventRef.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CalendarEventRefTypeRef,_TypeModel;return _export("createCalendarEventRef",function(values){return Object.assign(create(_TypeModel,CalendarEventRefTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CalendarEventRefTypeRef",CalendarEventRefTypeRef=new TypeRef("sys","CalendarEventRef")),_export("CalendarEventRefTypeRef",CalendarEventRefTypeRef),_export("_TypeModel",_TypeModel={name:"CalendarEventRef",since:48,type:"AGGREGATED_TYPE",id:1532,rootId:"A3N5cwAF_A",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:1533,since:48,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},elementId:{name:"elementId",id:1534,since:48,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},listId:{name:"listId",id:1535,since:48,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/rest/EntityRestCache.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./EntityRestClient","../../common/EntityFunctions","../../common/TutanotaConstants","../../common/utils/ArrayUtils","../../common/utils/Utils","../../entities/sys/Permission","../../entities/sys/EntityEventBatch","../../Env","../../common/EntityConstants","../../entities/sys/Session","../../entities/tutanota/StatisticLogEntry","../../entities/sys/BucketPermission","../../entities/sys/SecondFactor","../../entities/sys/RecoverCode","../../common/error/RestError","../../entities/tutanota/Mail"],function(_export,_context){"use strict";var _classCallCheck,_createClass,typeRefToPath,firstBiggerThanSecond,GENERATED_MAX_ID,GENERATED_MIN_ID,getLetId,HttpMethod,isSameTypeRef,READ_ONLY_HEADER,resolveTypeReference,TypeRef,OperationType,flat,remove,clone,containsEventOfType,downcast,getEventOfType,neverNull,PermissionTypeRef,EntityEventBatchTypeRef,assertWorkerOrNode,EC,SessionTypeRef,StatisticLogEntryTypeRef,BucketPermissionTypeRef,SecondFactorTypeRef,RecoverCodeTypeRef,NotAuthorizedError,NotFoundError,MailTypeRef,ValueType,EntityRestCache;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_EntityRestClient){typeRefToPath=_EntityRestClient.typeRefToPath},function(_commonEntityFunctions){firstBiggerThanSecond=_commonEntityFunctions.firstBiggerThanSecond,GENERATED_MAX_ID=_commonEntityFunctions.GENERATED_MAX_ID,GENERATED_MIN_ID=_commonEntityFunctions.GENERATED_MIN_ID,getLetId=_commonEntityFunctions.getLetId,HttpMethod=_commonEntityFunctions.HttpMethod,isSameTypeRef=_commonEntityFunctions.isSameTypeRef,READ_ONLY_HEADER=_commonEntityFunctions.READ_ONLY_HEADER,resolveTypeReference=_commonEntityFunctions.resolveTypeReference,TypeRef=_commonEntityFunctions.TypeRef},function(_commonTutanotaConstants){OperationType=_commonTutanotaConstants.OperationType},function(_commonUtilsArrayUtils){flat=_commonUtilsArrayUtils.flat,remove=_commonUtilsArrayUtils.remove},function(_commonUtilsUtils){clone=_commonUtilsUtils.clone,containsEventOfType=_commonUtilsUtils.containsEventOfType,downcast=_commonUtilsUtils.downcast,getEventOfType=_commonUtilsUtils.getEventOfType,neverNull=_commonUtilsUtils.neverNull},function(_entitiesSysPermission){PermissionTypeRef=_entitiesSysPermission.PermissionTypeRef},function(_entitiesSysEntityEventBatch){EntityEventBatchTypeRef=_entitiesSysEntityEventBatch.EntityEventBatchTypeRef},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonEntityConstants){EC=_commonEntityConstants.default},function(_entitiesSysSession){SessionTypeRef=_entitiesSysSession.SessionTypeRef},function(_entitiesTutanotaStatisticLogEntry){StatisticLogEntryTypeRef=_entitiesTutanotaStatisticLogEntry.StatisticLogEntryTypeRef},function(_entitiesSysBucketPermission){BucketPermissionTypeRef=_entitiesSysBucketPermission.BucketPermissionTypeRef},function(_entitiesSysSecondFactor){SecondFactorTypeRef=_entitiesSysSecondFactor.SecondFactorTypeRef},function(_entitiesSysRecoverCode){RecoverCodeTypeRef=_entitiesSysRecoverCode.RecoverCodeTypeRef},function(_commonErrorRestError){NotAuthorizedError=_commonErrorRestError.NotAuthorizedError,NotFoundError=_commonErrorRestError.NotFoundError},function(_entitiesTutanotaMail){MailTypeRef=_entitiesTutanotaMail.MailTypeRef}],execute:function(){ValueType=EC.ValueType,assertWorkerOrNode(),_export("EntityRestCache",EntityRestCache=function(){function EntityRestCache(entityRestClient){_classCallCheck(this,EntityRestCache),this._entityRestClient=entityRestClient,this._entities={},this._listEntities={},this._ignoredTypes=[EntityEventBatchTypeRef,PermissionTypeRef,BucketPermissionTypeRef,SessionTypeRef,StatisticLogEntryTypeRef,SecondFactorTypeRef,RecoverCodeTypeRef]}return _createClass(EntityRestCache,[{key:"entityRequest",value:function(typeRef,method,listId,id,entity,queryParameter,extraHeaders){var _this=this,readOnly=!1;if(extraHeaders&&(readOnly="true"===extraHeaders[READ_ONLY_HEADER],delete extraHeaders[READ_ONLY_HEADER]),method!==HttpMethod.GET||this._ignoredTypes.find(function(ref){return isSameTypeRef(typeRef,ref)}))return this._entityRestClient.entityRequest(typeRef,method,listId,id,entity,queryParameter,extraHeaders);if("monitor"===typeRef.app||queryParameter&&queryParameter.version)return this._entityRestClient.entityRequest(typeRef,method,listId,id,entity,queryParameter,extraHeaders);if(!id&&queryParameter&&queryParameter.ids)return this._loadMultiple(typeRef,method,listId,id,entity,queryParameter,extraHeaders,readOnly);if(this.isRangeRequest(listId,id,queryParameter))return resolveTypeReference(typeRef).then(function(typeModel){if(typeModel.values._id.type===ValueType.GeneratedId){var params=neverNull(queryParameter);return _this._loadRange(downcast(typeRef),neverNull(listId),params.start,Number(params.count),"true"===params.reverse,readOnly)}return _this._entityRestClient.entityRequest(typeRef,method,listId,id,entity,queryParameter,extraHeaders)});if(id)return this._isInCache(typeRef,listId,id)?Promise.resolve(this._getFromCache(typeRef,listId,id)):this._entityRestClient.entityRequest(typeRef,method,listId,id,entity,queryParameter,extraHeaders).then(function(entity){return readOnly||_this._putIntoCache(entity),entity});throw new Error("invalid request params: "+String(listId)+", "+String(id)+", "+JSON.stringify(queryParameter))}},{key:"isRangeRequest",value:function(listId,id,queryParameter){return listId&&!id&&queryParameter&&null!==queryParameter.start&&void 0!==queryParameter.start&&null!==queryParameter.count&&void 0!==queryParameter.count&&queryParameter.reverse}},{key:"_loadMultiple",value:function(typeRef,method,listId,id,entity,queryParameter,extraHeaders,readOnly){var _this2=this,ids=queryParameter.ids.split(","),inCache=[],notInCache=[];ids.forEach(function(id){_this2._isInCache(typeRef,listId,id)?inCache.push(id):notInCache.push(id)});var newQuery=Object.assign({},queryParameter,{ids:notInCache.join(",")}),loadFromServerPromise=notInCache.length>0?this._entityRestClient.entityRequest(typeRef,method,listId,id,entity,newQuery,extraHeaders).then(function(response){var entities=downcast(response);return readOnly||entities.forEach(function(e){return _this2._putIntoCache(e)}),entities}):Promise.resolve([]);return Promise.all([loadFromServerPromise,inCache.map(function(id){return _this2._getFromCache(typeRef,listId,id)})]).then(flat)}},{key:"_loadRange",value:function(typeRef,listId,start,count,reverse,readOnly){var _this3=this,path=typeRefToPath(typeRef),listCache=this._listEntities[path]&&this._listEntities[path][listId]?this._listEntities[path][listId]:null;if(!listCache||start===GENERATED_MAX_ID&&reverse&&listCache.upperRangeId!==GENERATED_MAX_ID||start===GENERATED_MIN_ID&&!reverse&&listCache.lowerRangeId!==GENERATED_MIN_ID)return this._entityRestClient.entityRequest(typeRef,HttpMethod.GET,listId,null,null,{start:start,count:String(count),reverse:String(reverse)}).then(function(result){var entities=downcast(result);if(readOnly)return entities;var newListCache=void 0;return listCache?((newListCache=listCache).allRange=[],newListCache.lowerRangeId=start,newListCache.upperRangeId=start):(_this3._listEntities[path]||(_this3._listEntities[path]={}),newListCache={allRange:[],lowerRangeId:start,upperRangeId:start,elements:{}},_this3._listEntities[path][listId]=newListCache),_this3._handleElementRangeResult(newListCache,start,count,reverse,entities,count)});if(firstBiggerThanSecond(start,listCache.upperRangeId)||firstBiggerThanSecond(listCache.lowerRangeId,start)){if(firstBiggerThanSecond(start,listCache.upperRangeId)&&!reverse||firstBiggerThanSecond(listCache.lowerRangeId,start)&&reverse){if(readOnly)return downcast(this._entityRestClient.entityRequest(typeRef,HttpMethod.GET,listId,null,null,{start:start,count:String(count),reverse:String(reverse)}));var loadStartId=void 0;return loadStartId=firstBiggerThanSecond(start,listCache.upperRangeId)&&!reverse?listCache.upperRangeId:listCache.lowerRangeId,this._entityRestClient.entityRequest(typeRef,HttpMethod.GET,listId,null,null,{start:loadStartId,count:String(count),reverse:String(reverse)}).then(function(entities){_this3._handleElementRangeResult(neverNull(listCache),loadStartId,count,reverse,entities,count);var resultElements=_this3._provideFromCache(neverNull(listCache),start,count,reverse);return entities.length<count||resultElements.length===count?resultElements:_this3.entityRequest(typeRef,HttpMethod.GET,listId,null,null,{start:start,count:String(count),reverse:String(reverse)})})}var msg="invalid range request. path: "+path+" list: "+listId+" start: "+start+" count: "+count+" reverse: "+String(reverse)+" lower: "+listCache.lowerRangeId+" upper: "+listCache.upperRangeId;return Promise.reject(new Error(msg))}var newRequestParams=this._getNumberOfElementsToRead(listCache,start,count,reverse);return newRequestParams.newCount>0?this._entityRestClient.entityRequest(typeRef,HttpMethod.GET,listId,null,null,{start:newRequestParams.newStart,count:String(newRequestParams.newCount),reverse:String(reverse)}).then(function(result){var entities=downcast(result);return readOnly?_this3._provideFromCache(listCache,start,count-newRequestParams.newCount,reverse).concat(entities):_this3._handleElementRangeResult(neverNull(listCache),start,count,reverse,entities,newRequestParams.newCount)}):Promise.resolve(this._provideFromCache(listCache,start,count,reverse))}},{key:"_handleElementRangeResult",value:function(listCache,start,count,reverse,elements,targetCount){var elementsToAdd=elements;if(elements.length>0){reverse?(elementsToAdd=elements.reverse(),elements.length<targetCount?listCache.lowerRangeId=GENERATED_MIN_ID:listCache.lowerRangeId=getLetId(elements[0])[1]):elements.length<targetCount?listCache.upperRangeId=GENERATED_MAX_ID:listCache.upperRangeId=getLetId(elements[elements.length-1])[1];for(var i=0;i<elementsToAdd.length;i++)this._putIntoCache(elementsToAdd[i])}else reverse?listCache.lowerRangeId=GENERATED_MIN_ID:listCache.upperRangeId=GENERATED_MAX_ID;return this._provideFromCache(listCache,start,count,reverse)}},{key:"_getNumberOfElementsToRead",value:function(listCache,start,count,reverse){var allRangeList=listCache.allRange,elementsToRead=count,startElementId=start,indexOfStart=allRangeList.indexOf(start);return!reverse&&listCache.upperRangeId===GENERATED_MAX_ID||reverse&&listCache.lowerRangeId===GENERATED_MIN_ID?elementsToRead=0:0===allRangeList.length?elementsToRead=count:-1!==indexOfStart?reverse?(elementsToRead=count-indexOfStart,startElementId=allRangeList[0]):(elementsToRead=count-(allRangeList.length-1-indexOfStart),startElementId=allRangeList[allRangeList.length-1]):listCache.lowerRangeId===start||firstBiggerThanSecond(start,listCache.lowerRangeId)&&firstBiggerThanSecond(allRangeList[0],start)?reverse||(startElementId=allRangeList[allRangeList.length-1],elementsToRead=count-allRangeList.length):(listCache.upperRangeId===start||firstBiggerThanSecond(start,allRangeList[allRangeList.length-1])&&firstBiggerThanSecond(listCache.upperRangeId,start))&&reverse&&(startElementId=allRangeList[0],elementsToRead=count-allRangeList.length),{newStart:startElementId,newCount:elementsToRead}}},{key:"_provideFromCache",value:function(listCache,start,count,reverse){var range=listCache.allRange,ids=[];if(reverse){var i=void 0;for(i=range.length-1;i>=0&&!firstBiggerThanSecond(start,range[i]);i--);if(i>=0){var startIndex=i+1-count;startIndex<0&&(startIndex=0),(ids=range.slice(startIndex,i+1)).reverse()}else ids=[]}else{var _i=void 0;for(_i=0;_i<range.length&&!firstBiggerThanSecond(range[_i],start);_i++);ids=range.slice(_i,_i+count)}for(var result=[],a=0;a<ids.length;a++)result.push(clone(listCache.elements[ids[a]]));return result}},{key:"entityEventsReceived",value:function(data){var _this4=this;return Promise.map(data,function(update){var instanceListId=update.instanceListId,instanceId=update.instanceId,operation=update.operation,type=update.type,application=update.application;if("monitor"!==application){var typeRef=new TypeRef(application,type);switch(operation){case OperationType.UPDATE:return _this4._processUpdateEvent(typeRef,update);case OperationType.DELETE:return isSameTypeRef(MailTypeRef,typeRef)&&containsEventOfType(data,OperationType.CREATE,instanceId)||_this4._tryRemoveFromCache(typeRef,instanceListId,instanceId),update;case OperationType.CREATE:return _this4._processCreateEvent(typeRef,update,data)}}}).filter(Boolean)}},{key:"_processCreateEvent",value:function(typeRef,update,batch){var _this5=this,instanceListId=update.instanceListId,instanceId=update.instanceId;if(instanceListId){var path=typeRefToPath(typeRef),deleteEvent=getEventOfType(batch,OperationType.DELETE,instanceId);if(deleteEvent&&isSameTypeRef(MailTypeRef,typeRef)&&this._isInCache(typeRef,deleteEvent.instanceListId,instanceId)){var element=this._getFromCache(typeRef,deleteEvent.instanceListId,instanceId);return this._tryRemoveFromCache(typeRef,deleteEvent.instanceListId,instanceId),element._id=[instanceListId,instanceId],this._putIntoCache(element),update}if(this._isInCacheRange(path,instanceListId,instanceId))return this._entityRestClient.entityRequest(typeRef,HttpMethod.GET,instanceListId,instanceId).then(function(entity){return _this5._putIntoCache(entity)}).return(update).catch(this._handleProcessingError)}return update}},{key:"_processUpdateEvent",value:function(typeRef,update){var _this6=this,instanceListId=update.instanceListId,instanceId=update.instanceId;return this._isInCache(typeRef,instanceListId,instanceId)?this._entityRestClient.entityRequest(typeRef,HttpMethod.GET,instanceListId,instanceId).then(function(entity){return _this6._putIntoCache(entity)}).return(update).catch(this._handleProcessingError):update}},{key:"_handleProcessingError",value:function(e){if(e instanceof NotFoundError||e instanceof NotAuthorizedError)return null;throw e}},{key:"_isInCache",value:function(typeRef,listId,id){var path=typeRefToPath(typeRef);return listId?null!=this._listEntities[path]&&null!=this._listEntities[path][listId]&&null!=this._listEntities[path][listId].elements[id]:null!=this._entities[path]&&null!=this._entities[path][id]}},{key:"_getFromCache",value:function(typeRef,listId,id){var path=typeRefToPath(typeRef);return clone(listId?this._listEntities[path][listId].elements[id]:this._entities[path][id])}},{key:"_isInCacheRange",value:function(path,listId,id){return null!=this._listEntities[path]&&null!=this._listEntities[path][listId]&&!firstBiggerThanSecond(id,this._listEntities[path][listId].upperRangeId)&&!firstBiggerThanSecond(this._listEntities[path][listId].lowerRangeId,id)}},{key:"_putIntoCache",value:function(originalEntity){var entity=clone(originalEntity),path=typeRefToPath(entity._type);if(entity._id instanceof Array){this._listEntities[path]||(this._listEntities[path]={});var listId=entity._id[0],id=entity._id[1];this._listEntities[path][listId]?(this._listEntities[path][listId].elements[id]=entity,this._isInCacheRange(path,listId,id)&&this._insertIntoRange(this._listEntities[path][listId].allRange,id)):(this._listEntities[path][listId]={allRange:[id],lowerRangeId:id,upperRangeId:id,elements:{}},this._listEntities[path][listId].elements[id]=entity)}else this._entities[path]||(this._entities[path]={}),this._entities[path][entity._id]=entity}},{key:"_insertIntoRange",value:function(allRange,elementId){for(var i=0;i<allRange.length;i++){var rangeElement=allRange[i];if(firstBiggerThanSecond(rangeElement,elementId))return void allRange.splice(i,0,elementId);if(rangeElement===elementId)return}allRange.push(elementId)}},{key:"_tryRemoveFromCache",value:function(typeRef,listId,id){var path=typeRefToPath(typeRef);this._isInCache(typeRef,listId,id)&&(listId?(delete this._listEntities[path][listId].elements[id],remove(this._listEntities[path][listId].allRange,id)):delete this._entities[path][id])}}]),EntityRestCache}()),_export("EntityRestCache",EntityRestCache)}}}),System.register("src/api/entities/tutanota/CalendarPostReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CalendarPostReturnTypeRef,_TypeModel;return _export("createCalendarPostReturn",function(values){return Object.assign(create(_TypeModel,CalendarPostReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CalendarPostReturnTypeRef",CalendarPostReturnTypeRef=new TypeRef("tutanota","CalendarPostReturn")),_export("CalendarPostReturnTypeRef",CalendarPostReturnTypeRef),_export("_TypeModel",_TypeModel={name:"CalendarPostReturn",since:34,type:"DATA_TRANSFER_TYPE",id:985,rootId:"CHR1dGFub3RhAAPZ",versioned:!1,encrypted:!0,values:{_format:{name:"_format",id:986,since:34,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{group:{name:"group",id:987,since:34,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!0,external:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/CalendarFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/toConsumableArray.js","node_modules/systemjs-plugin-babel/babel-helpers/slicedToArray.js","node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../EntityWorker","../../Env","../../entities/sys/UserAlarmInfo","../../common/utils/Utils","../../common/EntityFunctions","../../worker/EntityWorker","../../entities/sys/PushIdentifier","../crypto/CryptoFacade","../../entities/sys/AlarmServicePost","../../entities/sys/Services","../crypto/Aes","../../entities/sys/AlarmNotification","../../entities/sys/AlarmInfo","../../entities/sys/RepeatRule","../../common/TutanotaConstants","../../entities/sys/NotificationSessionKey","../../entities/tutanota/CalendarPostData","./UserManagementFacade","../../entities/tutanota/Services","../../entities/sys/Group","../../entities/tutanota/CalendarEvent","../../entities/sys/CalendarEventRef","../../entities/sys/User","../rest/EntityRestCache","../../common/error/RestError","../../entities/tutanota/CalendarDeleteData","../../entities/tutanota/CalendarPostReturn"],function(_export,_context){"use strict";var _toConsumableArray,_slicedToArray,_classCallCheck,_createClass,erase,serviceRequest,setup,update,assertWorkerOrNode,createUserAlarmInfo,UserAlarmInfoTypeRef,neverNull,noOp,elementIdPart,HttpMethod,isSameId,listIdPart,load,loadAll,serviceRequestVoid,PushIdentifierTypeModel,PushIdentifierTypeRef,encryptKey,resolveSessionKey,createAlarmServicePost,SysService,aes128RandomKey,createAlarmNotification,createAlarmInfo,createRepeatRule,GroupType,OperationType,createNotificationSessionKey,createCalendarPostData,TutanotaService,GroupTypeRef,CalendarEventTypeRef,createCalendarEventRef,UserTypeRef,NotAuthorizedError,NotFoundError,createCalendarDeleteData,CalendarPostReturnTypeRef,CalendarFacade;function createAlarmNotificationForEvent(event,alarmInfo,userId){return createAlarmNotification({alarmInfo:function(alarmInfo){var calendarRef=Object.assign(createCalendarEventRef(),{elementId:alarmInfo.calendarRef.elementId,listId:alarmInfo.calendarRef.listId});return Object.assign(createAlarmInfo(),{alarmIdentifier:alarmInfo.alarmIdentifier,trigger:alarmInfo.trigger,calendarRef:calendarRef})}(alarmInfo),repeatRule:event.repeatRule&&(calendarRepeatRule=event.repeatRule,Object.assign(createRepeatRule(),{endType:calendarRepeatRule.endType,endValue:calendarRepeatRule.endValue,frequency:calendarRepeatRule.frequency,interval:calendarRepeatRule.interval,timeZone:calendarRepeatRule.timeZone})),notificationSessionKeys:[],operation:OperationType.CREATE,summary:event.summary,eventStart:event.startTime,eventEnd:event.endTime,user:userId});var calendarRepeatRule}return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs){_toConsumableArray=_node_modulesSystemjsPluginBabelBabelHelpersToConsumableArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs){_slicedToArray=_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_EntityWorker){erase=_EntityWorker.erase,serviceRequest=_EntityWorker.serviceRequest,setup=_EntityWorker.setup,update=_EntityWorker.update},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_entitiesSysUserAlarmInfo){createUserAlarmInfo=_entitiesSysUserAlarmInfo.createUserAlarmInfo,UserAlarmInfoTypeRef=_entitiesSysUserAlarmInfo.UserAlarmInfoTypeRef},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull,noOp=_commonUtilsUtils.noOp},function(_commonEntityFunctions){elementIdPart=_commonEntityFunctions.elementIdPart,HttpMethod=_commonEntityFunctions.HttpMethod,isSameId=_commonEntityFunctions.isSameId,listIdPart=_commonEntityFunctions.listIdPart},function(_workerEntityWorker){load=_workerEntityWorker.load,loadAll=_workerEntityWorker.loadAll,serviceRequestVoid=_workerEntityWorker.serviceRequestVoid},function(_entitiesSysPushIdentifier){PushIdentifierTypeModel=_entitiesSysPushIdentifier._TypeModel,PushIdentifierTypeRef=_entitiesSysPushIdentifier.PushIdentifierTypeRef},function(_cryptoCryptoFacade){encryptKey=_cryptoCryptoFacade.encryptKey,resolveSessionKey=_cryptoCryptoFacade.resolveSessionKey},function(_entitiesSysAlarmServicePost){createAlarmServicePost=_entitiesSysAlarmServicePost.createAlarmServicePost},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService},function(_cryptoAes){aes128RandomKey=_cryptoAes.aes128RandomKey},function(_entitiesSysAlarmNotification){createAlarmNotification=_entitiesSysAlarmNotification.createAlarmNotification},function(_entitiesSysAlarmInfo){createAlarmInfo=_entitiesSysAlarmInfo.createAlarmInfo},function(_entitiesSysRepeatRule){createRepeatRule=_entitiesSysRepeatRule.createRepeatRule},function(_commonTutanotaConstants){GroupType=_commonTutanotaConstants.GroupType,OperationType=_commonTutanotaConstants.OperationType},function(_entitiesSysNotificationSessionKey){createNotificationSessionKey=_entitiesSysNotificationSessionKey.createNotificationSessionKey},function(_entitiesTutanotaCalendarPostData){createCalendarPostData=_entitiesTutanotaCalendarPostData.createCalendarPostData},function(_UserManagementFacade){_UserManagementFacade.UserManagementFacade},function(_entitiesTutanotaServices){TutanotaService=_entitiesTutanotaServices.TutanotaService},function(_entitiesSysGroup){GroupTypeRef=_entitiesSysGroup.GroupTypeRef},function(_entitiesTutanotaCalendarEvent){CalendarEventTypeRef=_entitiesTutanotaCalendarEvent.CalendarEventTypeRef},function(_entitiesSysCalendarEventRef){createCalendarEventRef=_entitiesSysCalendarEventRef.createCalendarEventRef},function(_entitiesSysUser){UserTypeRef=_entitiesSysUser.UserTypeRef},function(_restEntityRestCache){_restEntityRestCache.EntityRestCache},function(_commonErrorRestError){NotAuthorizedError=_commonErrorRestError.NotAuthorizedError,NotFoundError=_commonErrorRestError.NotFoundError},function(_entitiesTutanotaCalendarDeleteData){createCalendarDeleteData=_entitiesTutanotaCalendarDeleteData.createCalendarDeleteData},function(_entitiesTutanotaCalendarPostReturn){CalendarPostReturnTypeRef=_entitiesTutanotaCalendarPostReturn.CalendarPostReturnTypeRef}],execute:function(){assertWorkerOrNode(),_export("CalendarFacade",CalendarFacade=function(){function CalendarFacade(loginFacade,userManagementFacade,entityRestCache){_classCallCheck(this,CalendarFacade),this._loginFacade=loginFacade,this._userManagementFacade=userManagementFacade,this._entityRestCache=entityRestCache}return _createClass(CalendarFacade,[{key:"createCalendarEvent",value:function(event,alarmInfos,oldEvent){var _this=this,user=this._loginFacade.getLoggedInUser(),p=Promise.resolve();return oldEvent&&(p=erase(oldEvent).catch(NotFoundError,noOp)),p.then(function(){return _this._createAlarms(user,event,alarmInfos)}).then(function(userAlarmIdsWithAlarmNotifications){return event.alarmInfos.length=0,userAlarmIdsWithAlarmNotifications.forEach(function(_ref){var id=_slicedToArray(_ref,1)[0];event.alarmInfos.push(id)}),setup(listIdPart(event._id),event).then(function(){var alarmNotifications=userAlarmIdsWithAlarmNotifications.map(function(_ref3){var _ref4=_slicedToArray(_ref3,2);_ref4[0];return _ref4[1]});if(alarmNotifications.length>0)return loadAll(PushIdentifierTypeRef,neverNull(_this._loginFacade.getLoggedInUser().pushIdentifierList).list).then(function(pushIdentifierList){return _this._sendAlarmNotifications(alarmNotifications,pushIdentifierList)})})})}},{key:"updateCalendarEvent",value:function(newEvent,newAlarms,existingEvent){var _this2=this;newEvent._id=existingEvent._id,newEvent._ownerEncSessionKey=existingEvent._ownerEncSessionKey,newEvent._permissions=existingEvent._permissions;var user=this._loginFacade.getLoggedInUser();return Promise.resolve().then(function(){return _this2._createAlarms(user,newEvent,newAlarms)}).then(function(userAlarmIdsWithAlarmNotifications){var _newEvent$alarmInfos,userAlarmInfoListId=neverNull(user.alarmInfoList).alarms;(newEvent.alarmInfos=existingEvent.alarmInfos.filter(function(a){return!isSameId(listIdPart(a),userAlarmInfoListId)}),userAlarmIdsWithAlarmNotifications)&&(_newEvent$alarmInfos=newEvent.alarmInfos).push.apply(_newEvent$alarmInfos,_toConsumableArray(userAlarmIdsWithAlarmNotifications.map(function(_ref5){return _slicedToArray(_ref5,1)[0]})));return update(newEvent).then(function(){if(userAlarmIdsWithAlarmNotifications){var alarmNotifications=userAlarmIdsWithAlarmNotifications.map(function(_ref7){var _ref8=_slicedToArray(_ref7,2);_ref8[0];return _ref8[1]});if(alarmNotifications.length>0)return loadAll(PushIdentifierTypeRef,neverNull(_this2._loginFacade.getLoggedInUser().pushIdentifierList).list).then(function(pushIdentifierList){return _this2._sendAlarmNotifications(alarmNotifications,pushIdentifierList)})}})})}},{key:"_createAlarms",value:function(user,event,alarmInfos){var userAlarmInfoListId=neverNull(user.alarmInfoList).alarms;return Promise.map(alarmInfos,function(alarmInfo){var newAlarm=createUserAlarmInfo();newAlarm._ownerGroup=user.userGroup.group,newAlarm.alarmInfo=alarmInfo,newAlarm.alarmInfo.calendarRef=createCalendarEventRef({listId:listIdPart(event._id),elementId:elementIdPart(event._id)});var alarmNotification=createAlarmNotificationForEvent(event,alarmInfo,user._id);return setup(userAlarmInfoListId,newAlarm).then(function(id){return[[userAlarmInfoListId,id],alarmNotification]})})}},{key:"_sendAlarmNotifications",value:function(alarmNotifications,pushIdentifierList){var notificationSessionKey=aes128RandomKey();return Promise.map(pushIdentifierList,function(identifier){return resolveSessionKey(PushIdentifierTypeModel,identifier).then(function(pushIdentifierSk){if(pushIdentifierSk){var pushIdentifierSessionEncSessionKey=encryptKey(pushIdentifierSk,notificationSessionKey);return{identifierId:identifier._id,pushIdentifierSessionEncSessionKey:pushIdentifierSessionEncSessionKey}}return null})}).then(function(maybeEncSessionKeys){var encSessionKeys=maybeEncSessionKeys.filter(Boolean),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=alarmNotifications[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){_step.value.notificationSessionKeys=encSessionKeys.map(function(esk){return Object.assign(createNotificationSessionKey(),{pushIdentifier:esk.identifierId,pushIdentifierSessionEncSessionKey:esk.pushIdentifierSessionEncSessionKey})})}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var requestEntity=createAlarmServicePost();return requestEntity.alarmNotifications=alarmNotifications,serviceRequestVoid(SysService.AlarmService,HttpMethod.POST,requestEntity,null,notificationSessionKey)})}},{key:"addCalendar",value:function(name){var _this3=this;return load(GroupTypeRef,this._loginFacade.getUserGroupId()).then(function(userGroup){var adminGroupId=neverNull(userGroup.admin),adminGroupKey=null;-1!==_this3._loginFacade.getAllGroupIds().indexOf(adminGroupId)&&(adminGroupKey=_this3._loginFacade.getGroupKey(adminGroupId));var customerGroupKey=_this3._loginFacade.getGroupKey(_this3._loginFacade.getGroupId(GroupType.Customer)),userGroupKey=_this3._loginFacade.getUserGroupKey(),calendarData=_this3._userManagementFacade.generateCalendarGroupData(adminGroupId,adminGroupKey,customerGroupKey,userGroupKey,name),postData=Object.assign(createCalendarPostData(),{calendarData:calendarData});return serviceRequest(TutanotaService.CalendarService,HttpMethod.POST,postData,CalendarPostReturnTypeRef).then(function(returnData){return load(GroupTypeRef,returnData.group)}).then(function(group){return _this3._entityRestCache._tryRemoveFromCache(UserTypeRef,null,neverNull(userGroup.user)),load(UserTypeRef,neverNull(userGroup.user)).then(function(user){return _this3._loginFacade._user=user,{user:user,group:group}})})})}},{key:"deleteCalendar",value:function(groupRootId){return serviceRequestVoid(TutanotaService.CalendarService,HttpMethod.DELETE,Object.assign(createCalendarDeleteData(),{groupRootId:groupRootId}))}},{key:"scheduleAlarmsForNewDevice",value:function(pushIdentifier){var _this4=this,user=this._loginFacade.getLoggedInUser();return this.loadAlarmEvents().then(function(eventsWithAlarmInfo){var alarmNotifications=eventsWithAlarmInfo.map(function(_ref9){return createAlarmNotificationForEvent(_ref9.event,_ref9.userAlarmInfo.alarmInfo,user._id)});return _this4._sendAlarmNotifications(alarmNotifications,[pushIdentifier])})}},{key:"loadAlarmEvents",value:function(){var alarmInfoList=this._loginFacade.getLoggedInUser().alarmInfoList;return alarmInfoList?loadAll(UserAlarmInfoTypeRef,alarmInfoList.alarms).then(function(userAlarmInfos){return Promise.map(userAlarmInfos,function(userAlarmInfo){return load(CalendarEventTypeRef,[userAlarmInfo.alarmInfo.calendarRef.listId,userAlarmInfo.alarmInfo.calendarRef.elementId]).then(function(event){return{event:event,userAlarmInfo:userAlarmInfo}}).catch(NotFoundError,function(){return null}).catch(NotAuthorizedError,function(e){return console.warn("NotAuthorized when downloading alarm event",e),null})}).filter(Boolean)}):(console.warn("No alarmInfo list on user"),Promise.resolve([]))}}]),CalendarFacade}()),_export("CalendarFacade",CalendarFacade)}}}),System.register("src/api/entities/tutanota/SharedGroupData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SharedGroupDataTypeRef,_TypeModel;return _export("createSharedGroupData",function(values){return Object.assign(create(_TypeModel,SharedGroupDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SharedGroupDataTypeRef",SharedGroupDataTypeRef=new TypeRef("tutanota","SharedGroupData")),_export("SharedGroupDataTypeRef",SharedGroupDataTypeRef),_export("_TypeModel",_TypeModel={name:"SharedGroupData",since:38,type:"AGGREGATED_TYPE",id:992,rootId:"CHR1dGFub3RhAAPg",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:993,since:38,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},bucketEncInvitationSessionKey:{name:"bucketEncInvitationSessionKey",id:998,since:38,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},capability:{name:"capability",id:994,since:38,type:"Number",cardinality:"One",final:!1,encrypted:!1},sessionEncInviterName:{name:"sessionEncInviterName",id:997,since:38,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},sessionEncSharedGroupKey:{name:"sessionEncSharedGroupKey",id:995,since:38,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},sessionEncSharedGroupName:{name:"sessionEncSharedGroupName",id:996,since:38,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},sharedGroup:{name:"sharedGroup",id:1001,since:38,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1},sharedGroupEncInviterGroupInfoKey:{name:"sharedGroupEncInviterGroupInfoKey",id:999,since:38,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},sharedGroupEncSharedGroupInfoKey:{name:"sharedGroupEncSharedGroupInfoKey",id:1e3,since:38,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/InternalRecipientKeyData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,InternalRecipientKeyDataTypeRef,_TypeModel;return _export("createInternalRecipientKeyData",function(values){return Object.assign(create(_TypeModel,InternalRecipientKeyDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("InternalRecipientKeyDataTypeRef",InternalRecipientKeyDataTypeRef=new TypeRef("tutanota","InternalRecipientKeyData")),_export("InternalRecipientKeyDataTypeRef",InternalRecipientKeyDataTypeRef),_export("_TypeModel",_TypeModel={name:"InternalRecipientKeyData",since:11,type:"AGGREGATED_TYPE",id:527,rootId:"CHR1dGFub3RhAAIP",versioned:!1,encrypted:!1,values:{_id:{name:"_id",id:528,since:11,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},mailAddress:{name:"mailAddress",id:529,since:11,type:"String",cardinality:"One",final:!0,encrypted:!1},pubEncBucketKey:{name:"pubEncBucketKey",id:530,since:11,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},pubKeyVersion:{name:"pubKeyVersion",id:531,since:11,type:"Number",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/ReceipientKeyDataUtils.js",["../../entities/sys/PublicKeyData","../EntityWorker","../../entities/sys/Services","../../common/EntityFunctions","../../entities/sys/PublicKeyReturn","../crypto/Rsa","../../common/utils/Encoding","../crypto/CryptoUtils","../../entities/tutanota/InternalRecipientKeyData","../../common/error/RestError","../../common/error/RecipientNotResolvedError"],function(_export,_context){"use strict";var createPublicKeyData,serviceRequest,SysService,HttpMethod,PublicKeyReturnTypeRef,hexToPublicKey,rsaEncrypt,uint8ArrayToHex,bitArrayToUint8Array,createInternalRecipientKeyData,NotFoundError,TooManyRequestsError,RecipientNotResolvedError;return _export("encryptBucketKeyForInternalRecipient",function(bucketKey,recipientInfo,notFoundRecipients){var keyData=createPublicKeyData();return keyData.mailAddress=recipientInfo.mailAddress,serviceRequest(SysService.PublicKeyService,HttpMethod.GET,keyData,PublicKeyReturnTypeRef).then(function(publicKeyData){var publicKey=hexToPublicKey(uint8ArrayToHex(publicKeyData.pubKey)),uint8ArrayBucketKey=bitArrayToUint8Array(bucketKey);if(0===notFoundRecipients.length)return rsaEncrypt(publicKey,uint8ArrayBucketKey).then(function(encrypted){var data=createInternalRecipientKeyData();return data.mailAddress=recipientInfo.mailAddress,data.pubEncBucketKey=encrypted,data.pubKeyVersion=publicKeyData.pubKeyVersion,data})}).catch(NotFoundError,function(e){notFoundRecipients.push(recipientInfo.mailAddress)}).catch(TooManyRequestsError,function(e){throw new RecipientNotResolvedError})}),{setters:[function(_entitiesSysPublicKeyData){createPublicKeyData=_entitiesSysPublicKeyData.createPublicKeyData},function(_EntityWorker){serviceRequest=_EntityWorker.serviceRequest},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod},function(_entitiesSysPublicKeyReturn){PublicKeyReturnTypeRef=_entitiesSysPublicKeyReturn.PublicKeyReturnTypeRef},function(_cryptoRsa){hexToPublicKey=_cryptoRsa.hexToPublicKey,rsaEncrypt=_cryptoRsa.rsaEncrypt},function(_commonUtilsEncoding){uint8ArrayToHex=_commonUtilsEncoding.uint8ArrayToHex},function(_cryptoCryptoUtils){bitArrayToUint8Array=_cryptoCryptoUtils.bitArrayToUint8Array},function(_entitiesTutanotaInternalRecipientKeyData){createInternalRecipientKeyData=_entitiesTutanotaInternalRecipientKeyData.createInternalRecipientKeyData},function(_commonErrorRestError){NotFoundError=_commonErrorRestError.NotFoundError,TooManyRequestsError=_commonErrorRestError.TooManyRequestsError},function(_commonErrorRecipientNotResolvedError){RecipientNotResolvedError=_commonErrorRecipientNotResolvedError.RecipientNotResolvedError}],execute:function(){}}}),System.registerDynamic("src/api/worker/crypto/lib/bCrypt.js",[],!0,function($__require,exports,module){this||self;function bCrypt(){this.GENSALT_DEFAULT_LOG2_ROUNDS=10,this.BCRYPT_SALT_LEN=16,this.BLOWFISH_NUM_ROUNDS=16,this.MAX_EXECUTION_TIME=100,this.P_orig=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],this.S_orig=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],this.bf_crypt_ciphertext=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892],this.base64_code=[".","/","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],this.index_64=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1],this.P,this.S,this.lr,this.offp}bCrypt.prototype.getByte=function(c){try{var b=c.charCodeAt(0)}catch(err){b=c}return b>127?b%128-128:b},bCrypt.prototype.encode_base64=function(d,len){var c1,c2,off=0,rs=[];if(len<=0||len>d.length)throw"Invalid len";for(;off<len;){if(c1=255&d[off++],rs.push(this.base64_code[c1>>2&63]),c1=(3&c1)<<4,off>=len){rs.push(this.base64_code[63&c1]);break}if(c1|=(c2=255&d[off++])>>4&15,rs.push(this.base64_code[63&c1]),c1=(15&c2)<<2,off>=len){rs.push(this.base64_code[63&c1]);break}c1|=(c2=255&d[off++])>>6&3,rs.push(this.base64_code[63&c1]),rs.push(this.base64_code[63&c2])}return rs.join("")},bCrypt.prototype.char64=function(x){var code=x.charCodeAt(0);return code<0||code>this.index_64.length?-1:this.index_64[code]},bCrypt.prototype.decode_base64=function(s,maxolen){var c1,c2,c3,c4,o,off=0,slen=s.length,olen=0,rs=[];if(maxolen<=0)throw"Invalid maxolen";for(;off<slen-1&&olen<maxolen&&(c1=this.char64(s.charAt(off++)),c2=this.char64(s.charAt(off++)),-1!=c1&&-1!=c2)&&(o=this.getByte(c1<<2),o|=(48&c2)>>4,rs.push(String.fromCharCode(o)),!(++olen>=maxolen||off>=slen))&&-1!=(c3=this.char64(s.charAt(off++)))&&(o=this.getByte((15&c2)<<4),o|=(60&c3)>>2,rs.push(String.fromCharCode(o)),!(++olen>=maxolen||off>=slen));)c4=this.char64(s.charAt(off++)),o=this.getByte((3&c3)<<6),o|=c4,rs.push(String.fromCharCode(o)),++olen;var ret=[];for(off=0;off<olen;off++)ret.push(this.getByte(rs[off]));return ret},bCrypt.prototype.encipher=function(lr,off){var i,n,l=lr[off],r=lr[off+1];for(l^=this.P[0],i=0;i<=this.BLOWFISH_NUM_ROUNDS-2;)n=this.S[l>>24&255],n+=this.S[256|l>>16&255],n^=this.S[512|l>>8&255],r^=(n+=this.S[768|255&l])^this.P[++i],n=this.S[r>>24&255],n+=this.S[256|r>>16&255],n^=this.S[512|r>>8&255],l^=(n+=this.S[768|255&r])^this.P[++i];lr[off]=r^this.P[this.BLOWFISH_NUM_ROUNDS+1],lr[off+1]=l},bCrypt.prototype.streamtoword=function(data,offp){var i,word=0,off=offp;for(i=0;i<4;i++)word=word<<8|255&data[off],off=(off+1)%data.length;return this.offp=off,word},bCrypt.prototype.init_key=function(){this.P=this.P_orig.slice(),this.S=this.S_orig.slice()},bCrypt.prototype.key=function(key){var i;this.offp=0;var lr=new Array(0,0),plen=this.P.length,slen=this.S.length;for(i=0;i<plen;i++)this.P[i]=this.P[i]^this.streamtoword(key,this.offp);for(i=0;i<plen;i+=2)this.encipher(lr,0),this.P[i]=lr[0],this.P[i+1]=lr[1];for(i=0;i<slen;i+=2)this.encipher(lr,0),this.S[i]=lr[0],this.S[i+1]=lr[1]},bCrypt.prototype.ekskey=function(data,key){var i;this.offp=0;var lr=new Array(0,0),plen=this.P.length,slen=this.S.length;for(i=0;i<plen;i++)this.P[i]=this.P[i]^this.streamtoword(key,this.offp);for(this.offp=0,i=0;i<plen;i+=2)lr[0]^=this.streamtoword(data,this.offp),lr[1]^=this.streamtoword(data,this.offp),this.encipher(lr,0),this.P[i]=lr[0],this.P[i+1]=lr[1];for(i=0;i<slen;i+=2)lr[0]^=this.streamtoword(data,this.offp),lr[1]^=this.streamtoword(data,this.offp),this.encipher(lr,0),this.S[i]=lr[0],this.S[i+1]=lr[1]},bCrypt.prototype.crypt_raw=function(password,salt,log_rounds){var rounds,j,cdata=this.bf_crypt_ciphertext.slice(),clen=cdata.length;if(log_rounds<4||log_rounds>31)throw"Bad number of rounds";if(salt.length!=this.BCRYPT_SALT_LEN)throw"Bad _salt length";rounds=1<<log_rounds,Math.floor(rounds/100),this.init_key(),this.ekskey(salt,password);var obj=this,i=0,roundFunction=null;return(roundFunction=function(){if(i<rounds){for(new Date;i<rounds;)i+=1,obj.key(password),obj.key(salt);return roundFunction()}for(i=0;i<64;i++)for(j=0;j<clen>>1;j++)obj.encipher(cdata,j<<1);var ret=[];for(i=0;i<clen;i++)ret.push(obj.getByte(cdata[i]>>24&255)),ret.push(obj.getByte(cdata[i]>>16&255)),ret.push(obj.getByte(cdata[i]>>8&255)),ret.push(obj.getByte(255&cdata[i]));return ret})()},module.exports=bCrypt}),System.register("src/api/worker/crypto/Bcrypt.js",["./lib/bCrypt","./Randomizer","./Sha256","../../common/utils/Encoding","../../common/error/CryptoError","../../Env","./CryptoUtils","./CryptoConstants"],function(_export,_context){"use strict";var bCrypt,random,hash,stringToUtf8Uint8Array,CryptoError,assertWorkerOrNode,uint8ArrayToBitArray,KeyLength,logRounds;function _uint8ArrayToSignedBytes(unsignedBytes){return Array.from(new Uint8Array(new Int8Array(unsignedBytes)))}return _export("generateRandomSalt",function(){return random.generateRandomData(16)}),_export("generateKeyFromPassphrase",function(passphrase,salt,keyLengthType){var bytes=function(passphraseBytes,saltBytes,logRounds){try{return signedBytes=(new bCrypt).crypt_raw(_uint8ArrayToSignedBytes(passphraseBytes),_uint8ArrayToSignedBytes(saltBytes),logRounds),new Uint8Array(new Int8Array(signedBytes))}catch(e){throw new CryptoError(e)}var signedBytes}(hash(stringToUtf8Uint8Array(passphrase)),salt,logRounds);return keyLengthType===KeyLength.b128?uint8ArrayToBitArray(bytes.slice(0,16)):uint8ArrayToBitArray(hash(bytes))}),{setters:[function(_libBCrypt){bCrypt=_libBCrypt.default},function(_Randomizer){random=_Randomizer.random},function(_Sha){hash=_Sha.hash},function(_commonUtilsEncoding){stringToUtf8Uint8Array=_commonUtilsEncoding.stringToUtf8Uint8Array},function(_commonErrorCryptoError){CryptoError=_commonErrorCryptoError.CryptoError},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_CryptoUtils){uint8ArrayToBitArray=_CryptoUtils.uint8ArrayToBitArray},function(_CryptoConstants){KeyLength=_CryptoConstants.KeyLength}],execute:function(){assertWorkerOrNode(),logRounds=8}}}),System.register("src/api/worker/crypto/CryptoConstants.js",["../../Env"],function(_export,_context){"use strict";var assertWorkerOrNode,KeyLength;return{setters:[function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode}],execute:function(){assertWorkerOrNode(),_export("KeyLength",KeyLength=Object.freeze({b128:"128",b256:"256"})),_export("KeyLength",KeyLength)}}}),System.register("src/api/entities/sys/SaltData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SaltDataTypeRef,_TypeModel;return _export("createSaltData",function(values){return Object.assign(create(_TypeModel,SaltDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SaltDataTypeRef",SaltDataTypeRef=new TypeRef("sys","SaltData")),_export("SaltDataTypeRef",SaltDataTypeRef),_export("_TypeModel",_TypeModel={name:"SaltData",since:1,type:"DATA_TRANSFER_TYPE",id:417,rootId:"A3N5cwABoQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:418,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},mailAddress:{name:"mailAddress",id:419,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/SaltReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SaltReturnTypeRef,_TypeModel;return _export("createSaltReturn",function(values){return Object.assign(create(_TypeModel,SaltReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SaltReturnTypeRef",SaltReturnTypeRef=new TypeRef("sys","SaltReturn")),_export("SaltReturnTypeRef",SaltReturnTypeRef),_export("_TypeModel",_TypeModel={name:"SaltReturn",since:1,type:"DATA_TRANSFER_TYPE",id:420,rootId:"A3N5cwABpA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:421,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},salt:{name:"salt",id:422,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/ChangePasswordData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ChangePasswordDataTypeRef,_TypeModel;return _export("createChangePasswordData",function(values){return Object.assign(create(_TypeModel,ChangePasswordDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ChangePasswordDataTypeRef",ChangePasswordDataTypeRef=new TypeRef("sys","ChangePasswordData")),_export("ChangePasswordDataTypeRef",ChangePasswordDataTypeRef),_export("_TypeModel",_TypeModel={name:"ChangePasswordData",since:1,type:"DATA_TRANSFER_TYPE",id:534,rootId:"A3N5cwACFg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:535,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},code:{name:"code",id:539,since:1,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},oldVerifier:{name:"oldVerifier",id:1240,since:23,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},pwEncUserGroupKey:{name:"pwEncUserGroupKey",id:538,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},recoverCodeVerifier:{name:"recoverCodeVerifier",id:1418,since:36,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},salt:{name:"salt",id:537,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1},verifier:{name:"verifier",id:536,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/EntityEventBatch.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,EntityEventBatchTypeRef,_TypeModel;return _export("createEntityEventBatch",function(values){return Object.assign(create(_TypeModel,EntityEventBatchTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("EntityEventBatchTypeRef",EntityEventBatchTypeRef=new TypeRef("sys","EntityEventBatch")),_export("EntityEventBatchTypeRef",EntityEventBatchTypeRef),_export("_TypeModel",_TypeModel={name:"EntityEventBatch",since:20,type:"LIST_ELEMENT_TYPE",id:1079,rootId:"A3N5cwAENw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1083,since:20,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:1081,since:20,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1084,since:20,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:1082,since:20,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1}},associations:{events:{name:"events",id:1085,since:20,type:"AGGREGATION",cardinality:"Any",refType:"EntityUpdate",final:!0}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/WebsocketEntityData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,WebsocketEntityDataTypeRef,_TypeModel;return _export("createWebsocketEntityData",function(values){return Object.assign(create(_TypeModel,WebsocketEntityDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("WebsocketEntityDataTypeRef",WebsocketEntityDataTypeRef=new TypeRef("sys","WebsocketEntityData")),_export("WebsocketEntityDataTypeRef",WebsocketEntityDataTypeRef),_export("_TypeModel",_TypeModel={name:"WebsocketEntityData",since:41,type:"DATA_TRANSFER_TYPE",id:1483,rootId:"A3N5cwAFyw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1484,since:41,type:"Number",cardinality:"One",final:!1,encrypted:!1},eventBatchId:{name:"eventBatchId",id:1485,since:41,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1},eventBatchOwner:{name:"eventBatchOwner",id:1486,since:41,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{eventBatch:{name:"eventBatch",id:1487,since:41,type:"AGGREGATION",cardinality:"Any",refType:"EntityUpdate",final:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/EventBusClient.js",["node_modules/systemjs-plugin-babel/babel-helpers/slicedToArray.js","node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./crypto/CryptoFacade","../Env","../entities/tutanota/Mail","./EntityWorker","../common/EntityFunctions","../common/error/RestError","../entities/sys/EntityEventBatch","../common/utils/Utils","../common/error/OutOfSyncError","../common/utils/ArrayUtils","../common/TutanotaConstants","../entities/sys/WebsocketEntityData","../common/error/CancelledError"],function(_export,_context){"use strict";var _slicedToArray,_classCallCheck,_createClass,decryptAndMapToInstance,assertWorkerOrNode,getWebsocketOrigin,isAdminClient,isTest,Mode,MailTypeModel,load,loadAll,loadRange,firstBiggerThanSecond,GENERATED_MAX_ID,GENERATED_MIN_ID,getLetId,AccessBlockedError,AccessDeactivatedError,ConnectionError,handleRestError,NotAuthorizedError,NotFoundError,ServiceUnavailableError,SessionExpiredError,EntityEventBatchTypeRef,downcast,identity,neverNull,randomIntFromInterval,OutOfSyncError,contains,CloseEventBusOption,GroupType,SECOND_MS,WebsocketEntityDataTypeModel,CancelledError,EventBusState,LARGE_RECONNECT_INTERVAL,SMALL_RECONNECT_INTERVAL,MEDIUM_RECONNECT_INTERVAL,EventBusClient;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs){_slicedToArray=_node_modulesSystemjsPluginBabelBabelHelpersSlicedToArrayJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_cryptoCryptoFacade){decryptAndMapToInstance=_cryptoCryptoFacade.decryptAndMapToInstance},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode,getWebsocketOrigin=_Env.getWebsocketOrigin,isAdminClient=_Env.isAdminClient,isTest=_Env.isTest,Mode=_Env.Mode},function(_entitiesTutanotaMail){MailTypeModel=_entitiesTutanotaMail._TypeModel},function(_EntityWorker){load=_EntityWorker.load,loadAll=_EntityWorker.loadAll,loadRange=_EntityWorker.loadRange},function(_commonEntityFunctions){firstBiggerThanSecond=_commonEntityFunctions.firstBiggerThanSecond,GENERATED_MAX_ID=_commonEntityFunctions.GENERATED_MAX_ID,GENERATED_MIN_ID=_commonEntityFunctions.GENERATED_MIN_ID,getLetId=_commonEntityFunctions.getLetId},function(_commonErrorRestError){AccessBlockedError=_commonErrorRestError.AccessBlockedError,AccessDeactivatedError=_commonErrorRestError.AccessDeactivatedError,ConnectionError=_commonErrorRestError.ConnectionError,handleRestError=_commonErrorRestError.handleRestError,NotAuthorizedError=_commonErrorRestError.NotAuthorizedError,NotFoundError=_commonErrorRestError.NotFoundError,ServiceUnavailableError=_commonErrorRestError.ServiceUnavailableError,SessionExpiredError=_commonErrorRestError.SessionExpiredError},function(_entitiesSysEntityEventBatch){EntityEventBatchTypeRef=_entitiesSysEntityEventBatch.EntityEventBatchTypeRef},function(_commonUtilsUtils){downcast=_commonUtilsUtils.downcast,identity=_commonUtilsUtils.identity,neverNull=_commonUtilsUtils.neverNull,randomIntFromInterval=_commonUtilsUtils.randomIntFromInterval},function(_commonErrorOutOfSyncError){OutOfSyncError=_commonErrorOutOfSyncError.OutOfSyncError},function(_commonUtilsArrayUtils){contains=_commonUtilsArrayUtils.contains},function(_commonTutanotaConstants){CloseEventBusOption=_commonTutanotaConstants.CloseEventBusOption,GroupType=_commonTutanotaConstants.GroupType,SECOND_MS=_commonTutanotaConstants.SECOND_MS},function(_entitiesSysWebsocketEntityData){WebsocketEntityDataTypeModel=_entitiesSysWebsocketEntityData._TypeModel},function(_commonErrorCancelledError){CancelledError=_commonErrorCancelledError.CancelledError}],execute:function(){assertWorkerOrNode(),EventBusState=Object.freeze({Automatic:"automatic",Suspended:"suspended",Terminated:"terminated"}),3e4,1,LARGE_RECONNECT_INTERVAL=[60,120],SMALL_RECONNECT_INTERVAL=[5,10],MEDIUM_RECONNECT_INTERVAL=[20,40],_export("EventBusClient",EventBusClient=function(){function EventBusClient(worker,indexer,cache,mail,login){_classCallCheck(this,EventBusClient),this._failedConnectionAttempts=0,this._worker=worker,this._indexer=indexer,this._cache=cache,this._mail=mail,this._login=login,this._socket=null,this._state=EventBusState.Automatic,this._reconnectTimer=null,this._connectTimer=null,this._reset(),this._MAX_EVENT_IDS_QUEUE_LENGTH=1e3}return _createClass(EventBusClient,[{key:"_reset",value:function(){this._immediateReconnect=!1,this._lastEntityEventIds={},this._queueWebsocketEvents=!1,this._websocketWrapperQueue=[],this._serviceUnavailableRetry=null}},{key:"connect",value:function(reconnect){var _this=this;if(env.mode!==Mode.Test){console.log((new Date).toISOString(),"ws connect reconnect=",reconnect,"state:",this._state),this._websocketWrapperQueue=[],this._serviceUnavailableRetry=null,this._worker.updateWebSocketState("connecting"),this._state=EventBusState.Automatic,this._connectTimer=null;var authHeaders=this._login.createAuthHeaders(),authQuery="modelVersions="+WebsocketEntityDataTypeModel.version+"."+MailTypeModel.version+"&clientVersion="+env.versionNumber+"&userId="+this._login.getLoggedInUser()._id+"&accessToken="+authHeaders.accessToken,url=getWebsocketOrigin()+"/event?"+authQuery;this._unsubscribeFromOldWebsocket(),this._socket=new WebSocket(url),this._socket.onopen=function(){_this._failedConnectionAttempts=0,console.log("ws open: ",new Date,"state:",_this._state),_this._initEntityEvents(reconnect),_this._worker.updateWebSocketState("connected")},this._socket.onclose=function(event){return _this._close(event)},this._socket.onerror=function(error){return _this._error(error)},this._socket.onmessage=function(message){return _this._message(message)}}}},{key:"_initEntityEvents",value:function(reconnect){var _this2=this;this._queueWebsocketEvents=!0,(reconnect&&Object.keys(this._lastEntityEventIds).length>0?this._loadMissedEntityEvents():this._setLatestEntityEventIds()).then(function(){_this2._queueWebsocketEvents=!1}).catch(ConnectionError,function(e){console.log("not connected in connect(), close websocket",e),_this2.close(CloseEventBusOption.Reconnect)}).catch(CancelledError,function(e){console.log("cancelled retry process entity events after reconnect")}).catch(ServiceUnavailableError,function(e){_this2._lastEntityEventIds={},console.log("retry init entity events in 30s",e);var promise=Promise.delay(3e4).then(function(){if(_this2._serviceUnavailableRetry===promise)return console.log("retry initializing entity events"),_this2._initEntityEvents(reconnect);console.log("cancel initializing entity events")});return _this2._serviceUnavailableRetry=promise,promise}).catch(function(e){_this2._queueWebsocketEvents=!1,_this2._worker.sendError(e)})}},{key:"close",value:function(closeOption){switch(console.log((new Date).toISOString(),"ws close closeOption: ",closeOption,"state:",this._state),closeOption){case CloseEventBusOption.Terminate:this._terminate();break;case CloseEventBusOption.Pause:this._state=EventBusState.Suspended,this._worker.updateWebSocketState("connecting");break;case CloseEventBusOption.Reconnect:this._worker.updateWebSocketState("connecting")}this._socket&&this._socket.close&&this._socket.close()}},{key:"_unsubscribeFromOldWebsocket",value:function(){this._socket&&(this._socket.onopen=this._socket.onclose=this._socket.onerror=this._socket.onmessage=identity)}},{key:"_terminate",value:function(){this._state=EventBusState.Terminated,this._reset(),this._worker.updateWebSocketState("terminated")}},{key:"_error",value:function(error){console.log((new Date).toISOString(),"ws error: ",error,JSON.stringify(error),"state:",this._state)}},{key:"_message",value:function(message){var _this3=this,_downcast$split=downcast(message.data).split(";"),_downcast$split2=_slicedToArray(_downcast$split,2),type=_downcast$split2[0],value=_downcast$split2[1];return"entityUpdate"===type?decryptAndMapToInstance(WebsocketEntityDataTypeModel,JSON.parse(value),null).then(function(data){if(!_this3._queueWebsocketEvents)return _this3._queueWebsocketEvents=!0,_this3._processEntityEvents(data.eventBatch,data.eventBatchOwner,data.eventBatchId).then(function(){if(_this3._websocketWrapperQueue.length>0)return _this3._processQueuedEvents()}).then(function(){_this3._queueWebsocketEvents=!1}).catch(ConnectionError,function(e){_this3._queueWebsocketEvents=!1,console.log("not connected in _message(), close websocket",e),_this3.close(CloseEventBusOption.Reconnect)}).catch(CancelledError,function(e){console.log("cancelled retry process entity events after _message call")}).catch(function(e){_this3._queueWebsocketEvents=!1,_this3._worker.sendError(e)});_this3._websocketWrapperQueue.push(data)}):("unreadCounterUpdate"===type&&this._worker.updateCounter(JSON.parse(value)),Promise.resolve())}},{key:"_close",value:function(event){this._failedConnectionAttempts++,console.log((new Date).toISOString(),"ws _close: ",event,"state:",this._state);var serverCode=event.code-4e3;if([NotAuthorizedError.CODE,AccessDeactivatedError.CODE,AccessBlockedError.CODE].includes(serverCode))this._terminate(),this._worker.sendError(handleRestError(serverCode,"web socket error"));else if(serverCode===SessionExpiredError.CODE)this._state=EventBusState.Suspended,this._worker.updateWebSocketState("connecting");else if(this._state===EventBusState.Automatic&&this._login.isLoggedIn())if(this._worker.updateWebSocketState("connecting"),this._immediateReconnect)this._immediateReconnect=!1,this.tryReconnect(!1,!1);else{var reconnectionInterval=void 0;reconnectionInterval=1===serverCode?LARGE_RECONNECT_INTERVAL:1===this._failedConnectionAttempts?SMALL_RECONNECT_INTERVAL:2===this._failedConnectionAttempts?MEDIUM_RECONNECT_INTERVAL:LARGE_RECONNECT_INTERVAL,this.tryReconnect(!1,!1,SECOND_MS*randomIntFromInterval(reconnectionInterval[0],reconnectionInterval[1]))}}},{key:"tryReconnect",value:function(closeIfOpen,enableAutomaticState){var _this4=this,delay=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("tryReconnect, closeIfOpen",closeIfOpen,"enableAutomaticState",enableAutomaticState,"delay",delay),this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),delay?this._reconnectTimer=setTimeout(function(){return _this4._reconnect(closeIfOpen,enableAutomaticState)},delay):this._reconnect(closeIfOpen,enableAutomaticState)}},{key:"_reconnect",value:function(closeIfOpen,enableAutomaticState){var _this5=this;console.log((new Date).toISOString(),"ws _reconnect socket state (CONNECTING=0, OPEN=1, CLOSING=2, CLOSED=3): "+(this._socket?this._socket.readyState:"null"),"state:",this._state,"closeIfOpen",closeIfOpen,"enableAutomaticState",enableAutomaticState),this._state!==EventBusState.Terminated&&enableAutomaticState&&(this._state=EventBusState.Automatic),closeIfOpen&&this._socket&&this._socket.readyState===WebSocket.OPEN?(this._immediateReconnect=!0,neverNull(this._socket).close()):null!=this._socket&&this._socket.readyState!==WebSocket.CLOSED&&this._socket.readyState!==WebSocket.CLOSING||this._state===EventBusState.Terminated||!this._login.isLoggedIn()||(this._connectTimer&&clearTimeout(this._connectTimer),this._connectTimer=setTimeout(function(){return _this5.connect(!0)},100))}},{key:"_setLatestEntityEventIds",value:function(){var _this6=this,lastIds={};return Promise.each(this._eventGroups(),function(groupId){return loadRange(EntityEventBatchTypeRef,groupId,GENERATED_MAX_ID,1,!0).then(function(batches){lastIds[groupId]=[1===batches.length?getLetId(batches[0])[1]:GENERATED_MIN_ID]})}).then(function(){return _this6._lastEntityEventIds=lastIds,_this6._processQueuedEvents()})}},{key:"_loadMissedEntityEvents",value:function(){var _this7=this;return this._login.isLoggedIn()?this._checkIfEntityEventsAreExpired().then(function(expired){return expired?_this7._worker.sendError(new OutOfSyncError):Promise.each(_this7._eventGroups(),function(groupId){return loadAll(EntityEventBatchTypeRef,groupId,_this7._getLastEventBatchIdOrMinIdForGroup(groupId)).each(function(eventBatch){return _this7._processEntityEvents(eventBatch.events,groupId,getLetId(eventBatch)[1])}).catch(NotAuthorizedError,function(){console.log("could not download entity updates => lost permission")})}).then(function(){return _this7._processQueuedEvents()})}):Promise.resolve()}},{key:"_processQueuedEvents",value:function(){var _this8=this;if(0===this._websocketWrapperQueue.length)return Promise.resolve();var wrapper=this._websocketWrapperQueue.shift(),groupId=neverNull(wrapper.eventBatchOwner),eventId=neverNull(wrapper.eventBatchId),p=Promise.resolve();return this._isAlreadyProcessed(groupId,eventId)||(p=this._processEntityEvents(wrapper.eventBatch,groupId,eventId)),p.then(function(){return _this8._processQueuedEvents()})}},{key:"_processEntityEvents",value:function(events,groupId,batchId){var _this9=this;return this._executeIfNotTerminated(function(){return _this9._cache.entityEventsReceived(events).then(function(filteredEvents){return _this9._executeIfNotTerminated(function(){return _this9._login.entityEventsReceived(filteredEvents)}).then(function(){return _this9._executeIfNotTerminated(function(){return _this9._mail.entityEventsReceived(filteredEvents)})}).then(function(){return _this9._executeIfNotTerminated(function(){return _this9._worker.entityEventsReceived(filteredEvents,groupId)})}).return(filteredEvents)}).then(function(filteredEvents){_this9._lastEntityEventIds[groupId]||(_this9._lastEntityEventIds[groupId]=[]),_this9._lastEntityEventIds[groupId].push(batchId),_this9._lastEntityEventIds[groupId].sort(function(e1,e2){return e1===e2?0:firstBiggerThanSecond(e1,e2)?1:-1}),_this9._lastEntityEventIds[groupId].length>_this9._MAX_EVENT_IDS_QUEUE_LENGTH&&_this9._lastEntityEventIds[groupId].shift(),isTest()||isAdminClient()||_this9._executeIfNotTerminated(function(){_this9._indexer.addBatchesToQueue([{groupId:groupId,batchId:batchId,events:filteredEvents}]),_this9._indexer.startProcessing()})})}).catch(ServiceUnavailableError,function(e){console.log("retry processing event in 30s",e);var promise=Promise.delay(3e4).then(function(){if(_this9._serviceUnavailableRetry===promise)return _this9._processEntityEvents(events,groupId,batchId);throw new CancelledError("stop retry processing after service unavailable due to reconnect")});return _this9._serviceUnavailableRetry=promise,promise})}},{key:"_checkIfEntityEventsAreExpired",value:function(){var _this10=this;return Promise.each(this._eventGroups(),function(groupId){var lastEventBatchId=_this10._getLastEventBatchIdOrMinIdForGroup(groupId);if(lastEventBatchId!==GENERATED_MIN_ID)return load(EntityEventBatchTypeRef,[groupId,lastEventBatchId]).catch(NotAuthorizedError,function(){console.log("could not download entity updates => lost permission")})}).then(function(){return!1}).catch(NotFoundError,function(){return!0})}},{key:"_getLastEventBatchIdOrMinIdForGroup",value:function(groupId){return this._lastEntityEventIds[groupId]&&this._lastEntityEventIds[groupId].length>0?this._lastEntityEventIds[groupId][this._lastEntityEventIds[groupId].length-1]:GENERATED_MIN_ID}},{key:"_isAlreadyProcessed",value:function(groupId,eventId){return!!(this._lastEntityEventIds[groupId]&&this._lastEntityEventIds[groupId].length>0)&&(firstBiggerThanSecond(this._lastEntityEventIds[groupId][0],eventId)||contains(this._lastEntityEventIds[groupId],eventId))}},{key:"_executeIfNotTerminated",value:function(call){return this._state!==EventBusState.Terminated?call():Promise.resolve()}},{key:"_eventGroups",value:function(){return this._login.getLoggedInUser().memberships.filter(function(membership){return membership.groupType!==GroupType.MailingList}).map(function(membership){return membership.group}).concat(this._login.getLoggedInUser().userGroup.group)}}]),EventBusClient}()),_export("EventBusClient",EventBusClient)}}}),System.register("src/api/entities/sys/CreateSessionData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateSessionDataTypeRef,_TypeModel;return _export("createCreateSessionData",function(values){return Object.assign(create(_TypeModel,CreateSessionDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateSessionDataTypeRef",CreateSessionDataTypeRef=new TypeRef("sys","CreateSessionData")),_export("CreateSessionDataTypeRef",CreateSessionDataTypeRef),_export("_TypeModel",_TypeModel={name:"CreateSessionData",since:23,type:"DATA_TRANSFER_TYPE",id:1211,rootId:"A3N5cwAEuw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1212,since:23,type:"Number",cardinality:"One",final:!1,encrypted:!1},accessKey:{name:"accessKey",id:1216,since:23,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},authToken:{name:"authToken",id:1217,since:23,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!1},authVerifier:{name:"authVerifier",id:1214,since:23,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!1},clientIdentifier:{name:"clientIdentifier",id:1215,since:23,type:"String",cardinality:"One",final:!0,encrypted:!1},mailAddress:{name:"mailAddress",id:1213,since:23,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!1},recoverCodeVerifier:{name:"recoverCodeVerifier",id:1417,since:36,type:"String",cardinality:"ZeroOrOne",final:!0,encrypted:!1}},associations:{user:{name:"user",id:1218,since:23,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"User",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/CreateSessionReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,CreateSessionReturnTypeRef,_TypeModel;return _export("createCreateSessionReturn",function(values){return Object.assign(create(_TypeModel,CreateSessionReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("CreateSessionReturnTypeRef",CreateSessionReturnTypeRef=new TypeRef("sys","CreateSessionReturn")),_export("CreateSessionReturnTypeRef",CreateSessionReturnTypeRef),_export("_TypeModel",_TypeModel={name:"CreateSessionReturn",since:23,type:"DATA_TRANSFER_TYPE",id:1219,rootId:"A3N5cwAEww",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1220,since:23,type:"Number",cardinality:"One",final:!1,encrypted:!1},accessToken:{name:"accessToken",id:1221,since:23,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{challenges:{name:"challenges",id:1222,since:23,type:"AGGREGATION",cardinality:"Any",refType:"Challenge",final:!0},user:{name:"user",id:1223,since:23,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!0,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/EncryptTutanotaPropertiesData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,EncryptTutanotaPropertiesDataTypeRef,_TypeModel;return _export("createEncryptTutanotaPropertiesData",function(values){return Object.assign(create(_TypeModel,EncryptTutanotaPropertiesDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("EncryptTutanotaPropertiesDataTypeRef",EncryptTutanotaPropertiesDataTypeRef=new TypeRef("tutanota","EncryptTutanotaPropertiesData")),_export("EncryptTutanotaPropertiesDataTypeRef",EncryptTutanotaPropertiesDataTypeRef),_export("_TypeModel",_TypeModel={name:"EncryptTutanotaPropertiesData",since:9,type:"DATA_TRANSFER_TYPE",id:473,rootId:"CHR1dGFub3RhAAHZ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:474,since:9,type:"Number",cardinality:"One",final:!1,encrypted:!1},symEncSessionKey:{name:"symEncSessionKey",id:476,since:9,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{properties:{name:"properties",id:475,since:9,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"TutanotaProperties",final:!1,external:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/BucketPermission.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,BucketPermissionTypeRef,_TypeModel;return _export("createBucketPermission",function(values){return Object.assign(create(_TypeModel,BucketPermissionTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("BucketPermissionTypeRef",BucketPermissionTypeRef=new TypeRef("sys","BucketPermission")),_export("BucketPermissionTypeRef",BucketPermissionTypeRef),_export("_TypeModel",_TypeModel={name:"BucketPermission",since:1,type:"LIST_ELEMENT_TYPE",id:118,rootId:"A3N5cwB2",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:122,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:120,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1e3,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:121,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},ownerEncBucketKey:{name:"ownerEncBucketKey",id:1001,since:17,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},pubEncBucketKey:{name:"pubEncBucketKey",id:125,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},pubKeyVersion:{name:"pubKeyVersion",id:126,since:1,type:"Number",cardinality:"ZeroOrOne",final:!1,encrypted:!1},symEncBucketKey:{name:"symEncBucketKey",id:124,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},type:{name:"type",id:123,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{group:{name:"group",id:128,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/Permission.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PermissionTypeRef,_TypeModel;return _export("createPermission",function(values){return Object.assign(create(_TypeModel,PermissionTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PermissionTypeRef",PermissionTypeRef=new TypeRef("sys","Permission")),_export("PermissionTypeRef",PermissionTypeRef),_export("_TypeModel",_TypeModel={name:"Permission",since:1,type:"LIST_ELEMENT_TYPE",id:132,rootId:"A3N5cwAAhA",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:136,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:134,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerEncSessionKey:{name:"_ownerEncSessionKey",id:1003,since:17,type:"Bytes",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1002,since:17,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:135,since:1,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},bucketEncSessionKey:{name:"bucketEncSessionKey",id:139,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},listElementApplication:{name:"listElementApplication",id:1524,since:46,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},listElementTypeId:{name:"listElementTypeId",id:1523,since:46,type:"Number",cardinality:"ZeroOrOne",final:!1,encrypted:!1},ops:{name:"ops",id:140,since:1,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},symEncSessionKey:{name:"symEncSessionKey",id:138,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},type:{name:"type",id:137,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{bucket:{name:"bucket",id:142,since:1,type:"AGGREGATION",cardinality:"ZeroOrOne",refType:"Bucket",final:!1},group:{name:"group",id:141,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"ZeroOrOne",refType:"Group",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/UpdatePermissionKeyData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,UpdatePermissionKeyDataTypeRef,_TypeModel;return _export("createUpdatePermissionKeyData",function(values){return Object.assign(create(_TypeModel,UpdatePermissionKeyDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("UpdatePermissionKeyDataTypeRef",UpdatePermissionKeyDataTypeRef=new TypeRef("sys","UpdatePermissionKeyData")),_export("UpdatePermissionKeyDataTypeRef",UpdatePermissionKeyDataTypeRef),_export("_TypeModel",_TypeModel={name:"UpdatePermissionKeyData",since:1,type:"DATA_TRANSFER_TYPE",id:445,rootId:"A3N5cwABvQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:446,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},ownerEncSessionKey:{name:"ownerEncSessionKey",id:1031,since:17,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},symEncSessionKey:{name:"symEncSessionKey",id:447,since:1,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1}},associations:{bucketPermission:{name:"bucketPermission",id:451,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"BucketPermission",final:!1,external:!1},permission:{name:"permission",id:450,since:1,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"Permission",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/lz4.js",[],function(_export,_context){"use strict";return _export("uncompress",function(input){for(var endIndex=input.length,output=new Uint8Array(6*input.length),j=0,i=0,n=endIndex;i<n;){var token=input[i++],literals_length=token>>4;if(literals_length>0){for(var _l=literals_length+240;255===_l;)literals_length+=_l=input[i++];var _end=i+literals_length,_sizeNeeded=j+(_end-i);if(output.length<_sizeNeeded){var newSize=Math.max(2*output.length,_sizeNeeded),newOutput=new Uint8Array(newSize);newOutput.set(output),output=newOutput}for(;i<_end;)output[j++]=input[i++];if(i===n)break}var offset=input[i++]|input[i++]<<8;if(0===offset||offset>j)throw new Error("Invalid offset value. i: "+i+", -(i-2): "+-(i-2));for(var match_length=15&token,l=match_length+240;255===l;)match_length+=l=input[i++];var pos=j-offset,end=j+match_length+4,sizeNeeded=end;if(output.length<sizeNeeded){var _newSize=Math.max(2*output.length,sizeNeeded),_newOutput=new Uint8Array(_newSize);_newOutput.set(output),output=_newOutput}for(;j<end;)output[j++]=output[pos++]}return output.slice(0,j)}),{setters:[],execute:function(){Math.imul||(Math.imul=function(a,b){var al=65535&a,bl=65535&b;return al*bl+((a>>>16)*bl+al*(b>>>16)<<16)|0})}}}),System.register("src/api/worker/crypto/InstanceMapper.js",["../../common/EntityFunctions","../../common/error/ProgrammingError","../../common/utils/Encoding","./Randomizer","./Aes","../../common/EntityConstants","../../Env","../lz4"],function(_export,_context){"use strict";var resolveTypeReference,TypeRef,ProgrammingError,base64ToBase64Url,base64ToUint8Array,stringToUtf8Uint8Array,uint8ArrayToBase64,utf8Uint8ArrayToString,random,aes128Decrypt,aes128Encrypt,ENABLE_MAC,IV_BYTE_LENGTH,EC,assertWorkerOrNode,uncompress,Type,ValueType,Cardinality,AssociationType;function encryptValue(valueType,value,sk){if(null==value&&"_id"!==valueType.name&&"_permissions"!==valueType.name){if(valueType.cardinality===Cardinality.ZeroOrOne)return null;throw new ProgrammingError("Value "+valueType.name+" with cardinality ONE can not be null")}if(valueType.encrypted){var bytes=value;return valueType.type!==ValueType.Bytes&&(bytes=stringToUtf8Uint8Array(convertJsToDbType(valueType.type,value))),uint8ArrayToBase64(aes128Encrypt(sk,bytes,random.generateRandomData(IV_BYTE_LENGTH),!0,ENABLE_MAC))}return convertJsToDbType(valueType.type,value)}function decryptValue(valueType,value,sk){if(null==value){if(valueType.cardinality===Cardinality.ZeroOrOne)return null;throw new ProgrammingError("Value "+valueType.name+" with cardinality ONE can not be null")}if(valueType.cardinality===Cardinality.One&&""===value)return valueToDefault(valueType.type);if(valueType.encrypted){var decryptedBytes=aes128Decrypt(sk,base64ToUint8Array(value));return valueType.type===ValueType.Bytes?decryptedBytes:valueType.type===ValueType.CompressedString?decompressString(decryptedBytes):convertDbToJsType(valueType.type,utf8Uint8ArrayToString(decryptedBytes))}return convertDbToJsType(valueType.type,value)}function convertJsToDbType(type,value){if(type===ValueType.Bytes&&null!=value)return uint8ArrayToBase64(value);if(type===ValueType.Boolean)return value?"1":"0";if(type===ValueType.Date)return value.getTime().toString();if(type===ValueType.CompressedString)throw new ProgrammingError("Compression is not implemented yet");return value}function convertDbToJsType(type,value){return type===ValueType.Bytes?base64ToUint8Array(value):type===ValueType.Boolean?"0"!==value:type===ValueType.Date?new Date(parseInt(value)):type===ValueType.CompressedString?decompressString(base64ToUint8Array(value)):value}function decompressString(compressed){if(0===compressed.length)return"";var output=uncompress(compressed);return utf8Uint8ArrayToString(output)}function valueToDefault(type){switch(type){case ValueType.String:return"";case ValueType.Number:return"0";case ValueType.Bytes:return new Uint8Array(0);case ValueType.Date:return new Date;case ValueType.Boolean:return!1;case ValueType.CompressedString:return"";default:throw new ProgrammingError(type+" is not a valid value type")}}return _export("decryptAndMapToInstance",function decryptAndMapToInstance(model,instance,sk){var decrypted={_type:new TypeRef(model.app,model.name)},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Object.keys(model.values)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var key=_step.value,valueType=model.values[key],value=instance[valueType.name];try{decrypted[valueType.name]=decryptValue(valueType,value,sk)}catch(e){null==decrypted._errors&&(decrypted._errors={}),decrypted._errors[valueType.name]=JSON.stringify(e)}finally{valueType.encrypted&&(valueType.final?decrypted["_finalEncrypted_"+valueType.name]=value:""===value&&(decrypted["_defaultEncrypted_"+valueType.name]=decrypted[valueType.name]))}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return Promise.map(Object.keys(model.associations),function(associationName){if(model.associations[associationName].type===AssociationType.Aggregation)return resolveTypeReference(new TypeRef(model.app,model.associations[associationName].refType)).then(function(aggregateTypeModel){var aggregation=model.associations[associationName];if(aggregation.cardinality!==Cardinality.ZeroOrOne||null!=instance[associationName]){if(null==instance[associationName])throw new ProgrammingError("Undefined aggregation "+model.name+":"+associationName);return aggregation.cardinality===Cardinality.Any?Promise.map(instance[associationName],function(aggregate){return decryptAndMapToInstance(aggregateTypeModel,aggregate,sk)}).then(function(decryptedAggregates){decrypted[associationName]=decryptedAggregates}):decryptAndMapToInstance(aggregateTypeModel,instance[associationName],sk).then(function(decryptedAggregate){decrypted[associationName]=decryptedAggregate})}decrypted[associationName]=null});decrypted[associationName]=instance[associationName]}).then(function(){return decrypted})}),_export("encryptAndMapToLiteral",function encryptAndMapToLiteral(model,instance,sk){var encrypted={},i=instance,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=Object.keys(model.values)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var key=_step2.value,valueType=model.values[key],value=i[valueType.name];valueType.encrypted&&valueType.final&&null!=i["_finalEncrypted_"+valueType.name]?encrypted[valueType.name]=i["_finalEncrypted_"+valueType.name]:valueType.encrypted&&i["_defaultEncrypted_"+valueType.name]===value?encrypted[valueType.name]="":encrypted[valueType.name]=encryptValue(valueType,value,sk)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return model.type!==Type.Aggregated||encrypted._id||(encrypted._id=base64ToBase64Url(uint8ArrayToBase64(random.generateRandomData(4)))),Promise.map(Object.keys(model.associations),function(associationName){if(model.associations[associationName].type===AssociationType.Aggregation)return resolveTypeReference(new TypeRef(model.app,model.associations[associationName].refType)).then(function(aggregateTypeModel){var aggregation=model.associations[associationName];if(aggregation.cardinality!==Cardinality.ZeroOrOne||null!=i[associationName]){if(null==i[associationName])throw new ProgrammingError("Undefined attribute "+model.name+":"+associationName);return aggregation.cardinality===Cardinality.Any?Promise.map(i[associationName],function(aggregate){return encryptAndMapToLiteral(aggregateTypeModel,aggregate,sk)}).then(function(encryptedAggregates){encrypted[associationName]=encryptedAggregates}):encryptAndMapToLiteral(aggregateTypeModel,i[associationName],sk).then(function(encryptedAggregate){encrypted[associationName]=encryptedAggregate})}encrypted[associationName]=null});encrypted[associationName]=i[associationName]}).then(function(){return encrypted})}),_export("encryptValue",encryptValue),_export("decryptValue",decryptValue),_export("convertJsToDbType",convertJsToDbType),_export("convertDbToJsType",convertDbToJsType),_export("encryptBytes",function(sk,value){return aes128Encrypt(sk,value,random.generateRandomData(IV_BYTE_LENGTH),!0,ENABLE_MAC)}),_export("encryptString",function(sk,value){return aes128Encrypt(sk,stringToUtf8Uint8Array(value),random.generateRandomData(IV_BYTE_LENGTH),!0,ENABLE_MAC)}),_export("valueToDefault",valueToDefault),{setters:[function(_commonEntityFunctions){resolveTypeReference=_commonEntityFunctions.resolveTypeReference,TypeRef=_commonEntityFunctions.TypeRef},function(_commonErrorProgrammingError){ProgrammingError=_commonErrorProgrammingError.ProgrammingError},function(_commonUtilsEncoding){base64ToBase64Url=_commonUtilsEncoding.base64ToBase64Url,base64ToUint8Array=_commonUtilsEncoding.base64ToUint8Array,stringToUtf8Uint8Array=_commonUtilsEncoding.stringToUtf8Uint8Array,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64,utf8Uint8ArrayToString=_commonUtilsEncoding.utf8Uint8ArrayToString},function(_Randomizer){random=_Randomizer.random},function(_Aes){aes128Decrypt=_Aes.aes128Decrypt,aes128Encrypt=_Aes.aes128Encrypt,ENABLE_MAC=_Aes.ENABLE_MAC,IV_BYTE_LENGTH=_Aes.IV_BYTE_LENGTH},function(_commonEntityConstants){EC=_commonEntityConstants.default},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_lz){uncompress=_lz.uncompress}],execute:function(){assertWorkerOrNode(),Type=EC.Type,ValueType=EC.ValueType,Cardinality=EC.Cardinality,AssociationType=EC.AssociationType}}}),System.register("src/api/worker/crypto/Sha512.js",["./lib/crypto-sjcl-1.0.7","../../Env"],function(_export,_context){"use strict";var sjcl,assertWorkerOrNode,sha512;return _export("hash",function(uint8Array){try{return sha512.update(sjcl.codec.arrayBuffer.toBits(uint8Array.buffer)),new Uint8Array(sjcl.codec.arrayBuffer.fromBits(sha512.finalize(),!1))}finally{sha512.reset()}}),{setters:[function(_libCryptoSjcl){sjcl=_libCryptoSjcl.default},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode}],execute:function(){assertWorkerOrNode(),sha512=new sjcl.hash.sha512,_export("HASH_LENGTH_BYTES",64),_export("HASH_LENGTH_BYTES",64)}}}),System.register("src/api/worker/crypto/Aes.js",["./lib/crypto-sjcl-1.0.7","./Randomizer","./CryptoUtils","../../common/utils/ArrayUtils","../../common/utils/Encoding","../../common/error/CryptoError","../../Env","./Sha256","./Sha512"],function(_export,_context){"use strict";var sjcl,random,bitArrayToUint8Array,uint8ArrayToBitArray,arrayEquals,concat,uint8ArrayToBase64,CryptoError,assertWorkerOrNode,hash,Sha512,IV_BYTE_LENGTH,KEY_LENGTH_BYTES_AES_256,KEY_LENGTH_BITS_AES_256,KEY_LENGTH_BYTES_AES_128,KEY_LENGTH_BITS_AES_128,MAC_ENABLED_PREFIX,MAC_LENGTH_BYTES;function verifyKeySize(key,bitLength){if(sjcl.bitArray.bitLength(key)!==bitLength)throw new CryptoError("Illegal key length: "+sjcl.bitArray.bitLength(key)+" (expected: "+bitLength+")")}function getAes128SubKeys(key,mac){if(mac){var hashedKey=hash(bitArrayToUint8Array(key));return{cKey:uint8ArrayToBitArray(hashedKey.subarray(0,KEY_LENGTH_BYTES_AES_128)),mKey:uint8ArrayToBitArray(hashedKey.subarray(KEY_LENGTH_BYTES_AES_128,2*KEY_LENGTH_BYTES_AES_128))}}return{cKey:key,mKey:null}}function getAes256SubKeys(key,mac){if(mac){var hashedKey=Sha512.hash(bitArrayToUint8Array(key));return{cKey:uint8ArrayToBitArray(hashedKey.subarray(0,KEY_LENGTH_BYTES_AES_256)),mKey:uint8ArrayToBitArray(hashedKey.subarray(KEY_LENGTH_BYTES_AES_256,2*KEY_LENGTH_BYTES_AES_256))}}return{cKey:key,mKey:null}}return _export("aes256RandomKey",function(){return uint8ArrayToBitArray(random.generateRandomData(KEY_LENGTH_BYTES_AES_256))}),_export("aes256Encrypt",function(key,bytes,iv){var usePadding=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],useMac=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(verifyKeySize(key,KEY_LENGTH_BITS_AES_256),iv.length!==IV_BYTE_LENGTH)throw new CryptoError("Illegal IV length: "+iv.length+" (expected: "+IV_BYTE_LENGTH+"): "+uint8ArrayToBase64(iv)+" ");var subKeys=getAes256SubKeys(key,useMac),encryptedBits=sjcl.mode.cbc.encrypt(new sjcl.cipher.aes(subKeys.cKey),uint8ArrayToBitArray(bytes),uint8ArrayToBitArray(iv),[],usePadding),data=concat(iv,bitArrayToUint8Array(encryptedBits));if(useMac){var hmac=new sjcl.misc.hmac(subKeys.mKey,sjcl.hash.sha256),macBytes=bitArrayToUint8Array(hmac.encrypt(uint8ArrayToBitArray(data)));data=concat(data,macBytes)}return data}),_export("aes256Decrypt",function(key,encryptedBytes){var usePadding=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],useMac=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];verifyKeySize(key,KEY_LENGTH_BITS_AES_256);var subKeys=getAes256SubKeys(key,useMac),cipherTextWithoutMac=void 0;if(useMac){cipherTextWithoutMac=encryptedBytes.subarray(1,encryptedBytes.length-MAC_LENGTH_BYTES);var providedMacBytes=encryptedBytes.subarray(encryptedBytes.length-MAC_LENGTH_BYTES),hmac=new sjcl.misc.hmac(subKeys.mKey,sjcl.hash.sha256),computedMacBytes=bitArrayToUint8Array(hmac.encrypt(uint8ArrayToBitArray(cipherTextWithoutMac)));if(!arrayEquals(providedMacBytes,computedMacBytes))throw new CryptoError("invalid mac")}else cipherTextWithoutMac=encryptedBytes;var iv=cipherTextWithoutMac.slice(0,IV_BYTE_LENGTH);if(iv.length!==IV_BYTE_LENGTH)throw new CryptoError("Invalid IV length in AES256Decrypt: "+iv.length+" bytes, must be 16 bytes (128 bits)");var ciphertext=cipherTextWithoutMac.slice(IV_BYTE_LENGTH);try{var decrypted=sjcl.mode.cbc.decrypt(new sjcl.cipher.aes(subKeys.cKey),uint8ArrayToBitArray(ciphertext),uint8ArrayToBitArray(iv),[],usePadding);return new Uint8Array(bitArrayToUint8Array(decrypted))}catch(e){throw new CryptoError("aes decryption failed",e)}}),_export("aes128RandomKey",function(){return uint8ArrayToBitArray(random.generateRandomData(KEY_LENGTH_BYTES_AES_128))}),_export("aes128Encrypt",function(key,bytes,iv,usePadding,useMac){if(verifyKeySize(key,KEY_LENGTH_BITS_AES_128),iv.length!==IV_BYTE_LENGTH)throw new CryptoError("Illegal IV length: "+iv.length+" (expected: "+IV_BYTE_LENGTH+"): "+uint8ArrayToBase64(iv)+" ");var subKeys=getAes128SubKeys(key,useMac),encryptedBits=sjcl.mode.cbc.encrypt(new sjcl.cipher.aes(subKeys.cKey),uint8ArrayToBitArray(bytes),uint8ArrayToBitArray(iv),[],usePadding),data=concat(iv,bitArrayToUint8Array(encryptedBits));if(useMac){var hmac=new sjcl.misc.hmac(subKeys.mKey,sjcl.hash.sha256),macBytes=bitArrayToUint8Array(hmac.encrypt(uint8ArrayToBitArray(data)));data=concat(new Uint8Array([MAC_ENABLED_PREFIX]),data,macBytes)}return data}),_export("aes128Decrypt",function(key,encryptedBytes){var usePadding=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];verifyKeySize(key,KEY_LENGTH_BITS_AES_128);var useMac=encryptedBytes.length%2==1,subKeys=getAes128SubKeys(key,useMac),cipherTextWithoutMac=void 0;if(useMac){cipherTextWithoutMac=encryptedBytes.subarray(1,encryptedBytes.length-MAC_LENGTH_BYTES);var providedMacBytes=encryptedBytes.subarray(encryptedBytes.length-MAC_LENGTH_BYTES),hmac=new sjcl.misc.hmac(subKeys.mKey,sjcl.hash.sha256),computedMacBytes=bitArrayToUint8Array(hmac.encrypt(uint8ArrayToBitArray(cipherTextWithoutMac)));if(!arrayEquals(providedMacBytes,computedMacBytes))throw new CryptoError("invalid mac")}else cipherTextWithoutMac=encryptedBytes;var iv=cipherTextWithoutMac.slice(0,IV_BYTE_LENGTH);if(iv.length!==IV_BYTE_LENGTH)throw new CryptoError("Invalid IV length in AES128Decrypt: "+iv.length+" bytes, must be 16 bytes (128 bits)");var ciphertext=cipherTextWithoutMac.slice(IV_BYTE_LENGTH);try{var decrypted=sjcl.mode.cbc.decrypt(new sjcl.cipher.aes(subKeys.cKey),uint8ArrayToBitArray(ciphertext),uint8ArrayToBitArray(iv),[],usePadding);return new Uint8Array(bitArrayToUint8Array(decrypted))}catch(e){throw new CryptoError("aes decryption failed",e)}}),{setters:[function(_libCryptoSjcl){sjcl=_libCryptoSjcl.default},function(_Randomizer){random=_Randomizer.random},function(_CryptoUtils){bitArrayToUint8Array=_CryptoUtils.bitArrayToUint8Array,uint8ArrayToBitArray=_CryptoUtils.uint8ArrayToBitArray},function(_commonUtilsArrayUtils){arrayEquals=_commonUtilsArrayUtils.arrayEquals,concat=_commonUtilsArrayUtils.concat},function(_commonUtilsEncoding){uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64},function(_commonErrorCryptoError){CryptoError=_commonErrorCryptoError.CryptoError},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_Sha){hash=_Sha.hash},function(_Sha2){Sha512=_Sha2}],execute:function(){assertWorkerOrNode(),_export("ENABLE_MAC",!0),_export("ENABLE_MAC",!0),_export("IV_BYTE_LENGTH",IV_BYTE_LENGTH=16),_export("IV_BYTE_LENGTH",IV_BYTE_LENGTH),KEY_LENGTH_BITS_AES_256=8*(KEY_LENGTH_BYTES_AES_256=32),KEY_LENGTH_BITS_AES_128=8*(KEY_LENGTH_BYTES_AES_128=16),MAC_ENABLED_PREFIX=1,MAC_LENGTH_BYTES=32}}}),System.register("src/api/worker/crypto/SecureRandom.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./Randomizer","../../Env"],function(_export,_context){"use strict";var _classCallCheck,_createClass,random,assertWorkerOrNode,SecureRandom;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_Randomizer){random=_Randomizer.random},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode}],execute:function(){assertWorkerOrNode(),_export("SecureRandom",SecureRandom=function(){function SecureRandom(){_classCallCheck(this,SecureRandom)}return _createClass(SecureRandom,[{key:"nextBytes",value:function(array){for(var bytes=random.generateRandomData(array.length),i=0;i<array.length;i++)array[i]=bytes[i]}}]),SecureRandom}()),_export("SecureRandom",SecureRandom)}}}),System.registerDynamic("src/api/worker/crypto/lib/crypto-jsbn-2012-08-09_1.js",["../SecureRandom.js"],!0,function($__require,exports,module){"use strict";this||self;var dbits,SecureRandom=$__require("../SecureRandom.js").SecureRandom;function BigInteger(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function nbi(){return new BigInteger(null)}"object"==typeof navigator&&"Microsoft Internet Explorer"==navigator.appName?(BigInteger.prototype.am=function(i,x,w,j,c,n){for(var xl=32767&x,xh=x>>15;--n>=0;){var l=32767&this[i],h=this[i++]>>15,m=xh*l+h*xl;c=((l=xl*l+((32767&m)<<15)+w[j]+(1073741823&c))>>>30)+(m>>>15)+xh*h+(c>>>30),w[j++]=1073741823&l}return c},dbits=30):"object"==typeof navigator&&"Netscape"!=navigator.appName?(BigInteger.prototype.am=function(i,x,w,j,c,n){for(;--n>=0;){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864),w[j++]=67108863&v}return c},dbits=26):(BigInteger.prototype.am=function(i,x,w,j,c,n){for(var xl=16383&x,xh=x>>14;--n>=0;){var l=16383&this[i],h=this[i++]>>14,m=xh*l+h*xl;c=((l=xl*l+((16383&m)<<14)+w[j]+c)>>28)+(m>>14)+xh*h,w[j++]=268435455&l}return c},dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;BigInteger.prototype.FV=Math.pow(2,52),BigInteger.prototype.F1=52-dbits,BigInteger.prototype.F2=2*dbits-52;var rr,vv,BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array;for(rr="0".charCodeAt(0),vv=0;vv<=9;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return null==c?-1:c}function nbv(i){var r=nbi();return r.fromInt(i),r}function nbits(x){var t,r=1;return 0!=(t=x>>>16)&&(x=t,r+=16),0!=(t=x>>8)&&(x=t,r+=8),0!=(t=x>>4)&&(x=t,r+=4),0!=(t=x>>2)&&(x=t,r+=2),0!=(t=x>>1)&&(x=t,r+=1),r}function Classic(m){this.m=m}function Montgomery(m){this.m=m,this.mp=m.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<m.DB-15)-1,this.mt2=2*m.t}function op_and(x,y){return x&y}function op_or(x,y){return x|y}function op_xor(x,y){return x^y}function op_andnot(x,y){return x&~y}function lbit(x){if(0==x)return-1;var r=0;return 0==(65535&x)&&(x>>=16,r+=16),0==(255&x)&&(x>>=8,r+=8),0==(15&x)&&(x>>=4,r+=4),0==(3&x)&&(x>>=2,r+=2),0==(1&x)&&++r,r}function cbit(x){for(var r=0;0!=x;)x&=x-1,++r;return r}function NullExp(){}function nNop(x){return x}function Barrett(m){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*m.t,this.r2),this.mu=this.r2.divide(m),this.m=m}Classic.prototype.convert=function(x){return x.s<0||x.compareTo(this.m)>=0?x.mod(this.m):x},Classic.prototype.revert=function(x){return x},Classic.prototype.reduce=function(x){x.divRemTo(this.m,null,x)},Classic.prototype.mulTo=function(x,y,r){x.multiplyTo(y,r),this.reduce(r)},Classic.prototype.sqrTo=function(x,r){x.squareTo(r),this.reduce(r)},Montgomery.prototype.convert=function(x){var r=nbi();return x.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),x.s<0&&r.compareTo(BigInteger.ZERO)>0&&this.m.subTo(r,r),r},Montgomery.prototype.revert=function(x){var r=nbi();return x.copyTo(r),this.reduce(r),r},Montgomery.prototype.reduce=function(x){for(;x.t<=this.mt2;)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=32767&x[i],u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;for(x[j=i+this.m.t]+=this.m.am(0,u0,x,i,0,this.m.t);x[j]>=x.DV;)x[j]-=x.DV,x[++j]++}x.clamp(),x.drShiftTo(this.m.t,x),x.compareTo(this.m)>=0&&x.subTo(this.m,x)},Montgomery.prototype.mulTo=function(x,y,r){x.multiplyTo(y,r),this.reduce(r)},Montgomery.prototype.sqrTo=function(x,r){x.squareTo(r),this.reduce(r)},BigInteger.prototype.copyTo=function(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t,r.s=this.s},BigInteger.prototype.fromInt=function(x){this.t=1,this.s=x<0?-1:0,x>0?this[0]=x:x<-1?this[0]=x+DV:this.t=0},BigInteger.prototype.fromString=function(s,b){var k;if(16==b)k=4;else if(8==b)k=3;else if(256==b)k=8;else if(2==b)k=1;else if(32==b)k=5;else{if(4!=b)return void this.fromRadix(s,b);k=2}this.t=0,this.s=0;for(var i=s.length,mi=!1,sh=0;--i>=0;){var x=8==k?255&s[i]:intAt(s,i);x<0?"-"==s.charAt(i)&&(mi=!0):(mi=!1,0==sh?this[this.t++]=x:sh+k>this.DB?(this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh,this[this.t++]=x>>this.DB-sh):this[this.t-1]|=x<<sh,(sh+=k)>=this.DB&&(sh-=this.DB))}8==k&&0!=(128&s[0])&&(this.s=-1,sh>0&&(this[this.t-1]|=(1<<this.DB-sh)-1<<sh)),this.clamp(),mi&&BigInteger.ZERO.subTo(this,this)},BigInteger.prototype.clamp=function(){for(var c=this.s&this.DM;this.t>0&&this[this.t-1]==c;)--this.t},BigInteger.prototype.dlShiftTo=function(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n,r.s=this.s},BigInteger.prototype.drShiftTo=function(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0),r.s=this.s},BigInteger.prototype.lShiftTo=function(n,r){var i,bs=n%this.DB,cbs=this.DB-bs,bm=(1<<cbs)-1,ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM;for(i=this.t-1;i>=0;--i)r[i+ds+1]=this[i]>>cbs|c,c=(this[i]&bm)<<bs;for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c,r.t=this.t+ds+1,r.s=this.s,r.clamp()},BigInteger.prototype.rShiftTo=function(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t)r.t=0;else{var bs=n%this.DB,cbs=this.DB-bs,bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i)r[i-ds-1]|=(this[i]&bm)<<cbs,r[i-ds]=this[i]>>bs;bs>0&&(r[this.t-ds-1]|=(this.s&bm)<<cbs),r.t=this.t-ds,r.clamp()}},BigInteger.prototype.subTo=function(a,r){for(var i=0,c=0,m=Math.min(a.t,this.t);i<m;)c+=this[i]-a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){for(c-=a.s;i<this.t;)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;i<a.t;)c-=a[i],r[i++]=c&this.DM,c>>=this.DB;c-=a.s}r.s=c<0?-1:0,c<-1?r[i++]=this.DV+c:c>0&&(r[i++]=c),r.t=i,r.clamp()},BigInteger.prototype.multiplyTo=function(a,r){var x=this.abs(),y=a.abs(),i=x.t;for(r.t=i+y.t;--i>=0;)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0,r.clamp(),this.s!=a.s&&BigInteger.ZERO.subTo(r,r)},BigInteger.prototype.squareTo=function(r){for(var x=this.abs(),i=r.t=2*x.t;--i>=0;)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);(r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV&&(r[i+x.t]-=x.DV,r[i+x.t+1]=1)}r.t>0&&(r[r.t-1]+=x.am(i,x[i],r,2*i,0,1)),r.s=0,r.clamp()},BigInteger.prototype.divRemTo=function(m,q,r){var pm=m.abs();if(!(pm.t<=0)){var pt=this.abs();if(pt.t<pm.t)return null!=q&&q.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=nbi());var y=nbi(),ts=this.s,ms=m.s,nsh=this.DB-nbits(pm[pm.t-1]);nsh>0?(pm.lShiftTo(nsh,y),pt.lShiftTo(nsh,r)):(pm.copyTo(y),pt.copyTo(r));var ys=y.t,y0=y[ys-1];if(0!=y0){var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0),d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2,i=r.t,j=i-ys,t=null==q?nbi():q;for(y.dlShiftTo(j,t),r.compareTo(t)>=0&&(r[r.t++]=1,r.subTo(t,r)),BigInteger.ONE.dlShiftTo(ys,t),t.subTo(y,y);y.t<ys;)y[y.t++]=0;for(;--j>=0;){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd)for(y.dlShiftTo(j,t),r.subTo(t,r);r[i]<--qd;)r.subTo(t,r)}null!=q&&(r.drShiftTo(ys,q),ts!=ms&&BigInteger.ZERO.subTo(q,q)),r.t=ys,r.clamp(),nsh>0&&r.rShiftTo(nsh,r),ts<0&&BigInteger.ZERO.subTo(r,r)}}},BigInteger.prototype.invDigit=function(){if(this.t<1)return 0;var x=this[0];if(0==(1&x))return 0;var y=3&x;return(y=(y=(y=(y=y*(2-(15&x)*y)&15)*(2-(255&x)*y)&255)*(2-((65535&x)*y&65535))&65535)*(2-x*y%this.DV)%this.DV)>0?this.DV-y:-y},BigInteger.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},BigInteger.prototype.exp=function(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;for(g.copyTo(r);--i>=0;)if(z.sqrTo(r,r2),(e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2,r2=t}return z.revert(r)},BigInteger.prototype.toString=function(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(16==b)k=4;else if(8==b)k=3;else if(2==b)k=1;else if(32==b)k=5;else{if(4!=b)return this.toRadix(b);k=2}var d,km=(1<<k)-1,m=!1,r="",i=this.t,p=this.DB-i*this.DB%k;if(i-- >0)for(p<this.DB&&(d=this[i]>>p)>0&&(m=!0,r=int2char(d));i>=0;)p<k?(d=(this[i]&(1<<p)-1)<<k-p,d|=this[--i]>>(p+=this.DB-k)):(d=this[i]>>(p-=k)&km,p<=0&&(p+=this.DB,--i)),d>0&&(m=!0),m&&(r+=int2char(d));return m?r:"0"},BigInteger.prototype.negate=function(){var r=nbi();return BigInteger.ZERO.subTo(this,r),r},BigInteger.prototype.abs=function(){return this.s<0?this.negate():this},BigInteger.prototype.compareTo=function(a){var r=this.s-a.s;if(0!=r)return r;var i=this.t;if(0!=(r=i-a.t))return this.s<0?-r:r;for(;--i>=0;)if(0!=(r=this[i]-a[i]))return r;return 0},BigInteger.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)},BigInteger.prototype.mod=function(a){var r=nbi();return this.abs().divRemTo(a,null,r),this.s<0&&r.compareTo(BigInteger.ZERO)>0&&a.subTo(r,r),r},BigInteger.prototype.modPowInt=function(e,m){var z;return z=e<256||m.isEven()?new Classic(m):new Montgomery(m),this.exp(e,z)},BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=function(x,y,r){x.multiplyTo(y,r)},NullExp.prototype.sqrTo=function(x,r){x.squareTo(r)},Barrett.prototype.convert=function(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);if(x.compareTo(this.m)<0)return x;var r=nbi();return x.copyTo(r),this.reduce(r),r},Barrett.prototype.revert=function(x){return x},Barrett.prototype.reduce=function(x){for(x.drShiftTo(this.m.t-1,this.r2),x.t>this.m.t+1&&(x.t=this.m.t+1,x.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);x.compareTo(this.r2)<0;)x.dAddOffset(1,this.m.t+1);for(x.subTo(this.r2,x);x.compareTo(this.m)>=0;)x.subTo(this.m,x)},Barrett.prototype.mulTo=function(x,y,r){x.multiplyTo(y,r),this.reduce(r)},Barrett.prototype.sqrTo=function(x,r){x.squareTo(r),this.reduce(r)};var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];function parseBigInt(str,r){return new BigInteger(str,r)}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}BigInteger.prototype.chunkSize=function(r){return Math.floor(Math.LN2*this.DB/Math.log(r))},BigInteger.prototype.toRadix=function(b){if(null==b&&(b=10),0==this.signum()||b<2||b>36)return"0";var cs=this.chunkSize(b),a=Math.pow(b,cs),d=nbv(a),y=nbi(),z=nbi(),r="";for(this.divRemTo(d,y,z);y.signum()>0;)r=(a+z.intValue()).toString(b).substr(1)+r,y.divRemTo(d,y,z);return z.intValue().toString(b)+r},BigInteger.prototype.fromRadix=function(s,b){this.fromInt(0),null==b&&(b=10);for(var cs=this.chunkSize(b),d=Math.pow(b,cs),mi=!1,j=0,w=0,i=0;i<s.length;++i){var x=intAt(s,i);x<0?"-"==s.charAt(i)&&0==this.signum()&&(mi=!0):(w=b*w+x,++j>=cs&&(this.dMultiply(d),this.dAddOffset(w,0),j=0,w=0))}j>0&&(this.dMultiply(Math.pow(b,j)),this.dAddOffset(w,0)),mi&&BigInteger.ZERO.subTo(this,this)},BigInteger.prototype.fromNumber=function(a,b,c){if("number"==typeof b)if(a<2)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(BigInteger.ONE.shiftLeft(a-1),this);else{var x=new Array,t=7&a;x.length=1+(a>>3),b.nextBytes(x),t>0?x[0]&=(1<<t)-1:x[0]=0,this.fromString(x,256)}},BigInteger.prototype.bitwiseTo=function(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){for(f=a.s&this.DM,i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{for(f=this.s&this.DM,i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s),r.clamp()},BigInteger.prototype.changeBit=function(n,op){var r=BigInteger.ONE.shiftLeft(n);return this.bitwiseTo(r,op,r),r},BigInteger.prototype.addTo=function(a,r){for(var i=0,c=0,m=Math.min(a.t,this.t);i<m;)c+=this[i]+a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){for(c+=a.s;i<this.t;)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;i<a.t;)c+=a[i],r[i++]=c&this.DM,c>>=this.DB;c+=a.s}r.s=c<0?-1:0,c>0?r[i++]=c:c<-1&&(r[i++]=this.DV+c),r.t=i,r.clamp()},BigInteger.prototype.dMultiply=function(n){this[this.t]=this.am(0,n-1,this,0,0,this.t),++this.t,this.clamp()},BigInteger.prototype.dAddOffset=function(n,w){if(0!=n){for(;this.t<=w;)this[this.t++]=0;for(this[w]+=n;this[w]>=this.DV;)this[w]-=this.DV,++w>=this.t&&(this[this.t++]=0),++this[w]}},BigInteger.prototype.multiplyLowerTo=function(a,n,r){var j,i=Math.min(this.t+a.t,n);for(r.s=0,r.t=i;i>0;)r[--i]=0;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()},BigInteger.prototype.multiplyUpperTo=function(a,n,r){--n;var i=r.t=this.t+a.t-n;for(r.s=0;--i>=0;)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp(),r.drShiftTo(1,r)},BigInteger.prototype.modInt=function(n){if(n<=0)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(0==d)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r},BigInteger.prototype.millerRabin=function(t){var n1=this.subtract(BigInteger.ONE),k=n1.getLowestSetBit();if(k<=0)return!1;var r=n1.shiftRight(k);(t=t+1>>1)>lowprimes.length&&(t=lowprimes.length);for(var a=nbi(),i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(0!=y.compareTo(BigInteger.ONE)&&0!=y.compareTo(n1)){for(var j=1;j++<k&&0!=y.compareTo(n1);)if(0==(y=y.modPowInt(2,this)).compareTo(BigInteger.ONE))return!1;if(0!=y.compareTo(n1))return!1}}return!0},BigInteger.prototype.clone=function(){var r=nbi();return this.copyTo(r),r},BigInteger.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},BigInteger.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},BigInteger.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},BigInteger.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},BigInteger.prototype.toByteArray=function(){var i=this.t,r=new Array;r[0]=this.s;var d,p=this.DB-i*this.DB%8,k=0;if(i-- >0)for(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p&&(r[k++]=d|this.s<<this.DB-p);i>=0;)p<8?(d=(this[i]&(1<<p)-1)<<8-p,d|=this[--i]>>(p+=this.DB-8)):(d=this[i]>>(p-=8)&255,p<=0&&(p+=this.DB,--i)),0!=(128&d)&&(d|=-256),0==k&&(128&this.s)!=(128&d)&&++k,(k>0||d!=this.s)&&(r[k++]=d);return r},BigInteger.prototype.equals=function(a){return 0==this.compareTo(a)},BigInteger.prototype.min=function(a){return this.compareTo(a)<0?this:a},BigInteger.prototype.max=function(a){return this.compareTo(a)>0?this:a},BigInteger.prototype.and=function(a){var r=nbi();return this.bitwiseTo(a,op_and,r),r},BigInteger.prototype.or=function(a){var r=nbi();return this.bitwiseTo(a,op_or,r),r},BigInteger.prototype.xor=function(a){var r=nbi();return this.bitwiseTo(a,op_xor,r),r},BigInteger.prototype.andNot=function(a){var r=nbi();return this.bitwiseTo(a,op_andnot,r),r},BigInteger.prototype.not=function(){for(var r=nbi(),i=0;i<this.t;++i)r[i]=this.DM&~this[i];return r.t=this.t,r.s=~this.s,r},BigInteger.prototype.shiftLeft=function(n){var r=nbi();return n<0?this.rShiftTo(-n,r):this.lShiftTo(n,r),r},BigInteger.prototype.shiftRight=function(n){var r=nbi();return n<0?this.lShiftTo(-n,r):this.rShiftTo(n,r),r},BigInteger.prototype.getLowestSetBit=function(){for(var i=0;i<this.t;++i)if(0!=this[i])return i*this.DB+lbit(this[i]);return this.s<0?this.t*this.DB:-1},BigInteger.prototype.bitCount=function(){for(var r=0,x=this.s&this.DM,i=0;i<this.t;++i)r+=cbit(this[i]^x);return r},BigInteger.prototype.testBit=function(n){var j=Math.floor(n/this.DB);return j>=this.t?0!=this.s:0!=(this[j]&1<<n%this.DB)},BigInteger.prototype.setBit=function(n){return this.changeBit(n,op_or)},BigInteger.prototype.clearBit=function(n){return this.changeBit(n,op_andnot)},BigInteger.prototype.flipBit=function(n){return this.changeBit(n,op_xor)},BigInteger.prototype.add=function(a){var r=nbi();return this.addTo(a,r),r},BigInteger.prototype.subtract=function(a){var r=nbi();return this.subTo(a,r),r},BigInteger.prototype.multiply=function(a){var r=nbi();return this.multiplyTo(a,r),r},BigInteger.prototype.divide=function(a){var r=nbi();return this.divRemTo(a,r,null),r},BigInteger.prototype.remainder=function(a){var r=nbi();return this.divRemTo(a,null,r),r},BigInteger.prototype.divideAndRemainder=function(a){var q=nbi(),r=nbi();return this.divRemTo(a,q,r),new Array(q,r)},BigInteger.prototype.modPow=function(e,m){var x,y,n,ans,xHex=this.toString(16),eHex=e.toString(16),mHex=m.toString(16);return new BigInteger(function(x,base){var i,t,s="";if(s6.length!=x.length?s6=dup(x):copy_(s6,x),-1==base){for(i=x.length-1;i>0;i--)s+=x[i]+",";s+=x[0]}else for(;!isZero(s6);)t=divInt_(s6,base),s=digitsStr.substring(t,t+1)+s;return 0==s.length&&(s="0"),s}((x=str2bigInt(xHex,16),y=str2bigInt(eHex,16),n=str2bigInt(mHex,16),powMod_(ans=expand(x,n.length),trim(y,2),trim(n,2)),trim(ans,1)),16),16)},BigInteger.prototype.modInverse=function(m){var ac=m.isEven();if(this.isEven()&&ac||0==m.signum())return BigInteger.ZERO;for(var u=m.clone(),v=this.clone(),a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);0!=u.signum();){for(;u.isEven();)u.rShiftTo(1,u),ac?(a.isEven()&&b.isEven()||(a.addTo(this,a),b.subTo(m,b)),a.rShiftTo(1,a)):b.isEven()||b.subTo(m,b),b.rShiftTo(1,b);for(;v.isEven();)v.rShiftTo(1,v),ac?(c.isEven()&&d.isEven()||(c.addTo(this,c),d.subTo(m,d)),c.rShiftTo(1,c)):d.isEven()||d.subTo(m,d),d.rShiftTo(1,d);u.compareTo(v)>=0?(u.subTo(v,u),ac&&a.subTo(c,a),b.subTo(d,b)):(v.subTo(u,v),ac&&c.subTo(a,c),d.subTo(b,d))}return 0!=v.compareTo(BigInteger.ONE)?BigInteger.ZERO:d.compareTo(m)>=0?d.subtract(m):d.signum()<0?(d.addTo(m,d),d.signum()<0?d.add(m):d):d},BigInteger.prototype.pow=function(e){return this.exp(e,new NullExp)},BigInteger.prototype.gcd=function(a){var x=this.s<0?this.negate():this.clone(),y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y,y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;for(i<g&&(g=i),g>0&&(x.rShiftTo(g,x),y.rShiftTo(g,y));x.signum()>0;)(i=x.getLowestSetBit())>0&&x.rShiftTo(i,x),(i=y.getLowestSetBit())>0&&y.rShiftTo(i,y),x.compareTo(y)>=0?(x.subTo(y,x),x.rShiftTo(1,x)):(y.subTo(x,y),y.rShiftTo(1,y));return g>0&&y.lShiftTo(g,y),y},BigInteger.prototype.isProbablePrime=function(t){var i,x=this.abs();if(1==x.t&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return!0;return!1}if(x.isEven())return!1;for(i=1;i<lowprimes.length;){for(var m=lowprimes[i],j=i+1;j<lowprimes.length&&m<lplim;)m*=lowprimes[j++];for(m=x.modInt(m);i<j;)if(m%lowprimes[i++]==0)return!1}return x.millerRabin(t)},BigInteger.prototype.square=function(){var r=nbi();return this.squareTo(r),r},RSAKey.prototype.doPublic=function(x){return x.modPowInt(this.e,this.n)},RSAKey.prototype.setPublic=function(N,E){null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16)):alert("Invalid RSA public key")},RSAKey.prototype.encrypt=function(text){var m=function(s,n){if(n<s.length+11)return alert("Message too long for RSA"),null;for(var ba=new Array,i=s.length-1;i>=0&&n>0;){var c=s.charCodeAt(i--);c<128?ba[--n]=c:c>127&&c<2048?(ba[--n]=63&c|128,ba[--n]=c>>6|192):(ba[--n]=63&c|128,ba[--n]=c>>6&63|128,ba[--n]=c>>12|224)}ba[--n]=0;for(var rng=new SecureRandom,x=new Array;n>2;){for(x[0]=0;0==x[0];)rng.nextBytes(x);ba[--n]=x[0]}return ba[--n]=2,ba[--n]=0,new BigInteger(ba)}(text,this.n.bitLength()+7>>3);if(null==m)return null;var c=this.doPublic(m);if(null==c)return null;var h=c.toString(16);return 0==(1&h.length)?h:"0"+h},RSAKey.prototype.doPrivate=function(x){if(null==this.p||null==this.q)return x.modPow(this.d,this.n);for(var xp=x.mod(this.p).modPow(this.dmp1,this.p),xq=x.mod(this.q).modPow(this.dmq1,this.q);xp.compareTo(xq)<0;)xp=xp.add(this.p);return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq)},RSAKey.prototype.setPrivate=function(N,E,D){null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16),this.d=parseBigInt(D,16)):alert("Invalid RSA private key")},RSAKey.prototype.setPrivateEx=function(N,E,D,P,Q,DP,DQ,C){null!=N&&null!=E&&N.length>0&&E.length>0?(this.n=parseBigInt(N,16),this.e=parseInt(E,16),this.d=parseBigInt(D,16),this.p=parseBigInt(P,16),this.q=parseBigInt(Q,16),this.dmp1=parseBigInt(DP,16),this.dmq1=parseBigInt(DQ,16),this.coeff=parseBigInt(C,16)):alert("Invalid RSA private key")},RSAKey.prototype.generate=function(B,E){var rng=new SecureRandom,qs=B>>1;this.e=parseInt(E,16);for(var ee=new BigInteger(E,16);;){for(;this.p=new BigInteger(B-qs,10,rng),0!=this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE););for(;this.q=new BigInteger(qs,10,rng),0!=this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE););if(this.p.compareTo(this.q)<=0){var t=this.p;this.p=this.q,this.q=t}var p1=this.p.subtract(BigInteger.ONE),q1=this.q.subtract(BigInteger.ONE),phi=p1.multiply(q1);if(0==phi.gcd(ee).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=ee.modInverse(phi),this.dmp1=this.d.mod(p1),this.dmq1=this.d.mod(q1),this.coeff=this.q.modInverse(this.p);break}}},RSAKey.prototype.decrypt=function(ctext){var c=parseBigInt(ctext,16),m=this.doPrivate(c);return null==m?null:function(d,n){for(var b=d.toByteArray(),i=0;i<b.length&&0==b[i];)++i;if(b.length-i!=n-1||2!=b[i])return null;for(++i;0!=b[i];)if(++i>=b.length)return null;for(var ret="";++i<b.length;){var c=255&b[i];c<128?ret+=String.fromCharCode(c):c>191&&c<224?(ret+=String.fromCharCode((31&c)<<6|63&b[i+1]),++i):(ret+=String.fromCharCode((15&c)<<12|(63&b[i+1])<<6|63&b[i+2]),i+=2)}return ret}(m,this.n.bitLength()+7>>3)};var bpe=0,mask=0,radix=mask+1;const digitsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\'\"+-";for(bpe=0;1<<bpe+1>1<<bpe;bpe++);radix=(mask=(1<<(bpe>>=1))-1)+1;const one=int2bigInt(1,1,1);var t=new Array(0),s0=t,s3=t,s4=t,s5=t,s6=t,s7=t,sa=t;function expand(x,n){var ans=int2bigInt(0,(x.length>n?x.length:n)*bpe,0);return copy_(ans,x),ans}function inverseModInt(x,n){for(var a=1,b=0;;){if(1==x)return a;if(0==x)return 0;if(b-=a*Math.floor(n/x),1==(n%=x))return b;if(0==n)return 0;a-=b*Math.floor(x/n),x%=n}}function negative(x){return x[x.length-1]>>bpe-1&1}function greaterShift(x,y,shift){var i,kx=x.length,ky=y.length,k=kx+shift<ky?kx+shift:ky;for(i=ky-1-shift;i<kx&&i>=0;i++)if(x[i]>0)return 1;for(i=kx-1+shift;i<ky;i++)if(y[i]>0)return 0;for(i=k-1;i>=shift;i--){if(x[i-shift]>y[i])return 1;if(x[i-shift]<y[i])return 0}return 0}function greater(x,y){var i,k=x.length<y.length?x.length:y.length;for(i=x.length;i<y.length;i++)if(y[i])return 0;for(i=y.length;i<x.length;i++)if(x[i])return 1;for(i=k-1;i>=0;i--){if(x[i]>y[i])return 1;if(x[i]<y[i])return 0}return 0}function modInt(x,n){var i,c=0;for(i=x.length-1;i>=0;i--)c=(c*radix+x[i])%n;return c}function int2bigInt(t,bits,minSize){var k,buff;return k=minSize>(k=Math.ceil(bits/bpe)+1)?minSize:k,copyInt_(buff=new Array(k),t),buff}function str2bigInt(s,base,minSize){var d,i,x,y,kk,k=s.length;if(-1==base){for(x=new Array(0);;){for(y=new Array(x.length+1),i=0;i<x.length;i++)y[i+1]=x[i];if(y[0]=parseInt(s,10),x=y,(d=s.indexOf(",",0))<1)break;if(0==(s=s.substring(d+1)).length)break}return x.length<minSize?(copy_(y=new Array(minSize),x),y):x}for(x=int2bigInt(0,base*k,0),i=0;i<k&&(d=digitsStr.indexOf(s.substring(i,i+1),0),base<=36&&d>=36&&(d-=26),!(d>=base||d<0));i++)multInt_(x,base),addInt_(x,d);for(k=x.length;k>0&&!x[k-1];k--);for(k=minSize>k+1?minSize:k+1,y=new Array(k),kk=k<x.length?k:x.length,i=0;i<kk;i++)y[i]=x[i];for(;i<k;i++)y[i]=0;return y}function equalsInt(x,y){var i;if(x[0]!=y)return 0;for(i=1;i<x.length;i++)if(x[i])return 0;return 1}function isZero(x){var i;for(i=0;i<x.length;i++)if(x[i])return 0;return 1}function dup(x){var buff;return copy_(buff=new Array(x.length),x),buff}function copy_(x,y){var i,k=x.length<y.length?x.length:y.length;for(i=0;i<k;i++)x[i]=y[i];for(i=k;i<x.length;i++)x[i]=0}function copyInt_(x,n){var i,c;for(c=n,i=0;i<x.length;i++)x[i]=c&mask,c>>=bpe}function addInt_(x,n){var i,k,c,b;for(x[0]+=n,k=x.length,c=0,i=0;i<k;i++)if(b=0,(c+=x[i])<0&&(c+=(b=-(c>>bpe))*radix),x[i]=c&mask,!(c=(c>>bpe)-b))return}function rightShift_(x,n){var i,k=Math.floor(n/bpe);if(k){for(i=0;i<x.length-k;i++)x[i]=x[i+k];for(;i<x.length;i++)x[i]=0;n%=bpe}for(i=0;i<x.length-1;i++)x[i]=mask&(x[i+1]<<bpe-n|x[i]>>n);x[i]>>=n}function leftShift_(x,n){var i,k=Math.floor(n/bpe);if(k){for(i=x.length;i>=k;i--)x[i]=x[i-k];for(;i>=0;i--)x[i]=0;n%=bpe}if(n){for(i=x.length-1;i>0;i--)x[i]=mask&(x[i]<<n|x[i-1]>>bpe-n);x[i]=mask&x[i]<<n}}function multInt_(x,n){var i,k,c,b;if(n)for(k=x.length,c=0,i=0;i<k;i++)b=0,(c+=x[i]*n)<0&&(c+=(b=-(c>>bpe))*radix),x[i]=c&mask,c=(c>>bpe)-b}function divInt_(x,n){var i,s,r=0;for(i=x.length-1;i>=0;i--)s=r*radix+x[i],x[i]=Math.floor(s/n),r=s%n;return r}function linCombShift_(x,y,b,ys){var i,c,k,kk;for(k=x.length<ys+y.length?x.length:ys+y.length,kk=x.length,c=0,i=ys;i<k;i++)c+=x[i]+b*y[i-ys],x[i]=c&mask,c>>=bpe;for(i=k;c&&i<kk;i++)c+=x[i],x[i]=c&mask,c>>=bpe}function addShift_(x,y,ys){var i,c,k,kk;for(k=x.length<ys+y.length?x.length:ys+y.length,kk=x.length,c=0,i=ys;i<k;i++)c+=x[i]+y[i-ys],x[i]=c&mask,c>>=bpe;for(i=k;c&&i<kk;i++)c+=x[i],x[i]=c&mask,c>>=bpe}function subShift_(x,y,ys){var i,c,k,kk;for(k=x.length<ys+y.length?x.length:ys+y.length,kk=x.length,c=0,i=ys;i<k;i++)c+=x[i]-y[i-ys],x[i]=c&mask,c>>=bpe;for(i=k;c&&i<kk;i++)c+=x[i],x[i]=c&mask,c>>=bpe}function sub_(x,y){var i,c,k;for(k=x.length<y.length?x.length:y.length,c=0,i=0;i<k;i++)c+=x[i]-y[i],x[i]=c&mask,c>>=bpe;for(i=k;c&&i<x.length;i++)c+=x[i],x[i]=c&mask,c>>=bpe}function mod_(x,n){s4.length!=x.length?s4=dup(x):copy_(s4,x),s5.length!=x.length&&(s5=dup(x)),function(x,y,q,r){var kx,ky,i,y1,y2,c,a,b;for(copy_(r,x),ky=y.length;0==y[ky-1];ky--);for(b=y[ky-1],a=0;b;a++)b>>=1;for(leftShift_(y,a=bpe-a),leftShift_(r,a),kx=r.length;0==r[kx-1]&&kx>ky;kx--);for(copyInt_(q,0);!greaterShift(y,r,kx-ky);)subShift_(r,y,kx-ky),q[kx-ky]++;for(i=kx-1;i>=ky;i--){for(r[i]==y[ky-1]?q[i-ky]=mask:q[i-ky]=Math.floor((r[i]*radix+r[i-1])/y[ky-1]);c=(y2=(ky>1?y[ky-2]:0)*q[i-ky])>>bpe,y2&=mask,c=(y1=c+q[i-ky]*y[ky-1])>>bpe,y1&=mask,c==r[i]?y1==r[i-1]?y2>(i>1?r[i-2]:0):y1>r[i-1]:c>r[i];)q[i-ky]--;linCombShift_(r,y,-q[i-ky],i-ky),negative(r)&&(addShift_(r,y,i-ky),q[i-ky]--)}rightShift_(y,a),rightShift_(r,a)}(s4,n,s5,x)}function multMod_(x,y,n){var i;for(s0.length!=2*x.length&&(s0=new Array(2*x.length)),copyInt_(s0,0),i=0;i<y.length;i++)y[i]&&linCombShift_(s0,x,y[i],i);mod_(s0,n),copy_(x,s0)}function squareMod_(x,n){var i,j,c,kx,k;for(kx=x.length;kx>0&&!x[kx-1];kx--);for(k=kx>n.length?2*kx:2*n.length,s0.length!=k&&(s0=new Array(k)),copyInt_(s0,0),i=0;i<kx;i++){for(c=s0[2*i]+x[i]*x[i],s0[2*i]=c&mask,c>>=bpe,j=i+1;j<kx;j++)c=s0[i+j]+2*x[i]*x[j]+c,s0[i+j]=c&mask,c>>=bpe;s0[i+kx]=c}mod_(s0,n),copy_(x,s0)}function trim(x,k){var i,y;for(i=x.length;i>0&&!x[i-1];i--);return copy_(y=new Array(i+k),x),y}function powMod_(x,y,n){var k1,k2,kn,np;if(s7.length!=n.length&&(s7=dup(n)),0!=(1&n[0])){for(copyInt_(s7,0),kn=n.length;kn>0&&!n[kn-1];kn--);for(np=radix-inverseModInt(modInt(n,radix),radix),s7[kn]=1,multMod_(x,s7,n),s3.length!=x.length?s3=dup(x):copy_(s3,x),k1=y.length-1;k1>0&!y[k1];k1--);if(0!=y[k1]){for(k2=1<<bpe-1;k2&&!(y[k1]&k2);k2>>=1);for(;;){if(!(k2>>=1)){if(--k1<0)return void mont_(x,one,n,np);k2=1<<bpe-1}mont_(x,x,n,np),k2&y[k1]&&mont_(x,s3,n,np)}}else copyInt_(x,1)}else for(copy_(s7,x),copyInt_(x,1);!equalsInt(y,0);)1&y[0]&&multMod_(x,s7,n),divInt_(y,2),squareMod_(s7,n)}function mont_(x,y,n,np){var i,j,c,ui,t,ks,kn=n.length,ky=y.length;for(sa.length!=kn&&(sa=new Array(kn)),copyInt_(sa,0);kn>0&&0==n[kn-1];kn--);for(;ky>0&&0==y[ky-1];ky--);for(ks=sa.length-1,i=0;i<kn;i++){for(c=(t=sa[0]+x[i]*y[0])+(ui=(t&mask)*np&mask)*n[0]>>bpe,t=x[i],j=1;j<ky-4;)c+=sa[j]+ui*n[j]+t*y[j],sa[j-1]=c&mask,c>>=bpe,c+=sa[++j]+ui*n[j]+t*y[j],sa[j-1]=c&mask,c>>=bpe,c+=sa[++j]+ui*n[j]+t*y[j],sa[j-1]=c&mask,c>>=bpe,c+=sa[++j]+ui*n[j]+t*y[j],sa[j-1]=c&mask,c>>=bpe,c+=sa[++j]+ui*n[j]+t*y[j],sa[j-1]=c&mask,c>>=bpe,j++;for(;j<ky;)c+=sa[j]+ui*n[j]+t*y[j],sa[j-1]=c&mask,c>>=bpe,j++;for(;j<kn-4;)c+=sa[j]+ui*n[j],sa[j-1]=c&mask,c>>=bpe,c+=sa[++j]+ui*n[j],sa[j-1]=c&mask,c>>=bpe,c+=sa[++j]+ui*n[j],sa[j-1]=c&mask,c>>=bpe,c+=sa[++j]+ui*n[j],sa[j-1]=c&mask,c>>=bpe,c+=sa[++j]+ui*n[j],sa[j-1]=c&mask,c>>=bpe,j++;for(;j<kn;)c+=sa[j]+ui*n[j],sa[j-1]=c&mask,c>>=bpe,j++;for(;j<ks;)c+=sa[j],sa[j-1]=c&mask,c>>=bpe,j++;sa[j-1]=c&mask}greater(n,sa)||sub_(sa,n),copy_(x,sa)}module.exports={BigInteger:BigInteger,RSAKey:RSAKey,parseBigInt:parseBigInt}}),System.register("src/native/RsaApp.js",["../api/common/utils/Encoding","../api/common/error/CryptoError","./NativeWrapper","../api/common/WorkerProtocol"],function(_export,_context){"use strict";var uint8ArrayToBase64,base64ToUint8Array,nativeApp,Request,rsaApp;function generateRsaKey(seed){return nativeApp.invokeNative(new Request("generateRsaKey",[uint8ArrayToBase64(seed)]))}function rsaEncrypt(publicKey,bytes,seed){var encodedBytes=uint8ArrayToBase64(bytes);return nativeApp.invokeNative(new Request("rsaEncrypt",[publicKey,encodedBytes,uint8ArrayToBase64(seed)])).then(function(base64){return base64ToUint8Array(base64)})}function rsaDecrypt(privateKey,bytes){var encodedBytes=uint8ArrayToBase64(bytes);return nativeApp.invokeNative(new Request("rsaDecrypt",[privateKey,encodedBytes])).then(function(base64){return base64ToUint8Array(base64)})}return{setters:[function(_apiCommonUtilsEncoding){uint8ArrayToBase64=_apiCommonUtilsEncoding.uint8ArrayToBase64,base64ToUint8Array=_apiCommonUtilsEncoding.base64ToUint8Array},function(_apiCommonErrorCryptoError){_apiCommonErrorCryptoError.CryptoError},function(_NativeWrapper){nativeApp=_NativeWrapper.nativeApp},function(_apiCommonWorkerProtocol){Request=_apiCommonWorkerProtocol.Request}],execute:function(){_export("rsaApp",rsaApp={generateRsaKey:generateRsaKey,rsaEncrypt:rsaEncrypt,rsaDecrypt:rsaDecrypt}),_export("rsaApp",rsaApp)}}}),System.register("src/api/worker/crypto/Rsa.js",["../../common/utils/Encoding","../../common/utils/ArrayUtils","./Sha256","./Randomizer","../../common/error/CryptoError","../../Env","./lib/crypto-jsbn-2012-08-09_1","../../../native/RsaApp"],function(_export,_context){"use strict";var base64ToHex,base64ToUint8Array,hexToUint8Array,int8ArrayToBase64,uint8ArrayToBase64,uint8ArrayToHex,arrayEquals,concat,hash,random,CryptoError,assertWorkerOrNode,Mode,JSBN,rsaApp,RSAKey,parseBigInt,BigInteger,keyLengthInBits,publicExponent;function generateRsaKeySync(){try{var rsa=new RSAKey;return rsa.generate(keyLengthInBits,publicExponent.toString(16)),{publicKey:{version:0,keyLength:keyLengthInBits,modulus:uint8ArrayToBase64(new Uint8Array(rsa.n.toByteArray())),publicExponent:publicExponent},privateKey:{version:0,keyLength:keyLengthInBits,modulus:uint8ArrayToBase64(new Uint8Array(rsa.n.toByteArray())),privateExponent:uint8ArrayToBase64(new Uint8Array(rsa.d.toByteArray())),primeP:uint8ArrayToBase64(new Uint8Array(rsa.p.toByteArray())),primeQ:uint8ArrayToBase64(new Uint8Array(rsa.q.toByteArray())),primeExponentP:uint8ArrayToBase64(new Uint8Array(rsa.dmp1.toByteArray())),primeExponentQ:uint8ArrayToBase64(new Uint8Array(rsa.dmq1.toByteArray())),crtCoefficient:uint8ArrayToBase64(new Uint8Array(rsa.coeff.toByteArray()))}}}catch(e){throw new CryptoError("failed RSA key generation",e)}}function rsaEncryptSync(publicKey,bytes,seed){try{var rsa=new RSAKey;rsa.n=new BigInteger(new Int8Array(base64ToUint8Array(publicKey.modulus))),rsa.e=publicKey.publicExponent;var paddedHex=_bytesToHex(oaepPad(bytes,publicKey.keyLength,seed)),bigInt=parseBigInt(paddedHex,16),encryptedHex=rsa.doPublic(bigInt).toString(16);return encryptedHex.length%2==1&&(encryptedHex="0"+encryptedHex),hexToUint8Array(encryptedHex)}catch(e){throw new CryptoError("failed RSA encryption",e)}}function rsaDecryptSync(privateKey,bytes){try{var rsa=new RSAKey;rsa.n=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.modulus))),rsa.d=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.privateExponent))),rsa.p=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.primeP))),rsa.q=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.primeQ))),rsa.dmp1=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.primeExponentP))),rsa.dmq1=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.primeExponentQ))),rsa.coeff=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.crtCoefficient)));var hex=_bytesToHex(bytes),bigInt=parseBigInt(hex,16),decryptedHex=rsa.doPrivate(bigInt).toString(16),expectedPaddedHexLength=2*(privateKey.keyLength/8-1),fill=Array(expectedPaddedHexLength-decryptedHex.length+1).join("0");return oaepUnpad(hexToUint8Array(decryptedHex=fill+decryptedHex),privateKey.keyLength)}catch(e){throw new CryptoError("failed RSA decryption",e)}}function _bytesToHex(bytes){return uint8ArrayToHex(new Uint8Array(bytes))}function oaepPad(value,keyLength,seed){if(32!==seed.length)throw new CryptoError("invalid seed length: "+seed.length+". expected: 32 bytes!");if(value.length>keyLength/8-32-1)throw new CryptoError("invalid value length: "+value.length+". expected: max. "+(keyLength/8-32-1));for(var block=_getPSBlock(value,keyLength),dbMask=mgf1(seed,block.length-32),i=32;i<block.length;i++)block[i]^=dbMask[i-32];for(var seedMask=mgf1(block.slice(32,block.length),32),_i=0;_i<seedMask.length;_i++)block[_i]=seed[_i]^seedMask[_i];return block}function oaepUnpad(value,keyLength){if(value.length!==keyLength/8-1)throw new CryptoError("invalid value length: "+value.length+". expected: "+(keyLength/8-1)+" bytes!");for(var seedMask=mgf1(value.slice(32,value.length),32),seed=new Uint8Array(32),i=0;i<seedMask.length;i++)seed[i]=value[i]^seedMask[i];for(var dbMask=mgf1(seed,value.length-32),_i2=32;_i2<value.length;_i2++)value[_i2]^=dbMask[_i2-32];for(var index=64;index<value.length&&1!==value[index];index++)if(0!==value[index]||index===value.length)throw new CryptoError("invalid padding");return value.slice(index+1,value.length)}function _getPSBlock(value,keyLength){for(var block=new Uint8Array(keyLength/8-1),defHash=hash(new Uint8Array([])),nbrOfZeros=block.length-(1+value.length),i=0;i<block.length;i++)block[i]=i>=32&&i<64?defHash[i-32]:i<nbrOfZeros?0:i===nbrOfZeros?1:value[i-nbrOfZeros-1];return block}function encode(message,keyLength,salt){var emLen=Math.ceil(keyLength/8);if(32!==salt.length)throw new Error("invalid _salt length: "+salt.length+". expected: 32 bytes!");var length=32+salt.length+2;if(emLen<length)throw new Error("invalid hash/_salt length: "+length+". expected: max. "+emLen);var emBits=keyLength-1,minEmBitsLength=256+8*salt.length+9;if(emBits<minEmBitsLength)throw new Error("invalid maximum emBits length. Was "+emBits+", expected: "+minEmBitsLength);for(var messageHash=hash(message),message2=concat(new Uint8Array([0,0,0,0,0,0,0,0]),messageHash,salt),message2Hash=hash(message2),ps=new Uint8Array(emLen-salt.length-32-2),i=0;i<ps.length;i++)ps[i]=0;var db=concat(ps,new Uint8Array([1]),salt);_clear(ps);var expectedDbLength=emLen-32-1;if(db.length!==expectedDbLength)throw new Error("unexpected length of block: "+db.length+". Expected: "+expectedDbLength);for(var dbMask=mgf1(message2Hash,emLen-message2Hash.length-1),maskedDb=new Uint8Array(dbMask.length),_i3=0;_i3<dbMask.length;_i3++)maskedDb[_i3]=db[_i3]^dbMask[_i3];_clear(db),maskedDb[0]&=255>>8*emLen-emBits;var em=concat(maskedDb,message2Hash,new Uint8Array([188]));return _clear(maskedDb),em}function _verify(message,encodedMessage,keyLength){var emLen=Math.ceil(keyLength/8);try{if(encodedMessage.length<66)throw new Error("invalid length of encoded message: "+encodedMessage.length+". expected: > 66 bytes!");if(188!==encodedMessage[encodedMessage.length-1])throw new Error("rightmost octet of EM must be 188 (0xbc) but was "+encodedMessage[encodedMessage.length-1]);var maskedDB=encodedMessage.slice(0,emLen-32-1),hashed=encodedMessage.slice(emLen-32-1,emLen-32-1+32);if(maskedDB[0]>>8-(8*emLen-keyLength)!=0)throw new Error("inconsistent leftmost octet in maskedDB.");for(var dbMask=mgf1(hashed,emLen-32-1),db=new Uint8Array(dbMask.length),i=0;i<dbMask.length;i++)db[i]=maskedDB[i]^dbMask[i];db[0]&=255>>8*emLen-keyLength;for(var _i4=0;_i4<emLen-32-32-2;_i4++)if(0!==db[_i4])throw new Error("inconsistent leftmost octets of db.");if(1!==db[emLen-32-32-2])throw new Error("inconsistent octet value in db. Expected 1 (0x01) but was "+db[emLen-32-32-1]);var salt=db.slice(db.length-32),messageHash=hash(message),message2=concat(new Uint8Array([0,0,0,0,0,0,0,0]),messageHash,salt),message2Hash=hash(message2);if(!arrayEquals(hashed,message2Hash))throw new CryptoError("Hashes do not match")}finally{_clear(message),_clear(encodedMessage),_clear(maskedDB),_clear(hashed),_clear(dbMask),_clear(db),_clear(salt),_clear(messageHash),_clear(message2),_clear(message2Hash)}}function _clear(array){array&&array.fill(0)}function mgf1(seed,length){var C=null,counter=0,T=new Uint8Array(0);do{C=i2osp(counter),T=concat(T,hash(concat(seed,C)))}while(++counter<Math.ceil(length/32));return T.slice(0,length)}function i2osp(i){return new Uint8Array([i>>24&255,i>>16&255,i>>8&255,i>>0&255])}function _base64ToBigInt(base64){return parseBigInt(base64ToHex(base64),16)}function _hexLen(string){for(var hexLen=string.length.toString(16);hexLen.length<4;)hexLen="0"+hexLen;return hexLen}function _keyArrayToHex(key){for(var hex="",i=0;i<key.length;i++){var param=key[i].toString(16);param.length%2==1&&(param="0"+param),hex+=_hexLen(param)+param}return hex}function _hexToKeyArray(hex){try{for(var key=[],pos=0;pos<hex.length;){var nextParamLen=parseInt(hex.substring(pos,pos+4),16);pos+=4,key.push(parseBigInt(hex.substring(pos,pos+nextParamLen),16)),pos+=nextParamLen}return function(key){if(1!==key.length&&7!==key.length)throw new Error("invalid key params");if(key[0].bitLength()<keyLengthInBits-1||key[0].bitLength()>keyLengthInBits)throw new Error("invalid key length, expected: around "+keyLengthInBits+", but was: "+key[0].bitLength())}(key),key}catch(e){throw new CryptoError("hex to rsa key failed",e)}}return _export("generateRsaKey",function(){return env.mode===Mode.App?rsaApp.generateRsaKey(random.generateRandomData(512)):Promise.resolve(generateRsaKeySync())}),_export("generateRsaKeySync",generateRsaKeySync),_export("rsaEncrypt",function(publicKey,bytes){var seed=random.generateRandomData(32);if(env.mode===Mode.App)return rsaApp.rsaEncrypt(publicKey,bytes,seed);try{return Promise.resolve(rsaEncryptSync(publicKey,bytes,seed))}catch(e){return Promise.reject(e)}}),_export("rsaEncryptSync",rsaEncryptSync),_export("rsaDecrypt",function(privateKey,bytes){if(env.mode===Mode.App)return rsaApp.rsaDecrypt(privateKey,bytes);try{return Promise.resolve(rsaDecryptSync(privateKey,bytes))}catch(e){return Promise.reject(e)}}),_export("rsaDecryptSync",rsaDecryptSync),_export("sign",function(privateKey,bytes){try{var rsa=new RSAKey;rsa.n=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.modulus))),rsa.d=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.privateExponent))),rsa.p=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.primeP))),rsa.q=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.primeQ))),rsa.dmp1=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.primeExponentP))),rsa.dmq1=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.primeExponentQ))),rsa.coeff=new BigInteger(new Int8Array(base64ToUint8Array(privateKey.crtCoefficient)));var salt=random.generateRandomData(32),paddedHex=_bytesToHex(encode(bytes,privateKey.keyLength,salt)),bigInt=parseBigInt(paddedHex,16),signedHex=rsa.doPrivate(bigInt).toString(16);return signedHex.length%2==1&&(signedHex="0"+signedHex),hexToUint8Array(signedHex)}catch(e){throw new CryptoError("failed RSA sign",e)}}),_export("verifySignature",function(publicKey,bytes,signature){try{var rsa=new RSAKey;rsa.n=new BigInteger(new Int8Array(base64ToUint8Array(publicKey.modulus))),rsa.e=publicKey.publicExponent;var signatureHex=_bytesToHex(signature),bigInt=parseBigInt(signatureHex,16),paddedHex=rsa.doPublic(bigInt).toString(16);paddedHex.length%2==1&&(paddedHex="0"+paddedHex),_verify(bytes,hexToUint8Array(paddedHex),publicKey.keyLength-1)}catch(e){throw new CryptoError("failed RSA verify sign",e)}}),_export("oaepPad",oaepPad),_export("oaepUnpad",oaepUnpad),_export("_getPSBlock",_getPSBlock),_export("encode",encode),_export("_verify",_verify),_export("mgf1",mgf1),_export("i2osp",i2osp),_export("_keyArrayToHex",_keyArrayToHex),_export("privateKeyToHex",function(privateKey){return _keyArrayToHex(function(privateKey){return[_base64ToBigInt(privateKey.modulus),_base64ToBigInt(privateKey.privateExponent),_base64ToBigInt(privateKey.primeP),_base64ToBigInt(privateKey.primeQ),_base64ToBigInt(privateKey.primeExponentP),_base64ToBigInt(privateKey.primeExponentQ),_base64ToBigInt(privateKey.crtCoefficient)]}(privateKey))}),_export("publicKeyToHex",function(publicKey){return _keyArrayToHex(function(publicKey){return[_base64ToBigInt(publicKey.modulus)]}(publicKey))}),_export("hexToPrivateKey",function(privateKeyHex){return privateKey=_hexToKeyArray(privateKeyHex),{version:0,keyLength:keyLengthInBits,modulus:int8ArrayToBase64(new Int8Array(privateKey[0].toByteArray())),privateExponent:int8ArrayToBase64(new Int8Array(privateKey[1].toByteArray())),primeP:int8ArrayToBase64(new Int8Array(privateKey[2].toByteArray())),primeQ:int8ArrayToBase64(new Int8Array(privateKey[3].toByteArray())),primeExponentP:int8ArrayToBase64(new Int8Array(privateKey[4].toByteArray())),primeExponentQ:int8ArrayToBase64(new Int8Array(privateKey[5].toByteArray())),crtCoefficient:int8ArrayToBase64(new Int8Array(privateKey[6].toByteArray()))};var privateKey}),_export("hexToPublicKey",function(publicKeyHex){return publicKey=_hexToKeyArray(publicKeyHex),{version:0,keyLength:keyLengthInBits,modulus:int8ArrayToBase64(new Int8Array(publicKey[0].toByteArray())),publicExponent:publicExponent};var publicKey}),{setters:[function(_commonUtilsEncoding){base64ToHex=_commonUtilsEncoding.base64ToHex,base64ToUint8Array=_commonUtilsEncoding.base64ToUint8Array,hexToUint8Array=_commonUtilsEncoding.hexToUint8Array,int8ArrayToBase64=_commonUtilsEncoding.int8ArrayToBase64,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64,uint8ArrayToHex=_commonUtilsEncoding.uint8ArrayToHex},function(_commonUtilsArrayUtils){arrayEquals=_commonUtilsArrayUtils.arrayEquals,concat=_commonUtilsArrayUtils.concat},function(_Sha){hash=_Sha.hash},function(_Randomizer){random=_Randomizer.random},function(_commonErrorCryptoError){CryptoError=_commonErrorCryptoError.CryptoError},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode,Mode=_Env.Mode},function(_libCryptoJsbn20120809_){JSBN=_libCryptoJsbn20120809_.default},function(_nativeRsaApp){rsaApp=_nativeRsaApp.rsaApp}],execute:function(){RSAKey=JSBN.RSAKey,parseBigInt=JSBN.parseBigInt,BigInteger=JSBN.BigInteger,assertWorkerOrNode(),keyLengthInBits=2048,publicExponent=65537}}}),System.register("src/api/worker/crypto/Randomizer.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./lib/crypto-sjcl-1.0.7","../../common/error/CryptoError","../../Env","../../common/TutanotaConstants"],function(_export,_context){"use strict";var _classCallCheck,_createClass,sjcl,CryptoError,assertWorkerOrNode,EntropySrc,Randomizer,random;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_libCryptoSjcl){sjcl=_libCryptoSjcl.default},function(_commonErrorCryptoError){CryptoError=_commonErrorCryptoError.CryptoError},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonTutanotaConstants){EntropySrc=_commonTutanotaConstants.EntropySrc}],execute:function(){assertWorkerOrNode(),Randomizer=function(){function Randomizer(){_classCallCheck(this,Randomizer),this.random=new sjcl.prng(6)}return _createClass(Randomizer,[{key:"addEntropy",value:function(entropyCache){var _this=this;return entropyCache.forEach(function(entry){_this.random.addEntropy(entry.data,entry.entropy,entry.source)}),Promise.resolve()}},{key:"addStaticEntropy",value:function(bytes){var _this2=this;bytes.forEach(function(byte){_this2.random.addEntropy(byte,8,EntropySrc.static)})}},{key:"isReady",value:function(){return 0!==this.random.isReady()}},{key:"generateRandomData",value:function(nbrOfBytes){try{var nbrOfWords=Math.floor((nbrOfBytes+3)/4),words=this.random.randomWords(nbrOfWords),arrayBuffer=sjcl.codec.arrayBuffer.fromBits(words,!1);return new Uint8Array(arrayBuffer,0,nbrOfBytes)}catch(e){throw new CryptoError("error during random number generation",e)}}}]),Randomizer}(),_export("random",random=new Randomizer),_export("random",random)}}}),System.register("src/api/worker/crypto/KeyCryptoUtils.js",["../../Env","./Aes","./CryptoUtils","../../common/utils/ArrayUtils","../../common/utils/Encoding","./Rsa","./Randomizer"],function(_export,_context){"use strict";var assertWorkerOrNode,aes128Decrypt,aes128Encrypt,aes256Decrypt,aes256Encrypt,IV_BYTE_LENGTH,bitArrayToUint8Array,uint8ArrayToBitArray,concat,hexToUint8Array,uint8ArrayToHex,hexToPrivateKey,privateKeyToHex,random,fixedIv;return _export("encryptKey",function(encryptionKey,key){return aes128Encrypt(encryptionKey,bitArrayToUint8Array(key),fixedIv,!1,!1).slice(fixedIv.length)}),_export("decryptKey",function(encryptionKey,key){return uint8ArrayToBitArray(aes128Decrypt(encryptionKey,concat(fixedIv,key),!1))}),_export("encrypt256Key",function(encryptionKey,key){return aes128Encrypt(encryptionKey,bitArrayToUint8Array(key),fixedIv,!1,!1).slice(fixedIv.length)}),_export("aes256EncryptKey",function(encryptionKey,key){return aes256Encrypt(encryptionKey,bitArrayToUint8Array(key),fixedIv,!1,!1).slice(fixedIv.length)}),_export("aes256DecryptKey",function(encryptionKey,key){return uint8ArrayToBitArray(aes256Decrypt(encryptionKey,concat(fixedIv,key),!1,!1))}),_export("decrypt256Key",function(encryptionKey,key){return uint8ArrayToBitArray(aes128Decrypt(encryptionKey,concat(fixedIv,key),!1))}),_export("encryptRsaKey",function(encryptionKey,privateKey,iv){return aes128Encrypt(encryptionKey,hexToUint8Array(privateKeyToHex(privateKey)),iv||random.generateRandomData(IV_BYTE_LENGTH),!0,!1)}),_export("decryptRsaKey",function(encryptionKey,encryptedPrivateKey){return hexToPrivateKey(uint8ArrayToHex(aes128Decrypt(encryptionKey,encryptedPrivateKey,!0)))}),{setters:[function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_Aes){aes128Decrypt=_Aes.aes128Decrypt,aes128Encrypt=_Aes.aes128Encrypt,aes256Decrypt=_Aes.aes256Decrypt,aes256Encrypt=_Aes.aes256Encrypt,IV_BYTE_LENGTH=_Aes.IV_BYTE_LENGTH},function(_CryptoUtils){bitArrayToUint8Array=_CryptoUtils.bitArrayToUint8Array,uint8ArrayToBitArray=_CryptoUtils.uint8ArrayToBitArray,fixedIv=_CryptoUtils.fixedIv},function(_commonUtilsArrayUtils){concat=_commonUtilsArrayUtils.concat},function(_commonUtilsEncoding){hexToUint8Array=_commonUtilsEncoding.hexToUint8Array,uint8ArrayToHex=_commonUtilsEncoding.uint8ArrayToHex},function(_Rsa){hexToPrivateKey=_Rsa.hexToPrivateKey,privateKeyToHex=_Rsa.privateKeyToHex},function(_Randomizer){random=_Randomizer.random}],execute:function(){assertWorkerOrNode()}}}),System.register("src/api/worker/crypto/CryptoFacade.js",["../../common/utils/Encoding","./Aes","../../common/TutanotaConstants","../EntityWorker","../../entities/tutanota/Services","./Rsa","../../common/EntityFunctions","../../entities/sys/GroupInfo","../../entities/tutanota/TutanotaProperties","../../entities/tutanota/EncryptTutanotaPropertiesData","../../entities/sys/BucketPermission","../../entities/sys/Group","../../entities/sys/Permission","../../Env","../../common/utils/Utils","../rest/EntityRestClient","../rest/RestClient","../../entities/sys/UpdatePermissionKeyData","../../entities/sys/Services","./CryptoUtils","../../common/error/RestError","../../common/error/SessionKeyNotFoundError","../WorkerLocator","../../entities/tutanota/MailBody","../../entities/tutanota/Mail","../../common/error/CryptoError","../../entities/sys/PushIdentifier","./InstanceMapper.js","./KeyCryptoUtils.js"],function(_export,_context){"use strict";var base64ToUint8Array,uint8ArrayToBase64,aes128RandomKey,BucketPermissionType,GroupType,PermissionType,load,loadAll,serviceRequestVoid,TutanotaService,rsaDecrypt,HttpMethod,isSameTypeRef,isSameTypeRefByAttr,resolveTypeReference,TypeRef,GroupInfoTypeRef,TutanotaPropertiesTypeRef,createEncryptTutanotaPropertiesData,BucketPermissionTypeRef,GroupTypeRef,PermissionTypeRef,assertWorkerOrNode,neverNull,typeRefToPath,restClient,createUpdatePermissionKeyData,SysService,uint8ArrayToBitArray,NotFoundError,SessionKeyNotFoundError,locator,MailBodyTypeRef,MailTypeRef,CryptoError,PushIdentifierTypeRef,decryptAndMapToInstance,decryptValue,encryptAndMapToLiteral,encryptBytes,encryptString,encryptValue,aes256DecryptKey,aes256EncryptKey,decrypt256Key,decryptKey,decryptRsaKey,encrypt256Key,encryptKey,encryptRsaKey,mailBodySessionKeyCache,resolveSessionKeyLoaders;function _updateOwnerEncSessionKey(typeModel,instance,ownerGroupKey,sessionKey){instance._ownerEncSessionKey=uint8ArrayToBase64(encryptKey(ownerGroupKey,sessionKey));var path=typeRefToPath(new TypeRef(typeModel.app,typeModel.name))+"/"+(instance._id instanceof Array?instance._id.join("/"):instance._id),headers=locator.login.createAuthHeaders();return headers.v=typeModel.version,restClient.request(path,HttpMethod.PUT,{updateOwnerEncSessionKey:"true"},headers,JSON.stringify(instance))}return _export("applyMigrations",function(typeRef,data){if(isSameTypeRef(typeRef,GroupInfoTypeRef)&&null==data._ownerGroup){var customerGroupMembership=locator.login.getLoggedInUser().memberships.find(function(g){return g.groupType===GroupType.Customer}),customerGroupKey=locator.login.getGroupKey(customerGroupMembership.group);return loadAll(PermissionTypeRef,data._id[0]).then(function(listPermissions){var customerGroupPermission=listPermissions.find(function(p){return p.group===customerGroupMembership.group});if(!customerGroupPermission)throw new SessionKeyNotFoundError("Permission not found, could not apply OwnerGroup migration");var listKey=decryptKey(customerGroupKey,customerGroupPermission.symEncSessionKey),groupInfoSk=decryptKey(listKey,base64ToUint8Array(data._listEncSessionKey));return data._ownerGroup=customerGroupMembership.getGroup(),data._ownerEncSessionKey=uint8ArrayToBase64(encryptKey(customerGroupKey,groupInfoSk)),data})}if(isSameTypeRef(typeRef,TutanotaPropertiesTypeRef)&&null==data._ownerEncSessionKey){var migrationData=createEncryptTutanotaPropertiesData();data._ownerGroup=locator.login.getUserGroupId();var groupEncSessionKey=encryptKey(locator.login.getUserGroupKey(),aes128RandomKey());return data._ownerEncSessionKey=uint8ArrayToBase64(groupEncSessionKey),migrationData.properties=data._id,migrationData.symEncSessionKey=groupEncSessionKey,serviceRequestVoid(TutanotaService.EncryptTutanotaPropertiesService,HttpMethod.POST,migrationData).then(function(){return data})}return isSameTypeRef(typeRef,PushIdentifierTypeRef)&&null==data._ownerEncSessionKey?resolveTypeReference(typeRef).then(function(typeModel){return _updateOwnerEncSessionKey(typeModel,data,locator.login.getUserGroupKey(),aes128RandomKey())}).return(data):Promise.resolve(data)}),_export("resolveSessionKey",function(typeModel,instance,sessionKeyLoaders){return Promise.resolve().then(function(){var loaders=null==sessionKeyLoaders?resolveSessionKeyLoaders:sessionKeyLoaders;if(typeModel.encrypted){if(isSameTypeRefByAttr(MailBodyTypeRef,typeModel.app,typeModel.name)&&mailBodySessionKeyCache[instance._id]){var sessionKey=mailBodySessionKeyCache[instance._id];return delete mailBodySessionKeyCache[instance._id],sessionKey}if(instance._ownerEncSessionKey&&locator.login.isLoggedIn()&&locator.login.hasGroup(instance._ownerGroup)){var gk=locator.login.getGroupKey(instance._ownerGroup),_key=instance._ownerEncSessionKey;return"string"==typeof _key&&(_key=base64ToUint8Array(instance._ownerEncSessionKey)),Promise.resolve(decryptKey(gk,_key))}if(instance.ownerEncSessionKey){var _gk=locator.login.getGroupKey(locator.login.getGroupId(GroupType.Mail)),_key2=instance.ownerEncSessionKey;return"string"==typeof _key2&&(_key2=base64ToUint8Array(instance.ownerEncSessionKey)),Promise.resolve(decryptKey(_gk,_key2))}return loaders.loadPermissions(instance._permissions).then(function(listPermissions){var userGroupIds=locator.login.getAllGroupIds(),p=listPermissions.find(function(p){return(p.type===PermissionType.Public_Symmetric||p.type===PermissionType.Symmetric)&&p._ownerGroup&&-1!==userGroupIds.indexOf(p._ownerGroup)});if(p){var _gk2=locator.login.getGroupKey(p._ownerGroup);return Promise.resolve(decryptKey(_gk2,p._ownerEncSessionKey))}if(null==(p=listPermissions.find(function(p){return p.type===PermissionType.Public||p.type===PermissionType.External})))throw new SessionKeyNotFoundError("could not find permission");var permission=neverNull(p);return loaders.loadBucketPermissions(permission.bucket.bucketPermissions).then(function(bucketPermissions){var bp=bucketPermissions.find(function(bp){return(bp.type===BucketPermissionType.Public||bp.type===BucketPermissionType.External)&&permission._ownerGroup===bp._ownerGroup});if(null==bp)throw new SessionKeyNotFoundError("no corresponding bucket permission found");var bucketPermission=bp;if(bp.type===BucketPermissionType.External){var bucketKey=void 0;if(null!=bp.ownerEncBucketKey)bucketKey=decryptKey(locator.login.getGroupKey(neverNull(bp._ownerGroup)),neverNull(bp.ownerEncBucketKey));else{if(!bp.symEncBucketKey)throw new SessionKeyNotFoundError("BucketEncSessionKey is not defined for Permission "+permission._id.toString()+" (Instance: "+JSON.stringify(instance)+")");bucketKey=decryptKey(locator.login.getUserGroupKey(),neverNull(bp.symEncBucketKey))}return decryptKey(bucketKey,neverNull(permission.bucketEncSessionKey))}return loaders.loadGroup(bp.group).then(function(group){var keypair=group.keys[0],privKey=void 0;try{privKey=decryptRsaKey(locator.login.getGroupKey(group._id),keypair.symEncPrivKey)}catch(e){throw console.log("failed to decrypt rsa key for group with id "+group._id),e}var pubEncBucketKey=bucketPermission.pubEncBucketKey;if(null==pubEncBucketKey)throw new SessionKeyNotFoundError("PubEncBucketKey is not defined for BucketPermission "+bucketPermission._id.toString()+" (Instance: "+JSON.stringify(instance)+")");return rsaDecrypt(privKey,pubEncBucketKey).then(function(decryptedBytes){var bucketKey=uint8ArrayToBitArray(decryptedBytes),bucketEncSessionKey=permission.bucketEncSessionKey;if(null==bucketEncSessionKey)throw new SessionKeyNotFoundError("BucketEncSessionKey is not defined for Permission "+permission._id.toString()+" (Instance: "+JSON.stringify(instance)+")");var sk=decryptKey(bucketKey,bucketEncSessionKey),bucketPermissionOwnerGroupKey=locator.login.getGroupKey(neverNull(bucketPermission._ownerGroup)),bucketPermissionGroupKey=locator.login.getGroupKey(bucketPermission.group);return function(typeModel,instance,permission,bucketPermission,permissionOwnerGroupKey,permissionGroupKey,sessionKey){if(void 0!==instance._type)return Promise.resolve();if(instance._ownerEncSessionKey||permission._ownerGroup!==instance._ownerGroup){var updateService=createUpdatePermissionKeyData();return updateService.permission=permission._id,updateService.bucketPermission=bucketPermission._id,updateService.ownerEncSessionKey=encryptKey(permissionOwnerGroupKey,sessionKey),updateService.symEncSessionKey=encryptKey(permissionGroupKey,sessionKey),serviceRequestVoid(SysService.UpdatePermissionKeyService,HttpMethod.POST,updateService)}return _updateOwnerEncSessionKey(typeModel,instance,permissionOwnerGroupKey,sessionKey)}(typeModel,instance,permission,bucketPermission,bucketPermissionOwnerGroupKey,bucketPermissionGroupKey,sk).catch(NotFoundError,function(e){console.log("w> could not find instance to update permission")}).then(function(){return sk})})})})})}return Promise.resolve(null)}).then(function(sessionKey){return sessionKey&&isSameTypeRefByAttr(MailTypeRef,typeModel.app,typeModel.name)&&(mailBodySessionKeyCache[instance.body]=sessionKey),sessionKey}).catch(CryptoError,function(e){throw console.log("failed to resolve session key",e),new SessionKeyNotFoundError("Crypto error while resolving session key for instance "+instance._id)})}),_export("resolveServiceSessionKey",function(typeModel,instance){return instance._ownerPublicEncSessionKey?load(GroupTypeRef,instance._ownerGroup).then(function(group){var keypair=group.keys[0],gk=locator.login.getGroupKey(instance._ownerGroup),privKey=void 0;try{privKey=decryptRsaKey(gk,keypair.symEncPrivKey)}catch(e){throw console.log("failed to decrypt rsa key for group with id "+group._id),e}return rsaDecrypt(privKey,base64ToUint8Array(instance._ownerPublicEncSessionKey)).then(function(decryptedBytes){return uint8ArrayToBitArray(decryptedBytes)})}):Promise.resolve(null)}),_export("setNewOwnerEncSessionKey",function(model,entity){if(!entity._ownerGroup)throw new Error("no owner group set  "+JSON.stringify(entity));if(model.encrypted){if(entity._ownerEncSessionKey)throw new Error("ownerEncSessionKey already set "+JSON.stringify(entity));var sessionKey=aes128RandomKey();return entity._ownerEncSessionKey=encryptKey(locator.login.getGroupKey(entity._ownerGroup),sessionKey),sessionKey}return null}),{setters:[function(_commonUtilsEncoding){base64ToUint8Array=_commonUtilsEncoding.base64ToUint8Array,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64},function(_Aes){aes128RandomKey=_Aes.aes128RandomKey},function(_commonTutanotaConstants){BucketPermissionType=_commonTutanotaConstants.BucketPermissionType,GroupType=_commonTutanotaConstants.GroupType,PermissionType=_commonTutanotaConstants.PermissionType},function(_EntityWorker){load=_EntityWorker.load,loadAll=_EntityWorker.loadAll,serviceRequestVoid=_EntityWorker.serviceRequestVoid},function(_entitiesTutanotaServices){TutanotaService=_entitiesTutanotaServices.TutanotaService},function(_Rsa){rsaDecrypt=_Rsa.rsaDecrypt},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod,isSameTypeRef=_commonEntityFunctions.isSameTypeRef,isSameTypeRefByAttr=_commonEntityFunctions.isSameTypeRefByAttr,resolveTypeReference=_commonEntityFunctions.resolveTypeReference,TypeRef=_commonEntityFunctions.TypeRef},function(_entitiesSysGroupInfo){GroupInfoTypeRef=_entitiesSysGroupInfo.GroupInfoTypeRef},function(_entitiesTutanotaTutanotaProperties){TutanotaPropertiesTypeRef=_entitiesTutanotaTutanotaProperties.TutanotaPropertiesTypeRef},function(_entitiesTutanotaEncryptTutanotaPropertiesData){createEncryptTutanotaPropertiesData=_entitiesTutanotaEncryptTutanotaPropertiesData.createEncryptTutanotaPropertiesData},function(_entitiesSysBucketPermission){BucketPermissionTypeRef=_entitiesSysBucketPermission.BucketPermissionTypeRef},function(_entitiesSysGroup){GroupTypeRef=_entitiesSysGroup.GroupTypeRef},function(_entitiesSysPermission){PermissionTypeRef=_entitiesSysPermission.PermissionTypeRef},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull},function(_restEntityRestClient){typeRefToPath=_restEntityRestClient.typeRefToPath},function(_restRestClient){restClient=_restRestClient.restClient},function(_entitiesSysUpdatePermissionKeyData){createUpdatePermissionKeyData=_entitiesSysUpdatePermissionKeyData.createUpdatePermissionKeyData},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService},function(_CryptoUtils){uint8ArrayToBitArray=_CryptoUtils.uint8ArrayToBitArray},function(_commonErrorRestError){NotFoundError=_commonErrorRestError.NotFoundError},function(_commonErrorSessionKeyNotFoundError){SessionKeyNotFoundError=_commonErrorSessionKeyNotFoundError.SessionKeyNotFoundError},function(_WorkerLocator){locator=_WorkerLocator.locator},function(_entitiesTutanotaMailBody){MailBodyTypeRef=_entitiesTutanotaMailBody.MailBodyTypeRef},function(_entitiesTutanotaMail){MailTypeRef=_entitiesTutanotaMail.MailTypeRef},function(_commonErrorCryptoError){CryptoError=_commonErrorCryptoError.CryptoError},function(_entitiesSysPushIdentifier){PushIdentifierTypeRef=_entitiesSysPushIdentifier.PushIdentifierTypeRef},function(_InstanceMapperJs){decryptAndMapToInstance=_InstanceMapperJs.decryptAndMapToInstance,decryptValue=_InstanceMapperJs.decryptValue,encryptAndMapToLiteral=_InstanceMapperJs.encryptAndMapToLiteral,encryptBytes=_InstanceMapperJs.encryptBytes,encryptString=_InstanceMapperJs.encryptString,encryptValue=_InstanceMapperJs.encryptValue},function(_KeyCryptoUtilsJs){aes256DecryptKey=_KeyCryptoUtilsJs.aes256DecryptKey,aes256EncryptKey=_KeyCryptoUtilsJs.aes256EncryptKey,decrypt256Key=_KeyCryptoUtilsJs.decrypt256Key,decryptKey=_KeyCryptoUtilsJs.decryptKey,decryptRsaKey=_KeyCryptoUtilsJs.decryptRsaKey,encrypt256Key=_KeyCryptoUtilsJs.encrypt256Key,encryptKey=_KeyCryptoUtilsJs.encryptKey,encryptRsaKey=_KeyCryptoUtilsJs.encryptRsaKey}],execute:function(){assertWorkerOrNode(),_export("decryptAndMapToInstance",decryptAndMapToInstance),_export("encryptAndMapToLiteral",encryptAndMapToLiteral),_export("encryptValue",encryptValue),_export("decryptValue",decryptValue),_export("encryptBytes",encryptBytes),_export("encryptString",encryptString),_export("encryptKey",encryptKey),_export("decryptKey",decryptKey),_export("encrypt256Key",encrypt256Key),_export("decrypt256Key",decrypt256Key),_export("encryptRsaKey",encryptRsaKey),_export("decryptRsaKey",decryptRsaKey),_export("aes256EncryptKey",aes256EncryptKey),_export("aes256DecryptKey",aes256DecryptKey),mailBodySessionKeyCache={},resolveSessionKeyLoaders={loadPermissions:function(listId){return loadAll(PermissionTypeRef,listId)},loadBucketPermissions:function(listId){return loadAll(BucketPermissionTypeRef,listId)},loadGroup:function(groupId){return load(GroupTypeRef,groupId)}},"toJSON"in Error.prototype||Object.defineProperty(Error.prototype,"toJSON",{value:function(){var alt={};return Object.getOwnPropertyNames(this).forEach(function(key){alt[key]=this[key]},this),alt},configurable:!0,writable:!0})}}}),System.register("src/api/worker/rest/EntityRestClient.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","./RestClient","../crypto/CryptoFacade","../../common/EntityFunctions","../../Env","../../common/error/SessionKeyNotFoundError","../../entities/sys/PushIdentifier","../../common/error/RestError"],function(_export,_context){"use strict";var _classCallCheck,_createClass,restClient,applyMigrations,decryptAndMapToInstance,encryptAndMapToLiteral,resolveSessionKey,setNewOwnerEncSessionKey,HttpMethod,isSameTypeRef,MediaType,resolveTypeReference,assertWorkerOrNode,SessionKeyNotFoundError,PushIdentifierTypeRef,NotAuthenticatedError,EntityRestClient;function typeRefToPath(typeRef){return"/rest/"+typeRef.app+"/"+typeRef.type.toLowerCase()}return _export("typeRefToPath",typeRefToPath),{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_RestClient){restClient=_RestClient.restClient},function(_cryptoCryptoFacade){applyMigrations=_cryptoCryptoFacade.applyMigrations,decryptAndMapToInstance=_cryptoCryptoFacade.decryptAndMapToInstance,encryptAndMapToLiteral=_cryptoCryptoFacade.encryptAndMapToLiteral,resolveSessionKey=_cryptoCryptoFacade.resolveSessionKey,setNewOwnerEncSessionKey=_cryptoCryptoFacade.setNewOwnerEncSessionKey},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod,isSameTypeRef=_commonEntityFunctions.isSameTypeRef,MediaType=_commonEntityFunctions.MediaType,resolveTypeReference=_commonEntityFunctions.resolveTypeReference,_commonEntityFunctions.TypeRef},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_commonErrorSessionKeyNotFoundError){SessionKeyNotFoundError=_commonErrorSessionKeyNotFoundError.SessionKeyNotFoundError},function(_entitiesSysPushIdentifier){PushIdentifierTypeRef=_entitiesSysPushIdentifier.PushIdentifierTypeRef},function(_commonErrorRestError){NotAuthenticatedError=_commonErrorRestError.NotAuthenticatedError}],execute:function(){assertWorkerOrNode(),_export("EntityRestClient",EntityRestClient=function(){function EntityRestClient(authHeadersProvider){_classCallCheck(this,EntityRestClient),this._authHeadersProvider=authHeadersProvider}return _createClass(EntityRestClient,[{key:"entityRequest",value:function(typeRef,method,listId,id,entity,queryParameter,extraHeaders){var _this=this;return resolveTypeReference(typeRef).then(function(model){var path=typeRefToPath(typeRef);listId&&(path+="/"+listId),id&&(path+="/"+id);var queryParams=null==queryParameter?{}:queryParameter,authHeaders=_this._authHeadersProvider(),headers=Object.assign(authHeaders,extraHeaders);if(0===Object.keys(headers).length)throw new NotAuthenticatedError("user must be authenticated for entity requests");if(headers.v=model.version,method===HttpMethod.POST){var sk=setNewOwnerEncSessionKey(model,entity);return encryptAndMapToLiteral(model,entity,sk).then(function(encryptedEntity){return restClient.request(path,method,queryParams,headers,JSON.stringify(encryptedEntity),MediaType.Json).then(function(persistencePostReturn){return JSON.parse(persistencePostReturn).generatedId})})}return method===HttpMethod.PUT?resolveSessionKey(model,entity).then(function(sk){return encryptAndMapToLiteral(model,entity,sk)}).then(function(encryptedEntity){return restClient.request(path,method,queryParams,headers,JSON.stringify(encryptedEntity),MediaType.Json)}):method===HttpMethod.GET?restClient.request(path,method,queryParams,headers,null,MediaType.Json).then(function(json){var data=JSON.parse(json);if(data instanceof Array){var p=Promise.resolve();return isSameTypeRef(typeRef,PushIdentifierTypeRef)&&(p=Promise.map(data,function(instance){return applyMigrations(typeRef,instance)})),p.then(function(){return Promise.map(data,function(instance){return resolveSessionKey(model,instance).catch(SessionKeyNotFoundError,function(e){return console.log("could not resolve session key",e),null}).then(function(sk){return decryptAndMapToInstance(model,instance,sk)})},{concurrency:5})})}return applyMigrations(typeRef,data).then(function(data){return resolveSessionKey(model,data).catch(SessionKeyNotFoundError,function(e){return console.log("could not resolve session key",e),null}).then(function(sk){return decryptAndMapToInstance(model,data,sk)})})}):method===HttpMethod.DELETE?restClient.request(path,method,queryParams,headers):Promise.reject("Illegal method: "+method)})}},{key:"entityEventsReceived",value:function(data){return Promise.resolve(data)}}]),EntityRestClient}()),_export("EntityRestClient",EntityRestClient)}}}),System.register("src/api/worker/rest/RestClient.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../Env","../../common/error/RestError","../../common/EntityFunctions","../../common/utils/Encoding"],function(_export,_context){"use strict";var _classCallCheck,_createClass,assertWorkerOrNode,getHttpOrigin,isWorker,ConnectionError,handleRestError,HttpMethod,MediaType,uint8ArrayToArrayBuffer,RestClient,restClient;function addParamsToUrl(url,urlParams){if(urlParams){for(var key in url+="?",urlParams)url+=key+"="+urlParams[key]+"&";url=url.substring(0,url.length-1)}return url}return _export("addParamsToUrl",addParamsToUrl),{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode,getHttpOrigin=_Env.getHttpOrigin,isWorker=_Env.isWorker},function(_commonErrorRestError){ConnectionError=_commonErrorRestError.ConnectionError,handleRestError=_commonErrorRestError.handleRestError},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod,MediaType=_commonEntityFunctions.MediaType},function(_commonUtilsEncoding){uint8ArrayToArrayBuffer=_commonUtilsEncoding.uint8ArrayToArrayBuffer}],execute:function(){assertWorkerOrNode(),_export("RestClient",RestClient=function(){function RestClient(){_classCallCheck(this,RestClient),this.url=getHttpOrigin(),this.id=0}return _createClass(RestClient,[{key:"request",value:function(path,method,queryParams,headers,body,responseType,progressListener){var _this=this;return new Promise(function(resolve,reject){_this.id++,method===HttpMethod.GET&&"string"==typeof body&&(queryParams||(queryParams={}),queryParams._body=encodeURIComponent(body));var url=addParamsToUrl(_this.url+path,queryParams),xhr=new XMLHttpRequest;xhr.open(method,url),_this._setHeaders(xhr,headers,body,responseType),xhr.responseType=responseType===MediaType.Json||responseType===MediaType.Text?"text":"arraybuffer";var abortAfterTimeout=function(){var res={timeoutId:0,abortFunction:function(){console.log(_this.id+": "+String(new Date)+" aborting "+String(res.timeoutId)),xhr.abort()}};return res},t=abortAfterTimeout(),timeout=setTimeout(t.abortFunction,env.timeout);t.timeoutId=timeout,isWorker()&&self.debug&&console.log(_this.id+": set initial timeout "+String(timeout)+" of "+env.timeout),xhr.onload=function(){if(isWorker()&&self.debug&&console.log(_this.id+": "+String(new Date)+" finished request. Clearing Timeout "+String(timeout)+"."),clearTimeout(timeout),200===xhr.status||method===HttpMethod.POST&&201===xhr.status)responseType===MediaType.Json||responseType===MediaType.Text?resolve(xhr.response):responseType===MediaType.Binary?resolve(new Uint8Array(xhr.response)):resolve();else{var retryAfter=xhr.getResponseHeader("Retry-After");429==xhr.status&&retryAfter?(setTimeout(function(){resolve(_this.request(path,method,queryParams,headers,body,responseType,progressListener))},1e3*Number(retryAfter)),console.log("rate limited request to "+path+", retry after "+retryAfter+"s")):(console.log("failed request",method,url,xhr.status,xhr.statusText,headers,body),reject(handleRestError(xhr.status,"| "+method+" "+path,xhr.getResponseHeader("Error-Id"),xhr.getResponseHeader("Precondition"))))}},xhr.onerror=function(){clearTimeout(timeout),console.log("failed to request",method,url,headers,body),reject(handleRestError(xhr.status," | "+method+" "+path,xhr.getResponseHeader("Error-Id"),xhr.getResponseHeader("Precondition")))};try{xhr.upload.onprogress=function(pe){isWorker()&&self.debug&&console.log(_this.id+": "+String(new Date)+" upload progress. Clearing Timeout "+String(timeout),pe),clearTimeout(timeout);var t=abortAfterTimeout();timeout=setTimeout(t.abortFunction,env.timeout),t.timeoutId=timeout,isWorker()&&self.debug&&console.log(_this.id+": set new timeout "+String(timeout)+" of "+env.timeout),null!=progressListener&&pe.lengthComputable&&progressListener.upload(1/pe.total*pe.loaded)}}catch(e){clearTimeout(e)}xhr.onprogress=function(pe){isWorker()&&self.debug&&console.log(_this.id+": "+String(new Date)+" download progress. Clearing Timeout "+String(timeout),pe),clearTimeout(timeout);var t=abortAfterTimeout();timeout=setTimeout(t.abortFunction,env.timeout),t.timeoutId=timeout,isWorker()&&self.debug&&console.log(_this.id+": set new timeout "+String(timeout)+" of "+env.timeout),null!=progressListener&&pe.lengthComputable&&progressListener.download(1/pe.total*pe.loaded)},xhr.onabort=function(){clearTimeout(timeout),reject(new ConnectionError("Reached timeout of "+env.timeout+"ms "+xhr.statusText+" | "+method+" "+path))},body instanceof Uint8Array?xhr.send(uint8ArrayToArrayBuffer(body)):xhr.send(body)})}},{key:"_setHeaders",value:function(xhr,headers,body,responseType){for(var i in headers.cv=env.versionNumber,body instanceof Uint8Array?headers["Content-Type"]=MediaType.Binary:"string"==typeof body&&(headers["Content-Type"]=MediaType.Json),responseType&&(headers.Accept=responseType),headers)xhr.setRequestHeader(i,headers[i])}}]),RestClient}()),_export("RestClient",RestClient),_export("restClient",restClient=new RestClient),_export("restClient",restClient)}}}),System.register("src/api/entities/sys/SecondFactorAuthGetData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SecondFactorAuthGetDataTypeRef,_TypeModel;return _export("createSecondFactorAuthGetData",function(values){return Object.assign(create(_TypeModel,SecondFactorAuthGetDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SecondFactorAuthGetDataTypeRef",SecondFactorAuthGetDataTypeRef=new TypeRef("sys","SecondFactorAuthGetData")),_export("SecondFactorAuthGetDataTypeRef",SecondFactorAuthGetDataTypeRef),_export("_TypeModel",_TypeModel={name:"SecondFactorAuthGetData",since:23,type:"DATA_TRANSFER_TYPE",id:1233,rootId:"A3N5cwAE0Q",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1234,since:23,type:"Number",cardinality:"One",final:!1,encrypted:!1},accessToken:{name:"accessToken",id:1235,since:23,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/SecondFactorAuthGetReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,SecondFactorAuthGetReturnTypeRef,_TypeModel;return _export("createSecondFactorAuthGetReturn",function(values){return Object.assign(create(_TypeModel,SecondFactorAuthGetReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("SecondFactorAuthGetReturnTypeRef",SecondFactorAuthGetReturnTypeRef=new TypeRef("sys","SecondFactorAuthGetReturn")),_export("SecondFactorAuthGetReturnTypeRef",SecondFactorAuthGetReturnTypeRef),_export("_TypeModel",_TypeModel={name:"SecondFactorAuthGetReturn",since:23,type:"DATA_TRANSFER_TYPE",id:1236,rootId:"A3N5cwAE1A",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1237,since:23,type:"Number",cardinality:"One",final:!1,encrypted:!1},secondFactorPending:{name:"secondFactorPending",id:1238,since:23,type:"Boolean",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/DeleteCustomerData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,DeleteCustomerDataTypeRef,_TypeModel;return _export("createDeleteCustomerData",function(values){return Object.assign(create(_TypeModel,DeleteCustomerDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("DeleteCustomerDataTypeRef",DeleteCustomerDataTypeRef=new TypeRef("sys","DeleteCustomerData")),_export("DeleteCustomerDataTypeRef",DeleteCustomerDataTypeRef),_export("_TypeModel",_TypeModel={name:"DeleteCustomerData",since:5,type:"DATA_TRANSFER_TYPE",id:641,rootId:"A3N5cwACgQ",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:642,since:5,type:"Number",cardinality:"One",final:!1,encrypted:!1},authVerifier:{name:"authVerifier",id:1325,since:30,type:"Bytes",cardinality:"ZeroOrOne",final:!1,encrypted:!1},reason:{name:"reason",id:644,since:5,type:"String",cardinality:"One",final:!1,encrypted:!1},takeoverMailAddress:{name:"takeoverMailAddress",id:1077,since:19,type:"String",cardinality:"ZeroOrOne",final:!1,encrypted:!1},undelete:{name:"undelete",id:643,since:5,type:"Boolean",cardinality:"One",final:!1,encrypted:!1}},associations:{customer:{name:"customer",id:645,since:5,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"Customer",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/AutoLoginDataGet.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AutoLoginDataGetTypeRef,_TypeModel;return _export("createAutoLoginDataGet",function(values){return Object.assign(create(_TypeModel,AutoLoginDataGetTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AutoLoginDataGetTypeRef",AutoLoginDataGetTypeRef=new TypeRef("sys","AutoLoginDataGet")),_export("AutoLoginDataGetTypeRef",AutoLoginDataGetTypeRef),_export("_TypeModel",_TypeModel={name:"AutoLoginDataGet",since:1,type:"DATA_TRANSFER_TYPE",id:431,rootId:"A3N5cwABrw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:432,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},deviceToken:{name:"deviceToken",id:434,since:1,type:"String",cardinality:"One",final:!1,encrypted:!1}},associations:{userId:{name:"userId",id:433,since:1,type:"ELEMENT_ASSOCIATION",cardinality:"One",refType:"User",final:!1,external:!1}},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/AutoLoginDataReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,AutoLoginDataReturnTypeRef,_TypeModel;return _export("createAutoLoginDataReturn",function(values){return Object.assign(create(_TypeModel,AutoLoginDataReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("AutoLoginDataReturnTypeRef",AutoLoginDataReturnTypeRef=new TypeRef("sys","AutoLoginDataReturn")),_export("AutoLoginDataReturnTypeRef",AutoLoginDataReturnTypeRef),_export("_TypeModel",_TypeModel={name:"AutoLoginDataReturn",since:1,type:"DATA_TRANSFER_TYPE",id:438,rootId:"A3N5cwABtg",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:439,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},deviceKey:{name:"deviceKey",id:440,since:1,type:"Bytes",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/PasswordChannelReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PasswordChannelReturnTypeRef,_TypeModel;return _export("createPasswordChannelReturn",function(values){return Object.assign(create(_TypeModel,PasswordChannelReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PasswordChannelReturnTypeRef",PasswordChannelReturnTypeRef=new TypeRef("tutanota","PasswordChannelReturn")),_export("PasswordChannelReturnTypeRef",PasswordChannelReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PasswordChannelReturn",since:1,type:"DATA_TRANSFER_TYPE",id:327,rootId:"CHR1dGFub3RhAAFH",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:328,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{phoneNumberChannels:{name:"phoneNumberChannels",id:329,since:1,type:"AGGREGATION",cardinality:"Any",refType:"PasswordChannelPhoneNumber",final:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/PasswordMessagingReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PasswordMessagingReturnTypeRef,_TypeModel;return _export("createPasswordMessagingReturn",function(values){return Object.assign(create(_TypeModel,PasswordMessagingReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PasswordMessagingReturnTypeRef",PasswordMessagingReturnTypeRef=new TypeRef("tutanota","PasswordMessagingReturn")),_export("PasswordMessagingReturnTypeRef",PasswordMessagingReturnTypeRef),_export("_TypeModel",_TypeModel={name:"PasswordMessagingReturn",since:1,type:"DATA_TRANSFER_TYPE",id:313,rootId:"CHR1dGFub3RhAAE5",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:314,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},autoAuthenticationId:{name:"autoAuthenticationId",id:315,since:1,type:"GeneratedId",cardinality:"One",final:!1,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/PasswordMessagingData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,PasswordMessagingDataTypeRef,_TypeModel;return _export("createPasswordMessagingData",function(values){return Object.assign(create(_TypeModel,PasswordMessagingDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("PasswordMessagingDataTypeRef",PasswordMessagingDataTypeRef=new TypeRef("tutanota","PasswordMessagingData")),_export("PasswordMessagingDataTypeRef",PasswordMessagingDataTypeRef),_export("_TypeModel",_TypeModel={name:"PasswordMessagingData",since:1,type:"DATA_TRANSFER_TYPE",id:308,rootId:"CHR1dGFub3RhAAE0",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:309,since:1,type:"Number",cardinality:"One",final:!1,encrypted:!1},language:{name:"language",id:310,since:1,type:"String",cardinality:"One",final:!0,encrypted:!1},numberId:{name:"numberId",id:311,since:1,type:"CustomId",cardinality:"One",final:!0,encrypted:!1},symKeyForPasswordTransmission:{name:"symKeyForPasswordTransmission",id:312,since:1,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/RecoverCode.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,RecoverCodeTypeRef,_TypeModel;return _export("createRecoverCode",function(values){return Object.assign(create(_TypeModel,RecoverCodeTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("RecoverCodeTypeRef",RecoverCodeTypeRef=new TypeRef("sys","RecoverCode")),_export("RecoverCodeTypeRef",RecoverCodeTypeRef),_export("_TypeModel",_TypeModel={name:"RecoverCode",since:36,type:"ELEMENT_TYPE",id:1407,rootId:"A3N5cwAFfw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1411,since:36,type:"Number",cardinality:"One",final:!1,encrypted:!1},_id:{name:"_id",id:1409,since:36,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},_ownerGroup:{name:"_ownerGroup",id:1412,since:36,type:"GeneratedId",cardinality:"ZeroOrOne",final:!0,encrypted:!1},_permissions:{name:"_permissions",id:1410,since:36,type:"GeneratedId",cardinality:"One",final:!0,encrypted:!1},recoverCodeEncUserGroupKey:{name:"recoverCodeEncUserGroupKey",id:1414,since:36,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},userEncRecoverCode:{name:"userEncRecoverCode",id:1413,since:36,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},verifier:{name:"verifier",id:1415,since:36,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/sys/ResetFactorsDeleteData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,ResetFactorsDeleteDataTypeRef,_TypeModel;return _export("createResetFactorsDeleteData",function(values){return Object.assign(create(_TypeModel,ResetFactorsDeleteDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("ResetFactorsDeleteDataTypeRef",ResetFactorsDeleteDataTypeRef=new TypeRef("sys","ResetFactorsDeleteData")),_export("ResetFactorsDeleteDataTypeRef",ResetFactorsDeleteDataTypeRef),_export("_TypeModel",_TypeModel={name:"ResetFactorsDeleteData",since:36,type:"DATA_TRANSFER_TYPE",id:1419,rootId:"A3N5cwAFiw",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1420,since:36,type:"Number",cardinality:"One",final:!1,encrypted:!1},authVerifier:{name:"authVerifier",id:1422,since:36,type:"String",cardinality:"One",final:!0,encrypted:!1},mailAddress:{name:"mailAddress",id:1421,since:36,type:"String",cardinality:"One",final:!0,encrypted:!1},recoverCodeVerifier:{name:"recoverCodeVerifier",id:1423,since:36,type:"String",cardinality:"One",final:!0,encrypted:!1}},associations:{},app:"sys",version:"58"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/LoginFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../EntityWorker","../../entities/sys/Services","../../common/utils/Encoding","../crypto/Bcrypt","../crypto/CryptoConstants","../crypto/CryptoUtils","../crypto/CryptoFacade","../../common/TutanotaConstants","../crypto/Aes","../crypto/Randomizer","../../common/error/CryptoError","../../entities/sys/SaltData","../../entities/sys/SaltReturn","../../entities/sys/GroupInfo","../../entities/tutanota/TutanotaProperties","../../entities/sys/User","../../common/utils/Utils","../../common/EntityFunctions","../../Env","../crypto/Sha256","../../entities/sys/ChangePasswordData","../EventBusClient","../../entities/sys/CreateSessionData","../../entities/sys/CreateSessionReturn","../../entities/sys/Session","../rest/EntityRestClient","../rest/RestClient","../../entities/sys/SecondFactorAuthGetData","../../entities/sys/SecondFactorAuthGetReturn","../../common/error/SecondFactorPendingError","../../common/error/RestError","../../entities/sys/DeleteCustomerData","../../entities/sys/AutoLoginDataGet","../../entities/sys/AutoLoginDataReturn","../../common/error/CancelledError","../../entities/tutanota/PasswordChannelReturn","../../entities/tutanota/Services","../../entities/tutanota/PasswordMessagingReturn","../../entities/tutanota/PasswordMessagingData","../../entities/sys/RecoverCode","../../entities/sys/ResetFactorsDeleteData"],function(_export,_context){"use strict";var _classCallCheck,_createClass,load,loadRoot,serviceRequest,serviceRequestVoid,setup,update,SysService,base64ToBase64Ext,base64ToBase64Url,base64ToUint8Array,base64UrlToBase64,hexToUint8Array,uint8ArrayToBase64,uint8ArrayToHex,utf8Uint8ArrayToString,generateKeyFromPassphrase,generateRandomSalt,KeyLength,base64ToKey,bitArrayToUint8Array,createAuthVerifier,createAuthVerifierAsBase64Url,keyToUint8Array,uint8ArrayToBitArray,uint8ArrayToKey,aes256DecryptKey,aes256EncryptKey,decrypt256Key,decryptKey,encrypt256Key,encryptBytes,encryptKey,encryptString,CloseEventBusOption,GroupType,OperationType,aes128Decrypt,aes128RandomKey,aes256RandomKey,random,CryptoError,createSaltData,SaltReturnTypeRef,GroupInfoTypeRef,TutanotaPropertiesTypeRef,UserTypeRef,defer,neverNull,_loadEntity,GENERATED_ID_BYTES_LENGTH,HttpMethod,isSameId,isSameTypeRefByAttr,MediaType,assertWorkerOrNode,isAdminClient,isTest,hash,createChangePasswordData,createCreateSessionData,CreateSessionReturnTypeRef,SessionModelType,SessionTypeRef,EntityRestClient,typeRefToPath,restClient,createSecondFactorAuthGetData,SecondFactorAuthGetReturnTypeRef,SecondFactorPendingError,ConnectionError,NotAuthenticatedError,NotFoundError,ServiceUnavailableError,createDeleteCustomerData,createAutoLoginDataGet,AutoLoginDataReturnTypeRef,CancelledError,PasswordChannelReturnTypeRef,TutanotaService,PasswordMessagingReturnTypeRef,createPasswordMessagingData,createRecoverCode,RecoverCodeTypeRef,createResetFactorsDeleteData,LoginFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_EntityWorker){load=_EntityWorker.load,loadRoot=_EntityWorker.loadRoot,serviceRequest=_EntityWorker.serviceRequest,serviceRequestVoid=_EntityWorker.serviceRequestVoid,setup=_EntityWorker.setup,update=_EntityWorker.update},function(_entitiesSysServices){SysService=_entitiesSysServices.SysService},function(_commonUtilsEncoding){base64ToBase64Ext=_commonUtilsEncoding.base64ToBase64Ext,base64ToBase64Url=_commonUtilsEncoding.base64ToBase64Url,base64ToUint8Array=_commonUtilsEncoding.base64ToUint8Array,base64UrlToBase64=_commonUtilsEncoding.base64UrlToBase64,hexToUint8Array=_commonUtilsEncoding.hexToUint8Array,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64,uint8ArrayToHex=_commonUtilsEncoding.uint8ArrayToHex,utf8Uint8ArrayToString=_commonUtilsEncoding.utf8Uint8ArrayToString},function(_cryptoBcrypt){generateKeyFromPassphrase=_cryptoBcrypt.generateKeyFromPassphrase,generateRandomSalt=_cryptoBcrypt.generateRandomSalt},function(_cryptoCryptoConstants){KeyLength=_cryptoCryptoConstants.KeyLength},function(_cryptoCryptoUtils){base64ToKey=_cryptoCryptoUtils.base64ToKey,bitArrayToUint8Array=_cryptoCryptoUtils.bitArrayToUint8Array,createAuthVerifier=_cryptoCryptoUtils.createAuthVerifier,createAuthVerifierAsBase64Url=_cryptoCryptoUtils.createAuthVerifierAsBase64Url,keyToUint8Array=_cryptoCryptoUtils.keyToUint8Array,uint8ArrayToBitArray=_cryptoCryptoUtils.uint8ArrayToBitArray,uint8ArrayToKey=_cryptoCryptoUtils.uint8ArrayToKey},function(_cryptoCryptoFacade){aes256DecryptKey=_cryptoCryptoFacade.aes256DecryptKey,aes256EncryptKey=_cryptoCryptoFacade.aes256EncryptKey,decrypt256Key=_cryptoCryptoFacade.decrypt256Key,decryptKey=_cryptoCryptoFacade.decryptKey,encrypt256Key=_cryptoCryptoFacade.encrypt256Key,encryptBytes=_cryptoCryptoFacade.encryptBytes,encryptKey=_cryptoCryptoFacade.encryptKey,encryptString=_cryptoCryptoFacade.encryptString},function(_commonTutanotaConstants){CloseEventBusOption=_commonTutanotaConstants.CloseEventBusOption,GroupType=_commonTutanotaConstants.GroupType,OperationType=_commonTutanotaConstants.OperationType},function(_cryptoAes){aes128Decrypt=_cryptoAes.aes128Decrypt,aes128RandomKey=_cryptoAes.aes128RandomKey,aes256RandomKey=_cryptoAes.aes256RandomKey},function(_cryptoRandomizer){random=_cryptoRandomizer.random},function(_commonErrorCryptoError){CryptoError=_commonErrorCryptoError.CryptoError},function(_entitiesSysSaltData){createSaltData=_entitiesSysSaltData.createSaltData},function(_entitiesSysSaltReturn){SaltReturnTypeRef=_entitiesSysSaltReturn.SaltReturnTypeRef},function(_entitiesSysGroupInfo){GroupInfoTypeRef=_entitiesSysGroupInfo.GroupInfoTypeRef},function(_entitiesTutanotaTutanotaProperties){TutanotaPropertiesTypeRef=_entitiesTutanotaTutanotaProperties.TutanotaPropertiesTypeRef},function(_entitiesSysUser){UserTypeRef=_entitiesSysUser.UserTypeRef},function(_commonUtilsUtils){defer=_commonUtilsUtils.defer,neverNull=_commonUtilsUtils.neverNull},function(_commonEntityFunctions){_loadEntity=_commonEntityFunctions._loadEntity,GENERATED_ID_BYTES_LENGTH=_commonEntityFunctions.GENERATED_ID_BYTES_LENGTH,HttpMethod=_commonEntityFunctions.HttpMethod,isSameId=_commonEntityFunctions.isSameId,isSameTypeRefByAttr=_commonEntityFunctions.isSameTypeRefByAttr,MediaType=_commonEntityFunctions.MediaType},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode,isAdminClient=_Env.isAdminClient,isTest=_Env.isTest},function(_cryptoSha){hash=_cryptoSha.hash},function(_entitiesSysChangePasswordData){createChangePasswordData=_entitiesSysChangePasswordData.createChangePasswordData},function(_EventBusClient){_EventBusClient.EventBusClient},function(_entitiesSysCreateSessionData){createCreateSessionData=_entitiesSysCreateSessionData.createCreateSessionData},function(_entitiesSysCreateSessionReturn){CreateSessionReturnTypeRef=_entitiesSysCreateSessionReturn.CreateSessionReturnTypeRef},function(_entitiesSysSession){SessionModelType=_entitiesSysSession._TypeModel,SessionTypeRef=_entitiesSysSession.SessionTypeRef},function(_restEntityRestClient){EntityRestClient=_restEntityRestClient.EntityRestClient,typeRefToPath=_restEntityRestClient.typeRefToPath},function(_restRestClient){restClient=_restRestClient.restClient},function(_entitiesSysSecondFactorAuthGetData){createSecondFactorAuthGetData=_entitiesSysSecondFactorAuthGetData.createSecondFactorAuthGetData},function(_entitiesSysSecondFactorAuthGetReturn){SecondFactorAuthGetReturnTypeRef=_entitiesSysSecondFactorAuthGetReturn.SecondFactorAuthGetReturnTypeRef},function(_commonErrorSecondFactorPendingError){SecondFactorPendingError=_commonErrorSecondFactorPendingError.SecondFactorPendingError},function(_commonErrorRestError){ConnectionError=_commonErrorRestError.ConnectionError,NotAuthenticatedError=_commonErrorRestError.NotAuthenticatedError,NotFoundError=_commonErrorRestError.NotFoundError,ServiceUnavailableError=_commonErrorRestError.ServiceUnavailableError},function(_entitiesSysDeleteCustomerData){createDeleteCustomerData=_entitiesSysDeleteCustomerData.createDeleteCustomerData},function(_entitiesSysAutoLoginDataGet){createAutoLoginDataGet=_entitiesSysAutoLoginDataGet.createAutoLoginDataGet},function(_entitiesSysAutoLoginDataReturn){AutoLoginDataReturnTypeRef=_entitiesSysAutoLoginDataReturn.AutoLoginDataReturnTypeRef},function(_commonErrorCancelledError){CancelledError=_commonErrorCancelledError.CancelledError},function(_entitiesTutanotaPasswordChannelReturn){PasswordChannelReturnTypeRef=_entitiesTutanotaPasswordChannelReturn.PasswordChannelReturnTypeRef},function(_entitiesTutanotaServices){TutanotaService=_entitiesTutanotaServices.TutanotaService},function(_entitiesTutanotaPasswordMessagingReturn){PasswordMessagingReturnTypeRef=_entitiesTutanotaPasswordMessagingReturn.PasswordMessagingReturnTypeRef},function(_entitiesTutanotaPasswordMessagingData){createPasswordMessagingData=_entitiesTutanotaPasswordMessagingData.createPasswordMessagingData},function(_entitiesSysRecoverCode){createRecoverCode=_entitiesSysRecoverCode.createRecoverCode,RecoverCodeTypeRef=_entitiesSysRecoverCode.RecoverCodeTypeRef},function(_entitiesSysResetFactorsDeleteData){createResetFactorsDeleteData=_entitiesSysResetFactorsDeleteData.createResetFactorsDeleteData}],execute:function(){assertWorkerOrNode(),3e4,_export("LoginFacade",LoginFacade=function(){function LoginFacade(worker){_classCallCheck(this,LoginFacade),this._worker=worker,this.reset()}return _createClass(LoginFacade,[{key:"init",value:function(indexer,eventBusClient){indexer&&(this._indexer=indexer),eventBusClient&&(this._eventBusClient=eventBusClient)}},{key:"reset",value:function(){return this._user=null,this._userGroupInfo=null,this._accessToken=null,this.groupKeys={},this._eventBusClient&&this._eventBusClient.close(CloseEventBusOption.Terminate),Promise.resolve()}},{key:"createSession",value:function(mailAddress,passphrase,clientIdentifier,persistentSession,permanentLogin){var _this=this;return this._user&&console.log("session already exists, reuse data"),this._loadUserPassphraseKey(mailAddress,passphrase).then(function(userPassphraseKey){var authVerifier=createAuthVerifierAsBase64Url(userPassphraseKey),sessionData=createCreateSessionData();sessionData.mailAddress=mailAddress.toLowerCase().trim(),sessionData.clientIdentifier=clientIdentifier,sessionData.authVerifier=authVerifier;var accessKey=null;return persistentSession&&(accessKey=aes128RandomKey(),sessionData.accessKey=keyToUint8Array(accessKey)),serviceRequest(SysService.SessionService,HttpMethod.POST,sessionData,CreateSessionReturnTypeRef).then(function(createSessionReturn){return _this._waitUntilSecondFactorApprovedOrCancelled(createSessionReturn,mailAddress)}).then(function(sessionData){return _this._initSession(sessionData.userId,sessionData.accessToken,userPassphraseKey,permanentLogin).then(function(){return{user:neverNull(_this._user),userGroupInfo:neverNull(_this._userGroupInfo),sessionId:sessionData.sessionId,credentials:{mailAddress:mailAddress,accessToken:neverNull(_this._accessToken),encryptedPassword:accessKey?uint8ArrayToBase64(encryptString(accessKey,passphrase)):null,userId:sessionData.userId}}})})})}},{key:"_waitUntilSecondFactorApprovedOrCancelled",value:function(createSessionReturn,mailAddress){var p=Promise.resolve(),sessionId=[this._getSessionListId(createSessionReturn.accessToken),this._getSessionElementId(createSessionReturn.accessToken)];return this._loginRequestSessionId=sessionId,createSessionReturn.challenges.length>0&&(this._worker.sendError(new SecondFactorPendingError(sessionId,createSessionReturn.challenges,mailAddress)),p=this._waitUntilSecondFactorApproved(createSessionReturn.accessToken,sessionId,0)),this._loggingInPromiseWrapper=defer(),Promise.race([this._loggingInPromiseWrapper.promise,p]).return({sessionId:sessionId,accessToken:createSessionReturn.accessToken,userId:createSessionReturn.user})}},{key:"_waitUntilSecondFactorApproved",value:function(accessToken,sessionId,retryOnNetworkError){var _this2=this,secondFactorAuthGetData=createSecondFactorAuthGetData();return secondFactorAuthGetData.accessToken=accessToken,serviceRequest(SysService.SecondFactorAuthService,HttpMethod.GET,secondFactorAuthGetData,SecondFactorAuthGetReturnTypeRef).then(function(secondFactorAuthGetReturn){return _this2._loginRequestSessionId&&isSameId(_this2._loginRequestSessionId,sessionId)?secondFactorAuthGetReturn.secondFactorPending?_this2._waitUntilSecondFactorApproved(accessToken,sessionId,0):void 0:Promise.reject(new CancelledError("login cancelled"))}).catch(ConnectionError,function(e){if(retryOnNetworkError<10)return _this2._waitUntilSecondFactorApproved(accessToken,sessionId,retryOnNetworkError+1);throw e})}},{key:"loadExternalPasswordChannels",value:function(userId,salt){var headers={userId:userId,authToken:base64ToBase64Url(uint8ArrayToBase64(hash(salt)))};return serviceRequest(TutanotaService.PasswordChannelResource,HttpMethod.GET,null,PasswordChannelReturnTypeRef,null,null,headers)}},{key:"sendExternalPasswordSms",value:function(userId,salt,phoneNumberId,languageCode,symKeyForPasswordTransmission){var headers={userId:userId,authToken:base64ToBase64Url(uint8ArrayToBase64(hash(salt)))};symKeyForPasswordTransmission||(symKeyForPasswordTransmission=aes128RandomKey());var data=createPasswordMessagingData();return data.language=languageCode,data.numberId=phoneNumberId,data.symKeyForPasswordTransmission=keyToUint8Array(symKeyForPasswordTransmission),serviceRequest(TutanotaService.PasswordMessagingService,HttpMethod.POST,data,PasswordMessagingReturnTypeRef,null,null,headers).then(function(result){return{symKeyForPasswordTransmission:neverNull(symKeyForPasswordTransmission),autoAuthenticationId:result.autoAuthenticationId}})}},{key:"createExternalSession",value:function(userId,passphrase,salt,clientIdentifier,persistentSession){var _this3=this;if(this._user)throw new Error("user already logged in");console.log("login external worker");var userPassphraseKey=generateKeyFromPassphrase(passphrase,salt,KeyLength.b128),authVerifier=createAuthVerifierAsBase64Url(userPassphraseKey),authToken=base64ToBase64Url(uint8ArrayToBase64(hash(salt))),sessionData=createCreateSessionData();sessionData.user=userId,sessionData.authToken=authToken,sessionData.clientIdentifier=clientIdentifier,sessionData.authVerifier=authVerifier;var accessKey=null;return persistentSession&&(accessKey=aes128RandomKey(),sessionData.accessKey=keyToUint8Array(accessKey)),serviceRequest(SysService.SessionService,HttpMethod.POST,sessionData,CreateSessionReturnTypeRef).then(function(createSessionReturn){var sessionId=[_this3._getSessionListId(createSessionReturn.accessToken),_this3._getSessionElementId(createSessionReturn.accessToken)];return _this3._initSession(createSessionReturn.user,createSessionReturn.accessToken,userPassphraseKey,!0).then(function(){return{user:neverNull(_this3._user),userGroupInfo:neverNull(_this3._userGroupInfo),sessionId:sessionId,credentials:{mailAddress:userId,accessToken:neverNull(_this3._accessToken),encryptedPassword:accessKey?uint8ArrayToBase64(encryptString(accessKey,passphrase)):null,userId:userId}}})})}},{key:"cancelCreateSession",value:function(){this._loginRequestSessionId=null,this._loggingInPromiseWrapper&&this._loggingInPromiseWrapper.reject(new CancelledError("login cancelled"))}},{key:"resumeSession",value:function(credentials,externalUserSalt){var _this4=this;return this._loadSessionData(credentials.accessToken).then(function(sessionData){var passphrase=utf8Uint8ArrayToString(aes128Decrypt(sessionData.accessKey,base64ToUint8Array(neverNull(credentials.encryptedPassword))));return(externalUserSalt?Promise.resolve(generateKeyFromPassphrase(passphrase,externalUserSalt,KeyLength.b128)):_this4._loadUserPassphraseKey(credentials.mailAddress,passphrase)).then(function(userPassphraseKey){return _this4._initSession(sessionData.userId,credentials.accessToken,userPassphraseKey,!0).then(function(){return{user:neverNull(_this4._user),userGroupInfo:neverNull(_this4._userGroupInfo),sessionId:[_this4._getSessionListId(credentials.accessToken),_this4._getSessionElementId(credentials.accessToken)]}})})})}},{key:"_initSession",value:function(userId,accessToken,userPassphraseKey,permanentLogin){var _this5=this,userIdFromFormerLogin=this._user?this._user._id:null;if(userIdFromFormerLogin&&userId!==userIdFromFormerLogin)throw new Error("different user is tried to login in existing other user's session");return this._accessToken=accessToken,load(UserTypeRef,userId).then(function(user){if(uint8ArrayToBase64(user.verifier)!==uint8ArrayToBase64(hash(createAuthVerifier(userPassphraseKey))))throw _this5.deleteSession(accessToken),_this5._accessToken=null,console.log("password has changed"),new NotAuthenticatedError("password has changed");return _this5._user=user,_this5.groupKeys[_this5.getUserGroupId()]=decryptKey(userPassphraseKey,_this5._user.userGroup.symEncGKey),load(GroupInfoTypeRef,user.userGroup.groupInfo)}).then(function(groupInfo){return _this5._userGroupInfo=groupInfo}).then(function(){isTest()||!permanentLogin||isAdminClient()||(console.log("_initIndexer after log in"),_this5._initIndexer())}).then(function(){return _this5.loadEntropy()}).then(function(){permanentLogin&&(userIdFromFormerLogin?_this5._eventBusClient.tryReconnect(!0,!0):_this5._eventBusClient.connect(!1))}).then(function(){return _this5.storeEntropy()}).catch(function(e){throw _this5.reset(),e})}},{key:"_initIndexer",value:function(){var _this6=this;return this._indexer.init(neverNull(this._user),this.getUserGroupKey()).catch(ServiceUnavailableError,function(e){return console.log("Retry init indexer in 30 seconds after ServiceUnavailableError"),Promise.delay(3e4).then(function(){return console.log("_initIndexer after ServiceUnavailableError"),_this6._initIndexer()})}).catch(ConnectionError,function(e){return console.log("Retry init indexer in 30 seconds after ConnectionError"),Promise.delay(3e4).then(function(){return console.log("_initIndexer after ConnectionError"),_this6._initIndexer()})}).catch(function(e){_this6._worker.sendError(e)})}},{key:"_loadUserPassphraseKey",value:function(mailAddress,passphrase){mailAddress=mailAddress.toLowerCase().trim();var saltRequest=createSaltData();return saltRequest.mailAddress=mailAddress,serviceRequest(SysService.SaltService,HttpMethod.GET,saltRequest,SaltReturnTypeRef).then(function(saltReturn){return generateKeyFromPassphrase(passphrase,saltReturn.salt,KeyLength.b128)})}},{key:"deleteSession",value:function(accessToken){var path=typeRefToPath(SessionTypeRef)+"/"+this._getSessionListId(accessToken)+"/"+this._getSessionElementId(accessToken),headers={accessToken:neverNull(accessToken),v:SessionModelType.version};return restClient.request(path,HttpMethod.DELETE,{},headers,null,MediaType.Json).catch(NotAuthenticatedError,function(){console.log("authentication failed => session is already closed")}).catch(NotFoundError,function(){console.log("authentication failed => session instance is already deleted")})}},{key:"_getSessionElementId",value:function(accessToken){var byteAccessToken=base64ToUint8Array(base64UrlToBase64(neverNull(accessToken)));return base64ToBase64Url(uint8ArrayToBase64(hash(byteAccessToken.slice(GENERATED_ID_BYTES_LENGTH))))}},{key:"_getSessionListId",value:function(accessToken){var byteAccessToken=base64ToUint8Array(base64UrlToBase64(neverNull(accessToken)));return base64ToBase64Ext(uint8ArrayToBase64(byteAccessToken.slice(0,GENERATED_ID_BYTES_LENGTH)))}},{key:"_loadSessionData",value:function(accessToken){var path=typeRefToPath(SessionTypeRef)+"/"+this._getSessionListId(accessToken)+"/"+this._getSessionElementId(accessToken),headers={accessToken:accessToken,v:SessionModelType.version};return restClient.request(path,HttpMethod.GET,{},headers,null,MediaType.Json).then(function(instance){var session=JSON.parse(instance);return{userId:session.user,accessKey:base64ToKey(session.accessKey)}})}},{key:"createAuthHeaders",value:function(){return this._accessToken?{accessToken:this._accessToken}:{}}},{key:"getUserGroupId",value:function(){return this.getLoggedInUser().userGroup.group}},{key:"getAllGroupIds",value:function(){var groups=this.getLoggedInUser().memberships.map(function(membership){return membership.group});return groups.push(this.getLoggedInUser().userGroup.group),groups}},{key:"getUserGroupKey",value:function(){return this.groupKeys[this.getUserGroupId()]}},{key:"getGroupKey",value:function(groupId){return this.groupKeys[groupId]||(this.groupKeys[groupId]=decryptKey(this.groupKeys[this.getUserGroupId()],this.getMembership(groupId).symEncGKey)),this.groupKeys[groupId]}},{key:"getMembership",value:function(groupId){var membership=this.getLoggedInUser().memberships.find(function(g){return g.group===groupId});if(!membership)throw new Error("No group with groupId "+groupId+" found!");return membership}},{key:"hasGroup",value:function(groupId){return!!this._user&&(groupId===this._user.userGroup.group||null!=this._user.memberships.find(function(m){return m.group===groupId}))}},{key:"getGroupId",value:function(groupType){if(groupType===GroupType.User)return this.getUserGroupId();var membership=this.getLoggedInUser().memberships.find(function(m){return m.groupType===groupType});if(!membership)throw new Error("could not find groupType "+groupType+" for user "+this.getLoggedInUser()._id);return membership.group}},{key:"getGroupIds",value:function(groupType){return this.getLoggedInUser().memberships.filter(function(m){return m.groupType===groupType}).map(function(gm){return gm.group})}},{key:"isLoggedIn",value:function(){return null!=this._user}},{key:"getLoggedInUser",value:function(){return neverNull(this._user)}},{key:"loadEntropy",value:function(){var _this7=this;return loadRoot(TutanotaPropertiesTypeRef,this.getUserGroupId()).then(function(tutanotaProperties){if(tutanotaProperties.groupEncEntropy)try{var entropy=aes128Decrypt(_this7.getUserGroupKey(),neverNull(tutanotaProperties.groupEncEntropy));random.addStaticEntropy(entropy)}catch(error){error instanceof CryptoError&&console.log("could not decrypt entropy",error)}})}},{key:"storeEntropy",value:function(){var _this8=this;return this._accessToken?loadRoot(TutanotaPropertiesTypeRef,this.getUserGroupId()).then(function(tutanotaProperties){return tutanotaProperties.groupEncEntropy=encryptBytes(_this8.getUserGroupKey(),random.generateRandomData(32)),update(tutanotaProperties)}).catch(ConnectionError,function(e){console.log("could not store entropy",e)}).catch(ServiceUnavailableError,function(e){console.log("could not store entropy",e)}):Promise.resolve()}},{key:"entityEventsReceived",value:function(data){var _this9=this;return Promise.each(data,function(update){return _this9._user&&update.operation===OperationType.UPDATE&&isSameTypeRefByAttr(UserTypeRef,update.application,update.type)&&isSameId(_this9._user._id,update.instanceId)?load(UserTypeRef,_this9._user._id).then(function(updatedUser){_this9._user=updatedUser}):_this9._userGroupInfo&&update.operation===OperationType.UPDATE&&isSameTypeRefByAttr(GroupInfoTypeRef,update.application,update.type)&&isSameId(_this9._userGroupInfo._id,[neverNull(update.instanceListId),update.instanceId])?load(GroupInfoTypeRef,_this9._userGroupInfo._id).then(function(updatedUserGroupInfo){_this9._userGroupInfo=updatedUserGroupInfo}):Promise.resolve()}).return()}},{key:"changePassword",value:function(oldPassword,newPassword){var oldAuthVerifier=createAuthVerifier(generateKeyFromPassphrase(oldPassword,neverNull(neverNull(this._user).salt),KeyLength.b128)),salt=generateRandomSalt(),userPassphraseKey=generateKeyFromPassphrase(newPassword,salt,KeyLength.b128),pwEncUserGroupKey=encryptKey(userPassphraseKey,this.getUserGroupKey()),authVerifier=createAuthVerifier(userPassphraseKey),service=createChangePasswordData();return service.oldVerifier=oldAuthVerifier,service.salt=salt,service.verifier=authVerifier,service.pwEncUserGroupKey=pwEncUserGroupKey,serviceRequestVoid(SysService.ChangePasswordService,HttpMethod.POST,service)}},{key:"deleteAccount",value:function(password,reason,takeover){var d=createDeleteCustomerData();return d.authVerifier=createAuthVerifier(generateKeyFromPassphrase(password,neverNull(neverNull(this._user).salt),KeyLength.b128)),d.undelete=!1,d.customer=neverNull(neverNull(this._user).customer),d.reason=reason,d.takeoverMailAddress=""!==takeover?takeover:null,serviceRequestVoid(SysService.CustomerService,HttpMethod.DELETE,d)}},{key:"decryptUserPassword",value:function(userId,deviceToken,encryptedPassword){var getData=createAutoLoginDataGet();return getData.userId=userId,getData.deviceToken=deviceToken,serviceRequest(SysService.AutoLoginService,HttpMethod.GET,getData,AutoLoginDataReturnTypeRef,null,null).then(function(returnData){var key=uint8ArrayToKey(returnData.deviceKey);return utf8Uint8ArrayToString(aes128Decrypt(key,base64ToUint8Array(encryptedPassword)))})}},{key:"getRecoverCode",value:function(password){var _this10=this;if(null==this._user||null==this._user.auth||null==this._user.auth.recoverCode)return Promise.reject(new Error("Auth is missing"));var recoverCodeId=this._user.auth.recoverCode,key=generateKeyFromPassphrase(password,neverNull(this._user.salt),KeyLength.b128),extraHeaders={authVerifier:createAuthVerifierAsBase64Url(key)};return load(RecoverCodeTypeRef,recoverCodeId,null,extraHeaders).then(function(result){return uint8ArrayToHex(bitArrayToUint8Array(decrypt256Key(_this10.getUserGroupKey(),result.userEncRecoverCode)))})}},{key:"createRecoveryCode",value:function(password){var user=this._user;if(null==user||null==user.auth)throw new Error("Invalid state: no user or no user.auth");var _generateRecoveryCode=this.generateRecoveryCode(this.getUserGroupKey()),userEncRecoverCode=_generateRecoveryCode.userEncRecoverCode,recoverCodeEncUserGroupKey=_generateRecoveryCode.recoverCodeEncUserGroupKey,hexCode=_generateRecoveryCode.hexCode,recoveryCodeVerifier=_generateRecoveryCode.recoveryCodeVerifier,recoverPasswordEntity=createRecoverCode();recoverPasswordEntity.userEncRecoverCode=userEncRecoverCode,recoverPasswordEntity.recoverCodeEncUserGroupKey=recoverCodeEncUserGroupKey,recoverPasswordEntity._ownerGroup=this.getUserGroupId(),recoverPasswordEntity.verifier=recoveryCodeVerifier;var pwKey=generateKeyFromPassphrase(password,neverNull(user.salt),KeyLength.b128),authVerifier=createAuthVerifierAsBase64Url(pwKey);return setup(null,recoverPasswordEntity,{authVerifier:authVerifier}).return(hexCode)}},{key:"generateRecoveryCode",value:function(userGroupKey){var recoveryCode=aes256RandomKey(),userEncRecoverCode=encrypt256Key(userGroupKey,recoveryCode),recoverCodeEncUserGroupKey=aes256EncryptKey(recoveryCode,userGroupKey),recoveryCodeVerifier=createAuthVerifier(recoveryCode);return{userEncRecoverCode:userEncRecoverCode,recoverCodeEncUserGroupKey:recoverCodeEncUserGroupKey,hexCode:uint8ArrayToHex(bitArrayToUint8Array(recoveryCode)),recoveryCodeVerifier:recoveryCodeVerifier}}},{key:"recoverLogin",value:function(mailAddress,recoverCode,newPassword,clientIdentifier){var _this11=this,sessionData=createCreateSessionData(),recoverCodeKey=uint8ArrayToBitArray(hexToUint8Array(recoverCode)),recoverCodeVerifier=createAuthVerifier(recoverCodeKey),recoverCodeVerifierBase64=base64ToBase64Url(uint8ArrayToBase64(recoverCodeVerifier));sessionData.mailAddress=mailAddress.toLowerCase().trim(),sessionData.clientIdentifier=clientIdentifier,sessionData.recoverCodeVerifier=recoverCodeVerifierBase64;var eventRestClient=new EntityRestClient(function(){return{}});return serviceRequest(SysService.SessionService,HttpMethod.POST,sessionData,CreateSessionReturnTypeRef).then(function(createSessionReturn){return _this11._waitUntilSecondFactorApprovedOrCancelled(createSessionReturn,null)}).then(function(sessionData){return _loadEntity(UserTypeRef,sessionData.userId,null,eventRestClient,{accessToken:sessionData.accessToken}).then(function(user){if(null==user.auth||null==user.auth.recoverCode)return Promise.reject(new Error("missing recover code"));var extraHeaders={accessToken:sessionData.accessToken,recoverCodeVerifier:recoverCodeVerifierBase64};return _loadEntity(RecoverCodeTypeRef,user.auth.recoverCode,null,eventRestClient,extraHeaders)}).then(function(recoverCode){var groupKey=aes256DecryptKey(recoverCodeKey,recoverCode.recoverCodeEncUserGroupKey),salt=generateRandomSalt(),userPassphraseKey=generateKeyFromPassphrase(newPassword,salt,KeyLength.b128),pwEncUserGroupKey=encryptKey(userPassphraseKey,groupKey),newPasswordVerifier=createAuthVerifier(userPassphraseKey),postData=createChangePasswordData();postData.salt=salt,postData.pwEncUserGroupKey=pwEncUserGroupKey,postData.verifier=newPasswordVerifier,postData.recoverCodeVerifier=recoverCodeVerifier;var extraHeaders={accessToken:sessionData.accessToken};return serviceRequestVoid(SysService.ChangePasswordService,HttpMethod.POST,postData,null,null,extraHeaders)}).finally(function(){return _this11.deleteSession(sessionData.accessToken)})})}},{key:"resetSecondFactors",value:function(mailAddress,password,recoverCode){return this._loadUserPassphraseKey(mailAddress,password).then(function(passphraseReturn){var authVerifier=createAuthVerifierAsBase64Url(passphraseReturn),recoverCodeKey=uint8ArrayToBitArray(hexToUint8Array(recoverCode)),recoverCodeVerifier=createAuthVerifierAsBase64Url(recoverCodeKey),deleteData=createResetFactorsDeleteData();return deleteData.mailAddress=mailAddress,deleteData.authVerifier=authVerifier,deleteData.recoverCodeVerifier=recoverCodeVerifier,serviceRequestVoid(SysService.ResetFactorsService,HttpMethod.DELETE,deleteData,null,null)})}},{key:"getUserGroupInfo",value:function(){return neverNull(this._userGroupInfo)}}]),LoginFacade}()),_export("LoginFacade",LoginFacade)}}}),System.register("src/api/worker/crypto/Sha256.js",["./lib/crypto-sjcl-1.0.7","../../Env"],function(_export,_context){"use strict";var sjcl,assertWorkerOrNode,sha256;return _export("hash",function(uint8Array){try{return sha256.update(sjcl.codec.arrayBuffer.toBits(uint8Array.buffer)),new Uint8Array(sjcl.codec.arrayBuffer.fromBits(sha256.finalize(),!1))}finally{sha256.reset()}}),{setters:[function(_libCryptoSjcl){sjcl=_libCryptoSjcl.default},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode}],execute:function(){assertWorkerOrNode(),sha256=new sjcl.hash.sha256,_export("HASH_LENGTH_BYTES",32),_export("HASH_LENGTH_BYTES",32)}}});var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(message){this.toString=function(){return"CORRUPT: "+this.message},this.message=message},invalid:function(message){this.toString=function(){return"INVALID: "+this.message},this.message=message},bug:function(message){this.toString=function(){return"BUG: "+this.message},this.message=message},notReady:function(message){this.toString=function(){return"NOT READY: "+this.message},this.message=message}}};sjcl.cipher.aes=function(key){this._tables[0][0][0]||this._precompute();var i,j,tmp,encKey,decKey,sbox=this._tables[0][4],decTable=this._tables[1],keyLen=key.length,rcon=1;if(4!==keyLen&&6!==keyLen&&8!==keyLen)throw new sjcl.exception.invalid("invalid aes key size");for(this._key=[encKey=key.slice(0),decKey=[]],i=keyLen;i<4*keyLen+28;i++)tmp=encKey[i-1],(i%keyLen==0||8===keyLen&&i%keyLen==4)&&(tmp=sbox[tmp>>>24]<<24^sbox[tmp>>16&255]<<16^sbox[tmp>>8&255]<<8^sbox[255&tmp],i%keyLen==0&&(tmp=tmp<<8^tmp>>>24^rcon<<24,rcon=rcon<<1^283*(rcon>>7))),encKey[i]=encKey[i-keyLen]^tmp;for(j=0;i;j++,i--)tmp=encKey[3&j?i:i-4],decKey[j]=i<=4||j<4?tmp:decTable[0][sbox[tmp>>>24]]^decTable[1][sbox[tmp>>16&255]]^decTable[2][sbox[tmp>>8&255]]^decTable[3][sbox[255&tmp]]},sjcl.cipher.aes.prototype={encrypt:function(data){return this._crypt(data,0)},decrypt:function(data){return this._crypt(data,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var i,x,xInv,x2,x4,s,tEnc,tDec,encTable=this._tables[0],decTable=this._tables[1],sbox=encTable[4],sboxInv=decTable[4],d=[],th=[];for(i=0;i<256;i++)th[(d[i]=i<<1^283*(i>>7))^i]=i;for(x=xInv=0;!sbox[x];x^=x2||1,xInv=th[xInv]||1)for(s=(s=xInv^xInv<<1^xInv<<2^xInv<<3^xInv<<4)>>8^255&s^99,sbox[x]=s,sboxInv[s]=x,tDec=16843009*d[x4=d[x2=d[x]]]^65537*x4^257*x2^16843008*x,tEnc=257*d[s]^16843008*s,i=0;i<4;i++)encTable[i][x]=tEnc=tEnc<<24^tEnc>>>8,decTable[i][s]=tDec=tDec<<24^tDec>>>8;for(i=0;i<5;i++)encTable[i]=encTable[i].slice(0),decTable[i]=decTable[i].slice(0)},_crypt:function(input,dir){if(4!==input.length)throw new sjcl.exception.invalid("invalid aes block size");var a2,b2,c2,i,key=this._key[dir],a=input[0]^key[0],b=input[dir?3:1]^key[1],c=input[2]^key[2],d=input[dir?1:3]^key[3],nInnerRounds=key.length/4-2,kIndex=4,out=[0,0,0,0],table=this._tables[dir],t0=table[0],t1=table[1],t2=table[2],t3=table[3],sbox=table[4];for(i=0;i<nInnerRounds;i++)a2=t0[a>>>24]^t1[b>>16&255]^t2[c>>8&255]^t3[255&d]^key[kIndex],b2=t0[b>>>24]^t1[c>>16&255]^t2[d>>8&255]^t3[255&a]^key[kIndex+1],c2=t0[c>>>24]^t1[d>>16&255]^t2[a>>8&255]^t3[255&b]^key[kIndex+2],d=t0[d>>>24]^t1[a>>16&255]^t2[b>>8&255]^t3[255&c]^key[kIndex+3],kIndex+=4,a=a2,b=b2,c=c2;for(i=0;i<4;i++)out[dir?3&-i:i]=sbox[a>>>24]<<24^sbox[b>>16&255]<<16^sbox[c>>8&255]<<8^sbox[255&d]^key[kIndex++],a2=a,a=b,b=c,c=d,d=a2;return out}},sjcl.bitArray={bitSlice:function(a,bstart,bend){return a=sjcl.bitArray._shiftRight(a.slice(bstart/32),32-(31&bstart)).slice(1),void 0===bend?a:sjcl.bitArray.clamp(a,bend-bstart)},extract:function(a,bstart,blength){var sh=Math.floor(-bstart-blength&31);return(-32&(bstart+blength-1^bstart)?a[bstart/32|0]<<32-sh^a[bstart/32+1|0]>>>sh:a[bstart/32|0]>>>sh)&(1<<blength)-1},concat:function(a1,a2){if(0===a1.length||0===a2.length)return a1.concat(a2);var last=a1[a1.length-1],shift=sjcl.bitArray.getPartial(last);return 32===shift?a1.concat(a2):sjcl.bitArray._shiftRight(a2,shift,0|last,a1.slice(0,a1.length-1))},bitLength:function(a){var x,l=a.length;return 0===l?0:(x=a[l-1],32*(l-1)+sjcl.bitArray.getPartial(x))},clamp:function(a,len){if(32*a.length<len)return a;var l=(a=a.slice(0,Math.ceil(len/32))).length;return len&=31,l>0&&len&&(a[l-1]=sjcl.bitArray.partial(len,a[l-1]&2147483648>>len-1,1)),a},partial:function(len,x,_end){return 32===len?x:(_end?0|x:x<<32-len)+1099511627776*len},getPartial:function(x){return Math.round(x/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return!1;var i,x=0;for(i=0;i<a.length;i++)x|=a[i]^b[i];return 0===x},_shiftRight:function(a,shift,carry,out){var i,last2,shift2;for(void 0===out&&(out=[]);shift>=32;shift-=32)out.push(carry),carry=0;if(0===shift)return out.concat(a);for(i=0;i<a.length;i++)out.push(carry|a[i]>>>shift),carry=a[i]<<32-shift;return last2=a.length?a[a.length-1]:0,shift2=sjcl.bitArray.getPartial(last2),out.push(sjcl.bitArray.partial(shift+shift2&31,shift+shift2>32?carry:out.pop(),1)),out},_xor4:function(x,y){return[x[0]^y[0],x[1]^y[1],x[2]^y[2],x[3]^y[3]]},byteswapM:function(a){var i,v;for(i=0;i<a.length;++i)v=a[i],a[i]=v>>>24|v>>>8&65280|(65280&v)<<8|v<<24;return a}},sjcl.codec.utf8String={fromBits:function(arr){var i,tmp,out="",bl=sjcl.bitArray.bitLength(arr);for(i=0;i<bl/8;i++)0==(3&i)&&(tmp=arr[i/4]),out+=String.fromCharCode(tmp>>>8>>>8>>>8),tmp<<=8;return decodeURIComponent(escape(out))},toBits:function(str){str=unescape(encodeURIComponent(str));var i,out=[],tmp=0;for(i=0;i<str.length;i++)tmp=tmp<<8|str.charCodeAt(i),3==(3&i)&&(out.push(tmp),tmp=0);return 3&i&&out.push(sjcl.bitArray.partial(8*(3&i),tmp)),out}},sjcl.codec.hex={fromBits:function(arr){var i,out="";for(i=0;i<arr.length;i++)out+=(0xf00000000000+(0|arr[i])).toString(16).substr(4);return out.substr(0,sjcl.bitArray.bitLength(arr)/4)},toBits:function(str){var i,len,out=[];for(len=(str=str.replace(/\s|0x/g,"")).length,str+="00000000",i=0;i<str.length;i+=8)out.push(0^parseInt(str.substr(i,8),16));return sjcl.bitArray.clamp(out,4*len)}},sjcl.codec.base32={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",_hexChars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(arr,_noEquals,_hex){sjcl.codec.base32.BITS;var i,BASE=sjcl.codec.base32.BASE,REMAINING=sjcl.codec.base32.REMAINING,out="",bits=0,c=sjcl.codec.base32._chars,ta=0,bl=sjcl.bitArray.bitLength(arr);for(_hex&&(c=sjcl.codec.base32._hexChars),i=0;out.length*BASE<bl;)out+=c.charAt((ta^arr[i]>>>bits)>>>REMAINING),bits<BASE?(ta=arr[i]<<BASE-bits,bits+=REMAINING,i++):(ta<<=BASE,bits-=BASE);for(;7&out.length&&!_noEquals;)out+="=";return out},toBits:function(str,_hex){str=str.replace(/\s|=/g,"").toUpperCase();var i,x,BITS=sjcl.codec.base32.BITS,BASE=sjcl.codec.base32.BASE,REMAINING=sjcl.codec.base32.REMAINING,out=[],bits=0,c=sjcl.codec.base32._chars,ta=0,format="base32";for(_hex&&(c=sjcl.codec.base32._hexChars,format="base32hex"),i=0;i<str.length;i++){if((x=c.indexOf(str.charAt(i)))<0){if(!_hex)try{return sjcl.codec.base32hex.toBits(str)}catch(e){}throw new sjcl.exception.invalid("this isn't "+format+"!")}bits>REMAINING?(bits-=REMAINING,out.push(ta^x>>>bits),ta=x<<BITS-bits):ta^=x<<BITS-(bits+=BASE)}return 56&bits&&out.push(sjcl.bitArray.partial(56&bits,ta,1)),out}},sjcl.codec.base32hex={fromBits:function(arr,_noEquals){return sjcl.codec.base32.fromBits(arr,_noEquals,1)},toBits:function(str){return sjcl.codec.base32.toBits(str,1)}},sjcl.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(arr,_noEquals,_url){var i,out="",bits=0,c=sjcl.codec.base64._chars,ta=0,bl=sjcl.bitArray.bitLength(arr);for(_url&&(c=c.substr(0,62)+"-_"),i=0;6*out.length<bl;)out+=c.charAt((ta^arr[i]>>>bits)>>>26),bits<6?(ta=arr[i]<<6-bits,bits+=26,i++):(ta<<=6,bits-=6);for(;3&out.length&&!_noEquals;)out+="=";return out},toBits:function(str,_url){str=str.replace(/\s|=/g,"");var i,x,out=[],bits=0,c=sjcl.codec.base64._chars,ta=0;for(_url&&(c=c.substr(0,62)+"-_"),i=0;i<str.length;i++){if((x=c.indexOf(str.charAt(i)))<0)throw new sjcl.exception.invalid("this isn't base64!");bits>26?(bits-=26,out.push(ta^x>>>bits),ta=x<<32-bits):ta^=x<<32-(bits+=6)}return 56&bits&&out.push(sjcl.bitArray.partial(56&bits,ta,1)),out}},sjcl.codec.base64url={fromBits:function(arr){return sjcl.codec.base64.fromBits(arr,1,1)},toBits:function(str){return sjcl.codec.base64.toBits(str,1)}},sjcl.codec.bytes={fromBits:function(arr){var i,tmp,out=[],bl=sjcl.bitArray.bitLength(arr);for(i=0;i<bl/8;i++)0==(3&i)&&(tmp=arr[i/4]),out.push(tmp>>>24),tmp<<=8;return out},toBits:function(bytes){var i,out=[],tmp=0;for(i=0;i<bytes.length;i++)tmp=tmp<<8|bytes[i],3==(3&i)&&(out.push(tmp),tmp=0);return 3&i&&out.push(sjcl.bitArray.partial(8*(3&i),tmp)),out}},sjcl.hash.sha256=function(hash){this._key[0]||this._precompute(),hash?(this._h=hash._h.slice(0),this._buffer=hash._buffer.slice(0),this._length=hash._length):this.reset()},sjcl.hash.sha256.hash=function(data){return(new sjcl.hash.sha256).update(data).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(data){"string"==typeof data&&(data=sjcl.codec.utf8String.toBits(data));var i,b=this._buffer=sjcl.bitArray.concat(this._buffer,data),ol=this._length,nl=this._length=ol+sjcl.bitArray.bitLength(data);if(nl>9007199254740991)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var c=new Uint32Array(b),j=0;for(i=512+ol-(512+ol&511);i<=nl;i+=512)this._block(c.subarray(16*j,16*(j+1))),j+=1;b.splice(0,16*j)}else for(i=512+ol-(512+ol&511);i<=nl;i+=512)this._block(b.splice(0,16));return this},finalize:function(){var i,b=this._buffer,h=this._h;for(i=(b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)])).length+2;15&i;i++)b.push(0);for(b.push(Math.floor(this._length/4294967296)),b.push(0|this._length);b.length;)this._block(b.splice(0,16));return this.reset(),h},_init:[],_key:[],_precompute:function(){var factor,isPrime,i=0,prime=2;function frac(x){return 4294967296*(x-Math.floor(x))|0}for(;i<64;prime++){for(isPrime=!0,factor=2;factor*factor<=prime;factor++)if(prime%factor==0){isPrime=!1;break}isPrime&&(i<8&&(this._init[i]=frac(Math.pow(prime,.5))),this._key[i]=frac(Math.pow(prime,1/3)),i++)}},_block:function(w){var i,tmp,a,b,h=this._h,k=this._key,h0=h[0],h1=h[1],h2=h[2],h3=h[3],h4=h[4],h5=h[5],h6=h[6],h7=h[7];for(i=0;i<64;i++)i<16?tmp=w[i]:(a=w[i+1&15],b=w[i+14&15],tmp=w[15&i]=(a>>>7^a>>>18^a>>>3^a<<25^a<<14)+(b>>>17^b>>>19^b>>>10^b<<15^b<<13)+w[15&i]+w[i+9&15]|0),tmp=tmp+h7+(h4>>>6^h4>>>11^h4>>>25^h4<<26^h4<<21^h4<<7)+(h6^h4&(h5^h6))+k[i],h7=h6,h6=h5,h5=h4,h4=h3+tmp|0,h3=h2,h2=h1,h0=tmp+((h1=h0)&h2^h3&(h1^h2))+(h1>>>2^h1>>>13^h1>>>22^h1<<30^h1<<19^h1<<10)|0;h[0]=h[0]+h0|0,h[1]=h[1]+h1|0,h[2]=h[2]+h2|0,h[3]=h[3]+h3|0,h[4]=h[4]+h4|0,h[5]=h[5]+h5|0,h[6]=h[6]+h6|0,h[7]=h[7]+h7|0}},sjcl.hash.sha512=function(hash){this._key[0]||this._precompute(),hash?(this._h=hash._h.slice(0),this._buffer=hash._buffer.slice(0),this._length=hash._length):this.reset()},sjcl.hash.sha512.hash=function(data){return(new sjcl.hash.sha512).update(data).finalize()},sjcl.hash.sha512.prototype={blockSize:1024,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(data){"string"==typeof data&&(data=sjcl.codec.utf8String.toBits(data));var i,b=this._buffer=sjcl.bitArray.concat(this._buffer,data),ol=this._length,nl=this._length=ol+sjcl.bitArray.bitLength(data);if(nl>9007199254740991)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var c=new Uint32Array(b),j=0;for(i=1024+ol-(1024+ol&1023);i<=nl;i+=1024)this._block(c.subarray(32*j,32*(j+1))),j+=1;b.splice(0,32*j)}else for(i=1024+ol-(1024+ol&1023);i<=nl;i+=1024)this._block(b.splice(0,32));return this},finalize:function(){var i,b=this._buffer,h=this._h;for(i=(b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)])).length+4;31&i;i++)b.push(0);for(b.push(0),b.push(0),b.push(Math.floor(this._length/4294967296)),b.push(0|this._length);b.length;)this._block(b.splice(0,32));return this.reset(),h},_init:[],_initr:[12372232,13281083,9762859,1914609,15106769,4090911,4308331,8266105],_key:[],_keyr:[2666018,15689165,5061423,9034684,4764984,380953,1658779,7176472,197186,7368638,14987916,16757986,8096111,1480369,13046325,6891156,15813330,5187043,9229749,11312229,2818677,10937475,4324308,1135541,6741931,11809296,16458047,15666916,11046850,698149,229999,945776,13774844,2541862,12856045,9810911,11494366,7844520,15576806,8533307,15795044,4337665,16291729,5553712,15684120,6662416,7413802,12308920,13816008,4303699,9366425,10176680,13195875,4295371,6546291,11712675,15708924,1519456,15772530,6568428,6495784,8568297,13007125,7492395,2515356,12632583,14740254,7262584,1535930,13146278,16321966,1853211,294276,13051027,13221564,1051980,4080310,6651434,14088940,4675607],_precompute:function(){var factor,isPrime,i=0,prime=2;function frac(x){return 4294967296*(x-Math.floor(x))|0}function frac2(x){return 1099511627776*(x-Math.floor(x))&255}for(;i<80;prime++){for(isPrime=!0,factor=2;factor*factor<=prime;factor++)if(prime%factor==0){isPrime=!1;break}isPrime&&(i<8&&(this._init[2*i]=frac(Math.pow(prime,.5)),this._init[2*i+1]=frac2(Math.pow(prime,.5))<<24|this._initr[i]),this._key[2*i]=frac(Math.pow(prime,1/3)),this._key[2*i+1]=frac2(Math.pow(prime,1/3))<<24|this._keyr[i],i++)}},_block:function(words){var i,wrh,wrl,w,h=this._h,k=this._key,h0h=h[0],h0l=h[1],h1h=h[2],h1l=h[3],h2h=h[4],h2l=h[5],h3h=h[6],h3l=h[7],h4h=h[8],h4l=h[9],h5h=h[10],h5l=h[11],h6h=h[12],h6l=h[13],h7h=h[14],h7l=h[15];if("undefined"!=typeof Uint32Array){w=Array(160);for(var j=0;j<32;j++)w[j]=words[j]}else w=words;var ah=h0h,al=h0l,bh=h1h,bl=h1l,ch=h2h,cl=h2l,dh=h3h,dl=h3l,eh=h4h,el=h4l,fh=h5h,fl=h5l,gh=h6h,gl=h6l,hh=h7h,hl=h7l;for(i=0;i<80;i++){if(i<16)wrh=w[2*i],wrl=w[2*i+1];else{var gamma0xh=w[2*(i-15)],gamma0xl=w[2*(i-15)+1],gamma0h=(gamma0xl<<31|gamma0xh>>>1)^(gamma0xl<<24|gamma0xh>>>8)^gamma0xh>>>7,gamma0l=(gamma0xh<<31|gamma0xl>>>1)^(gamma0xh<<24|gamma0xl>>>8)^(gamma0xh<<25|gamma0xl>>>7),gamma1xh=w[2*(i-2)],gamma1xl=w[2*(i-2)+1],gamma1h=(gamma1xl<<13|gamma1xh>>>19)^(gamma1xh<<3|gamma1xl>>>29)^gamma1xh>>>6,gamma1l=(gamma1xh<<13|gamma1xl>>>19)^(gamma1xl<<3|gamma1xh>>>29)^(gamma1xh<<26|gamma1xl>>>6),wr7h=w[2*(i-7)],wr7l=w[2*(i-7)+1],wr16h=w[2*(i-16)],wr16l=w[2*(i-16)+1];wrh=gamma0h+wr7h+((wrl=gamma0l+wr7l)>>>0<gamma0l>>>0?1:0),wrh+=gamma1h+((wrl+=gamma1l)>>>0<gamma1l>>>0?1:0),wrh+=wr16h+((wrl+=wr16l)>>>0<wr16l>>>0?1:0)}w[2*i]=wrh|=0,w[2*i+1]=wrl|=0;var chh=eh&fh^~eh&gh,chl=el&fl^~el&gl,majh=ah&bh^ah&ch^bh&ch,majl=al&bl^al&cl^bl&cl,sigma0h=(al<<4|ah>>>28)^(ah<<30|al>>>2)^(ah<<25|al>>>7),sigma0l=(ah<<4|al>>>28)^(al<<30|ah>>>2)^(al<<25|ah>>>7),sigma1h=(el<<18|eh>>>14)^(el<<14|eh>>>18)^(eh<<23|el>>>9),sigma1l=(eh<<18|el>>>14)^(eh<<14|el>>>18)^(el<<23|eh>>>9),krh=k[2*i],krl=k[2*i+1],t1l=hl+sigma1l,t1h=hh+sigma1h+(t1l>>>0<hl>>>0?1:0);t1h+=chh+((t1l+=chl)>>>0<chl>>>0?1:0),t1h+=krh+((t1l+=krl)>>>0<krl>>>0?1:0);var t2l=sigma0l+majl;hh=gh,hl=gl,gh=fh,gl=fl,fh=eh,fl=el,eh=dh+(t1h+=wrh+((t1l=t1l+wrl|0)>>>0<wrl>>>0?1:0))+((el=dl+t1l|0)>>>0<dl>>>0?1:0)|0,dh=ch,dl=cl,ch=bh,cl=bl,bh=ah,bl=al,ah=t1h+(sigma0h+majh+(t2l>>>0<sigma0l>>>0?1:0))+((al=t1l+t2l|0)>>>0<t1l>>>0?1:0)|0}h0l=h[1]=h0l+al|0,h[0]=h0h+ah+(h0l>>>0<al>>>0?1:0)|0,h1l=h[3]=h1l+bl|0,h[2]=h1h+bh+(h1l>>>0<bl>>>0?1:0)|0,h2l=h[5]=h2l+cl|0,h[4]=h2h+ch+(h2l>>>0<cl>>>0?1:0)|0,h3l=h[7]=h3l+dl|0,h[6]=h3h+dh+(h3l>>>0<dl>>>0?1:0)|0,h4l=h[9]=h4l+el|0,h[8]=h4h+eh+(h4l>>>0<el>>>0?1:0)|0,h5l=h[11]=h5l+fl|0,h[10]=h5h+fh+(h5l>>>0<fl>>>0?1:0)|0,h6l=h[13]=h6l+gl|0,h[12]=h6h+gh+(h6l>>>0<gl>>>0?1:0)|0,h7l=h[15]=h7l+hl|0,h[14]=h7h+hh+(h7l>>>0<hl>>>0?1:0)|0}},sjcl.hash.sha1=function(hash){hash?(this._h=hash._h.slice(0),this._buffer=hash._buffer.slice(0),this._length=hash._length):this.reset()},sjcl.hash.sha1.hash=function(data){return(new sjcl.hash.sha1).update(data).finalize()},sjcl.hash.sha1.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(data){"string"==typeof data&&(data=sjcl.codec.utf8String.toBits(data));var i,b=this._buffer=sjcl.bitArray.concat(this._buffer,data),ol=this._length,nl=this._length=ol+sjcl.bitArray.bitLength(data);if(nl>9007199254740991)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var c=new Uint32Array(b),j=0;for(i=this.blockSize+ol-(this.blockSize+ol&this.blockSize-1);i<=nl;i+=this.blockSize)this._block(c.subarray(16*j,16*(j+1))),j+=1;b.splice(0,16*j)}else for(i=this.blockSize+ol-(this.blockSize+ol&this.blockSize-1);i<=nl;i+=this.blockSize)this._block(b.splice(0,16));return this},finalize:function(){var i,b=this._buffer,h=this._h;for(i=(b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)])).length+2;15&i;i++)b.push(0);for(b.push(Math.floor(this._length/4294967296)),b.push(0|this._length);b.length;)this._block(b.splice(0,16));return this.reset(),h},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(t,b,c,d){return t<=19?b&c|~b&d:t<=39?b^c^d:t<=59?b&c|b&d|c&d:t<=79?b^c^d:void 0},_S:function(n,x){return x<<n|x>>>32-n},_block:function(words){var t,tmp,a,b,c,d,e,w,h=this._h;if("undefined"!=typeof Uint32Array){w=Array(80);for(var j=0;j<16;j++)w[j]=words[j]}else w=words;for(a=h[0],b=h[1],c=h[2],d=h[3],e=h[4],t=0;t<=79;t++)t>=16&&(w[t]=this._S(1,w[t-3]^w[t-8]^w[t-14]^w[t-16])),tmp=this._S(5,a)+this._f(t,b,c,d)+e+w[t]+this._key[Math.floor(t/20)]|0,e=d,d=c,c=this._S(30,b),b=a,a=tmp;h[0]=h[0]+a|0,h[1]=h[1]+b|0,h[2]=h[2]+c|0,h[3]=h[3]+d|0,h[4]=h[4]+e|0}},sjcl.mode.cbc={name:"cbc",encrypt:function(prp,plaintext,iv,adata,usePadding){if(adata&&adata.length)throw new sjcl.exception.invalid("cbc can't authenticate data");if(128!==sjcl.bitArray.bitLength(iv))throw new sjcl.exception.invalid("cbc iv must be 128 bits");var i,w=sjcl.bitArray,xor=w._xor4,bl=w.bitLength(plaintext),bp=0,output=[];if(7&bl)throw new sjcl.exception.invalid("pkcs#5 padding only works for multiples of a byte");for(i=0;bp+128<=bl;i+=4,bp+=128)iv=prp.encrypt(xor(iv,plaintext.slice(i,i+4))),output.push(iv[0],iv[1],iv[2],iv[3]);return usePadding&&(bl=16843009*(16-(bl>>3&15)),iv=prp.encrypt(xor(iv,w.concat(plaintext,[bl,bl,bl,bl]).slice(i,i+4))),output.push(iv[0],iv[1],iv[2],iv[3])),output},decrypt:function(prp,ciphertext,iv,adata,usePadding){if(adata&&adata.length)throw new sjcl.exception.invalid("cbc can't authenticate data");if(128!==sjcl.bitArray.bitLength(iv))throw new sjcl.exception.invalid("cbc iv must be 128 bits");if(127&sjcl.bitArray.bitLength(ciphertext)||!ciphertext.length)throw new sjcl.exception.corrupt("cbc ciphertext must be a positive multiple of the block size");var i,bi,bo,w=sjcl.bitArray,xor=w._xor4,output=[];for(adata=adata||[],i=0;i<ciphertext.length;i+=4)bi=ciphertext.slice(i,i+4),bo=xor(iv,prp.decrypt(bi)),output.push(bo[0],bo[1],bo[2],bo[3]),iv=bi;if(usePadding){if(0===(bi=255&output[i-1])||bi>16)throw new sjcl.exception.corrupt("pkcs#5 padding corrupt");if(bo=16843009*bi,!w.equal(w.bitSlice([bo,bo,bo,bo],0,8*bi),w.bitSlice(output,32*output.length-8*bi,32*output.length)))throw new sjcl.exception.corrupt("pkcs#5 padding corrupt");return w.bitSlice(output,0,32*output.length-8*bi)}return output}},sjcl.mode.gcm={name:"gcm",encrypt:function(prf,plaintext,iv,adata,tlen){var out,data=plaintext.slice(0),w=sjcl.bitArray;return tlen=tlen||128,adata=adata||[],out=sjcl.mode.gcm._ctrMode(!0,prf,data,adata,iv,tlen),w.concat(out.data,out.tag)},decrypt:function(prf,ciphertext,iv,adata,tlen){var out,tag,data=ciphertext.slice(0),w=sjcl.bitArray,l=w.bitLength(data);if(adata=adata||[],(tlen=tlen||128)<=l?(tag=w.bitSlice(data,l-tlen),data=w.bitSlice(data,0,l-tlen)):(tag=data,data=[]),out=sjcl.mode.gcm._ctrMode(!1,prf,data,adata,iv,tlen),!w.equal(out.tag,tag))throw new sjcl.exception.corrupt("gcm: tag doesn't match");return out.data},_galoisMultiply:function(x,y){var i,j,Zi,Vi,lsb_Vi,xor=sjcl.bitArray._xor4;for(Zi=[0,0,0,0],Vi=y.slice(0),i=0;i<128;i++){for(0!=(x[Math.floor(i/32)]&1<<31-i%32)&&(Zi=xor(Zi,Vi)),lsb_Vi=0!=(1&Vi[3]),j=3;j>0;j--)Vi[j]=Vi[j]>>>1|(1&Vi[j-1])<<31;Vi[0]=Vi[0]>>>1,lsb_Vi&&(Vi[0]=Vi[0]^225<<24)}return Zi},_ghash:function(H,Y0,data){var Yi,i,l=data.length;for(Yi=Y0.slice(0),i=0;i<l;i+=4)Yi[0]^=4294967295&data[i],Yi[1]^=4294967295&data[i+1],Yi[2]^=4294967295&data[i+2],Yi[3]^=4294967295&data[i+3],Yi=sjcl.mode.gcm._galoisMultiply(Yi,H);return Yi},_ctrMode:function(encrypt,prf,data,adata,iv,tlen){var H,J0,S0,enc,i,ctr,tag,last,l,bl,abl,ivbl,w=sjcl.bitArray;for(l=data.length,bl=w.bitLength(data),abl=w.bitLength(adata),ivbl=w.bitLength(iv),H=prf.encrypt([0,0,0,0]),96===ivbl?(J0=iv.slice(0),J0=w.concat(J0,[1])):(J0=sjcl.mode.gcm._ghash(H,[0,0,0,0],iv),J0=sjcl.mode.gcm._ghash(H,J0,[0,0,Math.floor(ivbl/4294967296),4294967295&ivbl])),S0=sjcl.mode.gcm._ghash(H,[0,0,0,0],adata),ctr=J0.slice(0),tag=S0.slice(0),encrypt||(tag=sjcl.mode.gcm._ghash(H,S0,data)),i=0;i<l;i+=4)ctr[3]++,enc=prf.encrypt(ctr),data[i]^=enc[0],data[i+1]^=enc[1],data[i+2]^=enc[2],data[i+3]^=enc[3];return data=w.clamp(data,bl),encrypt&&(tag=sjcl.mode.gcm._ghash(H,S0,data)),last=[Math.floor(abl/4294967296),4294967295&abl,Math.floor(bl/4294967296),4294967295&bl],tag=sjcl.mode.gcm._ghash(H,tag,last),enc=prf.encrypt(J0),tag[0]^=enc[0],tag[1]^=enc[1],tag[2]^=enc[2],tag[3]^=enc[3],{tag:w.bitSlice(tag,0,tlen),data:data}}},sjcl.misc.hmac=function(key,Hash){this._hash=Hash=Hash||sjcl.hash.sha256;var i,exKey=[[],[]],bs=Hash.prototype.blockSize/32;for(this._baseHash=[new Hash,new Hash],key.length>bs&&(key=Hash.hash(key)),i=0;i<bs;i++)exKey[0][i]=909522486^key[i],exKey[1][i]=1549556828^key[i];this._baseHash[0].update(exKey[0]),this._baseHash[1].update(exKey[1]),this._resultHash=new Hash(this._baseHash[0])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(data){if(this._updated)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");return this.update(data),this.digest(data)},sjcl.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1},sjcl.misc.hmac.prototype.update=function(data){this._updated=!0,this._resultHash.update(data)},sjcl.misc.hmac.prototype.digest=function(){var w=this._resultHash.finalize(),result=new this._hash(this._baseHash[1]).update(w).finalize();return this.reset(),result},sjcl.prng=function(defaultParanoia){this._pools=[new sjcl.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=defaultParanoia,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80},sjcl.prng.prototype={randomWords:function(nwords,paranoia){var i,g,out=[],readiness=this.isReady(paranoia);if(readiness===this._NOT_READY)throw new sjcl.exception.notReady("generator isn't seeded");for(readiness&this._REQUIRES_RESEED&&this._reseedFromPools(!(readiness&this._READY)),i=0;i<nwords;i+=4)(i+1)%this._MAX_WORDS_PER_BURST==0&&this._gate(),g=this._gen4words(),out.push(g[0],g[1],g[2],g[3]);return this._gate(),out.slice(0,nwords)},setDefaultParanoia:function(paranoia,allowZeroParanoia){if(0===paranoia&&"Setting paranoia=0 will ruin your security; use it only for testing"!==allowZeroParanoia)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this._defaultParanoia=paranoia},addEntropy:function(data,estimatedEntropy,source){source=source||"user";var id,i,tmp,objName,t=(new Date).valueOf(),robin=this._robins[source],err=(this.isReady(),0);switch(void 0===(id=this._collectorIds[source])&&(id=this._collectorIds[source]=this._collectorIdNext++),void 0===robin&&(robin=this._robins[source]=0),this._robins[source]=(this._robins[source]+1)%this._pools.length,typeof data){case"number":void 0===estimatedEntropy&&(estimatedEntropy=1),this._pools[robin].update([id,this._eventId++,1,estimatedEntropy,t,1,0|data]);break;case"object":if("[object Uint32Array]"===(objName=Object.prototype.toString.call(data))){for(tmp=[],i=0;i<data.length;i++)tmp.push(data[i]);data=tmp}else for("[object Array]"!==objName&&(err=1),i=0;i<data.length&&!err;i++)"number"!=typeof data[i]&&(err=1);if(!err){if(void 0===estimatedEntropy)for(estimatedEntropy=0,i=0;i<data.length;i++)for(tmp=data[i];tmp>0;)estimatedEntropy++,tmp>>>=1;this._pools[robin].update([id,this._eventId++,2,estimatedEntropy,t,data.length].concat(data))}break;case"string":void 0===estimatedEntropy&&(estimatedEntropy=data.length),this._pools[robin].update([id,this._eventId++,3,estimatedEntropy,t,data.length]),this._pools[robin].update(data);break;default:err=1}if(err)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[robin]+=estimatedEntropy,this._poolStrength+=estimatedEntropy},isReady:function(paranoia){var entropyRequired=this._PARANOIA_LEVELS[void 0!==paranoia?paranoia:this._defaultParanoia];return this._strength&&this._strength>=entropyRequired?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=entropyRequired?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(paranoia){var entropyRequired=this._PARANOIA_LEVELS[paranoia||this._defaultParanoia];return this._strength>=entropyRequired?1:this._poolStrength>entropyRequired?1:this._poolStrength/entropyRequired},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else{if(!document.attachEvent)throw new sjcl.exception.bug("can't attach event");document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(name,callback){this._callbacks[name][this._callbackI++]=callback},removeEventListener:function(name,cb){var i,j,cbs=this._callbacks[name],jsTemp=[];for(j in cbs)cbs.hasOwnProperty(j)&&cbs[j]===cb&&jsTemp.push(j);for(i=0;i<jsTemp.length;i++)delete cbs[j=jsTemp[i]]},_bind:function(func){var that=this;return function(){func.apply(that,arguments)}},_gen4words:function(){for(var i=0;i<4&&(this._counter[i]=this._counter[i]+1|0,!this._counter[i]);i++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new sjcl.cipher.aes(this._key)},_reseed:function(seedWords){this._key=sjcl.hash.sha256.hash(this._key.concat(seedWords)),this._cipher=new sjcl.cipher.aes(this._key);for(var i=0;i<4&&(this._counter[i]=this._counter[i]+1|0,!this._counter[i]);i++);},_reseedFromPools:function(full){var i,reseedData=[],strength=0;for(this._nextReseed=reseedData[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,i=0;i<16;i++)reseedData.push(4294967296*Math.random()|0);for(i=0;i<this._pools.length&&(reseedData=reseedData.concat(this._pools[i].finalize()),strength+=this._poolEntropy[i],this._poolEntropy[i]=0,full||!(this._reseedCount&1<<i));i++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new sjcl.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=strength,strength>this._strength&&(this._strength=strength),this._reseedCount++,this._reseed(reseedData)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(ev){var x,y;try{x=ev.x||ev.clientX||ev.offsetX||0,y=ev.y||ev.clientY||ev.offsetY||0}catch(err){x=0,y=0}0!=x&&0!=y&&this.addEntropy([x,y],2,"mouse"),this._addCurrentTimeToEntropy(0)},_touchCollector:function(ev){var touch=ev.touches[0]||ev.changedTouches[0],x=touch.pageX||touch.clientX,y=touch.pageY||touch.clientY;this.addEntropy([x,y],1,"touch"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(estimatedEntropy){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?this.addEntropy(window.performance.now(),estimatedEntropy,"loadtime"):this.addEntropy((new Date).valueOf(),estimatedEntropy,"loadtime")},_accelerometerCollector:function(ev){var ac=ev.accelerationIncludingGravity.x||ev.accelerationIncludingGravity.y||ev.accelerationIncludingGravity.z;if(window.orientation){var or=window.orientation;"number"==typeof or&&this.addEntropy(or,1,"accelerometer")}ac&&this.addEntropy(ac,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(name,arg){var j,cbs=sjcl.random._callbacks[name],cbsTemp=[];for(j in cbs)cbs.hasOwnProperty(j)&&cbsTemp.push(cbs[j]);for(j=0;j<cbsTemp.length;j++)cbsTemp[j](arg)}},"undefined"==typeof ArrayBuffer&&function(globals){"use strict";globals.ArrayBuffer=function(){},globals.DataView=function(){}}(this),sjcl.codec.arrayBuffer={fromBits:function(arr,padding,padding_count){var out,i,ol,tmp,smallest;if(padding=null==padding||padding,padding_count=padding_count||8,0===arr.length)return new ArrayBuffer(0);if(ol=sjcl.bitArray.bitLength(arr)/8,sjcl.bitArray.bitLength(arr)%8!=0)throw new sjcl.exception.invalid("Invalid bit size, must be divisble by 8 to fit in an arraybuffer correctly");for(padding&&ol%padding_count!=0&&(ol+=padding_count-ol%padding_count),tmp=new DataView(new ArrayBuffer(4*arr.length)),i=0;i<arr.length;i++)tmp.setUint32(4*i,arr[i]<<32);if((out=new DataView(new ArrayBuffer(ol))).byteLength===tmp.byteLength)return tmp.buffer;for(smallest=tmp.byteLength<out.byteLength?tmp.byteLength:out.byteLength,i=0;i<smallest;i++)out.setUint8(i,tmp.getUint8(i));return out.buffer},toBits:function(buffer){var len,inView,tmp,out=[];if(0===buffer.byteLength)return[];len=(inView=new DataView(buffer)).byteLength-inView.byteLength%4;for(var i=0;i<len;i+=4)out.push(inView.getUint32(i));if(inView.byteLength%4!=0){tmp=new DataView(new ArrayBuffer(4));i=0;for(var l=inView.byteLength%4;i<l;i++)tmp.setUint8(i+4-l,inView.getUint8(len+i));out.push(sjcl.bitArray.partial(inView.byteLength%4*8,tmp.getUint32(0)))}return out},hexDumpBuffer:function(buffer){for(var n,width,stringBufferView=new DataView(buffer),string="",i=0;i<stringBufferView.byteLength;i+=2)i%16==0&&(string+="\n"+i.toString(16)+"\t"),string+=(n=stringBufferView.getUint16(i).toString(16),((n+="").length>=(width=4)?n:new Array(width-n.length+1).join("0")+n)+" ");void 0===typeof console&&(console=console||{log:function(){}}),console.log(string.toUpperCase())}},"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),System.registerDynamic("src/api/worker/crypto/lib/crypto-sjcl-1.0.7.js",[],!1,function($__require,$__exports,$__module){return function(){return sjcl}.call(this)}),System.register("src/api/worker/crypto/CryptoUtils.js",["../../common/utils/Encoding","../../common/utils/ArrayUtils","./Sha256","../../common/error/CryptoError","../../Env","../../worker/crypto/lib/crypto-sjcl-1.0.7"],function(_export,_context){"use strict";var base64ToBase64Url,base64ToUint8Array,hexToUint8Array,uint8ArrayToArrayBuffer,uint8ArrayToBase64,concat,hash,CryptoError,assertWorkerOrNode,sjcl,PADDING_BLOCK_LENGTH,fixedIv;function createAuthVerifier(passwordKey){return hash(bitArrayToUint8Array(passwordKey))}function bitArrayToUint8Array(bits){return new Uint8Array(sjcl.codec.arrayBuffer.fromBits(bits,!1))}function keyToBase64(key){return sjcl.codec.base64.fromBits(key)}function base64ToKey(base64){try{return sjcl.codec.base64.toBits(base64)}catch(e){throw new CryptoError("hex to aes key failed",e)}}return _export("pad",function(bytes){var paddingLength=PADDING_BLOCK_LENGTH-bytes.byteLength%PADDING_BLOCK_LENGTH,padding=new Uint8Array(paddingLength);return padding.fill(paddingLength),concat(bytes,padding)}),_export("unpad",function(bytes){var paddingLength=bytes[bytes.byteLength-1];if(0===paddingLength||paddingLength>bytes.byteLength||paddingLength>PADDING_BLOCK_LENGTH)throw new CryptoError("invalid padding: "+paddingLength);var length=bytes.byteLength-paddingLength,result=new Uint8Array(length);return result.set(bytes.subarray(0,length)),result}),_export("createAuthVerifier",createAuthVerifier),_export("createAuthVerifierAsBase64Url",function(passwordKey){return base64ToBase64Url(uint8ArrayToBase64(createAuthVerifier(passwordKey)))}),_export("checkIs128BitKey",function(key){var bitLength=sjcl.bitArray.bitLength(key);if(128===bitLength)return!0;if(256===bitLength)return!1;throw new CryptoError("invalid key bit length: "+bitLength)}),_export("bitArrayToUint8Array",bitArrayToUint8Array),_export("uint8ArrayToBitArray",function(uint8Array){return sjcl.codec.arrayBuffer.toBits(uint8ArrayToArrayBuffer(uint8Array))}),_export("keyToBase64",keyToBase64),_export("base64ToKey",base64ToKey),_export("uint8ArrayToKey",function(array){return base64ToKey(uint8ArrayToBase64(array))}),_export("keyToUint8Array",function(key){return base64ToUint8Array(keyToBase64(key))}),{setters:[function(_commonUtilsEncoding){base64ToBase64Url=_commonUtilsEncoding.base64ToBase64Url,base64ToUint8Array=_commonUtilsEncoding.base64ToUint8Array,hexToUint8Array=_commonUtilsEncoding.hexToUint8Array,uint8ArrayToArrayBuffer=_commonUtilsEncoding.uint8ArrayToArrayBuffer,uint8ArrayToBase64=_commonUtilsEncoding.uint8ArrayToBase64},function(_commonUtilsArrayUtils){concat=_commonUtilsArrayUtils.concat},function(_Sha){hash=_Sha.hash},function(_commonErrorCryptoError){CryptoError=_commonErrorCryptoError.CryptoError},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_workerCryptoLibCryptoSjcl){sjcl=_workerCryptoLibCryptoSjcl.default}],execute:function(){assertWorkerOrNode(),PADDING_BLOCK_LENGTH=16,_export("fixedIv",fixedIv=hexToUint8Array("88888888888888888888888888888888")),_export("fixedIv",fixedIv)}}}),System.register("src/api/entities/tutanota/GroupInvitationPostData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,GroupInvitationPostDataTypeRef,_TypeModel;return _export("createGroupInvitationPostData",function(values){return Object.assign(create(_TypeModel,GroupInvitationPostDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("GroupInvitationPostDataTypeRef",GroupInvitationPostDataTypeRef=new TypeRef("tutanota","GroupInvitationPostData")),_export("GroupInvitationPostDataTypeRef",GroupInvitationPostDataTypeRef),_export("_TypeModel",_TypeModel={name:"GroupInvitationPostData",since:38,type:"DATA_TRANSFER_TYPE",id:1002,rootId:"CHR1dGFub3RhAAPq",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1003,since:38,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{internalKeyData:{name:"internalKeyData",id:1005,since:38,type:"AGGREGATION",cardinality:"Any",refType:"InternalRecipientKeyData",final:!1},sharedGroupData:{name:"sharedGroupData",id:1004,since:38,type:"AGGREGATION",cardinality:"One",refType:"SharedGroupData",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/GroupInvitationPutData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,GroupInvitationPutDataTypeRef,_TypeModel;return _export("createGroupInvitationPutData",function(values){return Object.assign(create(_TypeModel,GroupInvitationPutDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("GroupInvitationPutDataTypeRef",GroupInvitationPutDataTypeRef=new TypeRef("tutanota","GroupInvitationPutData")),_export("GroupInvitationPutDataTypeRef",GroupInvitationPutDataTypeRef),_export("_TypeModel",_TypeModel={name:"GroupInvitationPutData",since:38,type:"DATA_TRANSFER_TYPE",id:1011,rootId:"CHR1dGFub3RhAAPz",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1012,since:38,type:"Number",cardinality:"One",final:!1,encrypted:!1},sharedGroupEncInviteeGroupInfoKey:{name:"sharedGroupEncInviteeGroupInfoKey",id:1014,since:38,type:"Bytes",cardinality:"One",final:!0,encrypted:!1},userGroupEncGroupKey:{name:"userGroupEncGroupKey",id:1013,since:38,type:"Bytes",cardinality:"One",final:!0,encrypted:!1}},associations:{receivedInvitation:{name:"receivedInvitation",id:1015,since:38,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"ReceivedGroupInvitation",final:!1,external:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/GroupInvitationDeleteData.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,GroupInvitationDeleteDataTypeRef,_TypeModel;return _export("createGroupInvitationDeleteData",function(values){return Object.assign(create(_TypeModel,GroupInvitationDeleteDataTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("GroupInvitationDeleteDataTypeRef",GroupInvitationDeleteDataTypeRef=new TypeRef("tutanota","GroupInvitationDeleteData")),_export("GroupInvitationDeleteDataTypeRef",GroupInvitationDeleteDataTypeRef),_export("_TypeModel",_TypeModel={name:"GroupInvitationDeleteData",since:38,type:"DATA_TRANSFER_TYPE",id:1016,rootId:"CHR1dGFub3RhAAP4",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1017,since:38,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{receivedInvitation:{name:"receivedInvitation",id:1018,since:38,type:"LIST_ELEMENT_ASSOCIATION",cardinality:"One",refType:"ReceivedGroupInvitation",final:!1,external:!0}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/entities/tutanota/GroupInvitationPostReturn.js",["../../common/EntityFunctions"],function(_export,_context){"use strict";var create,TypeRef,GroupInvitationPostReturnTypeRef,_TypeModel;return _export("createGroupInvitationPostReturn",function(values){return Object.assign(create(_TypeModel,GroupInvitationPostReturnTypeRef),values)}),{setters:[function(_commonEntityFunctions){create=_commonEntityFunctions.create,TypeRef=_commonEntityFunctions.TypeRef}],execute:function(){_export("GroupInvitationPostReturnTypeRef",GroupInvitationPostReturnTypeRef=new TypeRef("tutanota","GroupInvitationPostReturn")),_export("GroupInvitationPostReturnTypeRef",GroupInvitationPostReturnTypeRef),_export("_TypeModel",_TypeModel={name:"GroupInvitationPostReturn",since:38,type:"DATA_TRANSFER_TYPE",id:1006,rootId:"CHR1dGFub3RhAAPu",versioned:!1,encrypted:!1,values:{_format:{name:"_format",id:1007,since:38,type:"Number",cardinality:"One",final:!1,encrypted:!1}},associations:{existingMailAddresses:{name:"existingMailAddresses",id:1008,since:38,type:"AGGREGATION",cardinality:"Any",refType:"MailAddress",final:!1},invalidMailAddresses:{name:"invalidMailAddresses",id:1009,since:38,type:"AGGREGATION",cardinality:"Any",refType:"MailAddress",final:!1},invitedMailAddresses:{name:"invitedMailAddresses",id:1010,since:38,type:"AGGREGATION",cardinality:"Any",refType:"MailAddress",final:!1}},app:"tutanota",version:"39"}),_export("_TypeModel",_TypeModel)}}}),System.register("src/api/worker/facades/ShareFacade.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../../Env","../EntityWorker","../../entities/tutanota/Services","../crypto/CryptoFacade","../../entities/sys/GroupInfo","../crypto/Aes","../../entities/tutanota/SharedGroupData","../../common/EntityFunctions","../../common/utils/Utils","./ReceipientKeyDataUtils","../../common/error/RecipientsNotFoundError","./LoginFacade","../crypto/CryptoUtils","../../entities/tutanota/GroupInvitationPostData","../../entities/tutanota/GroupInvitationPutData","../../entities/tutanota/GroupInvitationDeleteData","../../entities/tutanota/GroupInvitationPostReturn"],function(_export,_context){"use strict";var _classCallCheck,_createClass,assertWorkerOrNode,serviceRequest,serviceRequestVoid,TutanotaService,encryptBytes,encryptKey,encryptString,resolveSessionKey,GroupInfoTypeModel,aes128RandomKey,createSharedGroupData,HttpMethod,neverNull,encryptBucketKeyForInternalRecipient,RecipientsNotFoundError,bitArrayToUint8Array,uint8ArrayToBitArray,createGroupInvitationPostData,createGroupInvitationPutData,createGroupInvitationDeleteData,GroupInvitationPostReturnTypeRef,ShareFacade;return{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_EntityWorker){serviceRequest=_EntityWorker.serviceRequest,serviceRequestVoid=_EntityWorker.serviceRequestVoid},function(_entitiesTutanotaServices){TutanotaService=_entitiesTutanotaServices.TutanotaService},function(_cryptoCryptoFacade){encryptBytes=_cryptoCryptoFacade.encryptBytes,encryptKey=_cryptoCryptoFacade.encryptKey,encryptString=_cryptoCryptoFacade.encryptString,resolveSessionKey=_cryptoCryptoFacade.resolveSessionKey},function(_entitiesSysGroupInfo){GroupInfoTypeModel=_entitiesSysGroupInfo._TypeModel},function(_cryptoAes){aes128RandomKey=_cryptoAes.aes128RandomKey},function(_entitiesTutanotaSharedGroupData){createSharedGroupData=_entitiesTutanotaSharedGroupData.createSharedGroupData},function(_commonEntityFunctions){HttpMethod=_commonEntityFunctions.HttpMethod},function(_commonUtilsUtils){neverNull=_commonUtilsUtils.neverNull},function(_ReceipientKeyDataUtils){encryptBucketKeyForInternalRecipient=_ReceipientKeyDataUtils.encryptBucketKeyForInternalRecipient},function(_commonErrorRecipientsNotFoundError){RecipientsNotFoundError=_commonErrorRecipientsNotFoundError.RecipientsNotFoundError},function(_LoginFacade){_LoginFacade.LoginFacade},function(_cryptoCryptoUtils){bitArrayToUint8Array=_cryptoCryptoUtils.bitArrayToUint8Array,uint8ArrayToBitArray=_cryptoCryptoUtils.uint8ArrayToBitArray},function(_entitiesTutanotaGroupInvitationPostData){createGroupInvitationPostData=_entitiesTutanotaGroupInvitationPostData.createGroupInvitationPostData},function(_entitiesTutanotaGroupInvitationPutData){createGroupInvitationPutData=_entitiesTutanotaGroupInvitationPutData.createGroupInvitationPutData},function(_entitiesTutanotaGroupInvitationDeleteData){createGroupInvitationDeleteData=_entitiesTutanotaGroupInvitationDeleteData.createGroupInvitationDeleteData},function(_entitiesTutanotaGroupInvitationPostReturn){GroupInvitationPostReturnTypeRef=_entitiesTutanotaGroupInvitationPostReturn.GroupInvitationPostReturnTypeRef}],execute:function(){assertWorkerOrNode(),_export("ShareFacade",ShareFacade=function(){function ShareFacade(loginFacade){_classCallCheck(this,ShareFacade),this._loginFacade=loginFacade}return _createClass(ShareFacade,[{key:"sendGroupInvitation",value:function(sharedGroupInfo,sharedGroupName,recipients,shareCapability){var _this=this,sharedGroupKey=this._loginFacade.getGroupKey(sharedGroupInfo.group);return resolveSessionKey(GroupInfoTypeModel,this._loginFacade.getUserGroupInfo()).then(function(userGroupInfoSessionKey){return resolveSessionKey(GroupInfoTypeModel,sharedGroupInfo).then(function(sharedGroupInfoSessionKey){var bucketKey=aes128RandomKey(),invitationSessionKey=aes128RandomKey(),sharedGroupData=createSharedGroupData({sessionEncInviterName:encryptString(invitationSessionKey,_this._loginFacade.getUserGroupInfo().name),sessionEncSharedGroupKey:encryptBytes(invitationSessionKey,bitArrayToUint8Array(sharedGroupKey)),sessionEncSharedGroupName:encryptString(invitationSessionKey,sharedGroupName),bucketEncInvitationSessionKey:encryptKey(bucketKey,invitationSessionKey),sharedGroupEncInviterGroupInfoKey:encryptKey(sharedGroupKey,neverNull(userGroupInfoSessionKey)),sharedGroupEncSharedGroupInfoKey:encryptKey(sharedGroupKey,neverNull(sharedGroupInfoSessionKey)),capability:shareCapability,sharedGroup:sharedGroupInfo.group}),invitationData=createGroupInvitationPostData({sharedGroupData:sharedGroupData,internalKeyData:[]}),notFoundRecipients=[];return Promise.each(recipients,function(recipient){return encryptBucketKeyForInternalRecipient(bucketKey,recipient,notFoundRecipients).then(function(keyData){keyData&&invitationData.internalKeyData.push(keyData)})}).then(function(){if(notFoundRecipients.length>0)throw new RecipientsNotFoundError(notFoundRecipients);return serviceRequest(TutanotaService.GroupInvitationService,HttpMethod.POST,invitationData,GroupInvitationPostReturnTypeRef)})})})}},{key:"acceptGroupInvitation",value:function(invitation){var _this2=this;return resolveSessionKey(GroupInfoTypeModel,this._loginFacade.getUserGroupInfo()).then(function(userGroupInfoSessionKey){var sharedGroupKey=uint8ArrayToBitArray(invitation.sharedGroupKey),serviceData=createGroupInvitationPutData();return serviceData.receivedInvitation=invitation._id,serviceData.userGroupEncGroupKey=encryptKey(_this2._loginFacade.getUserGroupKey(),sharedGroupKey),serviceData.sharedGroupEncInviteeGroupInfoKey=encryptKey(sharedGroupKey,neverNull(userGroupInfoSessionKey)),serviceRequestVoid(TutanotaService.GroupInvitationService,HttpMethod.PUT,serviceData)})}},{key:"rejectGroupInvitation",value:function(receivedGroupInvitaitonId){var serviceData=createGroupInvitationDeleteData({receivedInvitation:receivedGroupInvitaitonId});return serviceRequestVoid(TutanotaService.GroupInvitationService,HttpMethod.DELETE,serviceData)}}]),ShareFacade}()),_export("ShareFacade",ShareFacade)}}}),System.register("src/api/worker/WorkerLocator.js",["./facades/LoginFacade","./WorkerImpl","@hot","./search/Indexer","./rest/EntityRestClient","./facades/UserManagementFacade","./rest/EntityRestCache","./facades/GroupManagementFacade","./facades/MailFacade","./facades/MailAddressFacade","./facades/FileFacade","./search/SearchFacade","./facades/CustomerFacade","./facades/CounterFacade","./EventBusClient","../Env","../common/TutanotaConstants","./facades/CalendarFacade","./facades/ShareFacade"],function(_export,_context){"use strict";var LoginFacade,replaced,Indexer,EntityRestClient,UserManagementFacade,EntityRestCache,GroupManagementFacade,MailFacade,MailAddressFacade,FileFacade,SearchFacade,CustomerFacade,CounterFacade,EventBusClient,assertWorkerOrNode,isAdminClient,CloseEventBusOption,Const,CalendarFacade,ShareFacade,locator;function initLocator(worker,browserData){var restClient=new EntityRestClient(function(){return locator.login.createAuthHeaders()});locator._browserData=browserData;var cache=new EntityRestCache(restClient);locator.cache=isAdminClient()?restClient:cache,locator.indexer=new Indexer(restClient,worker,browserData,locator.cache),locator.login=new LoginFacade(worker);var suggestionFacades=[locator.indexer._contact.suggestionFacade,locator.indexer._groupInfo.suggestionFacade,locator.indexer._whitelabelChildIndexer.suggestionFacade];locator.search=new SearchFacade(locator.login,locator.indexer.db,locator.indexer._mail,suggestionFacades,browserData),locator.counters=new CounterFacade,locator.groupManagement=new GroupManagementFacade(locator.login,locator.counters),locator.userManagement=new UserManagementFacade(worker,locator.login,locator.groupManagement,locator.counters),locator.customer=new CustomerFacade(worker,locator.login,locator.groupManagement,locator.userManagement,locator.counters),locator.file=new FileFacade(locator.login),locator.mail=new MailFacade(locator.login,locator.file),locator.calendar=new CalendarFacade(locator.login,locator.userManagement,cache),locator.mailAddress=new MailAddressFacade(locator.login),locator.eventBusClient=new EventBusClient(worker,locator.indexer,locator.cache,locator.mail,locator.login),locator.login.init(locator.indexer,locator.eventBusClient),locator.Const=Const,locator.share=new ShareFacade(locator.login)}return _export("initLocator",initLocator),_export("resetLocator",function(){return locator.login.reset().then(function(){return initLocator(locator.login._worker,locator._browserData)})}),{setters:[function(_facadesLoginFacade){LoginFacade=_facadesLoginFacade.LoginFacade},function(_WorkerImpl){_WorkerImpl.WorkerImpl},function(_hot){replaced=_hot.module},function(_searchIndexer){Indexer=_searchIndexer.Indexer},function(_restEntityRestClient){EntityRestClient=_restEntityRestClient.EntityRestClient},function(_facadesUserManagementFacade){UserManagementFacade=_facadesUserManagementFacade.UserManagementFacade},function(_restEntityRestCache){EntityRestCache=_restEntityRestCache.EntityRestCache},function(_facadesGroupManagementFacade){GroupManagementFacade=_facadesGroupManagementFacade.GroupManagementFacade},function(_facadesMailFacade){MailFacade=_facadesMailFacade.MailFacade},function(_facadesMailAddressFacade){MailAddressFacade=_facadesMailAddressFacade.MailAddressFacade},function(_facadesFileFacade){FileFacade=_facadesFileFacade.FileFacade},function(_searchSearchFacade){SearchFacade=_searchSearchFacade.SearchFacade},function(_facadesCustomerFacade){CustomerFacade=_facadesCustomerFacade.CustomerFacade},function(_facadesCounterFacade){CounterFacade=_facadesCounterFacade.CounterFacade},function(_EventBusClient){EventBusClient=_EventBusClient.EventBusClient},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode,isAdminClient=_Env.isAdminClient},function(_commonTutanotaConstants){CloseEventBusOption=_commonTutanotaConstants.CloseEventBusOption,Const=_commonTutanotaConstants.Const},function(_facadesCalendarFacade){CalendarFacade=_facadesCalendarFacade.CalendarFacade},function(_facadesShareFacade){ShareFacade=_facadesShareFacade.ShareFacade}],execute:function(){assertWorkerOrNode(),_export("locator",locator={}),_export("locator",locator),"undefined"!=typeof self&&(self.locator=locator),replaced&&(replaced.locator.login&&(Object.assign(locator.login,replaced.locator.login),locator.login._eventBusClient._socket&&locator.login._eventBusClient._socket.close&&locator.login._eventBusClient.close(CloseEventBusOption.Reconnect),locator.login.isLoggedIn()&&locator.login._eventBusClient.connect(!1)),replaced.locator.indexer&&Object.assign(locator.indexer,replaced.locator.indexer),replaced.locator.search&&Object.assign(locator.search,replaced.locator.search))}}}),System.register("src/api/worker/EntityWorker.js",["node_modules/systemjs-plugin-babel/babel-helpers/classCallCheck.js","node_modules/systemjs-plugin-babel/babel-helpers/createClass.js","../common/EntityFunctions","./rest/ServiceRestClient","../entities/sys/RootInstance","../Env","./WorkerLocator"],function(_export,_context){"use strict";var _classCallCheck,_createClass,_eraseEntity,_loadEntity,_loadEntityRange,_loadMultipleEntities,_loadReverseRangeBetween,_setupEntity,_updateEntity,GENERATED_MIN_ID,getLetId,resolveTypeReference,_service,RootInstanceTypeRef,assertWorkerOrNode,locator,RANGE_ITEM_LIMIT,EntityWorker;function _loadAll(typeRef,listId,start,target){return _loadEntityRange(typeRef,listId,start,RANGE_ITEM_LIMIT,!1,target).then(function(elements){if(elements.length===RANGE_ITEM_LIMIT){var lastElementId=getLetId(elements[elements.length-1])[1];return _loadAll(typeRef,listId,lastElementId,target).then(function(nextElements){return elements.concat(nextElements)})}return Promise.resolve(elements)})}function _loadRoot(typeRef,groupId,target){return resolveTypeReference(typeRef).then(function(typeModel){var rootId=[groupId,typeModel.rootId];return _loadEntity(RootInstanceTypeRef,rootId,null,target).then(function(root){return _loadEntity(typeRef,root.reference,null,target)})})}return _export("setup",function(listId,instance,extraHeaders){return _setupEntity(listId,instance,locator.cache,extraHeaders)}),_export("update",function(instance){return _updateEntity(instance,locator.cache)}),_export("erase",function(instance){return _eraseEntity(instance,locator.cache)}),_export("load",function(typeRef,id,queryParams,extraHeaders){return _loadEntity(typeRef,id,queryParams,locator.cache,extraHeaders)}),_export("loadMultiple",function(typeRef,listId,elementIds){return _loadMultipleEntities(typeRef,listId,elementIds,locator.cache)}),_export("loadRange",function(typeRef,listId,start,count,reverse){return _loadEntityRange(typeRef,listId,start,count,reverse,locator.cache)}),_export("loadAll",function(typeRef,listId,start){return _loadAll(typeRef,listId,start||GENERATED_MIN_ID,locator.cache)}),_export("loadReverseRangeBetween",function(typeRef,listId,start,end){var rangeItemLimit=arguments.length>4&&void 0!==arguments[4]?arguments[4]:RANGE_ITEM_LIMIT;return _loadReverseRangeBetween(typeRef,listId,start,end,locator.cache,rangeItemLimit)}),_export("loadRoot",function(typeRef,groupId){return _loadRoot(typeRef,groupId,locator.cache)}),_export("serviceRequest",function(service,method,requestEntity,responseTypeRef,queryParams,sk,extraHeaders){return _service(service,method,requestEntity,responseTypeRef,queryParams,sk,extraHeaders)}),_export("serviceRequestVoid",function(service,method,requestEntity,queryParams,sk,extraHeaders){return _service(service,method,requestEntity,null,queryParams,sk,extraHeaders)}),{setters:[function(_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs){_classCallCheck=_node_modulesSystemjsPluginBabelBabelHelpersClassCallCheckJs.default},function(_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs){_createClass=_node_modulesSystemjsPluginBabelBabelHelpersCreateClassJs.default},function(_commonEntityFunctions){_eraseEntity=_commonEntityFunctions._eraseEntity,_loadEntity=_commonEntityFunctions._loadEntity,_loadEntityRange=_commonEntityFunctions._loadEntityRange,_loadMultipleEntities=_commonEntityFunctions._loadMultipleEntities,_loadReverseRangeBetween=_commonEntityFunctions._loadReverseRangeBetween,_setupEntity=_commonEntityFunctions._setupEntity,_updateEntity=_commonEntityFunctions._updateEntity,GENERATED_MIN_ID=_commonEntityFunctions.GENERATED_MIN_ID,getLetId=_commonEntityFunctions.getLetId,resolveTypeReference=_commonEntityFunctions.resolveTypeReference,_commonEntityFunctions.TypeRef},function(_restServiceRestClient){_service=_restServiceRestClient._service},function(_entitiesSysRootInstance){RootInstanceTypeRef=_entitiesSysRootInstance.RootInstanceTypeRef},function(_Env){assertWorkerOrNode=_Env.assertWorkerOrNode},function(_WorkerLocator){locator=_WorkerLocator.locator}],execute:function(){assertWorkerOrNode(),RANGE_ITEM_LIMIT=1e3,_export("EntityWorker",EntityWorker=function(){function EntityWorker(target){_classCallCheck(this,EntityWorker),this._target=target}return _createClass(EntityWorker,[{key:"load",value:function(typeRef,id,queryParams,extraHeaders){return _loadEntity(typeRef,id,queryParams,this._target,extraHeaders)}},{key:"loadRoot",value:function(typeRef,groupId){return _loadRoot(typeRef,groupId,this._target)}},{key:"loadAll",value:function(typeRef,listId,start){return _loadAll(typeRef,listId,null==start?GENERATED_MIN_ID:start,this._target)}},{key:"loadReverseRangeBetween",value:function(typeRef,listId,start,end){var rangeItemLimit=arguments.length>4&&void 0!==arguments[4]?arguments[4]:RANGE_ITEM_LIMIT;return _loadReverseRangeBetween(typeRef,listId,start,end,this._target,rangeItemLimit)}},{key:"loadRange",value:function(typeRef,listId,start,count,reverse){return _loadEntityRange(typeRef,listId,start,count,reverse,this._target)}},{key:"loadMultipleEntities",value:function(typeRef,listId,elementIds){return _loadMultipleEntities(typeRef,listId,elementIds,this._target)}}]),EntityWorker}()),_export("EntityWorker",EntityWorker)}}}),System.register("src/system-resolve.js",[],function(_export,_context){"use strict";var resolve;return{setters:[],execute:function(){_export("a",""),_export("a",""),env.dist&&(System.__proto__.getConfig=function(){return System[Object.getOwnPropertySymbols(System)[1]]}),resolve=System.__proto__.resolve,System.__proto__.resolve=function(key,parent){var config=System.getConfig();return"@empty"===config.map[key]?Promise.resolve(config.map[key]):(0!==key.indexOf("core-js")&&null!=config.map[key]||key.indexOf(".js")===key.length-".js".length||(key+=".js"),resolve.apply(System,[key,parent]))}.bind(System)}}});
//# sourceMappingURL=worker.js.map